require=function t(e,i,s){function o(r,a){if(!i[r]){if(!e[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(n)return n(r,!0);throw new Error("Cannot find module '"+r+"'")}var h=i[r]={exports:{}};e[r][0].call(h.exports,function(t){var i=e[r][1][t];return o(i?i:t)},h,h.exports,t,e,i,s)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<s.length;r++)o(s[r]);return o}({1:[function(t,e){"use strict";var i=t("prima/bootloader"),s=t("prima/lib/domeventor"),o=t("prima/lib/logger"),n=i.extend({setup:function(){i.prototype.setup.apply(this,arguments),s.init(),o.log("Exec","Bootstrap/DOMEventor"),o.log("Exec","Bootstrap/Legacy"),t("./legacy")},initialize:function(){this.context=new(t("context"))}});e.exports=n},{"./legacy":208,context:"6dWAyf","prima/bootloader":257,"prima/lib/domeventor":265,"prima/lib/logger":268}],2:[function(t,e){var i=t("prima/collection"),s=t("../models/tumblelog"),o=i.extend({model:s});e.exports=o},{"../models/tumblelog":212,"prima/collection":259}],3:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/blog_card_view"),n=s.extend({name:"BlogCard",defaults:{compact:!0,highlighted_posts:!0},initialize:function(t){this.options=i.extend({},this.defaults,t)},getView:function(t,e){var s=i.extend({model:t},this.defauts,e);return new o(s)}});e.exports=new n},{"./views/blog_card_view":7,lodash:"K2RcUv","prima/component":260}],4:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";var is_popover="boolean"==typeof popover?popover:!1,has_avatar=avatar_url&&global_theme_params.show_avatar,has_bg_img=global_theme_params.header_image_focused&&global_theme_params.show_header_image,has_title=title&&global_theme_params.show_title,has_description=description_sanitized&&global_theme_params.show_description,expanded_name=cname?cname:name+".tumblr.com",description_color=title_color_rgb?"rgba("+title_color_rgb+",0.7)":global_theme_params.title_color,header_class=global_theme_params.header_stretch?"":" no_stretch_header";header_class+=has_bg_img?"":" no_header_image",header_class+=has_avatar?"":" no_avatar",header_class+=!has_bg_img||has_avatar||has_title||has_description?"":" header_image_only",header_class+=has_title||has_description?" has_info":" no_info",__p+='<div class="indash_header_wrapper '+(null==(__t=header_class)?"":__t)+" tumblelog_name_"+(null==(__t=name)?"":_.escape(__t))+'" style="background-color:'+(null==(__t=global_theme_params.background_color)?"":__t)+"; color:"+(null==(__t=global_theme_params.title_color)?"":__t)+'">',show_navigation&&(__p+='<div class="navigation"><div class="navigation_bg" style="background-color: '+(null==(__t=global_theme_params.background_color)?"":__t)+'"></div><div class="navigation_inner">',"undefined"!==name&&(__p+='<h3><a href="'+(null==(__t=url)?"":__t)+'" target="_blank" class="blog_name"><span class="name">'+(null==(__t=name)?"":_.escape(__t))+'</span> <span class="full_url">'+(null==(__t=expanded_name)?"":_.escape(__t))+"</span></a></h3>"),__p+="",show_share_controls&&(__p+='<a class="open_blog_button nav_icon icon_export"></a>'),__p+="",!customizable&&show_user_controls&&(__p+=' <a class="info_popover_button nav_icon user_dropdown_lockup"><i class="user_dropdown_icon user_dropdown_icon_user icon_user_settings"></i> <i class="user_dropdown_icon user_dropdown_icon_arrow icon_arrow_carrot_down"></i></a>'),__p+="",!customizable&&show_follow_button&&(__p+="",__p+=following?' <button class="chrome unfollow" type="button">Unfollow</button> <button class="chrome follow" type="button" style="display:none">Follow</button>':' <button class="chrome unfollow" type="button" style="display:none">Unfollow</button> <button class="chrome follow" type="button">Follow</button>',__p+=""),__p+="</div></div>"),__p+="",global_theme_params.header_image_focused&&global_theme_params.show_header_image&&(__p+='<div class="header_image_wrapper',has_avatar&&(__p+=" has_avatar"),__p+='"><div class="header_image" style="background-image:url('+(null==(__t=global_theme_params.header_image_focused)?"":__t)+')">',__p+=is_popover||!customizable?'<a href="'+(null==(__t=url)?"":__t)+'" target="_blank"><img src="'+(null==(__t=global_theme_params.header_image_focused)?"":__t)+'" alt="'+(null==(__t=title)?"":_.escape(__t))+'"></a>':' <img src="'+(null==(__t=global_theme_params.header_image_focused)?"":__t)+'" alt="">',__p+="</div></div>"),__p+="",avatar_url&&global_theme_params.show_avatar&&(__p+='<div class="avatar '+(null==(__t=global_theme_params.avatar_shape)?"":__t)+'" style="background-color:'+(null==(__t=global_theme_params.background_color)?"":__t)+"; background-image:url("+(null==(__t=avatar_url)?"":__t)+"); color:"+(null==(__t=global_theme_params.background_color)?"":__t)+'">',__p+=is_popover||!customizable?'<a href="'+(null==(__t=url)?"":__t)+'" target="_blank"><img src="'+(null==(__t=avatar_url)?"":__t)+'" alt="'+(null==(__t=title)?"":_.escape(__t))+'"></a>':' <img src="'+(null==(__t=avatar_url)?"":__t)+'" alt="">',__p+="</div>"),__p+="",(has_title||has_description)&&(__p+='<div class="info_wrapper"><div class="info">',has_title&&(__p+='<h1 class="title" style="font-family:'+(null==(__t=title_font_family||"inherit")?"":__t)+"; font-weight:"+(null==(__t=global_theme_params.title_font_weight)?"":__t)+'">'+(null==(__t=title)?"":_.escape(__t))+"</h1>"),__p+="",has_description&&(__p+='<div class="description" style="color:'+(null==(__t=description_color)?"":__t)+'"><div class="description_inner">'+(null==(__t=description_sanitized)?"":__t)+"</div></div>"),__p+="</div></div>"),__p+="</div>"}return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],5:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";var color="undefined"!=typeof loader_color?loader_color:"#D9D9D9";__p+='<div class="Knight-Rider-loader centered animate"><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div></div>'}return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],6:[function(t,e){"use strict";var i={"1785 GLC Baskerville":{display_name:"1785 Baskerville",family:"'1785 GLC Baskerville', serif",path:"1785glcbaskerville",_v:"1"},"Alternate Gothic":{display_name:"Alternate Gothic",family:"'Alternate Gothic', sans-serif",path:"alternategothic",_v:"3"},Arquitecta:{display_name:"Arquitecta",family:"'Arquitecta', sans-serif",path:"arquitecta",_v:"3"},Avalon:{display_name:"Avalon",family:"'Avalon', sans-serif",path:"avalon",_v:"1"},Baskerville:{display_name:"Baskerville",family:"Baskerville, 'Times New Roman', Times, serif"},"Bodoni Recut FS":{display_name:"Bodoni",family:"'Bodoni Recut FS', serif",path:"bodonirecutfs",_v:"3"},Bookmania:{display_name:"Bookmania",family:"'Bookmania', serif",path:"bookmania",_v:"1"},"Brutal Type":{display_name:"Brutal Type",family:"'Brutal Type', sans-serif",path:"brutaltype",_v:"1"},Calluna:{display_name:"Calluna",family:"'Calluna', serif",path:"calluna",_v:"3"},"Calluna Sans":{display_name:"Calluna Sans",family:"'Calluna Sans', sans-serif",path:"callunasans",_v:"3"},Capita:{display_name:"Capita",family:"'Capita', serif",path:"capita",_v:"1"},"Caslon FS":{display_name:"Caslon FS",family:"'Caslon FS', serif",path:"caslonfs",_v:"3"},"Clarendon Text Pro":{display_name:"Clarendon",family:"'Clarendon Text Pro', serif",path:"clarendontextpro",_v:"3"},"Clearface FS":{display_name:"Clearface",family:"'Clearface FS', serif",path:"clearface",_v:"4"},"Courier New":{display_name:"Courier New",family:"'Courier New', Courier, monospace"},Futura:{display_name:"Futura",family:"Futura, 'Century Gothic', AppleGothic, sans-serif"},"Garamond Classic FS":{display_name:"Garamond",family:"'Garamond Classic FS', serif",path:"garamondclassicfs",_v:"3"},Georgia:{display_name:"Georgia",family:"Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif"},Gibson:{display_name:"Gibson",family:"'Gibson', sans-serif",path:"gibson",_v:"3"},"Grumpy Black 48":{display_name:"Grumpy",family:"'Grumpy Black 48', serif",path:"grumpyblack48",_v:"3"},"Helvetica Neue":{display_name:"Helvetica",family:"'Helvetica Neue', Arial, Helvetica, sans-serif"},"Lorimer No 2":{display_name:"Lorimer No 2",family:"'Lorimer No 2', sans-serif",path:"lorimerno2",_v:"3"},"Lucida Sans":{display_name:"Lucida Sans",family:"'Lucida Sans', 'Lucida Grande', 'Lucida Sans Unicode', sans-serif"},"News Gothic FS":{display_name:"News Gothic",family:"'News Gothic FS', sans-serif",path:"newsgothicfs",_v:"3"},"Pratt Pro":{display_name:"Pratt Pro",family:"'Pratt Pro', serif",path:"prattpro",_v:"1"},Quadrat:{display_name:"Quadrat",family:"'Quadrat', serif",path:"quadrat",_v:"1"},"Sofia Pro":{display_name:"Sofia Pro",family:"'Sofia Pro', sans-serif",path:"sofiapro",_v:"2"},Spade:{display_name:"Spade",family:"'Spade', serif",path:"spade",_v:"1"},"Square Serif":{display_name:"Square Serif",family:"'Square Serif', serif",path:"squareserif",_v:"4"},Streetscript:{display_name:"Streetscript",family:"'Streetscript', sans-serif",path:"streetscript",_v:"1"},"Typewriter FS":{display_name:"Typewriter",family:"'Typewriter FS', serif",path:"typewriterfs",_v:"1"},Verdana:{display_name:"Verdana",family:"Verdana, Geneva, Tahoma, sans-serif"},Ziclets:{display_name:"Ziclets",family:"'Ziclets', serif",path:"ziclets",_v:"1"}};e.exports=i},{}],7:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("./header/compact"),n=t("./posts/highlighted"),r=s.extend({defaults:{top:!1},initialize:function(t){this.options=i.extend({},this.defaults,t),this.model=this.options.model,this.header=new o({model:this.model}),this.posts=new n({model:this.model}),this.bindEvents()},bindEvents:function(){this.listenToOnce(this.header,"ready",this._triggerReady)},_triggerReady:function(){this.trigger("ready")},render:function(){return this.header.render(),this.posts.render(),this.header.attachPosts(this.posts.el,this.options.top),this.$el.replaceWith(this.header.el),this.setElement(this.header.el),this}});e.exports=r},{"./header/compact":8,"./posts/highlighted":9,lodash:"K2RcUv","prima/view":318}],8:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/lib/flags"),n=t("prima/lib/data"),r=t("prima/view"),a=t("prima/events"),l=t("prima/utils/colors"),h=t("prima/utils/url"),d=t("prima/lib/translate"),c=t("../../templates/blog_card.tpl"),u=t("../../utils/webfonts"),p=r.extend({className:"indash_tumblelog_compact",template:c,defaults:{current_data:{},unfollow_data:{},follow_data:{},template_data:{},hide_posts_on_unfollow:!1,stripDescriptionLineBreaks:!1,include_info_popover:!0},events:{"click .description a":"_descriptionLinkClicked","click .info_popover_button":"_infoPopoverButtonClicked","click .follow":"_onFollowClick","click .unfollow":"_onFollowClick"},initialize:function(t){if(this.options=i.extend({},this.defaults,t||{}),this.bindEvents(),this.is_rendered=!1,this.assets_host=n.get("Context/hosts/assets_host")||"",this.$description=null,this.$description_inner=null,!i.isEmpty(this.current_data)){var e=i.extend({},this.current_data,this.model.toJSON());this.model.set(e,{silent:!0})}this.model.get("global_theme_params")&&i.delay(i.bind(this.render,this),1)},bindEvents:function(){this.listenTo(this.model,"change:following",this._renderFollowButton),this.listenTo(this.model,"change:global_theme_params",this.render)},attachPosts:function(t,e){var i=this.$el.find(".indash_header_wrapper");e?i.prepend(t):i.append(t)},render:function(){var t=this.model.toJSON();if(t.following||(t.following=!1),this.is_rendered||!t.global_theme_params)return this;var e=i.result(u,t.global_theme_params.title_font),s=l.hexToRgb(t.global_theme_params.title_color);return this.$el.html(this.template(i.merge(t,{show_navigation:!0,show_share_controls:!1,show_user_controls:!1,show_follow_button:!0,title_font_family:e?e.family:!1,title_color_rgb:String(i.values(s).join(","))},this.options.template_data))),this.$description=this.$(".description"),this.$description_inner=this.$description.find(".description_inner"),this._renderFontStyles(),this._renderInlineStyles(),this.is_rendered=!0,this.$description.length&&(i.delay(i.bind(this.truncateDescription,this),100),this.options.stripDescriptionLineBreaks&&this.stripDescriptionLineBreaks()),this.trigger("ready"),this},stripDescriptionLineBreaks:function(){this.$description_inner.find("br").remove();var t=this.$description_inner.html(),e=t.replace(/[\n\r]/g," ");this.$description_inner.html(e)},truncateDescription:function(){var t=this.$description_inner.get(0);if(!(t.scrollHeight<=t.clientHeight)){var e=this.model.get("global_theme_params"),s=e.background_color,o=l.hexToRgb(s);this.$description.append(this.description_gradient_template({background_color:String(i.values(o).join(","))}))}},_onFollowClick:function(t){if(t.preventDefault(),!o.bool("is_logged_in"))return void window.open("/follow/"+this.model.get("name"),"_self");var e={follow_data:this.options.follow_data};this.model.get("following")?this._confirm_unfollow(e):(a.trigger("tumblelog:log_follow"),this.model.follow(e))},_confirm_unfollow:function(){var t=d("Are you sure you want to unfollow %1$s?").replace("%1$s","<strong>"+this.model.get("name")+"</strong>"),e={text:t,text_ok:d("Ok"),text_cancel:d("Nevermind")},i=this.model.requestUnfollow(),s={tumblelog:this.model.get("name")};i.promise.then(function(){a.trigger("tumblelog:log_unfollow",{loggingData:s})}),a.trigger("dialog:confirm:promise",i,e)},_infoPopoverButtonClicked:function(t){t.preventDefault(),this.info_popover.show()},_descriptionLinkClicked:function(t){t.preventDefault();var e=s(t.currentTarget).attr("href");try{if(h&&h.hasAllowedProtocol(e)){if(!h.isAbsoluteUrl(e)){var i="http://"+this.model.get("name")+".tumblr.com/";e="/"===e.charAt(0)?e.substr(1):e,e=i+e}window.open(e,"_blank")}}catch(o){}},_renderFollowButton:function(){var t=this.model.get("following");this.$el.find(".follow").toggle(!t),this.$el.find(".unfollow").toggle(t)},_hidePosts:function(){},_open_dialog:function(t,e){function s(t,e){t.is_disabled=t.is_menu_open,e&&e()}this.is_disabled=!0,t.fail(i.bind(s,null,this)),t.done(i.bind(s,null,this,e))},_renderInlineStyles:function(){var t=this.model.get("global_theme_params"),e=t.header_image_focused&&t.header_stretch&&t.show_header_image,i=l.hexToHsv(t.background_color),s=l.hexToHsv(t.link_color),o=t.link_color;return l.compare(s,i)&&(o=l.readable(i)),e||(this.$(".navigation .nav_icon").css("color",o),this.$(".navigation .blog_name").css("color",o),this.$(".navigation button").css({color:t.background_color,"background-color":o})),this.$(".description a").css("color",t.link_color),this},_renderFontStyles:function(){if(u){var t=this.model.get("global_theme_params");if(i.has(u,t.title_font)){var e=i.result(u,t.title_font),o="webfont_"+e.path;if(e.path&&!s("head #"+o).length){var n=this.assets_host+"/fonts/"+e.path+"/stylesheet.css";n+=i.has(e,"_v")?"?v="+e._v:"",s("<link>",{id:o,rel:"stylesheet",type:"text/css",href:n}).appendTo(s("head"))}}}},description_gradient_template:i.template('<div class="description_gradient" style="background: -moz-linear-gradient(top,  rgba(<%= background_color %>,0) 0%, rgba(<%= background_color %>,0.75) 50%, rgba(<%= background_color %>,1) 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(<%= background_color %>,0)), color-stop(50%,rgba(<%= background_color %>,0.75)), color-stop(100%,rgba(<%= background_color %>,1)));background: -webkit-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -o-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -ms-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: linear-gradient(to bottom,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);"></div>')});e.exports=p},{"../../templates/blog_card.tpl":4,"../../utils/webfonts":6,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/lib/data":263,"prima/lib/flags":"f/LVtH","prima/lib/translate":288,"prima/utils/colors":304,"prima/utils/url":317,"prima/view":318}],9:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),r=t("../../templates/posts/highlighted_posts.tpl"),a=o.extend({className:"recent_posts",template:r,events:{"click a":"onPostClick",mouseenter:"onMouseEnter"},defaults:{on_bottom:!0,$popover:s(),min_load_time:500,model:{},dashboard_post:{}},initialize:function(t){i.extend(this,this.defaults,t),this.model&&(this.renderLoader(),this.renderInlineStyles(),this.posts=this.model.get("highlighted_posts"),i.isUndefined(this.posts)&&this.fetchPosts(),this.bindEvents())},bindEvents:function(){this.listenTo(this.model,"change:highlighted_posts",this.render),this.listenTo(this.model,"change:global_theme_params",this.renderInlineStyles)},fetchPosts:function(){this.model.fetch_popover_data({is_tumblelog_popover:!0})},updatePosts:function(t){this.model=t,this.posts=this.model.get("highlighted_posts"),i.isUndefined(this.posts)?this.fetchPosts():this.render(!0)},renderLoader:function(){var t=this.model.toJSON();this.$el.html(this.template({loader_color:t.global_theme_params?t.global_theme_params.title_color:"#D9D9D9"}))},renderInlineStyles:function(){var t=this.model.get("global_theme_params");t&&this.$el.css("background-color",t.background_color)},render:function(t){var e=this.posts||this.model.get("highlighted_posts");if(i.isArray(e)){var s=e.join("");return e.length<2?void setTimeout(i.bind(function(){this.$popover.addClass("is_empty"),this.$el.html("")},this),this.min_load_time):(this.$el.addClass("has_"+e.length+"_posts"),t===!0?(this.$el.addClass("is_cached").html(s),this):(setTimeout(i.bind(function(){this.$el.addClass("is_loaded").html(s)},this),this.min_load_time),this))}},onPostClick:function(){},onMouseEnter:function(){n.trigger("TumblelogPopover:mouseenter_posts")}});e.exports=a},{"../../templates/posts/highlighted_posts.tpl":5,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/view":318}],10:[function(t,e){"use strict";var i=t("app/vendor/ace"),s=i.acequire("ace/lib/dom"),o=t("./post_form.scss").getCSSText(),n={isDark:!1,cssClass:"ace-post-form",cssText:o};s.importCssString(n.cssText,n.cssClass),e.exports=n},{"./post_form.scss":11,"app/vendor/ace":"4e8++S"}],11:[function(t,e){var i,s=t("sassr/style"),o=".ace-post-form .ace_selection{background-color:rgba(220, 235, 244, 0.8);}.ace-post-form .ace_entity{color:#f2992e;}.ace-post-form .ace_string{color:#748089;}.ace-post-form .ace_underline{color:#56bc8a;text-decoration:underline;}.ace-post-form .ace_storage{color:#d95e40;}.ace-post-form .ace_operator{color:#748089;}.ace-post-form .ace_identifier{color:#444444;}.ace-post-form .ace_function{color:#f2992e;}.ace-post-form .ace_type{color:#a77dc2;}.ace-post-form .ace_constant{color:#d95e40;}.ace-post-form .ace_variable{color:#56bc8a;}.ace-post-form .ace_keyword{color:#f2992e;}.ace-post-form .ace_tag,.ace-post-form .ace_attribute-equals,.ace-post-form .ace_attribute-name{color:#529ecc;}.ace-post-form .ace_attribute-value{color:#a77dc2;}.ace-post-form .ace_heading{color:#529ecc;}.ace-post-form .ace_strong{color:#000000;}.ace-post-form .ace_emphasis{color:#748089;}.ace-post-form .ace_list.ace_markup{color:#a77dc2;}";e.exports.getStyleElement=function(){return s.style},e.exports.getCSSText=function(){return o},e.exports.append=function(){return i||s.inject(o),i=!0,s.style},e.exports.remove=function(){return i&&s.eject(o),i=!1,s.style}},{"sassr/style":334}],12:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/dialog"),n=s.extend({name:"Dialog",initialize:function(t){this.dialogView=o,this.options=i.extend({},this.defaults,t)},alert:function(t,e,i){return this.dialogView.alert.call(this.dialogView,t,e,i)},confirm:function(t,e,i,s,o){return this.dialogView.confirm.call(this.dialogView,t,e,i,s,o)},dialog:function(t){return this.dialogView.dialog.call(this.dialogView,t)},isActive:function(t){return this.dialogView.isActive.call(this.dialogView,t)},close:function(t){return this.dialogView.close.call(this.dialogView,t)},getDialogEl:function(){return this.dialogView.getDialogEl.call(this.dialogView)},__:function(t){return this.dialogView.__.call(this.dialogView,t)}});e.exports=new n},{"./views/dialog":16,lodash:"K2RcUv","prima/component":260}],13:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<button class="ui_button btn_'+(null==(__t=btn_id)?"":__t)+" chrome "+(null==(__t=btn_class)?"":__t)+'" data-btn-id="'+(null==(__t=btn_id)?"":__t)+'"><span>'+(null==(__t=text)?"":__t)+"</span></button>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],14:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<span class="text">'+(null==(__t=text)?"":__t)+"</span>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],15:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="ui_dialog '+(null==(__t=type)?"":__t)+'">'+(null==(__t=content_html)?"":__t)+'<div class="buttons">'+(null==(__t=buttons_html)?"":__t)+"</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],16:[function(t,e,i){"use strict";var s=t("jquery"),o=t("lodash"),n=t("prima/view"),r=t("prima/events"),a=t("prima/lib/translate"),l=n.extend({el:".ui_dialog",translations:{},defaultTemplates:{dialog:t("../templates/dialog.tpl"),content:t("../templates/content.tpl"),button:t("../templates/button.tpl")},events:{"click .ui_button":"buttonClick"},defaultDialog:{text:"",type:"default",has_form:"auto",visible_glass:!0,confirm_by_enter:!0,close_by_space:!0,key_tab:!0,key_close:!0,scroll_lock:!1,keycommand_maintain:!1,animate:!0,animate_in:{dialog_el:".ui_dialog",dialog_class:"add_animation fadeIn"},on_close:function(){},on_open:function(){}},initialize:function(){this.options=o.extend(this.defaults,this.options),this.templates=this.defaultTemplates,this.is_visible=!1,this.dialogQueueOrder=[],this.dialogQueue={},this.queueCounter=0,this.currentDialog=!1,this.currentDialogId=0,this.uid=0,this.$body=s("body"),this._initClickLock(),this._setupKeys(),r&&!i.Dialog&&(this.listenTo(r,"dialog:dialog",this.dialog),this.listenTo(r,"dialog:confirm",this.confirm),this.listenTo(r,"dialog:confirm:promise",this.confirmPromise),this.listenTo(r,"dialog:alert",this.alert),this.listenTo(r,"dialog:close",this.close))},dialog:function(t){return o.isObject(t)?this._dialog(t):!1},confirm:function(t,e,i,s,n){o.isString(t)&&(t={text:t});var r={callback_ok:e,callback_cancel:i,text_ok:s,text_cancel:n};t=o.extend({},r,t);var l={text:t.text,type:"confirm",visible_glass:!0,keycommand_maintain:t.keycommand_maintain||!1,templates:t.templates||null,escape_button:0,buttons:{0:{text:t.text_cancel||a("Cancel"),close:!0,callback:o.isFunction(t.callback_cancel)?t.callback_cancel:function(){}},1:{text:t.text_ok||a("OK"),selected:!0,btn_class:"blue",close:!0,callback:o.isFunction(t.callback_ok)?t.callback_ok:function(){}}}};return this._dialog(l)},confirmPromise:function(t,e){this.confirm(e,t.resolve,t.reject)},alert:function(t,e,i){o.isString(t)&&(t={text:t});var s={callback_ok:e,text_ok:i};t=o.extend({},s,t);var n={text:t.text,type:"alert",visible_glass:!0,keycommand_maintain:t.keycommand_maintain||!1,templates:t.templates||null,escape_button:0,buttons:{0:{text:t.text_ok||a("OK"),selected:!0,btn_class:"blue",close:!0,callback:o.isFunction(t.callback_ok)?t.callback_ok:function(){}}}};return this._dialog(n)},getDialogEl:function(){return this.el},buttonClick:function(t){var e=s(t.currentTarget),i=e.data("btn-id");if(o.isUndefined(this.currentDialog.buttons[i])||e.hasClass("disabled"))return!1;var n=this.currentDialog.buttons[i],r=null;o.isFunction(n.callback)&&(r=n.callback(this)),r!==!1&&(!o.isUndefined(n.close)&&n.close||o.isUndefined(n.close))&&this.close()},isActive:function(t){return this.currentDialog===!1||this.currentDialog.uid!==t?!1:!0},close:function(t){if(this.currentDialog===!1)return!1;if(o.isUndefined(t)&&(t=!1),t!==!1&&this.currentDialog.uid!==t)return!1;if(this.$dialog_lock.hide(),s(".ui_dialog_pos").remove(),this.is_visible=!1,this.currentDialog.keycommand_maintain||r.trigger("keycommands:resume"),o.isFunction(this.currentDialog.on_close)&&this.currentDialog.on_close(),r.trigger("dialog:closed"),this.currentDialog=!1,s("html").removeClass("dialog_lock"),this.dialogQueueOrder.length>0){var e=this.dialogQueueOrder.shift(),i=this.dialogQueue[e];delete this.dialogQueue[e],this._dialog(i)}},_tab:function(){var t=this.$el.find(".buttons .tab_frame"),e=t.filter(".focus"),i=t.index(e),s=t.length,o=!1;o=s>i+1?i+1:0,e.removeClass("focus init_focus");var n=t.eq(o);n.length>0&&(n.addClass("focus"),n.find("button").focus())},_formIsTabToButton:function(t,e){var i=this.$el.find(":focus");if(0===i.length)return!0;var s=this.$el.find(".buttons .tab_frame"),o=this.$el.find(":input:visible"),n=o.index(i);if(e&&n===o.length-1)return this.$el.find(":input:visible:first").focus(),t.preventDefault(),s.removeClass("focus init_focus"),!1;if(n>=0){var r=this.$el.find(":input:visible:eq("+(n+1)+")");if(r.length>0&&r.hasClass("ui_button"))return!0}return s.removeClass("focus init_focus"),!1},_select:function(){var t=this.$el.find(".buttons .tab_frame.focus"),e=t;1===e.length&&e.find(".ui_button").click()},_formIsFocusOnButton:function(){var t=this.$el.find(":focus");return 0===t.length?!1:t.hasClass("ui_button")},_escape:function(){if(!o.isUndefined(this.currentDialog.escape_button)){var t=this.$el.find(".btn_"+this.currentDialog.escape_button);t.length&&t.click()}},_dialog:function(t){if(o.isUndefined(t.uid)&&(t.uid=this._getUid()),this.currentDialog!==!1)return this.dialogQueueOrder.push(this.queueCounter),this.dialogQueue[this.queueCounter]=t,this.queueCounter++,t.uid;o.defaults(t,this.defaultDialog);var e=this._buildButtons(t.buttons);o.extend(t,{buttons_html:e});var i=this.templates;o.isObject(t.templates)&&(i=o.extend({},this.templates,t.templates));var n=o.isString(i.dialog)?o.template(i.dialog):i.dialog,a=o.isString(i.content)?o.template(i.content):i.content;t.content_html=a(t);var l=n(t);this.$dialog_lock.show(),o.isUndefined(t.visible_glass)?this.$dialog_lock.removeClass("opaque"):t.visible_glass&&this.$dialog_lock.addClass("opaque"),!o.isUndefined(t.scroll_lock)&&t.scroll_lock&&s("html").addClass("dialog_lock"),this.currentDialogId=t.uid,this.currentDialog=t;var h=s('<div id="dialog_'+this.currentDialogId+'" class="ui_dialog_pos">'+l+"</div>");return h.appendTo(this.$body),this.setElement(h),this.is_visible=!0,t.animate&&o.isObject(t.animate_in)&&this.$el.find(t.animate_in.dialog_el).length&&this.$el.find(t.animate_in.dialog_el).addClass(t.animate_in.dialog_class),this._focus(),this.currentDialog.keycommand_maintain||r.trigger("keycommands:suspend"),o.isUndefined(t.has_form)&&(t.has_form="auto"),"auto"===t.has_form&&(t.has_form=this.$el.find("form, input").length>0),o.isFunction(t.on_open)&&t.on_open(),this.el=this.$el[0],this.delegateEvents(),r.trigger("dialog:opened"),t.uid},_button:function(t,e,i,s){var n,r=o.isString(this.templates.button)?o.template(this.templates.button):this.templates.button;o.isObject(this.currentDialog.templates)&&(n=this.currentDialog.templates.button),s&&(e+=" default-pulse");var a=r({btn_class:e,text:t,btn_id:o.isUndefined(i)?"":i});return a='<div class="tab_frame">'+a+"</div>"},_focus:function(){if(!this.currentDialog)return!1;for(var t in this.currentDialog.buttons){var e=this.currentDialog.buttons[t];if(!o.isUndefined(e.selected)&&e.selected){var i=this.$el.find(".btn_"+t);i.length>0&&i.parent().addClass("focus init_focus")}}},_setupKeys:function(){s(document).on("keydown",o.bind(function(t){var e=t.ctrlKey||t.shiftKey||t.metaKey;if(this.is_visible&&!e){var i=t.keyCode||t.which;if(9===i&&this.currentDialog.key_tab){if(this.currentDialog.has_form&&!this._formIsTabToButton(t,!0))return;t.preventDefault(),this._tab(t)}if(13===i&&this.currentDialog.confirm_by_enter||32===i&&this.currentDialog.close_by_space){if(this.currentDialog.has_form&&32===i&&!this._formIsFocusOnButton(t))return;t.preventDefault(),this._select(t)}27===i&&this.currentDialog.key_close&&(t.preventDefault(),this._escape(t))}},this))},_buildButtons:function(t){if(!o.isObject(t))return"";var e=0;for(var i in t)t.hasOwnProperty(i)&&e++;for(var s="",n=0;e>n;n++)if(!o.isUndefined(t[n])){var r=o.isUndefined(t[n].text)?"":t[n].text,a=o.isUndefined(t[n].btn_class)?"":t[n].btn_class,l=o.isUndefined(t[n].selected)?!1:t[n].selected;s+=this._button(r,a,n,l)}return s},_initClickLock:function(){var t=this.$dialog_lock=s("<div>",{"class":"ui_dialog_lock"});s(document).ready(function(){t.prependTo("body")})},_getUid:function(){return this.uid++},__:function(t){return a(t)}});e.exports=new l},{"../templates/button.tpl":13,"../templates/content.tpl":14,"../templates/dialog.tpl":15,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/lib/translate":288,"prima/view":318}],17:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/component"),o=t("./views/footer"),n=t("./views/sidebar_footer"),r=s.extend({name:"footer",initialize:function(){this.createFooter()},createFooter:function(){i(".l-footer").length&&(this.footerView=new o({el:".l-footer"})),i(".sidebar_nav").length&&(this.sidebarFooterView=new n({el:".sidebar_nav"}))}});e.exports=new r},{"./views/footer":18,"./views/sidebar_footer":19,jquery:"HlZQrA","prima/component":260}],18:[function(t,e){"use strict";var i=t("prima/view"),s=i.extend({initialize:function(){}});e.exports=s},{"prima/view":318}],19:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/events"),o=(t("prima/lib/domeventor"),t("prima/mixins/accessor")),n=i.extend({mixins:[o],defaults:{fadeScrollDistance:2e3,visible:!0},initialize:function(){this.listenTo(s,"DOMEventor:flatscroll",this.onScroll),this.on("change:visible",this.toggleVisibility)},onScroll:function(t){t&&(t.windowScrollY>=this.get("fadeScrollDistance")?this.set("visible",!1):this.set("visible",!0))},toggleVisibility:function(t,e){this.$el.toggleClass("visible",e)}});e.exports=n},{"prima/events":261,"prima/lib/domeventor":265,"prima/mixins/accessor":289,"prima/view":318}],20:[function(t,e){"use strict";var i=t("prima/component"),s=t("prima/lib/domeventor"),o=t("prima/events"),n=i.extend({name:"GutterMediaManager",gutteredView:null,gutterMargin:20,gutterWidth:215,maxViewWidth:300,viewportTransitionWidth:900,putViewInGutter:function(t,e){if(this.gutteredView!==t){var i={},n=!1;i.winRect=s.rect(),i.gutterPosition=this.gutterPosition(),i.animation=e,this.gutteredView&&(this.removeGutteredView({wasDisplaced:!0}),n=!0),this.gutteredView=t,t.moveToGutter(i),o.trigger("post:docked",{loggingData:{post_id:t.model.get("id"),tumblelog:t.model.get("tumblelog"),service:t.$el.data("embed-service")}})}},removeGutteredView:function(t){return this.removeViewFromGutter(this.gutteredView,t)
},removeViewFromGutter:function(t){if(this.gutteredView===t){var e=this.gutteredView.$placeholder.get(0).getBoundingClientRect();-e.top>e.height||e.top>window.innerHeight?t.slideOutOfGutter():t.translateOutOfGutter(!0),this.gutteredView=null,o.trigger("post:undocked",{loggingData:{post_id:t.model.get("id"),tumblelog:t.model.get("tumblelog"),service:t.$el.data("embed-service")}})}},gutterPosition:function(){var t=s.rect(),e=this.viewportTransitionWidth/2-this.gutterMargin-this.gutterWidth,i={width:this.maxViewWidth,left:"50%",bottom:20,translateX:e},o=this.maxViewWidth-this.gutterWidth+this.viewportTransitionWidth;return t.windowWidth<o&&(i.width=o-t.windowWidth),i.width<this.gutterWidth&&(i.width=this.gutterWidth),i}});e.exports=new n},{"prima/component":260,"prima/events":261,"prima/lib/domeventor":265}],21:[function(t,e){"use strict";var i=t("prima/component"),s=t("prima/lib/flags"),o=t("./views/header"),n=t("./views/logo"),r=i.extend({name:"header",initialize:function(){s.bool("dashboard_refresh")?(this.headerView=new o({el:'[prima-component="header"]'}),this.enableFunctionality()):this.logo=new n({el:'[prima-component="logo"]'})},enableFunctionality:function(){s.bool("dashboard_refresh")&&this.headerView.enableCompose()},disableSticky:function(){s.bool("dashboard_refresh")&&this.headerView.disableSticky()}});e.exports=new r},{"./views/header":23,"./views/logo":24,"prima/component":260,"prima/lib/flags":"f/LVtH"}],22:[function(t,e){"use strict";var i=t("prima/lib/flags"),s=t("prima/view"),o=t("prima/events"),n=t("prima/mixins/accessor"),r=s.extend({mixins:[n],el:".compose-button",events:{click:"toggleOpen"},defaults:{open:!1},loggingData:{source:"compose-button"},initialize:function(){this.on("change:open",this.onChangeOpen),i.bool("dashboard_refresh")?(this.listenTo(o,"fastCompose:init:complete",this.open),this.listenTo(o,"fastCompose:dismiss:complete",this.close)):(this.listenTo(o,"fastCompose:init:complete",this.open),this.listenTo(o,"fastCompose:dismiss:complete",this.close))},toggleOpen:function(){this.toggle("open")},open:function(){this.set("open",!0)},close:function(){this.set("open",!1)},onChangeOpen:function(t,e){i.bool("dashboard_refresh")?e?o.trigger("fastCompose:init",{loggingData:this.loggingData}):o.trigger("fastCompose:dismiss",{loggingData:this.loggingData}):o.trigger(e?"fastCompose:init":"fastCompose:dismiss")}});e.exports=r},{"prima/events":261,"prima/lib/flags":"f/LVtH","prima/mixins/accessor":289,"prima/view":318}],23:[function(t,e){"use strict";var i=(t("jquery"),t("prima/view")),s=t("prima/mixins/accessor"),o=t("./compose_btn"),n=t("app/components/switcher"),r=t("./logo"),a=i.extend({mixins:[s],defaults:{},initialize:function(){this.logo=new r({el:'[prima-component="logo"]'})},enableCompose:function(){this.composeBtn=new o,this.switcher=new n},disableSticky:function(){this.$el.addClass("l-header-container--unstuck")}});e.exports=a},{"./compose_btn":22,"./logo":24,"app/components/switcher":185,jquery:"HlZQrA","prima/mixins/accessor":289,"prima/view":318}],24:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),r=t("app/components/tooltip"),a=(t("prima/lib/flags"),o.extend({events:{"mouseenter .logo_dot":"hover_dot","click .logo_dot":"click_dot"},initialize:function(){this.$dot=i(".logo_dot",this.$el),this.$dot.length&&(this.$dot.data("tooltip")&&this.init_tooltip(),this.$dot.data("frame-count")&&this.init_dot_animation())},hover_dot:function(){this.$el.undelegate(this.$dot.el,"mouseenter"),n.trigger("Capture:push","tumblr_dot_usage","hover")},click_dot:function(){n.trigger("Capture:push","tumblr_dot_usage","click",{click_location:"dot"})},init_tooltip:function(){this.toolTip=new r({selector:".logo .logo_dot",offset:this.$dot.data("tooltip-offset"),placement:"down"}),n.trigger("Capture:push","tumblr_dot_usage","impression")},init_dot_animation:function(){this.frame_rate=30,this.frame_width=this.$dot.width(),this.frame_count=this.$dot.data("frame-count")-1,this.current_frame=0,this.frame_timing=this.$dot.data("timing")&&this.$dot.data("timing").split(/,\s*/),this.frame_timing?this.stagger_animation():setInterval(s.bind(function(){this.animate_dot_frame()},this),1e3/this.frame_rate)},stagger_animation:function(){this.animate_dot_frame();var t=1e3*this.frame_timing[this.current_frame];setTimeout(s.bind(function(){this.stagger_animation()},this),t)},animate_dot_frame:function(){this.current_frame++,this.current_frame>this.frame_count&&(this.current_frame=0),this.$dot.css({"background-position":"-"+this.current_frame*this.frame_width+"px 0px"})}}));e.exports=a},{"app/components/tooltip":188,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/lib/flags":"f/LVtH","prima/view":318}],25:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/collection"),o=t("../models/photo"),n=s.extend({model:o,getSubset:function(t){return i.isUndefined(t)?[]:i.map(i.isArray(t)?t:i.toArray(arguments),this.get,this)},getSubCollection:function(){return new n(this.getSubset.apply(this,arguments))},setIdOrder:function(t,e){e||(e={}),this.models=i.map(t,function(t){return this.get(t)},this),e.silent||this.trigger("sort",this,e)}});e.exports=n},{"../models/photo":27,lodash:"K2RcUv","prima/collection":259}],26:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./models/photoset"),n=(t("./models/photo"),t("./collections/photos"),t("./utils"),t("./views/photoset")),r=t("./views/photo"),a=s.extend({name:"Photoset",initialize:function(t){(i.isArray(t)||t instanceof o)&&(t={photoset:t}),this.options=t=i.extend({},t),this.model=t.photoset instanceof o?t.photoset:new o(t.photoset);var e=i.keys(n.prototype.defaults);e.push("PhotoView"),e.push("post");var s=i.pick(t,e);s.photoset=this.model,this._PhotosetView=t.PhotosetView||n,this._PhotoView=t.PhotoView||r,this.indexView=new this._PhotosetView(s),this.listenTo(this.model,"all",this._relayModelEvent),this.listenTo(this.model.photos,"all",this._relayModelEvent)},_relayModelEvent:function(){this.trigger.apply(this,arguments)},teardown:function(){return this.indexView.teardown(),this.stopListening(),this},remove:function(){return this.teardown(),this.indexView.remove(),this},render:function(){return this.indexView.render(),this},getElement:function(){return this.indexView.$el}});e.exports=a},{"./collections/photos":25,"./models/photo":27,"./models/photoset":28,"./utils":33,"./views/photo":36,"./views/photoset":37,lodash:"K2RcUv","prima/component":260}],27:[function(t,e){"use strict";var i=t("prima/model"),s=t("../utils/imagelayout"),o=i.extend({defaults:{width:null,height:null,x:"50%",y:"50%",url:"",caption:"",clickthroughUrl:""},getAspectRatio:function(){return s.aspectRatio(this.get("width"),this.get("height"))},getWidthForHeight:function(t){return s.widthForHeight(this.get("width"),this.get("height"),t)},getHeightForWidth:function(t){return s.heightForWidth(this.get("width"),this.get("height"),t)}});e.exports=o},{"../utils/imagelayout":32,"prima/model":298}],28:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=t("../collections/photos"),n=t("../utils/imagelayout"),r=["","1","11","12","13","123","133","1232","1323","12223"],a=3,l=s.extend({defaults:{layout:null},initialize:function(t,e){e=i.extend({},e),this.layouts=e.layouts||r,this.maxPerRow=e.maxPerRow||a,(i.isArray(t)||t instanceof o)&&(this.attributes=i.extend({photos:t},this.defaults)),this.photos=this.get("photos")instanceof o?this.get("photos"):new o(this.get("photos")),this.unset("photos"),this.fixLayout()},fixLayout:function(){var t=this.get("layout");return t=t?n.fix(t,this.photos.length,this.layouts,this.maxPerRow):n.calculateDefault(this.photos.length,this.layouts,this.maxPerRow),this.set("layout",t),t},getRows:function(t){return n.toArray(t||this.get("layout"),this.photos,this.layouts,this.maxPerRow)},getPhotoRow:function(t){var e={id:t};return i.findIndex(this.getRows(),function(t){return i.some(t,e)})},removePhoto:function(t){var e=this.getPhotoRow(t),s=this.photos.remove(t),o=i.reduce(this.get("layout").split(""),function(t,s,o){return s=i.parseInt(s),o===e&&s--,t+(s>0?s:"")},"");this.set("layout",o),s&&this.trigger("photo:remove",s,t,o)},toJSON:function(){var t=s.prototype.toJSON.apply(this,arguments);return t.photos=this.photos.toJSON(),t.rows=this.getRows(),t}}),h=["add","remove","reset","push","pop","unshift","shift","slice","where","findWhere","forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];i.forEach(h,function(t){var e=o.prototype[t];l.prototype[t]=function(){return e.apply(this.photos,i.toArray(arguments))}}),e.exports=l},{"../collections/photos":25,"../utils/imagelayout":32,lodash:"K2RcUv","prima/model":298}],29:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-imagecrop style="width:'+(null==(__t=displayWidth)?"":_.escape(__t))+"px;height:"+(null==(__t=displayHeight)?"":_.escape(__t))+'px" class="photoset--image-crop"><div data-js-imagewrap style="background-image:url('+(null==(__t=url)?"":_.escape(__t))+");background-position:"+(null==(__t=x)?"":_.escape(__t))+" "+(null==(__t=y)?"":_.escape(__t))+'" class="photoset--image-wrap"><img data-js-image src="'+(null==(__t=url)?"":_.escape(__t))+'" alt="'+(null==(__t=caption)?"":_.escape(__t))+'" data-width="'+(null==(__t=width)?"":_.escape(__t))+'" data-height="'+(null==(__t=height)?"":_.escape(__t))+'" class="photoset--image"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],30:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";var rows=photoset.rows,cellId=0;__p+='<div data-js-layout class="photoset--layout">',_.forEach(rows,function(t,e){__p+="";var i=e>0?padding:0,s=e<rows.length-1?padding:0,o=_rowSize(t,width,padding),n=o.height;__p+='<div data-photoset-row="'+(null==(__t=e)?"":_.escape(__t))+'" style="height:'+(null==(__t=n+i+s)?"":_.escape(__t))+'px" class="photoset--row">',_.forEach(t,function(e,r){__p+="";var a=o.photos[r],l=a.width,h=a.height,d=n,c=r<t.length-1?padding:0,u=r>0?padding:0,p=l+u+c,m=_.map([i,c,s,u],function(t){return t?t+"px":0}).join(" ");__p+='<div data-photoset-position="'+(null==(__t=cellId)?"":_.escape(__t))+'" data-photo-id="'+(null==(__t=e.id)?"":_.escape(__t))+'" style="width:'+(null==(__t=p)?"":_.escape(__t))+"px;height:"+(null==(__t=n)?"":_.escape(__t))+"px;padding:"+(null==(__t=m)?"":_.escape(__t))+'" class="photoset--cell">'+(null==(__t=photoTemplate(_.defaults({scaledWidth:l,scaledHeight:h,displayWidth:a.width,displayHeight:d},e)))?"":__t)+"</div>",cellId++,__p+=""}),__p+="</div>"}),__p+="</div>"}return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],31:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o={},n=function(t,e,o){var n=t instanceof s?t:s(t),r=e;i.isObject(e)||(r={},r[e]=o),n.attr(r);var a=i.transform(r,function(t,e,s){s.match(/^data\-/i)&&(t[i.camelize(s.replace(/^data\-/,""))]=e)},{});return n.data(a),n},r=function(t,e){var o=t instanceof s?t:s(t);return i.isString(e)&&(e=i.rest(arguments,1)),i.forEach(e,function(t){o.removeAttr(t),t.match(/^data\-/i)&&o.removeData(i.camelize(t.replace(/^data\-/,"")))}),o};o.set=n,o.remove=r,e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],32:[function(t,e){"use strict";var i=t("lodash"),s=t("../models/photo"),o={},n=function(t,e,s){return t<e.length?e[t]:i.trim(i.pad(t%s||" ",Math.floor(t/s)+1,s+"","right"))},r=function(t,e,s,o){var r=i.isNumber(e)?e:e.length;t?i.isString(t)||(t=t.toString()):t="";var a=r-i.reduce(t.split(""),function(t,e){return t+i.parseInt(e)},0);return a>0?t+=n(a,s,o):0>a&&(t=i(t.split("")).reverse().transform(function(t,e){a?(a+=i.parseInt(e),a>0&&(t.push(a),a=0)):t.push(e)},[]).reverse().value().join("")),t},a=function(t,e,s,o){var n=r(t,e,s,o).split(""),a=0;return i.map(n,function(t){t=i.parseInt(t);var s=i.map(e.slice(a,a+t),function(t){return i.isFunction(t.toJSON)?t.toJSON():t});return a+=t,s})},l=function(t,e){return t&&e?t/e:0},h=function(t,e,i){var s=e?i/e:0;return t*s},d=function(t,e,i){var s=t?i/t:0;return e*s},c=function(t,e){if(!t.length)return 0;var o=i.map(t,function(t){var i,o;return t instanceof s?(i=t.get("width"),o=t.get("height")):(i=t.width,o=t.height),d(i,o,e)});return i.min(o)},u=function(t,e,i){return i||(i=0),(i+e+i)/t-i-i};o.calculateDefault=n,o.fix=r,o.toArray=a,o.aspectRatio=l,o.widthForHeight=h,o.heightForWidth=d,o.rowHeightForWidth=c,o.rowImageWidth=u,e.exports=o},{"../models/photo":27,lodash:"K2RcUv"}],33:[function(t,e){"use strict";var i={ImageLoader:t("prima/utils/image/loader"),ImageLayout:t("./imagelayout")};e.exports=i},{"./imagelayout":32,"prima/utils/image/loader":312}],34:[function(t,e){"use strict";var i=t("lodash"),s=function(t,e){e||(e=t.originalEvent),i.extend(t,i.pick(e,"pageX","pageY"));var s,o,n;return null==t.pageX&&null!=e.clientX&&(s=t.target.ownerDocument||document,o=s.documentElement,n=s.body,t.pageX=e.clientX+(o&&o.scrollLeft||n&&n.scrollLeft||0)-(o&&o.clientLeft||n&&n.clientLeft||0),t.pageY=e.clientY+(o&&o.scrollTop||n&&n.scrollTop||0)-(o&&o.clientTop||n&&n.clientTop||0)),{x:t.pageX,y:t.pageY}};e.exports=s},{lodash:"K2RcUv"}],35:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").animate,r=t("prima/events"),a=t("./photoset"),l=150,h=s(window),d=t("../utils/attrdata"),c=t("../utils/page_coords"),u=0,p=1,m=2,g=a.extend({className:"editable-photoset photoset",defaults:i.extend({x:null,y:null,dragId:null,sourceCell:null,targetCell:null,dragOverCell:null,isLocked:!1,isDragging:!1,dragScrollVelocityY:0,dragScrollUpdateMs:50,dragScrollHeight:100,dragSlide:20,ghostWidth:100,ghostMaxHeight:120},a.prototype.defaults),events:i.defaults({'mousedown [data-js-sortable][draggable="true"]':"_onMouseDownSortable","dragstart .photoset--photo-dragger":"_onDragStart"},a.prototype.events),initialize:function(){a.prototype.initialize.apply(this,arguments),this.__updateCursorPosition=i.throttle(i.bind(function(t){this.set(c(t))},this)),i.forEach(["_onDragStart","_onDragEnter","_onDragOver","_onDragLeave","_onDragEnd","_onDrop"],function(t){var e=this[t]||i.noop;this["_"+t]=i.bind(e,this)},this)},_onMouseDownSortable:function(t){if(this.get("isLocked"))return t.preventDefault(),void t.stopPropagation();if(1===t.which&&!t.ctrlKey){if(this.get("isDragging"))return this._onDragEnd(t);if(this.trigger("photoset:predrag",this),!window.DataTransfer||!i.isFunction(window.DataTransfer.prototype.setDragImage)){var e=s(t.target),o=e.closest(".photoset--photo"),n=this.photoset.photos.get(o.data("photoId")),r=n?n.get("url")||"":"";r&&(e.css({backgroundColor:"#ffffff",backgroundImage:"url("+r+")"}),e.one("mouseout mouseup",i.bind(function(){e.css({backgroundColor:"",backgroundImage:""})},this)))}}},_onDragStart:function(t){if(this.get("isLocked"))return t.preventDefault(),void t.stopPropagation();var e=s(t.target),o=e.closest(".photoset--photo"),n=o.data("photoId"),r=t.originalEvent.dataTransfer;if(r){r.effectAllowed="move",r.dropEffect="move";var a=this.$('[data-ghost-id="'+n+'"]');!i.isEmpty(a)&&i.isFunction(r.setDragImage)&&r.setDragImage(a.get(0),.5*a.outerWidth(),.5*a.outerHeight());try{var l=this.photoset.photos.get(n),d=l?l.get("url")||"":"";r.setData("text/uri-list",d),r.setData("text/plain",d)}catch(t){}}var c=o.closest(this.$$cacheKeys.cell),u=c.closest(this.$$cacheKeys.row);this.set({sourceCell:null,targetCell:null,dragOverCell:null,dragId:n}),this.listenTo(this,"change:targetCell",this._onChangeTargetCell),this.$el.on("dragover .photoset--cell",this.__onDragOver),this.$el.on("dragend",this.__onDragEnd),this.$el.on("drop .photoset--cell",this.__onDrop),h.on("dragover",this.__updateCursorPosition),this.startDragScroll(),i.defer(i.bind(function(){var t=this.$$cacheKeys.cell;this.set("isDragging",!0),c.addClass("photoset--placeholder-cell photoset--source-cell"),u.addClass("photoset--source-row"),i.isEmpty(c.siblings(t))&&c.closest(this.$$cacheKeys.row).addClass("photoset--placeholder-row"),e.css({backgroundColor:"",backgroundImage:""}),this.createPlaceholders(),this.set({sourceCell:c.data("placeholderCell"),targetCell:c.data("placeholderCell"),dragOverCell:c.data("dragOverCell")}),this.listenTo(this,"change:dragOverCell change:x change:y",this._onChangeDragTarget)},this))},_onDragOver:function(t){t.preventDefault(),t.stopPropagation(),this.__updateCursorPosition(t);var e=s(t.target),i=e.closest(this.$$cacheKeys.cell);this.set("dragOverCell",i.data("dragOverCell"))},_onDragEnd:function(t){t.preventDefault(),t.stopPropagation(),this.stopListening(this,"change:targetCell",this._onChangeTargetCell),this.stopListening(this,"change:dragOverCell change:x change:y",this._onChangeDragTarget);var e=this.get("dragId");if(null!=e){var s=this.placePhotoInCell(e,this.get("targetCell"));this.set({sourceCell:null,targetCell:null,dragId:null}),s.removeClass("photoset--placeholder-cell"),s.closest(this.$$cacheKeys.row).removeClass("photoset--placeholder-row")}this.removePlaceholders(),this.set("isDragging",!1);var o=this.determineLayout();this.photoset.photos.setIdOrder(o.order),this.photoset.set("layout",o.layout),this.set("isLocked",!0),this.resize().then(i.bind(function(){this.removeTemporary(),this.set("isLocked",!1)},this)),this._ensurePhotoInViewport(e),this.$el.off("dragover .photoset--cell",this.__onDragOver),this.$el.off("dragend",this.__onDragEnd),this.$el.off("drop .photoset--cell",this.__onDrop),h.off("dragover",this.__updateCursorPosition),this.stopDragScroll()},_onDrop:function(t){t.preventDefault(),t.stopPropagation()},_onChangeIsDragging:function(t,e){this.$el.toggleClass("photoset--drag-to-sort",e)},_onChangeIsLocked:function(t,e){this.$el.toggleClass("photoset--locked",e),e||this.$(".photoset--cropped-cell").removeClass("photoset--cropped-cell")},_onUpdate:function(){this.teardown().render(),this.photoset.photos.length>1&&this._ensurePhotoInViewport(this.photoset.photos.last().get("id")),r.trigger("postForms:resized")},startDragScroll:function(){this.set({dragScrollTop:this.get("dragScrollHeight"),dragScrollBottom:h.height()-this.get("dragScrollHeight")}),this.listenTo(this,"change:y",this._onChangeDragY)},stopDragScroll:function(){clearInterval(this.dragScrollInterval),delete this.dragScrollInterval,this.stopListening(this,"change:y",this._onChangeDragY)},_onChangeDragY:function(t,e){var s=0,o=e-h.scrollTop();s=o<this.get("dragScrollTop")?Math.ceil(100*(o-this.get("dragScrollTop"))/this.get("dragScrollHeight")):o>this.get("dragScrollBottom")?Math.ceil(100*(o-this.get("dragScrollBottom"))/this.get("dragScrollHeight")):0,this.set("dragScrollVelocityY",s),s?this.dragScrollInterval||(this.dragScrollInterval=setInterval(i.bind(function(){var t=this.get("dragScrollVelocityY");t&&r.trigger("Photoset:dragScroll",t)},this),this.get("dragScrollUpdateMs"))):this.dragScrollInterval&&(clearInterval(this.dragScrollInterval),delete this.dragScrollInterval)},_ensurePhotoInViewport:function(t,e){i.isNumber(e)||(e=l);var s=this._layoutCache||this._updateLayoutCache(),o=this.$el.offset().top||0,n=i.find(s.rows,function(e){return i.find(e.cells,{photo:t})?!0:void(o+=e.height)});n&&r.trigger("Photoset:scrollToRow",o,n.height,e)},createPhotoSubView:function(){var t=a.prototype.createPhotoSubView.apply(this,arguments);return this.options.post&&(t.post=this.options.post),this.listenTo(t,"photoset:hover",function(){var e=i.toArray(arguments);e.unshift("photoset:unhover"),i(this.subViews).omit(t.photo.get("id")).invoke(function(){this.trigger.apply(this,e)})}),t},createPlaceholders:function(){var t=this.photoset.maxPerRow,e=".photoset--placeholder-row",o=".photoset--placeholder-cell",n=".photoset--source-row",r=".photoset--source-cell",a=this.$$cacheKeys.cell,l='<div class="photoset--row photoset--placeholder-row"></div>',h='<div class="photoset--cell photoset--placeholder-cell"></div>';this._createPlaceholders(this.js$("layout"),this.$$rows(),l,e),i.forEach(this.$$rows(!0),function(e){var i=s(e),r=i.children(this.$$cacheKeys.cell);(r.length<t||i.is(n))&&this._createPlaceholders(i,r,h,o)},this),i.forEach(this.$$cells(!0).filter(o),function(t,e){d.set(t,"data-placeholder-cell",e)},this);var c=this.determineLayout(),u=this.get("padding"),p=0;i.forEach(this.$$rows(!0),function(t){var l=s(t),h=l.index(),m=this.get("width"),g=h<=c.topRow||h>c.bottomRow?0:u,f=h>=c.bottomRow||h<c.topRow?0:u,_=l.height()||0;l.height(_);var v=l.children(a),b=l.prev(e).not(n).find(a),y=l.next(e).not(n).find(a),w=b.data("placeholderCell"),x=y.data("placeholderCell");i.forEach(v,function(t){var i=s(t);i.is(o)&&!i.is(r)&&i.css({paddingTop:g,paddingBottom:f,width:l.is(e)?m:0,height:_}),i.data("targetCells",{top:w,left:i.prev(o).data("placeholderCell"),center:i.data("placeholderCell"),right:i.next(o).data("placeholderCell"),bottom:x}),d.set(i,"data-drag-over-cell",p++)},!0)},this)},_createPlaceholders:function(t,e,o,n){e.first().is(n)||t.prepend(o),i.forEach(e.not(n),function(t){var e=s(t);i.isEmpty(e.next(n))&&e.after(o)},this)},removePlaceholders:function(){this.$$rows(!0).removeClass("photoset--source-row"),this.$$cells(!0).removeClass("photoset--source-cell").removeData("targetCells"),this.$$rows().filter(".photoset--placeholder-row").remove(),this.$$cells().filter(".photoset--placeholder-cell").remove(),this.renumberRowsAndCells(),d.remove(this.$$cells(),"data-drag-over-cell","data-placeholder-cell")},removeTemporary:function(){this.$(".photoset--temporary").remove(),this.$$rows(!0),this.$$cells(!0),this.renumberRowsAndCells()},resize:function(t){i.isNumber(t)||(t=l);var e=i.map(this.$$rows(),function(e,i){return this.resizeRow(e,t,i)},this);return this._updateLayoutCache(),o.all(e)},_calculateCellSize:function(t){var e=s(t),o=e.find(".photoset--photo [data-js-imageCrop]"),n={width:0,height:0,$content:o,$el:e},r=this.photoset.photos.get(e.data("photoId"));return r&&i.extend(n,{isCurrentCell:!0,width:r.get("width"),height:r.get("height")}),n},resizeRow:function(t,e,a){i.isNumber(e)||(e=l);var h=t instanceof s?t:s(t),d=this.determineLayout();i.isNumber(a)||(a=h.index());var c=this.get("width"),u=this.get("padding"),p=a<=d.topRow||a>d.bottomRow?0:u,m=a>=d.bottomRow||a<d.topRow?0:u,g=this.$$cacheKeys.cell,f=i.map(h.children(g),this._calculateCellSize,this),_=[],v=0;i.forEach(f,function(t,e){t.index=e,t.isCurrentCell&&(t.position=v++,t.id=_.length,_.push(t))});var b=this.rowSize(_,c),y=b.height,w=y?y+p+m:0,x=i.map(f,function(t){var s={width:t.width,height:y,paddingTop:p,paddingRight:0,paddingBottom:m,paddingLeft:0};null!=t.id&&(s.width=b.photos[t.id].width),null!=t.position&&(s.paddingRight=t.position<v-1?u:0,s.paddingLeft=t.position>0?u:0),i.isEmpty(t.$content)||(n(t.$content,"stop"),n(t.$content,{opacity:1,width:s.width,height:s.height,translateX:0,translateY:0},{duration:e}));var o=this.subViews[t.$el.data("photoId")];return o&&o.set({displayWidth:s.width,displayHeight:s.height}),n(t.$el,"stop"),n(t.$el,i.defaults({width:s.width+s.paddingLeft+s.paddingRight,height:s.height+s.paddingTop+s.paddingBottom},s),{duration:e})},this);n(h,"stop"),x.push(n(h,{height:w},{duration:e})),this.get("isDragging")&&(this._rowHeightCache[h.data("photosetRow")]=w);var k=o.all(x);return k.then(function(){r.trigger("postForms:resized")}),k},determineLayout:function(t){if(t&&this._determineLayout)return this._determineLayout;var e="",o=[],n=-1,r=-1,a=this.$$cacheKeys.cell;return i.forEach(this.$$rows(),function(t,l){var h=0;i.forEach(s(t).children(a),function(t){var e=s(t).data("photoId");(e||0===e)&&(o.push(e),h++)},this),h&&(e+=h,0>n&&(n=l),r=l)},this),this._determineLayout={topRow:n,bottomRow:r,order:o,layout:e},this._determineLayout},_onChangeTargetCell:function(t,e){if(null!=e){var o=this.$$cells().filter('[data-placeholder-cell="'+e+'"]'),r=o.closest(this.$$cacheKeys.row),a=o.data("dragOverCell"),h=u;h=o.is(".photoset--source-cell")?u:r.is(".photoset--placeholder-row")?p:m,i.forEach(this.$$cells(),function(t){var e=s(t),o=e.find(".photoset--image-crop");if(!i.isEmpty(o)){var d={translateX:0,translateY:0};switch(h){case p:i.isEmpty(r.find(e))&&(e.data("dragOverCell")<a?d.translateY=-this.get("dragSlide"):e.data("dragOverCell")>a&&(d.translateY=this.get("dragSlide")));break;case m:i.isEmpty(r.find(e))||(e.data("dragOverCell")<a?d.translateX=-this.get("dragSlide"):e.data("dragOverCell")>a&&(d.translateX=this.get("dragSlide")))}n(o,"stop"),n(o,d,l)}},this)}else i.forEach(this.$$cells(),function(t){var e=s(t).find(".photoset--image-crop");i.isEmpty(e)||(n(e,"stop"),n(e,{translateX:0,translateY:0},l))},this)},_onChangeDragTarget:function(){var t=this.get("dragOverCell");if(null!=t){var e=this.$$cells().filter('[data-drag-over-cell="'+t+'"]'),i=e.offset(),s=e.width(),o=e.height(),n=this.get("x")-(i.left+.5*s),r=this.get("y")-(i.top+.5*o),a=e.data("targetCells");null!=a.top&&-o/3>r?this.set("targetCell",a.top):null!=a.bottom&&r>o/3?this.set("targetCell",a.bottom):null!=a.center?null!=a.left&&-s/3>n?this.set("targetCell",a.left):null!=a.right&&n>s/3?this.set("targetCell",a.right):this.set("targetCell",a.center):null!=a.left&&0>n?this.set("targetCell",a.left):null!=a.right&&n>0&&this.set("targetCell",a.right)}},placePhotoInCell:function(t,e){var i=this.subViews[t],s=i.$el.closest(this.$$cacheKeys.cell),o=s.closest(this.$$cacheKeys.row),n=this.$$cells().filter('[data-placeholder-cell="'+e+'"]');return d.set(n,"data-photo-id",t),n.is(s)||(s.removeClass("photoset--placeholder-cell").addClass("photoset--temporary"),d.remove(s,"data-photo-id"),o.is(".photoset--placeholder-row")&&o.removeClass("photoset--placeholder-row").addClass("photoset--temporary"),i.js$("imageCrop").css({opacity:0,width:n.width(),height:n.height()}),i.$el.detach(),n.append(i.$el),n.addClass("photoset--cropped-cell")),n},beforeRender:function(){this.listenTo(this,"update",this._onUpdate),this.listenTo(this,"change:isDragging",this._onChangeIsDragging),this.listenTo(this,"change:isLocked",this._onChangeIsLocked)},afterRender:function(){this.renderSubViews(),this.$el.prepend('<div data-js-ghosts class="photoset--ghosts"></div>'),i.forEach(this.subViews,function(t,e){var i=t.thumbnailDimensions(this.get("ghostWidth"),this.get("ghostMaxHeight"));i["background-image"]="url("+t.photo.get("url")+")";var o=s('<div data-js-ghost class="photoset--ghost"></div>').css(i);d.set(o,"data-ghost-id",e),this.js$("ghosts").append(o)},this),this.js$("ghosts").append('<div class="photoset--ghost-cover"></div>').css({width:this.get("ghostWidth"),height:this.get("ghostMaxHeight")})}});e.exports=g},{"../utils/attrdata":31,"../utils/page_coords":34,"./photoset":37,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"velocity-animate":"lWl/mc",when:"RG2dij"}],36:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("velocity-animate").animate,n=t("prima/view"),r=150,a=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("prima/mixins/accessor"),d=t("../models/photo"),c=t("../templates/photo.tpl"),u=n.extend({className:"photoset--photo",template:c,mixins:[a,l,h],defaults:{scaledWidth:null,scaledHeight:null,displayWidth:null,displayHeight:null},initialize:function(t){t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.photo=t.photo||new d,this.photos=t.photos,this.photoset=t.photoset,this.$el.attr("data-photo-id",this.photo.get("id")),this.listenTo(this.photo,"change:id",function(t,e){this.$el.attr("data-photo-id",e)})},thumbnailDimensions:function(t,e){var i=this.photo.getHeightForWidth(100);return e&&i>e&&(i=e,t=this.photo.getWidthForHeight(100)),{width:Math.ceil(t),height:Math.ceil(i)}},resize:function(t){t||(t=r);var e=this.get("displayWidth")||0,i=this.get("displayHeight")||0,n=this.get("scaledWidth")||0,a=this.get("scaledHeight")||0;return o(this.js$("crop"),"stop"),o(this.js$("positioner"),"stop"),o(this.js$("image"),"stop"),s.join(o(this.js$("crop"),{width:e,height:i},{duration:t}),o(this.js$("positioner"),{width:Math.max(0,n-e),height:Math.max(0,a-i)},{duration:t}),o(this.js$("image"),{width:n,height:a},{duration:t}))},serialize:function(){return i.defaults(this.toJSON(),this.photo.toJSON())},beforeTeardown:function(){return this.stopListening(),this},render:function(){var t=this.serialize();return this.$el.html(this.template(t)),this.attachSubViews(),this}});e.exports=u},{"../models/photo":27,"../templates/photo.tpl":29,lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318,"velocity-animate":"lWl/mc",when:"RG2dij"}],37:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("../utils/imagelayout"),r=(t("prima/lib/logger"),t("prima/mixins/subviewable")),a=t("prima/mixins/selectorcache"),l=t("prima/mixins/accessor"),h=t("../models/photo"),d=t("../models/photoset"),c=t("../templates/photoset.tpl"),u=t("./photo"),p=t("../utils/attrdata"),m=function(t,e,s){i.isNumber(s)||(s=0);var o=0,r=t.length,a=e-2*s*(r-1),l=a/r,d=i.map(t,function(t,e){t instanceof h&&(t=t.toJSON());var i=e%2?Math.ceil(l):Math.floor(l);e>=r-1&&(i=a),a-=i;var s=Math.round(n.heightForWidth(t.width,t.height,i));return(!o||s&&o>s)&&(o=s),{width:i,height:s}});return{width:e,height:o,photos:d}},g=o.extend({className:"photoset",template:c,mixins:[r,a,l],defaults:{dynamic:!1,smallImageWidth:300,width:500,height:0,padding:5},$$cacheKeys:{row:".photoset--row",cell:".photoset--cell"},$$rows:function(t){return this.$$(this.$$cacheKeys.row,t)},$$cells:function(t){return this.$$(this.$$cacheKeys.cell,t)},initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this._PhotoView=t.PhotoView||u,this.photoset=t.photoset||new d},_updateRowCache:function(){return this._rowCache=i.map(this.photoset.getRows(),function(t){return i.pluck(t,"id")}),this._rowCache},_updateLayoutCache:function(){var t=this._updateRowCache(),e=this._layoutCache={rows:[],photos:{}},s=this.get("padding"),o=this.get("width"),n=0;return i.forEach(t,function(r,a){var l=this.photoset.photos.getSubset(r),h=a>0?s:0,d=a<t.length-1?s:0,c=this.rowSize(l,o,s),u=c.height+h+d;e.rows[a]={unpaddedHeight:c.height,paddingTop:h,paddingBottom:d,height:u,cells:[]},n+=u,i.forEach(l,function(t,i){var o=i<l.length-1?s:0,n=i>0?s:0,r=c.photos[i],h=t.get("id");e.photos[h]={scaledWidth:r.width,scaledHeight:r.height,displayWidth:r.width,displayHeight:c.height},e.rows[a].cells[i]={photo:h,unpaddedWidth:r.width,paddingLeft:n,paddingRight:o,width:r.width+n+o,height:u}},this)},this),e.width=o,e.height=n,this.set("height",n),e},rowSize:function(t,e,s){return t||(t=this.photoset.photos),i.isNumber(e)||(e=this.get("width")),i.isNumber(s)||(s=this.get("padding")),m(t,e,s)},createRowElement:function(){return s('<div class="photoset--row"></div>')},createCellElement:function(t){var e=s('<div class="photoset--cell"></div>');return null!=t&&p.set(e,"data-photo-id",t),e},createPhotoSubView:function(t){var e=new this._PhotoView({photoset:this.photoset,photos:this.photoset.photos,photo:t});return t.get("id")&&(this.subViews[t.get("id")]=e),e},createSubViews:function(){this.photoset.photos.forEach(this.createPhotoSubView,this)},createSinglePhotoLayout:function(){this._layoutCache||this._updateLayoutCache();var t=this.photoset.photos.at(0),e=t.get("width"),i=t.get("height");e>=this.get("smallImageWidth")&&(i=Math.round(n.heightForWidth(e,i,this.get("width"))),e=this.get("width"));var s=t.get("id"),o=this.subViews[s];o.set({scaledWidth:e,scaledHeight:i,displayWidth:e,displayHeight:i});var r=this.js$("layout"),a=this.createRowElement().height(i),l=this.createCellElement(s);
l.css({width:e,height:i,padding:0}).addClass("photoset--single-cell"),l.append(o.$el),a.append(l),r.append(a),this.renumberRowsAndCells()},createPhotosetLayout:function(){var t=this._layoutCache||this._updateLayoutCache();i.forEach(t.rows,function(e){var s=this.createRowElement();s.height(e.height),i.forEach(e.cells,function(o){var n=o.photo,r=t.photos[n],a=this.subViews[n];a.set(r);var l=this.createCellElement(n);l.css({width:o.width,height:o.height,padding:i.map([e.paddingTop,o.paddingRight,e.paddingBottom,o.paddingLeft],function(t){return t?t+"px":0}).join(" ")}),l.append(a.$el),s.append(l)},this),this.js$("layout").append(s)},this),this.renumberRowsAndCells()},renumberRowsAndCells:function(){i.forEach(this.$$rows(!0),function(t,e){p.set(t,"data-photoset-row",e)},this),i.forEach(this.$$cells(!0),function(t,e){p.set(t,"data-photoset-position",e)},this)},serialize:function(){return i.extend(this.toJSON(),{_rowSize:i.bind(this.rowSize,this),photoTemplate:u.prototype.template,photoset:this.photoset.toJSON()})},afterTeardown:function(){return this.stopListening(),delete this._rowCache,delete this._layoutCache,this.teardownSubViews()},render:function(){return this.get("dynamic")?(this.$el.html('<div class="photoset--layout" data-js-layout></div>'),this.createSubViews(),this.createPhotosetLayout()):this.$el.html(this.template(this.serialize())),this}});e.exports=g},{"../models/photo":27,"../models/photoset":28,"../templates/photoset.tpl":30,"../utils/attrdata":31,"../utils/imagelayout":32,"./photo":36,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/logger":268,"prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],38:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./templates/embed-code.tpl"),n=t("prima/lib/data"),r=s.extend({name:"PostEmbedCodeGenerator",defaults:{host_name:"",tumblelog_name:"",post_id:"",post_url:""},initialize:function(t){if(this.options=i.extend({},this.defaults,t),!this.options.host_name){var e=n.get("Context/hosts");this.options.host_name=e?e.embed_host:"https://www.tumblr.com"}this.template=o},getCode:function(){return this.template(this.options)}});e.exports=r},{"./templates/embed-code.tpl":39,lodash:"K2RcUv","prima/component":260,"prima/lib/data":263}],39:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",__p+="undefined"!=typeof language&&"undefined"!=typeof width?'<div class="tumblr-post" data-href="'+(null==(__t=host_name)?"":_.escape(__t))+"/embed/post/"+(null==(__t=tumblelog_name)?"":_.escape(__t))+"/"+(null==(__t=post_id)?"":_.escape(__t))+'" data-language="'+(null==(__t=language)?"":_.escape(__t))+'" data-width="'+(null==(__t=width)?"":_.escape(__t))+'">':"undefined"!=typeof language?'<div class="tumblr-post" data-href="'+(null==(__t=host_name)?"":_.escape(__t))+"/embed/post/"+(null==(__t=tumblelog_name)?"":_.escape(__t))+"/"+(null==(__t=post_id)?"":_.escape(__t))+'" data-language="'+(null==(__t=language)?"":_.escape(__t))+'">':"undefined"!=typeof width?'<div class="tumblr-post" data-href="'+(null==(__t=host_name)?"":_.escape(__t))+"/embed/post/"+(null==(__t=tumblelog_name)?"":_.escape(__t))+"/"+(null==(__t=post_id)?"":_.escape(__t))+'" data-width="'+(null==(__t=width)?"":_.escape(__t))+'">':'<div class="tumblr-post" data-href="'+(null==(__t=host_name)?"":_.escape(__t))+"/embed/post/"+(null==(__t=tumblelog_name)?"":_.escape(__t))+"/"+(null==(__t=post_id)?"":_.escape(__t))+'">',__p+='<a href="'+(null==(__t=post_url)?"":_.escape(__t))+'">'+(null==(__t=post_url)?"":_.escape(__t))+'</a></div><script async src="https://assets.tumblr.com/client/prod/standalone/embeddable_external/index.js"></script></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],40:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/collection"),o=t("../models/photo"),n=s.extend({model:o,add:function(t){return t&&!i.isArray(t)&&(t=[t]),i.forEach(t,function(t,e){t.id||(i.isFunction(t.set)?t.set("id",this.generateId(e)):t.id=this.generateId(e))},this),s.prototype.add.apply(this,arguments)},generateId:function(t){var e=1+(t||0),s=i.map(i.range(this.length+1),function(t){return"o"+(e+t)});return i.find(s,function(t){return!this.get(t)},this)},setIdOrder:function(t,e){e||(e={}),this.models=i.map(t,function(t){return this.get(t)},this),e.silent||this.trigger("sort",this,e)}});e.exports=n},{"../models/photo":47,lodash:"K2RcUv","prima/collection":259}],41:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("prima/mixins/promisifyevents"),n=t("prima/events"),r=t("prima/utils/sequence-with-context"),a=t("prima/component"),l=(t("prima/lib/logger"),t("./utils/avatar_size")),h=t("./models/post"),d=t("app/lib/currentuser"),c=t("app/components/upload/collections/uploads"),u=t("./views/post_form"),p=t("./utils/drag_eventor"),m=new p("body"),g=a.extend({name:"PostForm",viewOptionKeys:["fullWidthPosts","isModal","popoverContainer","dragEvents"],initialize:function(t){t=i.extend({dragEvents:m,autoFetch:!0},t),this.user=t.user||d(),this.post=t.post||new h,this.uploads=new c,this._preloadAvatars(),this.postForm=new u(i.extend(i.pick(t,this.viewOptionKeys),{user:this.user,post:this.post,uploads:this.uploads,model:this.post})),this.listenTo(n,"DOMEventor:keydown:escape",function(){n.trigger("postForms:close")}),this.listenTo(this.postForm,"all",function(){this.trigger.apply(this,arguments)}),t.autoFetch&&(this.postFetch=this.fetchPostData(this.post))},_preloadAvatars:function(t){t||(t=this.user.channels.pluck("avatar_url")),i.forEach(t,function(t){var e=new Image;e.src=l(t)(128)})},fetchPostData:function(t){return this.postFetch?this.postFetch:(t||(t=this.post),s.promise(function(e){t.has("lookupData")?t.fetch(t.get("lookupData")).then(function(){t.unset("lookupData"),e(t)}):e(t)}))},enable:function(){this.postForm.set("enabled",!0)},disable:function(){this.postForm.set("enabled",!1)},getRect:function(){return this.postForm.getRect()},isRendered:function(){return this.postForm.isRendered()},whenRendered:function(t){return null==t&&(t=!this.isRendered()),s.promise(i.bind(function(e){t?(this.listenToOnce(this,"ready",function(){e(this)}),this.render()):e(this)},this))},_render:function(){var t=this.whenEvent(this.postForm,"media:ready");return this.postForm.render(),this.initialPostState=this.postForm.post.toJSON(),this.postForm.set("initialPostState",this.initialPostState),this.listenToOnce(this.postForm,"postForms:changePostType",this.reloadPostForm),this.postForm.get("useMediaReady")?t.then(i.bind(function(){this.trigger("ready")},this)):this.trigger("ready"),delete this.postFetch,this},render:function(){return this.fetchPostData(this.post).then(i.bind(this._render,this))},remove:function(){this.stopListening(),this.postForm.remove()},reloadPostForm:function(){var t=r([function(){return this.postForm.animateHide(200)},function(){this.postForm.teardown();var t={lookupData:this.post.getLookupData(),tumblelog:this.post.get("tumblelog"),mode:this.post.get("mode"),loggingData:this.post.loggingData};this.post=this.postForm.post=this.postForm.model=new h(t),this.render()}],this);return t}});o.applyTo(g.prototype),e.exports=g},{"./models/post":49,"./utils/avatar_size":107,"./utils/drag_eventor":110,"./views/post_form":137,"app/components/upload/collections/uploads":191,"app/lib/currentuser":209,lodash:"K2RcUv","prima/component":260,"prima/events":261,"prima/lib/logger":268,"prima/mixins/promisifyevents":294,"prima/utils/sequence-with-context":315,when:"RG2dij"}],42:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("prima/lib/translate");i.prototype.genericFieldMap={two:"caption",three:"url"},i.prototype.editorField="two",i.prototype.typeAttributes={service:!1,preuploadUrl:"",trackTitle:"",trackArtist:"",trackAlbum:"",preuploadAlbumArt:!1,albumArt:"",caption:"",confirmTos:!1},i.prototype.resetPreserveFields=["caption","tags"],i.prototype.resetAttributes=["service","url","preuploadUrl","trackTitle","trackArtist","trackAlbum","confirmTos","preuploadAlbumArt","albumArt"],i.prototype.parseForType=function(t,e,i){e.url=i.audio_url,delete e.audio_url,e.albumArt=i.audio_artwork,delete e.audio_artwork;var s=i.id3_tags||{};return delete e.id3_tags,e.trackTitle=s.Title||"",e.trackArtist=s.Artist||"",e.trackAlbum=s.Album||"",e},i.prototype.serializeForServer=function(t){var e=t.apply(this,s.rest(arguments)),i={"id3_tags[title]":this.get("trackTitle")||null,"id3_tags[artist]":this.get("trackArtist")||null,"id3_tags[album]":this.get("trackAlbum")||null,preuploaded_url:this.get("preuploadUrl"),confirm_tos:this.get("confirmTos"),artwork_pre_upload:this.get("preuploadAlbumArt"),album_art:this.get("albumArt"),remove_album_art:"edit"===this.get("mode")&&s.isEmpty(this.get("albumArt"))};return s.extend(e,s.pick(i,function(t){return!s.isUndefined(t)})),e},i.prototype.validate=function(t,e){var i=[];return s.isEmpty(e.url)?i.push(o("Please choose an audio source before continuing.")):e.preuploadUrl?e.confirmTos||i.push(o("You must agree that you have permission to share this file.")):s.isEmpty(e.url)&&i.push(o("Please choose an audio source before continuing.")),t.call(this,e,{errors:i})},e.exports=i},{lodash:"K2RcUv","prima/lib/translate":288}],43:[function(t,e){"use strict";function i(){}var s=t("lodash");i.prototype.genericFieldMap={one:"title",two:"chat"},i.prototype.validate=function(t,e){var i=[];return(!e.chat||e.chat.length<1)&&i.push("No chat."),t.call(this,e,{errors:i})},i.prototype.serializeForServer=function(t){var e=this,i=t.apply(this,s.rest(arguments));return i["post[two]"]=e.get("chat").replace(/&nbsp;/gm," "),i},e.exports=i},{lodash:"K2RcUv"}],44:[function(t,e){"use strict";function i(){}var s=t("lodash");i.prototype.genericFieldMap={one:"title",two:"url",three:"caption",thumbnail:"thumbnail"},i.prototype.editorField="three",i.prototype.resetPreserveFields=["caption","tags"],i.prototype.resetAttributes=["title","url","thumbnail"],i.prototype.softReset=function(t){t.apply(this,s.rest(arguments)),s.isEmpty(this.get("thumbnail"))||"new"===this.get("mode")||this.set("remove_thumbnail",1)},i.prototype.serializeForServer=function(t){var e=t.apply(this,s.rest(arguments));return this.get("remove_thumbnail")&&(e.remove_thumbnail=this.get("remove_thumbnail")),e},i.prototype.validate=function(t,e){var i=[];return(!e.url||e.url.length<1)&&i.push("No url."),t.call(this,e,{errors:i})},e.exports=i},{lodash:"K2RcUv"}],45:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.extend({defaults:{fetchOptions:{url:"/svc/mention",with_form_key:!0},suggestCache:{},queryHistory:[],maxCacheSize:20,maxSuggests:5,blogSuggestions:{}},fetch:function(t){"query"in t&&"success"in t&&i.isFunction(t.success)||console.error("Mention must be provided a query and a success callback.");var e=t.query;if(i.extend(t,this.get("fetchOptions")),e in this.get("suggestCache")){var o=this.get("suggestCache")[e];return this.set("blogSuggestions",o),t.success.call(this,this,o,t)}return t.data={q:e},s.prototype.fetch.call(this,t)},parse:function(t,e){var i=this._processQueryResults(t,e);return this._cacheQueryResults(i,e),i},_processQueryResults:function(t,e){var s=e.query;return i.extend(t,{queryRegex:this._escapeRegex(s)})},_cacheQueryResults:function(t,e){var s=i.clone(this.get("suggestCache")),o=i.clone(this.get("queryHistory"));s[e.query]=t,o.push(e.query),i.size(s)>this.get("maxCacheSize")&&(delete s[o[0]],o.shift()),this.set("suggestCache",s),this.set("queryHistory",o)},_escapeRegex:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\~\`\!\@\#]/g,"\\$&")}});e.exports=o},{lodash:"K2RcUv","prima/model":298}],46:[function(t,e){"use strict";function i(){}i.prototype.genericFieldMap={one:"ask",two:"answer",three:"caption"},i.prototype.editorField="three",i.prototype.validate=function(t,e){var i=[];return(!e.ask||e.ask.length<1||!e.answer||e.answer.length<1)&&i.push("Post body empty."),t.call(this,e,{errors:i})},e.exports=i},{}],47:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/model"),n=t("prima/utils/image/loader"),r=t("prima/utils/image/filereader"),a=t("prima/utils/image/canvas"),l=1080,h=o.extend({defaults:{url:"",preuploadUrl:"",externalUrl:"",file:null,photoRaw:null,base64:null,isSelfie:!1,isSelfieGif:!1,width:null,height:null,caption:"",id:""},initialize:function(){this.on("change:externalUrl",function(t,e){e&&this.readUrl(e),this.set({preuploadUrl:null,base64:null})},this),this.get("externalUrl")&&!this.get("base64")&&this.trigger("change:file",this,this.get("file")),this.on("change:file",function(t,e){e&&this.readFile(e),this.set({externalUrl:null,base64:null})},this),this.get("file")&&!this.get("base64")&&this.trigger("change:file",this,this.get("file"))},readUrl:function(t,e){e||(e="photo:readUrl"),n.load(t).then(i.bind(function(t){this.set({url:t.src,width:t.width,height:t.height}),this.trigger(e,!0,this)},this),i.bind(function(i){this.set({url:t,width:null,height:null}),this.trigger(e,!1,this)},this))},readFile:function(t){return r.canReadFiles()?void r.read(t).then(i.bind(function(t){if(!t.file.type.match(/image\/(jpg|jpeg|png)/i))return this.readUrl(t.objectUrl||t.base64,"photo:readFile");var e=s("<img/>");e.attr("src",t.objectUrl||t.base64),n.load(t.objectUrl||t.base64).then(i.bind(function(i){var s=a.drawScaledAndRotated(e,i.width,i.height,t.rotation,t.mirrored,l);return this.readUrl(s.toDataURL(t.file.type),"photo:readFile")},this))},this),i.bind(function(){this.trigger("photo:readFile",!1,this)},this)):void this.trigger("photo:readFile",!1,this)},getDisplayUrl:function(){return this.get(this.get("preuploadUrl")?"preuploadUrl":this.get("externalUrl")?"externalUrl":this.get("base64")?"base64":"url")},getUploadUrl:function(){return this.get("preuploadUrl")?this.get("preuploadUrl"):this.get("externalUrl")?this.get("externalUrl"):""},toJSON:function(){var t=o.prototype.toJSON.apply(this,arguments);return t.displayUrl=this.getDisplayUrl(),t.uploadUrl=this.getUploadUrl(),t}});e.exports=h},{jquery:"HlZQrA",lodash:"K2RcUv","prima/model":298,"prima/utils/image/canvas":310,"prima/utils/image/filereader":311,"prima/utils/image/loader":312}],48:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("../collections/photos");i.prototype.genericFieldMap={two:"caption",three:"linkthrough"},i.prototype.editorField="two",i.prototype.typeAttributes={layout:"",linkthrough:"",photos:[]},i.prototype.MAX_IMAGES=10,i.prototype.resetPreserveFields=["caption","tags"],i.prototype.afterDelegate=function(t){t.apply(this,s.rest(arguments)),this.photos=new o(this.attributes.photos,{parse:!0}),this.on("change:photos",function(t,e){this.photos.reset(e,{parse:!0}),delete this.attributes.photos},this),this.trigger("change:photos",this.get("photos")),this.listenTo(this.photos,"add remove change:preuploadUrl change:externalUrl",function(){this.trigger("validate")})},i.prototype.parseForType=function(t,e,i){return e.layout=i.photoset_layout,delete e.photoset_layout,e},i.prototype.serializeForServer=function(t){var e=this,i=t.apply(this,s.rest(arguments));return s.forEach(this.photos.toJSON(),function(t){i["images["+t.id+"]"]=t.uploadUrl,i["caption["+t.id+"]"]=(t.caption||"").substr(0,200),t.photoRaw&&(i.photo_raw=t.photoRaw,i.is_selfie_gif=t.isSelfieGif,i.is_selfie=t.isSelfie)}),i["post[photoset_layout]"]=e.get("layout"),i["post[photoset_order]"]=this.photos.pluck("id").join(","),i},i.prototype.canAddPhotos=function(){return this.photos.length<this.MAX_IMAGES},i.prototype.validate=function(t,e){var i=[];0===this.photos.length&&i.push("No photos specified.");var s=this.photos.all(function(t){return t.getUploadUrl()||!t.has("upload")});return s||i.push("Uploads in progress."),t.call(this,e,{errors:i})},e.exports=i},{"../collections/photos":40,lodash:"K2RcUv"}],49:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=t("prima/mixins/delegator"),n=t("./text_post"),r=t("./photo_post"),a=t("./quote_post"),l=t("./link_post"),h=t("./chat_post"),d=t("./audio_post"),c=t("./video_post"),u=t("./note_post"),p=t("../utils/bool_tool"),m=s.extend({mixins:[o],typeDelegateMap:{text:n,photo:r,quote:a,link:l,chat:h,audio:d,video:c,note:u},_VALID_STATES:{published:"0",draft:"1",queued:"2",scheduled:"on.2","private":"private",unapproved:"3",transcoding:"4"},_FORMAT_CODE_TO_EDITOR_TYPE:{0:"rich",1:"html",2:"markdown"},_STATE_CODE_TO_TEXT:{0:"published","0 3":"published",1:"draft",2:"queued",3:"unapproved",4:"transcoding","on.2":"scheduled","private":"private"},defaults:{allow_photo_replies:Boolean(),postDate:String(),customUrl:String(),sourceUrl:String(),state:"published",editorType:"rich",tags:[],publish_on:String(),tumblelog:String(),uploading:!1,mode:"new"},typeAttributes:{},editorField:!1,resetPreserveFields:[],resetAttributes:[],_syntheticAttributes:{pseudoState:function(){var t=this.get("state"),e=this.get("publish_on");return"published"===t&&1===parseInt(this.get("is_private"),10)&&(t="private"),"queued"===t?i.isEmpty(e)?"queued":"scheduled":t},formattedSourceUrl:function(){var t=this.get("sourceUrl"),e=function(t,e){return/^([^\/]+):\/\//i.test(t)||(e||(e="http"),t=e+"://"+t),t};return i.isEmpty(t)?"":e(t)}},initialize:function(){this._assignPostTypeFunctionality()},_assignPostTypeFunctionality:function(){var t=this.get("type"),e=i.bind(function(t){return t in this.typeDelegateMap?this.typeDelegateMap[t].prototype:!1},this);t?(this.delegateObject(e(t)),this.afterDelegate()):this.listenToOnce(this,"change:type",function(t,i){this.delegateObject(e(i)),this.afterDelegate()})},afterDelegate:function(){i.defaults(this.attributes,this.typeAttributes)},_normalizeType:function(t,e){var s={regular:"text",conversation:"chat"};return e===!1&&(s=i.invert(s)),t in s?s[t]:t},get:function(t){return(this._syntheticAttributes[t]||s.prototype.get).apply(this,arguments)},fetch:function(t){var e={data:t};return s.prototype.fetch.call(this,e)},parse:function(t,e){var s=t.post,o=e.data,n={},r=s.id?"edit":"reblog";n.type=this._normalizeType(s.type,!0),n.can_reblog_as=i.map(s.can_reblog_as,i.bind(function(t){return this._normalizeType(t,!0)},this)),this.set("type",n.type),i.forEach(this.genericFieldMap,function(t,e){n[t]=s[e]});var a=["one","two","three","state","publish_on","tags","type","can_reblog_as"];return i.extend(n,i.omit(s,a),{createdPost:!!t.created_post,postTumblelog:t.post_tumblelog||{},postContextPage:t.post_context_page}),"edit"===r?(n["post-id"]=s.id,n.tags=s.tags?s.tags.split(","):[],n.tumblelog=n.postTumblelog.name_or_id||!1):"reblog"===r&&i.extend(n,i.pick(o,["reblog_id","reblog_key"])),"state"in s&&(n.state=this._extractState(s)),s.from_app&&1===i.parseInt(s.format)||(n.editorType=this._FORMAT_CODE_TO_EDITOR_TYPE[i.parseInt(s.format||0)]),n.editorType||(n.editorType=this.get("editorType")||this._FORMAT_CODE_TO_EDITOR_TYPE[0]),i.extend(n,{sourceUrl:n.source_url||"",htmlEdited:"rich"!==n.format&&!(this.editorField&&!s[this.editorField]),postDate:n.date||"",customUrl:n.slug||""},i.mapValues(i.pick(n,["allow_answers","allow_photo_replies","html_mode"]),p)),"edit"!==r||"queued"!==n.state||i.isEmpty(s.publish_on)||(n.state="scheduled",n.publish_on=s.publish_on),this.parseForType(n,s)},parseForType:function(t){return t},sync:function(t,e,o){var n={create:"/svc/post/update",read:"/svc/post/fetch",update:"/svc/post/update"};return i.defaults(o||(o={}),{emulateHTTP:!0,forServer:!0,url:n[t]}),s.prototype.sync.call(this,t,e,o)},toJSON:function(t){return t=i.defaults(t||{},{forServer:!1}),t.forServer?this.serializeForServer(t):s.prototype.toJSON.call(this,t)},serializeForServer:function(){var t=this,e=t.attributes,s={channel_id:e.tumblelog,post_id:e["post-id"],"post[date]":e.postDate,"post[one]":this.getAttributeFromGeneric("one"),"post[publish_on]":e.publish_on,"post[slug]":e.customUrl,"post[tags]":e.tags.join(),"post[two]":this.getAttributeFromGeneric("two"),"post[three]":this.getAttributeFromGeneric("three"),thumbnail:this.getAttributeFromGeneric("thumbnail"),editor_type:e.editorType,send_to_twitter:e.send_to_twitter,custom_tweet:e.custom_tweet,send_to_fbog:e.send_to_fbog,loggingData:e.loggingData,allow_photo_replies:e.allow_photo_replies};"edit"===e.mode&&(s.edit_post_id=e["post-id"]),s["post[source_url]"]=t.get("formattedSourceUrl"),s["post[state]"]=t._VALID_STATES[e.state],s["post[type]"]=this._normalizeType(e.type,!1);var o={reblog:e.is_reblog,reblog_key:e.reblog_key,reblog_post_id:e.reblog_id,pt:e.pt,remove_reblog_tree:e.remove_reblog_tree};i.extend(s,i.pick(o,function(t){return!i.isUndefined(t)})),e.allow_answers&&(s.allow_answers="on"),this.getAttributeFromGeneric("thumbnail")&&(s.thumbnail_pre_upload="1");var n="dashboard";return e.contextData&&"baseRoute"in e.contextData&&(n=e.contextData.baseRoute.split("/").pop()),i.extend(s,{context_id:e.tumblelog,context_page:n,"is_rich_text[one]":"0","is_rich_text[two]":"0","is_rich_text[three]":"0"}),this.editorField&&(s["is_rich_text["+this.editorField+"]"]="1"),s},validate:function(t,e){var s="errors"in e?e.errors:[];return t.state&&(i.has(this._VALID_STATES,t.state)||s.push('Invalid "state" value')),i.each(this.defaults,function(e,i){typeof e!=typeof t[i]&&s.push('Invalid "'+i+'" type. Expected '+typeof e+", got "+typeof t[i]+".")}),s.length?s:void 0},_extractState:function(t){var e=this._STATE_CODE_TO_TEXT[t.state];return 1===parseInt(t.is_private,10)&&(e="private"),e},findBlogChannelByName:function(t){return this.attributes.tumblelog&&this.attributes.tumblelog.collection&&"findWhere"in this.attributes.tumblelog.collection?this.attributes.tumblelog.collection.findWhere({name_or_id:t}):void 0},getPreservedData:function(){return this.resetPreserveFields.some(i.bind(function(t){return this.get(t)&&this.get(t).length>0},this))},softReset:function(){i.forEach(this.resetAttributes,function(t){i.has(this.typeAttributes,t)?this.set(t,this.typeAttributes[t]):i.has(this.defaults,t)?this.set(t,this.defaults[t]):this.unset(t)},this)},getLookupData:function(){return"reblog"===this.get("mode")?{reblog_id:this.get("reblog_id"),reblog_key:this.get("reblog_key"),post_type:this.get("type")}:void 0},getAttributeFromGeneric:function(t){return this.get(this.genericFieldMap[t])},canEditMedia:function(){return!this.get("is_reblog")},isReblog:function(){return!!this.get("is_reblog")},allowsReblogAs:function(){var t=[this.get("type")],e=this.get("can_reblog_as")||t;return"reblog"===this.get("mode")&&i.difference(e,t).length},deepHasChanged:function(t){var e=this.toJSON(),s=this.get("mode"),o=i.keys(t),n=i.keys(e);if(i.isEqual(t,e))return!1;if("new"!==s)return!0;var r=i.difference(n,o),a=i.reduce(r,function(t,s){var o=e[s],n=i.isUndefined(o)||i.isNull(o)?0:o.length;return t+n},0);return a>0?!0:(t=i.omit(t,r),e=i.omit(e,r),!i.isEqual(t,e))}});e.exports=m},{"../utils/bool_tool":108,"./audio_post":42,"./chat_post":43,"./link_post":44,"./note_post":46,"./photo_post":48,"./quote_post":50,"./text_post":52,"./video_post":53,lodash:"K2RcUv","prima/mixins/delegator":290,"prima/model":298}],50:[function(t,e){"use strict";function i(){}i.prototype.genericFieldMap={one:"quote",two:"source"},i.prototype.editorField="two",i.prototype.validate=function(t,e){var i=[];return(!e.quote||e.quote.length<1)&&i.push("No quote."),t.call(this,e,{errors:i})},e.exports=i},{}],51:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.extend({defaults:{fetchOptions:{url:"/svc/tag_suggest",with_form_key:!0},suggestCache:{},queryHistory:[],maxCacheSize:20,maxSuggests:5,tagSuggestions:{}},initialize:function(t){if(!1==("user"in t&&"post"in t))throw new Error("Tag Suggestions must be provided user and post models.")},fetch:function(t){return"query"in t&&"success"in t&&i.isFunction(t.success)||console.error("TagSuggestion must be provided a query and a success callback."),i.extend(t,this.get("fetchOptions")),t.query in this.get("suggestCache")?(this.set("tagSuggestions",this.get("suggestCache")[t.query]),t.success.call(this,this,"suggestCache",t)):(t.data={q:t.query},s.prototype.fetch.call(this,t))},parse:function(t,e){var i=this.get("user"),s=this.get("post").get("tumblelog"),o={suggestions:"tags"in t?t.tags:[],userTags:s?i.getChannelProperty(s,"tags"):[]};return o.userTags||(o.userTags=[]),o=this._processQueryResults(o,e),this._cacheQueryResults(o,e),{tagSuggestions:o}},_processQueryResults:function(t,e){var s=new RegExp(this._escapeRegex(e.query),"i");return t.suggestions=i.compact(i.map(t.suggestions,function(t){return t.tag})).slice(0,this.get("maxSuggests")),t.userTags=i.compact(i.filter(t.userTags,function(t){return s.test(t)})).slice(0,this.get("maxSuggests")),t},_cacheQueryResults:function(t,e){var s=i.clone(this.get("suggestCache")),o=i.clone(this.get("queryHistory"));s[e.query]=t,o.push(e.query),i.size(s)>this.get("maxCacheSize")&&(delete s[o[0]],o.shift()),this.set("suggestCache",s),this.set("queryHistory",o)},_escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}});e.exports=o},{lodash:"K2RcUv","prima/model":298}],52:[function(t,e){"use strict";function i(){}var s=t("lodash");i.prototype.genericFieldMap={one:"title",two:"body"},i.prototype.editorField="two",i.prototype.validate=function(t,e){var i=[],o=!s.isUndefined(e.reblog_tree)&&e.reblog_tree!==!1&&""!==e.reblog_tree,n=o&&e.remove_reblog_tree===!0;return(!e.body||e.body.length<1)&&(!e.title||e.title.length<1)&&(!o||o&&n)&&i.push("Post body empty."),t.call(this,e,{errors:i})},e.exports=i},{lodash:"K2RcUv"}],53:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("prima/lib/translate"),n=t("../utils/remap_keys"),r=t("../utils/camelize_keys");i.prototype.genericFieldMap={one:"embedCode",two:"caption"},i.prototype.editorField="two",i.prototype.resetPreserveFields=["caption","tags"],i.prototype.resetAttributes=["preuploadUrl","preuploadKey","embedCode","confirmTos"],i.prototype.typeAttributes={caption:"",confirmTos:!1},i.prototype.validate=function(t,e){var i=[];return e.embedCode?0===e.embedCode.length&&i.push("No embed specified."):e.preuploadUrl?e.confirmTos||i.push(o("You must agree that you have permission to share this file.")):e.video?0===e.video.embed_code.length&&i.push("Direct embed missing."):i.push("No video specified."),t.call(this,e,{errors:i})},i.prototype.serializeForServer=function(t){var e=t.apply(this,s.rest(arguments)),i=s.omit({preuploaded_url:this.get("preuploadUrl"),preuploaded_ch:this.get("preuploadKey"),confirm_tos:this.get("confirmTos")},s.isUndefined);return s.extend(e,i),e=n(e,"snake",["embedCode"])},i.prototype.getEmbedData=function(){var t=!1;return this.has("video")?(t=r(this.get("video")),t={isNativeVideo:!0,embedRenderContext:"inline",width:t.dimensions.width,height:t.dimensions.height,previewIframe:t.previewIframe,embedCode:t.embedCode}):this.has("video_embed")&&(t=r(this.get("video_embed"))),t},e.exports=i},{"../utils/camelize_keys":109,"../utils/remap_keys":111,lodash:"K2RcUv","prima/lib/translate":288}],54:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("backbone"),n=function(){var t=4,e=["spotify","soundcloud","bandcamp"],n=["spotify","soundcloud"],r={normalizeResults:function(e,s){switch(e){case"spotify":return{service:e,tracks:i.map(i.first(s.tracks,t),function(t){return{primary:t.name,secondary:i.first(t.artists).name,info:t.album.name,href:t.href,id:t.href}})};case"soundcloud":return{service:e,tracks:i.map(i.first(s,t),function(t){return{primary:t.title,secondary:t.user.username,info:null,href:t.permalink_url,id:t.id}})};default:throw"Invalid service: "+e}},getServiceByUrl:function(t){var e={spotify:/(open\.spotify\.com|spotify)[\/|:](track|album|artist|playlist|user)[\/|:](.*)?([\d\w]{22})$/,soundcloud:/(http|https):\/\/soundcloud\.com\/[^\/]+\/(sets\/)?[^\/]+\/?$/,bandcamp:/(http|https):\/\/(?:([^\/]+\.)\.bandcamp\.com|[^\/]+\.[^\/]+)\/(track|album)\/[^\/]+$/,direct:/[.](mp3)$/i};for(var i in e)if(e[i].test(t))return i;return!1},getData:function(t,o){if(!i.contains(e,o))return!1;var n=s.ajax({url:"/svc/post/get_"+o+"_data",type:"POST",with_form_key:!0,data:{url:t,service:o}});return n.then(i.bind(function(e){e&&!e.error?this.trigger("audioEmbedData:fetched",t,o,e):this.trigger("audioEmbedData:error",t,o,e)},this),i.bind(function(e){this.trigger("audioEmbedData:error",t,o,e)},this))},search:function(t,e){if(!i.contains(n,t))return!1;var o=s.ajax({url:"/search_audio",type:"POST",with_form_key:!0,data:{q:e,audio_search_provider:t}});return o.then(i.bind(function(e){this.trigger("searchResults:fetched",this.normalizeResults(t,e))},this),i.bind(function(){this.trigger("searchResults:fetched",{service:t,tracks:[]})},this))}};return function(){this.dataServices=e,this.searchServices=n,i.extend(this,o.Events,r)}}();e.exports=n},{backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv"}],55:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=2e3,r=t("prima/class"),n=2e3,a=function(t,e,i){this.name="EmbedError",this.message=t,this.input=e,this.data=i,this.stack=(new Error).stack};a.prototype=new Error;var l=r.extend({constructor:function(t){this.setEmbedRegexes(t||[])},setEmbedRegexes:function(t){this.regexes=t},isValidEmbedService:function(t){return i.any(this.regexes,function(e,i){return new RegExp(i,"mi").test(t)})},getUrlFromEmbedCode:function(t){var e=s("<div/>").append(t),i=e.find("iframe[src], embed[src], script[src]").first(),o=e.find("object[data]").first();return i.attr("src")||o.attr("data")||!1},fetchEmbedData:function(t,e){var r=s.ajax({url:"/svc/post/get_video_data",type:"POST",with_form_key:!0,data:JSON.stringify({embed_url:t})});return o(r).then(function(s){if(i.isEmpty(s)||"false"===s)throw new a("Invalid embed response",t,s);if(s.thumbnail||e)return s;var r=i.bind(this.fetchEmbedData,this,t,!0);return o.promise(function(){i.delay(function(){r().then(function(t){return t},function(){return s})},n)})}).catch(function(t){return o.reject(t)})},parseEmbedData:function(t){if(!i.isString(t))throw"The input is invalid. Expected a string";var e=i.trim(t);if(this.isValidEmbedService(e))return this.fetchEmbedData(e);var s=this.getUrlFromEmbedCode(e);return i.isEmpty(s)?o.reject(new a("Invalid embed code",t)):o.resolve({unsupported:!0,thumbnail:!1,embed_render_context:"blank",url:s,preview_iframe:"",embed_code:t})}});e.exports=new l},{jquery:"HlZQrA",lodash:"K2RcUv","prima/class":258,when:"RG2dij"}],56:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=(t("prima/events"),t("backbone")),n=t("../views/inline_embed_field"),r=t("../services/embed_data"),a=(t("prima/lib/logger"),t("prima/lib/translate")),l=t("../utils/camelize_keys"),h=function(){var t=10,e={trayOpened:function(){this.checkLimit(),this.inlineEmbedField.hide()},trayClosed:function(){this.inlineEmbedField.hide()},disable:function(){this.isDisabled=!0,this.$inlineEmbedButton.addClass("disabled")},enable:function(){this.isDisabled=!1,this.$inlineEmbedButton.removeClass("disabled")},checkLimit:function(){this.isAtLimit()?this.disable():this.enable()},isAtLimit:function(){var e=s(this.editor.element).find("figure.inlineEmbedPlaceholder, figure.inlineEmbed");return e.length>=t},calculateWidth:function(){var t=s(this.editor.element),e=t.width(),i=t.offset(),o=this.editor.inlineControls.tray,n=o.offset();return e-(n.left-i.left)},returnFocus:function(){if(!this.editorView.inlineControlNode)return!1;var t=document.createRange(),e=window.getSelection();t.setStart(this.editorView.inlineControlNode,0),t.collapse(!0),this.inlineEmbedField.hide(),this.editor.inlineControls.open(),e.removeAllRanges(),e.addRange(t)},insertEmbed:function(t){if(this.editor.inlineControls.isTrayOpen){var e={"class":"inlineEmbedPlaceholder","data-provider":encodeURIComponent(t.service),"data-orig-width":encodeURIComponent(t.widthOrig),"data-orig-height":encodeURIComponent(t.heightOrig),"data-embed-code":encodeURIComponent(t.embedCode)};i.isEmpty(t.url)||(e["data-url"]=encodeURIComponent(t.url));var s=this._buildEmbedFigure(e,t.previewIframe),o=s.get(0);
this.editor.insertMedia(o,!1,this.editorView.inlineControlNode,0),this.editor.inlineControls.close(),this.checkLimit()}},submitEmbedCode:function(){var t=this.inlineEmbedField.getCurrentValue();if(t=i.trim(t.replace(/\u200B/g,"")),""===t)return void this.inlineEmbedField._set_field_state_default();var e=this.embedCodeParser(t);return e?void e.then(i.bind(function(e){return this.inlineEmbedField.set("embedCode",t),e?(this.inlineEmbedField._set_field_state_default(),e=l(e),void this.insertEmbed(e)):void this.inlineEmbedField._set_field_state_invalid()},this),function(e){this.inlineEmbedField.set("embedCode",t),this.inlineEmbedField._set_field_state_invalid()}):(this.inlineEmbedField._set_field_state_invalid(),void this.inlineEmbedField.set("embedCode",t))},embedCodeParser:function(t){if(this._embedCodeParsing&&this._embedCodeParsing.abortEmbedCodeParse(),!i.isEmpty(i.trim(t))){var e=!1,s=this._parseEmbedCode=r.parseEmbedData(t).then(i.bind(function(t){return t},this),function(t){return!1});return s.abortEmbedCodeParse=function(){e=!0},s}},removeEmbedPlaceholders:function(t){var e=document.createElement("div");e.innerHTML=t;var o=function(t){return i.isEmpty(t)?!1:decodeURIComponent(t)};return s(e).find("figure.inlineEmbedPlaceholder").each(i.bind(function(t,e){var i=s(e),n=o(i.attr("data-embed-code")),r=i.attr("data-url"),a={"class":"inlineEmbed","data-provider":i.attr("data-provider"),"data-orig-width":i.attr("data-orig-width"),"data-orig-height":i.attr("data-orig-height")};if(r&&(a["data-url"]=r),o(a["data-provider"])&&o(a["data-orig-width"])&&o(a["data-orig-height"])&&n){var l=this._buildEmbedFigure(a,n);i.replaceWith(l)}else i.remove()},this)),e.innerHTML},addEmbedPlaceholders:function(e){var o=this.editorView.hosts.safe_host+"/svc/embed/inline/",n=document.createElement("div");n.innerHTML=e;var r=function(t){return i.isEmpty(t)?!1:decodeURIComponent(t)};return s(n).find("figure.inlineEmbed").each(i.bind(function(e,i){var n=s(i),a=n.parents(),l=a&&s(a).filter("blockquote").length>0;if(t>=e){var h={code:n.html(),provider:r(n.attr("data-provider")),url:r(n.attr("data-url")),width:r(n.attr("data-orig-width")),height:r(n.attr("data-orig-height"))},d=this.editorView.get(l?"inlineMediaWidthReblog":"inlineMediaWidthFull"),c=Math.ceil(h.height*d/h.width),u=o+encodeURIComponent(h.url?h.url:h.code);u+="?w="+d+"&h="+c;var p={"class":"embed_iframe inline",src:u,scrolling:"no",frameBorder:"0",allowfullscreen:!0,mozallowfullscreen:!0,webkitallowfullscreen:!0},m=s("<iframe/>",p);m.attr("width",d),m.attr("height",c);var g=document.createElement("div");g.appendChild(m.get(0).cloneNode(!0));var f=g.innerHTML,_={"class":"inlineEmbedPlaceholder","data-provider":n.attr("data-provider"),"data-orig-width":n.attr("data-orig-width"),"data-orig-height":n.attr("data-orig-height"),"data-embed-code":encodeURIComponent(h.code)};n.attr("data-url")&&(_["data-url"]=n.attr("data-url"));var v=this._buildEmbedFigure(_,f);n.replaceWith(v)}else n.remove()},this)),this.checkLimit(),n.innerHTML},_buildEmbedFigure:function(t,e){var i=s("<figure/>",t);return e&&i.html(e),i}},h=function(t,r){i.extend(this,o.Events,e),this.editorView=t,this.editor=r,this.$inlineEmbedButton=s('<div class="control add-inline-embed"></div>'),this.editor.inlineControls.addToTray(this.$inlineEmbedButton);var l=s("<div/>",{"data-subview":"inlineEmbedField"});this.editor.inlineControls.addToTray(l.get(0)),this.inlineEmbedField=t.subViews.inlineEmbedField=new n({placeholder:a("Paste a video embed..."),submitEmbedCode:i.bind(this.submitEmbedCode,this),calculateWidth:i.bind(this.calculateWidth,this),returnFocus:i.bind(this.returnFocus,this)}),this.$inlineEmbedButton.on("mousedown",i.bind(function(t){this.checkLimit(),1===t.which&&(this.isDisabled||this.inlineEmbedField.show())},this)),this.isDisabled=this.isAtLimit()};return h}();e.exports=h},{"../services/embed_data":55,"../utils/camelize_keys":109,"../views/inline_embed_field":125,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/lib/logger":268,"prima/lib/translate":288}],57:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/events"),n=t("ligature").SelectionContext,r=t("backbone"),a=function(){var t=function(){},e={rangeDebounce:10},a={enterMention:function(e){this.currentMention=e,this.inMention=!0,this.renderGhost(e),this.trigger("mention:enter"),t("MentionSupport:enterMention - querying server for [%s]",e.string),this.queryServer(e.string)},updateMention:function(e){if(this.inMention&&e.string!==this.currentMention.string){if(!this.isSameMention(e))return this.exitMention(e),void this.enterMention(e);this.currentMention=e,this.inMention=!0,this.renderGhost(e),this.trigger("mention:update"),t("MentionSupport:updateMention - querying server for [%s]",e.string),this.queryServer(e.string)}},exitMention:function(){this.currentMention=!1,this.inMention=!1,this.lastTypeahead="",this.teardownGhost(),this.trigger("mention:exit")},softConfirm:function(t){var e=h();e.caretPosition===e.offsetEnd&&this.confirmMention(t)},confirmMention:function(t,e){e=e||this.dropdown.getCurrentBlogChoice(),e&&this.setMention(e)},setMention:function(t){var e=this.lastInfo,i=t.name,s=document.createTextNode(""),o=document.createElement("a"),n=this.lastSelection;o.setAttribute("class","tumblelog"),o.spellcheck=!1,o.innerHTML=i,e.mentionRange.deleteContents(),e.mentionRange.insertNode(s),e.mentionRange.insertNode(o),e.mentionRange.collapse(),n.removeAllRanges(),n.addRange(e.mentionRange),this.exitMention(e)},linkToMention:function(e){var i,o,r,a=n.getSelection(),l=e.range.commonAncestorContainer.parentElement||s(e.range.commonAncestorContainer).parent().get(0);return this.currentMention!==!1&&this.exitMention(e),l.classList.contains("tumblelog")?(i=document.createRange(),i.selectNode(l),i.deleteContents(),o=document.createTextNode("@"+e.string),i.insertNode(o),r=document.createRange(),a.removeAllRanges(),r.setStart(o,e.caretPosition+1),r.setEnd(o,e.caretPosition+1),a.addRange(r),this.cleanupRangeArea(a,r),t("MentionSupport:linkToMention",e.string),void this.onSelection(a)):!1},abortMention:function(){this.escapeMention=h(),this.inMention&&this.exitMention(this.escapeMention)},isSameMention:function(t){return this.currentMention&&this.currentMention.offsetStart===t.offsetStart},isMentionLink:function(t){var e,i=document.createElement("div"),o=this.adjustRange(t);return o?(i.appendChild(o.cloneContents()),e=s(i).find("a:first"),e.length?e.hasClass("tumblelog"):!1):!1},cleanupRangeArea:function(t,e){var i,o,n=document.createElement("span");n.setAttribute("id","mention_cleanup_placeholder"),n.innerHTML="",e.insertNode(n),this.normalize(t,e),i=e.commonAncestorContainer.parentElement,i||(i=s(e.commonAncestorContainer).parent().get(0)),i.normalize(),1===s(i).length&&(o=s(i).html(),o=o.replace(/[\u200B]/g,""),s(i).html(o));var r=s(document).find("#mention_cleanup_placeholder");r.length>0&&(t.removeAllRanges(),e.selectNode(r.get(0)),e.deleteContents(),t.addRange(e),i.normalize())},adjustRange:function(t){var e,s;return i.isUndefined(t)?!1:(t=t.cloneRange(),e=t.commonAncestorContainer,s=3===e.nodeType?e.parentNode:e,s.textContent===t.toString()&&t.selectNode(s),t)},normalize:function(t,e){this.editor.element.normalize(),null===t||i.isUndefined(e)||(t.removeAllRanges(),t.addRange(e))},renderGhost:function(t){if(this.$ghost=s(document).find("#ui_mention_util_ghost"),!(this.$ghost.length>0)){var e=document.createElement("q");e.setAttribute("id","ui_mention_util_ghost"),e.innerHTML="&#8203;",e.className="mention-ghost",t.suffixRange.surroundContents(e),this.$ghost=s(document).find("#ui_mention_util_ghost"),this.trigger("ghost:render",this.$ghost)}},teardownGhost:function(t){if(t&&t.range||(t=this.lastInfo),this.$ghost=s(document).find("#ui_mention_util_ghost"),0!==this.$ghost.length){var e=this.$ghost.parent().get(0),i=t.caretRange.commonAncestorContainer,o=n.getSelection(0),r=o?o.getRangeAt(0):!1;o&&"ui_mention_util_ghost"===s(i).attr("id")&&(r.selectNode(i),r.deleteContents(),r.collapse(!1)),this.$ghost=s(document).find("#ui_mention_util_ghost"),1===this.$ghost.length&&(this.$ghost.remove(),this.trigger("ghost:teardown")),e&&e.normalize(),o&&r&&(o.removeAllRanges(),o.addRange(r))}},insertGhost:function(t){var e=n.getSelection(0),o=e.getRangeAt(0);this.$ghost=s(document).find("#ui_mention_util_ghost"),0!==this.$ghost.length&&(this.$ghost.html(t),null===e||i.isUndefined(o)||(e.removeAllRanges(),e.addRange(o)))},maintainTypeaheadGhost:function(e,i){var s=this.dropdown.getBlogChoice(0),o=s?s.name:this.lastTypeahead;if(t("MentionSupport:maintainGhost - topSuggestion = %s, typeahead = %s, lastChar = %s",s,o,i),i&&this.lastTypeahead.length&&i===this.$ghost.text().substr(0,1))this.$ghost.text(this.$ghost.text().substr(1));else if(e&&8===e.keyCode){var n=o.substr(this.lastTypeahead.length-this.$ghost.text().length-1);t("MentionSupport:maintainGhost BACKSPACE"),this.$ghost.text(n)}else this.updateTypeahead(o)},stripGhost:function(t){if(!t)return t;var e=s("<span>"+t+"</span>");return e.find("#ui_mention_util_ghost").remove(),e.html()},updateTypeahead:function(e){var i=this.currentMention;i&&this.inMention||this.teardownGhost(),t("MentionSupport:updateTypeahead - typeahead = [%s]",e),this.lastTypeahead=e;var s="";i=i.string;var o=i.toUpperCase(),n=e.toUpperCase();e.length>i.length&&o===n.substr(0,o.length)&&(s=e.substr(i.length,e.length-i.length)),this.insertGhost(s)},updateForInteractive:function(t){var e=this.dropdown.getCurrentBlogChoice();t&&e&&this.updateTypeahead(e.name)},bindEditorCallbacks:function(){this.editor.config.onSelection=i.bind(this.onSelection,this),this.editor.config.onClientEvent=i.bind(this.onClientEvent,this)},setupListeners:function(){this.dropdown.listenTo(this,"editor:cycleUp",this.dropdown.cycleUp),this.dropdown.listenTo(this,"editor:cycleDown",this.dropdown.cycleDown),this.listenTo(this,"editor:abortMention",this.abortMention),this.listenTo(this,"editor:softConfirm",this.softConfirm),this.listenTo(this,"editor:confirm",this.confirmMention),this.listenTo(this.dropdown,"dropdown:confirm",this.confirmMention),this.dropdown.listenTo(this,"ghost:render",this.dropdown.setPinnedTarget),this.dropdown.listenTo(this,"mention:exit",this.dropdown.teardown),this.listenTo(this.dropdown,"dropdown:render",this.maintainTypeaheadGhost),this.listenTo(this.dropdown,"dropdown:empty",this.exitMention),this.listenTo(this.dropdown,"dropdown:menuInteraction",this.updateForInteractive)},queryServer:function(t){var e={query:t,success:i.bind(this.dropdown.updateMentionDropdown,this.dropdown)};this.mentionModel.fetch(e)},getMentionRect:function(t){if(!(t&&t.range&&"getClientRects"in t.range))return!1;var e=t.range.getClientRects();return i.isUndefined(e[0])?!1:e[0]}},l=function(e,s){i.extend(this,r.Events,a),this.editor=e,this.dropdown=s,this.mentionModel=s.model,this.inMention=!1,this.currentMention=!1,this.escapeMention=!1,this.lastInfo=!1,this.lastSelection=!1,this.$ghost=!1,this.lastTypeahead="",this.debugMode=!1,this.bindEditorCallbacks(),this.setupListeners(),t=i.bind(t,this)},h=function(t){t=t||n.getSelection();var e=function(t){return/[^\-a-z0-9]/i.test(t)},s={isMention:!1,len:0,string:"",stringBefore:"",stringAfter:"",range:!1,mentionRange:!1,suffixRange:!1,caretRange:!1,offsetStart:!1,offsetEnd:!1,caretPosition:!1,caretNode:!1};if(s.caretRange=t&&t.rangeCount>0?t.getRangeAt(0):!1,s.caretRange===!1||s.caretRange.startOffset!==s.caretRange.endOffset)return!1;var o=s.caretRange.commonAncestorContainer;o.normalize(),s.caretNode=1===o.nodeType?o.firstChild:o;var r=null==s.caretNode?"":s.caretNode.nodeValue;if(s.caretPosition=s.caretRange.startOffset,null==r||0===r.length)return!1;for(var a=0,l=0;l<s.caretPosition;l++)e(r.charAt(l))?a=0:a++;s.stringBefore=r.substr(s.caretPosition-a,a);var h=!1;if(s.caretPosition-(a+2)>=0){h=r.substr(s.caretPosition-a-1,1);var d=r.substr(s.caretPosition-a-2,1);i.contains([32,160],d.charCodeAt(0))||(h=!1)}else s.caretPosition-(a+1)>=0&&(h=r.substr(s.caretPosition-a-1,1));for(s.isMention="@"===h,a=0,l=s.caretPosition;l<r.length&&!e(r.charAt(l));l++)a++;return s.stringAfter=r.substr(s.caretPosition,a),s.string=s.stringBefore+s.stringAfter,s.len=s.string.length,0===s.len||""===s.string?!1:(s.range=document.createRange(),s.offsetStart=s.caretRange.startOffset-s.stringBefore.length,s.offsetEnd=s.caretRange.startOffset+s.stringAfter.length,s.range.setStart(s.caretNode,s.offsetStart),s.range.setEnd(s.caretNode,s.offsetEnd),s.isMention?(s.mentionRange=document.createRange(),s.mentionRange.setStart(s.caretNode,s.offsetStart-1),s.mentionRange.setEnd(s.caretNode,s.offsetEnd),s.suffixRange=document.createRange(),s.suffixRange.setStart(s.caretNode,s.caretRange.startOffset+s.stringAfter.length),s.suffixRange.setEnd(s.caretNode,s.caretRange.startOffset+s.stringAfter.length),s):s)},d={keydown:{27:"editor:abortMention",38:"editor:cycleUp",40:"editor:cycleDown",39:"editor:softConfirm",9:"editor:confirm",13:"editor:confirm"}};return l.prototype.onClientEvent=function(t){o.trigger("richTextEditor:onClientEvent",t,this.editor);var e,i=["keyup","keydown","keypress"];if(this.inMention&&-1!==i.indexOf(t.type)){if(t=t||window.event,e=t.which||t.keyCode,"keydown"===t.type)e in d[t.type]?(this.trigger(d[t.type][e],t),39!==e&&(t.preventDefault(),t.stopImmediatePropagation())):8===e&&this.maintainTypeaheadGhost(t);else if("keyup"===t.type){if(e in d.keydown)return!1}else this.maintainTypeaheadGhost(t,String.fromCharCode(e));var s=h();s&&(this.lastInfo=s)}},l.prototype.onSelection=i.debounce(function(t){var e=h(t);e?(this.escapeMention&&(this.escapeMention.string===e.string?e.isMention=!1:this.escapeMention=!1),this.lastInfo=e,this.lastSelection=t):this.escapeMention=!1,e&&e.isMention===!0?this.inMention&&this.isSameMention(e)?this.updateMention(e):this.enterMention(e):this.inMention?this.exitMention(e):e&&this.isMentionLink(e.range)&&this.linkToMention(e)},e.rangeDebounce),l}();e.exports=a},{backbone:"5kFNoY",jquery:"HlZQrA",ligature:325,lodash:"K2RcUv","prima/events":261}],58:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/class"),n=o.extend({fetchOpenGraphData:function(t){var e=s.ajax({url:"/svc/post/fetch_og",type:"POST",with_form_key:!0,data:{url:t}});return e.then(function(e){var o=s.parseJSON(e)||{};return i.extend({url:t},o.response)})}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","prima/class":258}],59:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=function(){var t=function(t){if(!i.trim(t.html||""))return i.isFunction(t.done)&&t.done(""),void(i.isFunction(t.always)&&t.always(""));var e=s.ajax({url:"/svc/filter_html_for_dash_preview",type:"POST",with_form_key:!0,data:{html:t.html||""}});return i.isFunction(t.done)&&e.done(t.done),i.isFunction(t.fail)&&e.fail(t.fail),i.isFunction(t.always)&&e.always(t.always),e};return{filterForDash:function(e,i,s,o,n){return t({html:e,done:s,fail:o,always:n})},filterHtmlForDash:function(e,i,s,o){return t({html:e,done:i,fail:s,always:o})}}};e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],60:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="album-art--container"><div data-js-albumart class="album-art" style="'+(null==(__t=url?"background-image:url("+url+");":"")?"":_.escape(__t))+'"></div><div data-js-removebutton class="album-art--remove-button"><div class="v-center-outer"><div class="v-center-inner"><span data-js-removebuttontext>'+(null==(__t=__("Remove image"))?"":_.escape(__t))+'</span></div></div></div></div><div data-js-dropzone class="media-dropzone"><div data-js-mediaupload class="media-upload-button"><div class="v-center-outer"><div class="v-center-inner"><div class="dropzone-title"><span data-js-mediauploadtext class="dropzone-text">'+(null==(__t=dropzoneText)?"":_.escape(__t))+'</span></div></div></div><div class="media-upload"><div data-subview="upload"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],61:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<label class="binary_switch"><input type="checkbox" id="allowAnswers" type="checkbox" data-js-allowanswerscheckbox> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label class="allow-answers-label" for="allowAnswers">'+(null==(__t=__("Let people answer this"))?"":_.escape(__t))+"</label>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],62:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="ask-field" data-name="askField"><div class="note_item"><div class="text"><p class="speaker"><strong>'+(null==(__t=post.get("asking_tumblelog").name.toLowerCase())?"":_.escape(__t))+"</strong> <span>"+(null==(__t=__("said"))?"":_.escape(__t))+':</span></p><p class="note_text">'+(null==(__t=post.get("ask"))?"":__t)+'</p></div><div class="nipple"></div></div><div class="avatar"><img src="'+(null==(__t=post.get("asking_tumblelog").avatar)?"":_.escape(__t))+'" alt="" width="40" height="40"></div><div class="clearfix"></div></div>',post.get("is_reblog")===!0&&(__p+='<div class="answer-field" data-name="answerField"><div class="note_item"><div class="text"><p class="speaker"><strong>'+(null==(__t=post.get("answering_tumblelog").name.toLowerCase())?"":_.escape(__t))+"</strong> <span>"+(null==(__t=__("answered"))?"":_.escape(__t))+":</span></p>"+(null==(__t=post.get("answer"))?"":__t)+'</div><div class="nipple"></div></div><div class="avatar"><img src="'+(null==(__t=post.get("answering_tumblelog").avatar)?"":_.escape(__t))+'" alt="" width="40" height="40"></div><div class="clearfix"></div></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],63:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="media-dropzone" data-js-dropzone><div class="media-upload-button" data-js-mediaupload><div class="v-center-outer"><div class="v-center-inner"><div class="dropzone-icon '+(null==(__t=uploadIcon)?"":_.escape(__t))+'"></div></div></div><div class="media-upload"><div data-subview="upload"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],64:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="channel-avatar avatar-container"><a class="avatar-link" href="'+(null==(__t=channel.url)?"":_.escape(__t))+'" target="_blank" title="'+(null==(__t=channel.directory_safe_title||channel.title||channel.name)?"":_.escape(__t))+'" style="background-image: url(\''+(null==(__t=avatarUrl)?"":_.escape(__t))+'\')"><img class="avatar-image" src="'+(null==(__t=avatarUrl)?"":_.escape(__t))+'" alt="'+(null==(__t=channel.name)?"":_.escape(__t))+'"></a></div><div class="primary-avatar avatar-container"><a class="avatar-link" href="'+(null==(__t=primary.url)?"":_.escape(__t))+'" target="_blank" title="'+(null==(__t=primary.directory_safe_title||primary.title||primary.name)?"":_.escape(__t))+'" style="background-image: url(\''+(null==(__t=subavatarUrl)?"":_.escape(__t))+'\')"><img class="avatar-image" src="'+(null==(__t=subavatarUrl)?"":_.escape(__t))+'" alt="'+(null==(__t=primary.name)?"":_.escape(__t))+'"></a></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],65:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<label class="confirm-tos--label" data-name="confirm-tos"><div class="binary_switch"><input class="confirm-tos--checkbox" type="checkbox" name="confirm_tos" data-js-confirmtos> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></div><span class="confirm-tos--text">'+(null==(__t=__("This is my original work, or I %1$shave permission%2$s from the copyright holder to post this.",'<a href="/terms-of-service" target="_blank">',"</a>"))?"":__t)+"</span></label>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],66:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="html-mode"><div class="tabs clearfix"><div class="tab src-button" data-js-srcbutton><span class="icon html" data-js-srcicon></span> <span class="tab-label" data-js-srclabel>'+(null==(__t=srcLabel)?"":_.escape(__t))+'</span></div><div class="tab preview-button" data-js-previewbutton><span class="icon"></span> <span class="tab-label" data-js-previewlabel>'+(null==(__t=previewLabel)?"":_.escape(__t))+'</span></div></div><div class="views"><div class="view src-view" data-js-srcview><div data-js-ace></div></div><div class="view preview-view" data-js-previewview><div class="html-preview editor" data-js-htmlpreview></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],67:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",_.forEach(id3Fields,function(t,e){__p+='<div class="id3-editor--container '+(null==(__t=id3FieldLabel[e]?"id3-editor--"+id3FieldLabel[e].toLowerCase():"")?"":_.escape(__t))+'"><input name="'+(null==(__t=e)?"":_.escape(__t))+'" value="'+(null==(__t=t)?"":_.escape(__t))+'" class="id3-editor--input" type="text"><label class="id3-editor--label">'+(null==(__t=id3FieldLabel[e]||__(_.capitalize(e)))?"":_.escape(__t))+"</label></div>"}),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],68:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="inline-embed-field" data-name="inlineEmbedField"><div data-subview="inlineEmbedInput"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],69:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="","spotify"===service&&(__p+='<iframe data-js-audioembed src="https://embed.spotify.com/?uri='+(null==(__t=url)?"":_.escape(__t))+'&view=coverart" width="500" height="580" frameborder="0" allowtransparency="true" scrolling="no" class="audio-embed--spotify"></iframe>'),__p+="","soundcloud"===service&&(__p+='<iframe data-js-audioembed src="https://w.soundcloud.com/player/?url='+(null==(__t=url)?"":_.escape(__t))+'&amp;visual=true&amp;liking=false&amp;sharing=false&amp;auto_play=false&amp;show_comments=false&amp;continuous_play=false&amp;origin=tumblr" frameborder="0" allowtransparency="true" scrolling="no" width="500" height="500" class="audio-embed--soundcloud"></iframe>'),__p+="","bandcamp"===service&&(__p+='<iframe data-js-audioembed src="https://bandcamp.com/EmbeddedPlayer/size=medium/bgcol=ffffff/linkcol=0687f5/notracklist=true/transparent=true/'+(null==(__t=type)?"":_.escape(__t))+"="+(null==(__t=id)?"":_.escape(__t))+'/" frameborder="0" allowtransparency="true" scrolling="no" width="500" height="120" class="audio-embed--bandcamp"></iframe>'),__p+="","direct"===service&&(__p+='<div data-js-audioembed class="audio-embed--direct '+(null==(__t=canEditMedia?"audio-embed--direct-editable":"")?"":_.escape(__t))+'"><div data-subview="audioPlayer"></div><div data-subview="id3Editor"></div><div data-subview="albumArtUploader"></div></div>'),__p+="",canEditMedia&&(__p+='<div data-subview="removeButton"></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],70:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-sortable class="photoset--photo-dragger"></div><div data-js-mediaoverlay class="media-overlay"><div data-js-clickthroughurlbutton class="overlay-button '+(null==(__t=hasClickthroughUrl?"active":"")?"":_.escape(__t))+'"><div class="icon icon_editor_link"></div></div><div data-js-captionbutton class="overlay-button '+(null==(__t=hasCaption?"active":"")?"":_.escape(__t))+'"><div class="icon icon_editor_more"></div></div></div><div data-subview="removeButton"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],71:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="photobooth-container" data-js-photobooth></div><div class="photoset-container" data-js-photoset></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],72:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="video-container" data-js-video></div>',canEditMedia&&(__p+='<div data-subview="removeButton"></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],73:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="","inline"===embedRenderContext?__p+='<div class="video-preview">'+(null==(__t=previewIframe)?"":__t)+"</div>":(__p+='<div class="video-preview video_preview '+(null==(__t=thumbnail&&thumbnail.url?"":"no_thumbnail")?"":_.escape(__t))+'">',thumbnail&&thumbnail.url&&(__p+='<img src="'+(null==(__t=thumbnail.url)?"":_.escape(__t))+'" alt="" width="'+(null==(__t=thumbnail.width||"")?"":_.escape(__t))+'" height="'+(null==(__t=thumbnail.height||"")?"":_.escape(__t))+'">'),__p+='<div class="video_info_wrapper"><i class="icon_post_video"></i><div class="video_text"><span class="clippable">'+(null==(__t=__("Watch on %s",tumblelogHostname))?"":_.escape(__t))+'</span> <i class="icon_arrow_carrot_right"></i></div></div></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],74:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="video-error"><div class="v-center-outer"><div class="v-center-inner"><span class="icon"></span> <span class="error-message">'+(null==(__t=__("This video embed stopped working. Try another?"))?"":_.escape(__t))+"</span></div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],75:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="media-preview"><div class="v-center-outer"><div class="v-center-inner"><div class="icon '+(null==(__t=icon)?"":_.escape(__t))+'" data-js-previewicon></div><p class="media-preview-text" data-js-previewmessage>'+(null==(__t=message)?"":_.escape(__t))+"</p></div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],76:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";var dropzoneClasses=[];showInput&&dropzoneClasses.push("show-input"),splitDropzone&&dropzoneClasses.push("split-dropzone"),toggleDropzone&&dropzoneClasses.push("toggle-dropzone"),defaultBehavior&&dropzoneClasses.push("toggle-dropzone-"+defaultBehavior),__p+='<div class="media-dropzone '+(null==(__t=dropzoneClasses.join(" "))?"":_.escape(__t))+'" data-js-dropzone><div class="split-cells">',enableUpload&&(__p+='<div class="split-cell media-upload-button" data-js-mediaupload><div class="split-cell-inner"><div class="v-center-outer"><div class="v-center-inner">',uploadIcon&&(__p+='<div class="dropzone-icon '+(null==(__t=uploadIcon)?"":_.escape(__t))+'"></div>'),__p+="",uploadText&&(__p+='<div class="dropzone-title"><span class="dropzone-text" data-js-mediauploadtext>'+(null==(__t=toggleDropzone?dropzoneText:uploadText)?"":_.escape(__t))+"</span>",uploadTooltip&&(__p+='<div class="dropzone-tooltip" data-js-uploadtooltip><span class="icon icon_help" data-show-tooltip="uploadTooltip"></span></div>'),__p+="</div>"),__p+='</div></div></div><div class="media-upload"><div data-subview="upload"></div></div></div>'),__p+="",enableUrl&&(__p+='<div class="split-cell media-url-button" data-js-mediaurl><div class="split-cell-inner"><div class="v-center-outer"><div class="v-center-inner">',urlIcon&&(__p+='<div class="dropzone-icon '+(null==(__t=urlIcon)?"":_.escape(__t))+'"></div>'),__p+="",urlText&&(__p+='<div class="dropzone-title"><span class="dropzone-text" data-js-mediaurltext>'+(null==(__t=toggleDropzone?dropzoneText:urlText)?"":_.escape(__t))+"</span>",urlTooltip&&(__p+='<div class="dropzone-tooltip" data-js-urltooltip><span class="icon icon_help" data-show-tooltip="urlTooltip"></span></div>'),__p+="</div>"),__p+='</div></div></div><div class="media-url-cropper media-dropzone-cropper"><div class="media-url"><div class="v-center-outer"><div class="v-center-inner"><div data-subview="urlInput"></div></div></div></div></div><div data-subview="removeButton"></div></div>'),__p+="</div></div>"}return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],77:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><div class="inner">',_.each(blogs,function(t,e){__p+="";var i=t.name.replace(queryRegex,"<u>$&</u>");__p+='<div id="mention_'+(null==(__t=e)?"":_.escape(__t))+'" class="item-option" data-tumblelog="'+(null==(__t=t.name)?"":_.escape(__t))+'"><div class="blog-info"><span class="blog-name">'+(null==(__t=i)?"":__t)+'</span> <span class="blog-title">'+(null==(__t=t.title)?"":_.escape(__t))+'</span></div><span class="blog-thumb" style="background-image:url(\''+(null==(__t=t.avatar_url)?"":_.escape(__t))+"')\"></span></div>"}),__p+="</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],78:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="overlay-button-popover" data-js-popover><input data-js-input type="text" value="'+(null==(__t=value)?"":_.escape(__t))+'" placeholder="'+(null==(__t=placeholder)?"":_.escape(__t))+'" maxlength="'+(null==(__t=maxLength)?"":_.escape(__t))+'" class="input-field"><div data-js-confirm class="input-confirm">'+(null==(__t=confirmText)?"":_.escape(__t))+"</div></div>";
return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],79:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="editor editor-plaintext" contenteditable="true" data-js-plaintexteditor></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],80:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="post-margin" data-js-margin><div data-subview="avatar"></div></div><div class="post-container" data-js-container-outer><div class="post-container-inner post" data-js-container-inner><div class="post-form--header post-header clearfix" data-js-header><div class="controls-container"><div class="control left"><div data-subview="tumblelogSelect"></div></div><div class="control right">',"reblog"===mode&&(__p+='<div data-subview="reblogAsButton"></div>'),__p+='<div data-subview="postSettings"></div></div></div></div><div class="post-form--form post-content"><div data-subview="postTypeForm"></div></div><div class="post-form--footer post-footer" data-js-footer><div data-subview="tagEditor"></div><div data-subview="editorButtons"></div></div><div class="post-form--guard"></div><div class="post-form--blank-bar" data-js-blank-bar></div><div class="post-form--bottom" data-js-bottom><div class="post-form--controls" data-js-postformcontrols><div class="controls-container"><div class="control left"><button class="chrome flat post-form--close" data-js-clickableclose="">'+(null==(__t=__("Close"))?"":_.escape(__t))+'</button></div><div class="control right"><div data-subview="socialButtons"></div></div><div class="control right"><div data-subview="savePostButton"></div></div></div></div></div><div data-subview="allowAnswers"></div><div data-subview="errorBar"></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],81:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<form method="POST" target="_blank" action="'+(null==(__t=action)?"":_.escape(__t))+'">',_.each(inputs,function(t,e){__p+='<input type="hidden" name="'+(null==(__t=e)?"":_.escape(__t))+'" value="'+(null==(__t=t)?"":_.escape(__t))+'">'}),__p+="</form>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],82:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<button class="post-settings" data-js-clickablepostsettingscog><span class="dropdown icon_settings" data-js-postsettingscog></span></button>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],83:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><div class="inner"><div class="form-horizontal"><div class="form-group"><div class="group-label"><label for="customUrl_input">'+(null==(__t=__("Custom URL"))?"":_.escape(__t))+'</label></div><div class="group-content"><div class="adjacent-content"><label for="customUrl_input" class="prefix" data-js-customurllabel>/post/123/</label><input name="customUrl" id="customUrl_input" class="field crystal" type="text" autocomplete="off" data-js-customurl value="'+(null==(__t=customUrl)?"":__t)+'"></div></div></div><div class="form-group"><div class="group-label"><label for="sourceUrl_input">'+(null==(__t=__("Content source"))?"":_.escape(__t))+'</label></div><div class="group-content"><input id="sourceUrl_input" name="sourceUrl" class="field crystal" type="text" placeholder="http://..." autocomplete="off" data-js-sourceurl value="'+(null==(__t=sourceUrl)?"":__t)+'"></div></div><div class="form-group"><div class="group-label"><label for="postDate_input">'+(null==(__t=__("Post date"))?"":_.escape(__t))+'</label></div><div class="group-content"><input id="postDate_input" name="postDate" class="field crystal" type="text" placeholder="'+(null==(__t=__("Now"))?"":_.escape(__t))+'" autocomplete="off" data-js-postdate value="'+(null==(__t=postDate)?"":__t)+'"></div></div><div class="form-group"><div class="group-label">'+(null==(__t=__("Replies"))?"":_.escape(__t))+'</div><div class="group-content"><div class="checkbox field row"><label class="binary_switch"><input name="allow_photo_replies" type="checkbox" id="allowPhotoReplies" type="checkbox" data-js-allowphotoreplies> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label for="allowPhotoReplies">'+(null==(__t=__("Let people photo reply"))?"":_.escape(__t))+'</label></div></div></div><div class="form-group"><div class="group-label">'+(null==(__t=__("Text editor"))?"":_.escape(__t))+'</div><div class="group-content"><div class="checkbox field row"><label class="binary_switch"><input type="hidden" id="editorType" name="editorType" value="'+(null==(__t=editorType||"rich")?"":_.escape(__t))+'" data-js-editortype> <input type="checkbox" id="htmlMode" name="htmlMode" data-js-htmlmode> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label for="htmlMode">'+(null==(__t=__("HTML mode"))?"":_.escape(__t))+'&nbsp;</label><span id="htmlModeHelp" class="icon_help" data-tooltip="'+(null==(__t=__("Note that the dashboard doesn't display all HTML elements, but you're free to put them in your posts anyway."))?"":_.escape(__t))+'"></span></div></div></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],84:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="clear-results icon_close '+(null==(__t=0===resultCount?"inactive":"")?"":_.escape(__t))+'"></div>',_.each(serviceResults,function(t,e){__p+='<div class="audio-result-set" data-service="'+(null==(__t=e)?"":__t)+'">',_.each(t,function(t){__p+='<div class="result" data-href="'+(null==(__t=t.href)?"":__t)+'"><span class="primary">'+(null==(__t=t.primary)?"":__t)+'</span><span class="secondary">'+(null==(__t=t.secondary)?"":__t)+'</span> <span class="info">'+(null==(__t=t.info)?"":__t)+"</span></div>"}),__p+="</div>"}),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],85:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="media-wrapper" data-js-media><div data-subview="mediaPreview"></div><div data-js-mediacomposer><div data-subview="searchField"></div><div data-subview="audioUploader"></div><div data-subview="searchResultList"></div></div></div><div class="caption-wrapper" data-js-tos><div data-subview="confirmTos"></div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],86:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="title"></div><div data-subview="chat"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],87:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="media-wrapper" data-js-media><div class="media-container link-media-container"><div class="link-editor" data-js-linkeditor><div class="link-fields"><div data-subview="title"></div><div data-subview="url"></div></div><div class="thumb" data-js-urlimage></div></div>',canEditMedia&&(__p+='<div data-subview="removeButton"></div>'),__p+='</div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],88:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="askField"></div><div data-subview="answerField"></div><div data-subview="reblogTree"></div><div data-subview="caption"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],89:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="media-wrapper" data-js-media><div data-subview="mediaPreview"></div><div data-subview="mediaComposer"></div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],90:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="quote"></div><div data-subview="source"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],91:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="title"></div><div data-subview="reblogTree"></div><div data-subview="body"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],92:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="media-wrapper" data-js-media><div data-subview="mediaPreview"></div><div data-subview="mediaComposer"></div></div><div class="caption-wrapper" data-js-tos><div data-subview="confirmTos"></div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],93:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="reblog-as-type '+(null==(__t=post.get("type"))?"":_.escape(__t))+'" data-js-reblogselectpin data-js-clickablereblogselect></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],94:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><div class="inner select-center"><div class="item-option-wrapper"><div class="header-item">'+(null==(__t=__("Reblog as..."))?"":_.escape(__t))+"</div>",_.forEach(postReblogAsTypes,function(t,e){__p+='<div class="item-option '+(null==(__t=postType===e?"icon_checkmark":"")?"":_.escape(__t))+'" data-reblog-as-type="'+(null==(__t=e)?"":_.escape(__t))+'">'+(null==(__t=t)?"":_.escape(__t))+"</div>"}),__p+="</div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],95:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",showReblogTree&&(__p+='<div class="control-reblog-tree post"><div class="reblog-tree post_content">'+(null==(__t=post.get("reblog_tree"))?"":__t)+'</div><div data-subview="removeButton"></div><div class="btn-show-tree btn-toggle-reblog">'+(null==(__t=__("Include reblogs"))?"":_.escape(__t))+"</div></div>"),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],96:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="editor editor-richtext" contenteditable="true" data-js-richtexteditor></div><div data-subview="htmlField"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],97:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="split chrome blue"><div data-subview="loader"></div><button class="chrome blue caption create_post_button" data-js-clickablesave></button><div class="chrome blue dropdown options icon_arrow_carrot_down" data-js-clickablesavedropdown></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],98:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><ul class="inner select-left" data-js-options><li class="item-option '+(null==(__t="published"===state?"icon_checkmark":"")?"":__t)+'" data-js-publish><span class="">'+(null==(__t=__("Post now"))?"":_.escape(__t))+'</span></li><li class="item-option '+(null==(__t="queued"===state?"icon_checkmark":"")?"":__t)+" "+(null==(__t=-1===activeOptions.indexOf("queued")?"hidden":"")?"":__t)+'" data-js-queue><span class="">'+(null==(__t=__("Add to queue"))?"":_.escape(__t))+'</span></li><li class="item-option '+(null==(__t="draft"===state?"icon_checkmark":"")?"":__t)+" "+(null==(__t=-1===activeOptions.indexOf("draft")?"hidden":"")?"":__t)+'" data-js-draft><span class="">'+(null==(__t=__("Save as draft"))?"":_.escape(__t))+'</span></li><li class="item-option '+(null==(__t="private"===state?"icon_checkmark":"")?"":__t)+'" data-js-private><span class="">'+(null==(__t=__("Post privately"))?"":_.escape(__t))+'</span></li><li class="item-option '+(null==(__t="scheduled"===state?"icon_checkmark":"")?"":__t)+" "+(null==(__t=-1===activeOptions.indexOf("scheduled")?"hidden":"")?"":__t)+'" data-js-schedule><span class="">'+(null==(__t=__("Schedule"))?"":_.escape(__t))+'</span><br><input class="field square solid" type="text" autocomplete="off" placeholder="Next Tuesday 10am" data-js-scheduletext></li>',showPreview&&(__p+='<li class="item-option full" data-js-preview><button class="button chrome">'+(null==(__t=__("Preview on blog"))?"":_.escape(__t))+"</button></li>"),__p+="</ul></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],99:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<ul class="social-buttons">',twitter&&(__p+='<li data-js-twitter data-service="twitter" class="social-button twitter '+(null==(__t=twitterOn?"checked":"")?"":_.escape(__t))+'" data-js-tweetdropdownpin><label class="social-button--label social-button--twitter" data-js-sharebuttonlabel data-js-twitterlabel><input type="checkbox" data-js-twittercheckbox class="social-button--checkbox" id="send_to_twitter" name="send_to_twitter"></label></li>'),__p+="",facebook&&(__p+='<li data-js-facebook data-service="facebook" class="social-button facebook '+(null==(__t=facebookOn?"checked":"")?"":_.escape(__t))+'"><label class="social-button--label social-button--facebook" data-js-sharebuttonlabel data-js-facebooklabel><input type="checkbox" data-js-facebookcheckbox class="social-button--checkbox" id="send_to_fbog" name="send_to_fbog"></label></li>'),__p+="</ul>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],100:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="tag-input-wrapper" data-js-taginputfieldwrapper><div data-subview="tagInputField"></div><div class="ghost" data-js-taginputghost></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],101:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><div class="inner select-center"><div class="item-option-wrapper" data-js-tagsuggestwrapper>',_.each(results.userTags,function(t){__p+="";var e=_.escape(t).replace(queryRegex,"<u>$&</u>");__p+='<div class="item-option user-tags" data-tag="'+(null==(__t=_.escape(t))?"":__t)+'"><span class="tag-suggest-tag">'+(null==(__t=e)?"":__t)+"</span></div>"}),__p+='<div class="header-item">Popular</div>',_.each(results.suggestions,function(t){__p+="";var e=_.escape(t).replace(queryRegex,"<u>$&</u>");__p+='<div class="item-option suggest-tags" data-tag="'+(null==(__t=_.escape(t))?"":__t)+'"><span class="tag-suggest-tag">'+(null==(__t=e)?"":__t)+"</span></div>"}),__p+="</div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],102:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="tooltip-inner">',__p+=sanitize?""+(null==(__t=text)?"":_.escape(__t)):""+(null==(__t=text)?"":__t),__p+="</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],103:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<button class="tumblelog-select '+(null==(__t="edit"===post.get("mode")?"inactive":"")?"":_.escape(__t))+'" data-js-clickabletumbleloglabel><span class="caption" data-js-tumbleloglabel></span>',"edit"!==post.get("mode")&&(__p+=' <span class="dropdown icon_arrow_carrot_down" data-js-tumblelogselectpin></span>'),__p+="","reblog"===post.get("mode")&&(__p+=' <span class="reblog_source"><i class="icon icon_reblog"></i> <span class="reblog_name">'+(null==(__t=post.get("reblog_name"))?"":_.escape(__t))+"</span></span>"),__p+="</button>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],104:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><ul class="inner select-right">',_.forEach(channels,function(t){__p+='<li class="item-option '+(null==(__t=t.name===tumblelog?"select":"")?"":_.escape(__t))+'" title="'+(null==(__t=t.name)?"":_.escape(__t))+'" data-js-tumblelogchoice><img class="ts-avatar" src="'+(null==(__t=t.avatarUrl)?"":_.escape(__t))+'" alt="'+(null==(__t=t.name)?"":_.escape(__t))+'"><div class="ts-info"><p class="ts-name">'+(null==(__t=t.name)?"":_.escape(__t))+'</p><p class="ts-title">'+(null==(__t=t.directory_safe_title||t.title)?"":_.escape(__t))+"</p></div></li>"}),__p+="</ul></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],105:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-tweetpopover><div class="custom_tweet_container"><textarea data-js-customtweet name="custom_tweet" class="tweet-textarea">',__p+="string"==typeof post.custom_tweet&&""!==post.custom_tweet?""+(null==(__t=post.custom_tweet)?"":_.escape(__t)):"[URL]",__p+='</textarea></div><button data-js-dismisstweet type="button" class="chrome small dismiss">'+(null==(__t=__("Done"))?"":_.escape(__t))+'</button> <span data-js-tweetlength class="tweet-length"></span></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],106:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-webcambutton class="webcam-button"><span data-js-smiley class="icon icon_postforms_selfie"></span> <span data-js-text class="dropzone-text">'+(null==(__t=__("Take a selfie"))?"":_.escape(__t))+"</span></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],107:[function(t,e){"use strict";var i=t("lodash"),s=[16,24,30,40,48,64,96,128,512],o=i.last(s),n=128,r=function(t){return t>=o?o:i.find(s,function(e){return e>=t})},a=function(t,e){var i=function(e){return e=null==e?n:r(e),t.replace(/^(.*_)?(\d+)(\D.*)?$/,"$1"+e+"$3")};return i.toString=function(){return this()},null!=e?i(e):i};e.exports=a},{lodash:"K2RcUv"}],108:[function(t,e){"use strict";var i=t("lodash"),s=function(t){if(i.isString(t)){if(t=t.toLowerCase(),"true"===t||"1"===t||"on"===t)return!0;if("false"===t||""===t||"off"===t)return!1;if(t=i.parseInt(t),i.isNaN(t))return!0}return!!t};e.exports=s},{lodash:"K2RcUv"}],109:[function(t,e){"use strict";var i=t("lodash"),s=function(t,e){return null==e?e=5:i.isNumber(e)||(e=0),i.transform(t,function(t,o,n){e&&i.isObject(o)&&(o=s(o,e-1)),t[i.camelize(n)]=o},{})};e.exports=s},{lodash:"K2RcUv"}],110:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("backbone"),n=t("prima/class"),r=0,a=function(t){t=null==t||i.isPlainObject(t)?i.extend({target:"body",autostart:!1},t):{target:t,autostart:!1};var e=".drag_eventor_"+r++,a=s(t.target),l=!1,h=0,d=new n;i.extend(d,o.Events);var c=["dragenter","dragover","dragleave","dragend","drop"],u=function(t){d.trigger(t.type,t)};return d.start=function(){h++,l||(l=!0,i.forEach(c,function(t){a.on(t+e,u)}))},d.stop=function(){h--,0>=h&&(l=!1,i.forEach(c,function(t){a.off(t+e,u)}))},t.autostart&&d.start(),d};e.exports=a},{backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/class":258}],111:[function(t,e){"use strict";var i=t("lodash"),s={camel:i.camelize,snake:i.underscored,kebab:i.dasherize},o=function(t,e){return i.isString(e)&&(e=i.result(s,e)),i.isFunction(e)?i.map(t,e):t},n=function(t,e,s){return i.isString(e)&&(e=o(s||i.keys(t),e)),i.transform(t,function(t,s,o){t[i.result(e,o)||o]=s},{})};e.exports=n},{lodash:"K2RcUv"}],112:[function(t,e){var i=function(t,e,i){var s={};_.isPlainObject(t)&&(i=e,_.extend(s,t),t=s.width,e=s.height);var o=Math.round(e/t*i);return s.width=i,s.height=o,s};e.exports=i},{}],113:[function(t,e){"use strict";var i={normalizeSpace:function(t){return t.trim().replace(""," ").replace(/\s\s+/," ")},stripScripts:function(t){return t.replace(new RegExp("<script[^>]*>([\\S\\s]*?)</script\\s*>","img"),"")},stripTags:function(t){return t.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},stripHtml:function(t,e){if(!t)return"";"undefined"==typeof e&&(e=!0);try{var i=document.implementation.createHTMLDocument("");i.body.innerHTML=this.stripScripts(t);var s=i.body.textContent||i.body.innerText;return s=s.trim(),e&&(s=this.normalizeSpace(s)),s}catch(o){var s=this.stripScripts(this.stripTags(t)).trim();return e&&(s=this.normalizeSpace(s)),s}},truncate:function(t,e,i){return e=e||100,i=i||"",t.length>e?t.slice(0,e-i.length)+i:t}};e.exports=i},{}],114:[function(t,e){"use strict";var i={isUrl:function(t){var e="%[0-9a-fA-F]{2}",i="(http|https):\\/\\/",s='([a-zA-Z0-9$\\-_.+!*"(),;:&=]|'+e+")+@",o="(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])",n="("+o+"(\\."+o+"){3})",r="([a-zA-Z0-9\\-\\u00C0-\\u017F]+\\.)+([a-zA-Z]{2,})",a="[0-9]+",l="("+n+"|localhost|"+r+")(:"+a+")?",h='a-zA-Z0-9$\\-_.+!*"(),;:@&=',d="(["+h+"]|"+e+")*",c=d+"(\\/"+d+")*",u="\\?(["+h+"/?]|"+e+")*",p="\\#(["+h+"/?]|"+e+")*",m=new RegExp("^"+i+"("+s+")?"+l+"(\\/("+c+")?("+u+")?("+p+")?)?$");return m.test(t)===!0},isImageUrl:function(t){var e=i.isUrl(t),s=/.+[.](jpg|jpeg|png|gif)([?]|$)/.test(t)===!0;return e&&s}};e.exports=i},{}],115:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("../templates/album_art_uploader.tpl"),n=t("./media_dropzone"),r=n.extend({className:"media-dropzone-container album-art-uploader",defaultOptions:i.defaults({enableUrl:!1,dropzoneText:s("Select album art"),uploadText:s("Select album art"),uploadOptions:{name:"album_art",maxUploadSize:10485760,uploadPattern:/^image\/(?:.*)$/i,accept:"image/*",url:"/svc/post/upload_album_art"}},n.prototype.defaultOptions),template:o,events:i.extend({"click [data-js-removeButton]":"_onClickRemoveButton"},n.prototype.events),initialize:function(){n.prototype.initialize.apply(this,arguments),this.options.fullWidthPosts=!1},_onClickRemoveButton:function(){this.set("url","")},_onUploadUrlChange:function(t,e){this.set("url",e)},_onUrlChange:function(t,e){this.model.set({preuploadAlbumArt:!i.isEmpty(e),albumArt:e}),this.js$("albumArt").css("background-image",e?"url("+e+")":""),this.$el.toggleClass("can-upload-album-art",i.isEmpty(e))},afterRender:function(){this.listenTo(this.upload,"change:url",this._onUploadUrlChange),this.listenTo(this,"change:url",this._onUrlChange),this.$el.toggleClass("can-upload-album-art",i.isEmpty(this.get("url"))),n.prototype.afterRender.apply(this,arguments)}});e.exports=r},{"../templates/album_art_uploader.tpl":60,"./media_dropzone":132,lodash:"K2RcUv","prima/lib/translate":288}],116:[function(t,e){"use strict";var i=t("prima/view"),s=t("lodash"),o=t("../utils/string_helpers"),n=t("prima/mixins/selectorcache"),r=t("../templates/allow_answers.tpl"),a=i.extend({mixins:[n],template:r,className:"post-form--allow-answers",events:{"click [data-js-allowAnswersCheckbox]":"updateModel"},initialize:function(t){this.model=t.model},_onModelChange:function(){var t=!1;s.each(this.model.genericFieldMap,function(e){return this.endsWithQuestionMark(this.model.get(e))?(t=!0,!1):void 0},this),t?this.$el.slideDown():(this.js$("allowAnswersCheckbox").removeAttr("checked"),this.updateModel(),this.$el.slideUp())},endsWithQuestionMark:function(t){return t=o.stripHtml(t,!1),-1!==t.indexOf("?",t.length-1)},updateModel:function(){this.model.set("allow_answers",this.js$("allowAnswersCheckbox").is(":checked"))},render:function(){return this.addStateListeners(),this.$el.html(this.template()),this},addStateListeners:function(){"new"===this.model.get("mode")&&"chat"!==this.model.get("type")&&this.listenTo(this.model,"change",this._onModelChange)},teardown:function(){return this.stopListening(),this}});e.exports=a},{"../templates/allow_answers.tpl":61,"../utils/string_helpers":113,lodash:"K2RcUv","prima/mixins/selectorcache":295,"prima/view":318}],117:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/mixins/accessor"),o=t("prima/mixins/subviewable"),n=t("../templates/ask_field.tpl"),r=i.extend({template:n,mixins:[s,o],render:function(){return this.$el.html(this.template({post:this.model})),this}});e.exports=r},{"../templates/ask_field.tpl":62,"prima/mixins/accessor":289,"prima/mixins/subviewable":296,"prima/view":318}],118:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("../templates/audio_uploader.tpl"),n=t("./media_dropzone"),r=n.extend({className:"audio-direct-upload-button",defaultOptions:i.defaults({enableUrl:!1,dropzoneText:"",uploadIcon:"dropzone-add-audio-icon",uploadText:"",uploadOptions:{name:"audio",mediaType:"audio",maxUploadSize:10485760,uploadPattern:s.browser.mozilla?/^audio\/(?:.*)$/i:/^(?:audio\/mp3|audio\/mpeg)$/i,accept:"audio/mp3",url:"/svc/post/upload_audio"}},n.prototype.defaultOptions),template:o});e.exports=r},{"../templates/audio_uploader.tpl":63,"./media_dropzone":132,jquery:"HlZQrA",lodash:"K2RcUv"}],119:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("velocity-animate").animate,n=t("prima/utils/sequence-with-context"),r=t("app/components/post_form_builder/utils/transition_speed"),a=t("prima/view"),l=t("../utils/avatar_size"),h=t("prima/mixins/subviewable"),d=t("prima/mixins/selectorcache"),c=t("prima/mixins/accessor"),u=t("app/lib/currentuser"),p=t("../templates/avatar.tpl"),m=a.extend({className:"post-form--avatar",mixins:[h,d,c],template:p,defaultOptions:{size:128,determineViewState:!0},defaults:{flipQueued:!1,showSubavatar:!1,avatarUrl:""},initialize:function(t){if(this.options=t=i.extend({},this.defaultOptions,t),this.user=t.user||u(),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),t.post&&(this.post=t.post,this.tumblelog=t.tumblelog||this.user.getChannel(this.post.get("tumblelog")),this.listenTo(this.post,"change:tumblelog",this._onChangePostTumblelog)),!this.tumblelog)throw new Error("AvatarView requires a Tumblelog model!");this.options.determineViewState?this.updateViewState():this.get("avatarUrl")||this.set("avatarUrl",this.tumblelog.get("avatar_url")),this.listenTo(this,"change:showSubavatar",this._onChangeShowSubavatar),this.listenTo(this,"change:avatarUrl",this._onChangeAvatarUrl)},_onChangeShowSubavatar:function(t,e){e?this.showSubavatar():this.hideSubavatar()},_onChangeAvatarUrl:function(){return this.queueFlipAvatar()},updateViewState:function(){this.set({showSubavatar:this.tumblelog.get("show_author_avatar")||this.tumblelog.get("is_private_group_channel"),avatarUrl:this.tumblelog.get("avatar_url")})},_onChangePostTumblelog:function(t,e){this.tumblelog=this.user.getChannel(e),this.updateViewState()},showSubavatar:function(t,e){return null!=t||(t=r(150)),null!=e||(e=r(300)),o(this.$$(".primary-avatar"),{scale:1},{display:"block",duration:t,delay:e,easing:[.25,1.5,.75,1]})},hideSubavatar:function(t,e){return null!=t||(t=r(100)),null!=e||(e=0),o(this.$$(".primary-avatar"),{scale:0},{display:"none",duration:t,delay:e,easing:[0,0,.6,1]})},queueFlipAvatar:function(){if(this._avatarFlipping)return void this.set("flipQueued",!0);var t=this.flipAvatar();t.then(i.bind(function(){this.get("flipQueued")&&(this.set("flipQueued",!1),this.flipAvatar())},this))},flipAvatar:function(t,e){null!=t||(t=r(300)),null!=e||(e=r(50));var i=l(this.get("avatarUrl"),this.options.size),a=this.tumblelog.get("name"),h=this.$$(".channel-avatar"),d=h.clone();return this._avatarFlipping=!0,n([function(){return d.children(".avatar-link").css("background-image","url('"+i+"')"),d.children(".avatar-image").attr({src:i,alt:a}),o(d,{rotateY:[180,180]},{duration:0}).then(function(){d.insertAfter(h)})},function(){return s.join(o(h,{rotateY:[180,0]},{duration:t}),o(d,{rotateY:[360,180]},{duration:t}))},function(){return h.remove(),this.$$.remove(".channel-avatar"),o(d,{rotateY:[0,0]},{duration:0})},function(){this._avatarFlipping=!1}],this)},resetAvatar:function(){return this.set(i.defaults(i.pick(this.options,["showSubavatar","avatarUrl"]),i.pick(this.attributes,["showSubavatar","avatarUrl"]))),this},serialize:function(){return i.extend(this.toJSON(),{avatarUrl:l(this.get("avatarUrl"),this.options.size),subavatarUrl:l(this.user.getChannel().get("avatar_url"),this.options.size),primary:this.user.getChannel().toJSON(),channel:this.tumblelog.toJSON()})
},render:function(){return this.$el.html(this.template(this.serialize())),this.get("showSubavatar")||(this.$$(".primary-avatar").css("display","none"),this.hideSubavatar(0)),this}});e.exports=m},{"../templates/avatar.tpl":64,"../utils/avatar_size":107,"app/components/post_form_builder/utils/transition_speed":175,"app/lib/currentuser":209,lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/utils/sequence-with-context":315,"prima/view":318,"velocity-animate":"lWl/mc",when:"RG2dij"}],120:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/lib/translate"),r=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),l=t("prima/mixins/accessor"),h=t("../templates/confirm_tos.tpl"),d=o.extend({className:"confirm-tos",events:{"change [data-js-confirmTos]":"_onChangeConfirmTos"},mixins:[r,a,l],template:h,initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.user=t.user,this.post=t.post},_onChangeConfirmTos:function(t){this.post.set("confirmTos",s(t.currentTarget).is(":checked"))},serialize:function(){return{__:n,confirmTos:this.post.get("confirmTos")}},render:function(){return this.$el.html(this.template(this.serialize())),this.js$("confirmTos").attr("checked",!!this.post.get("confirmTos")),this},teardown:function(){return this.$el.empty(),this}});e.exports=d},{"../templates/confirm_tos.tpl":65,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":288,"prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],121:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/mixins/subviewable"),o=t("prima/mixins/selectorcache"),n=i.extend({mixins:[s,o],initialize:function(){},render:function(){return this}});e.exports=n},{"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],122:[function(t,e){"use strict";var i=t("prima/view"),s=i.extend({className:"post-form--error-bar",showErrorBar:function(t){this.$el.html(t).slideDown()},hideErrorBar:function(){this.$el.hide()}});e.exports=s},{"prima/view":318}],123:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/translate"),n=t("prima/events"),r=t("../services/preview_service"),a=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("prima/mixins/accessor"),d=t("../templates/html_field.tpl"),c=t("app/vendor/ace"),u=c.require("ace/mode/html").Mode,p=t("app/components/code_editor/theme/post_form"),m=s.extend({mixins:[h,a,l],className:"html-field",events:{"click [data-js-srcButton]":"_onClickSrcButton","click [data-js-previewButton]":"_onClickPreviewButton"},template:d,defaults:{name:"",editedSincePreview:!1,currentValue:"",htmlPreviewValue:null,isResizable:!1,textareaClass:""},initialize:function(t){this.set(t),this.updateValueFromModel(),this.previewService=new r,this._renderPreview=i.bind(this.renderPreview,this)},_onClickSrcButton:function(){this.showSource(!0)},_onClickPreviewButton:function(){this.showPreview()},renderPreview:function(t){!i.isUndefined(t)||(t=this.get("currentValue"));var e=this.get("htmlPreviewValue");this.get("editedSincePreview")||null==e?(this.js$("htmlPreview").html('<p style="text-align:center;"><b>'+o("Loading preview...")+"</b></p>"),this.previewService.filterForDash(t,!1,i.bind(function(t){this.set("htmlPreviewValue",t),this.set("editedSincePreview",!1),this.js$("htmlPreview").html(t)},this),i.bind(function(){this.js$("htmlPreview").html('<p style="text-align:center;"><i>'+o("Failed to load preview :(")+"</i></p>")},this))):this.js$("htmlPreview").html(e)},teardown:function(){return this.stopListening(),this.$el.empty(),this},serialize:function(){return{srcLabel:o("HTML"),previewLabel:o("Preview")}},render:function(){return this.$el.html(this.template(this.serialize())),this.$el.attr("data-name",this.get("name")),this._initAce(this.js$("ace").get(0)),this.showSource(),this.updateEditor(),this},hide:function(){this.$el.hide()},show:function(){this.$el.show(),this.updateEditor(),this.updatePreview()},focus:function(){this.editor&&i.defer(i.bind(function(){this.editor.focus()},this))},updateValueFromModel:function(){this.set("currentValue",this.model.get(this.get("name"))||"")},showSource:function(t){this.js$("previewButton").removeClass("active"),this.js$("srcButton").addClass("active"),this.js$("previewView").hide(),this.js$("srcView").show(),t&&this.focus(),n.trigger("postForms:resized")},showPreview:function(){this.js$("srcButton").removeClass("active"),this.js$("previewButton").addClass("active"),this.updatePreview(),this.js$("srcView").hide(),this.js$("previewView").show(),n.trigger("postForms:resized")},updateEditor:function(){this.editor&&(this._ignoreAceChange=!0,this.editor.setValue(this.get("currentValue"),1),this._ignoreAceChange=!1,this.editor.focus())},updatePreview:function(){var t=this.get("currentValue");this._renderPreview(t)},_updateValueFromAce:function(t){var e=this.get("name"),i=this.model.get(e);this.set("editedSincePreview",!0),this.set("currentValue",t),this.model.set(e,t),this.model.set("htmlEdited",t&&i!==t)},_initAce:function(t){var e=this.editor=c.edit(t),s=e.getSession();s.setUseWorker(!1),s.setUseWrapMode(!0),s.setFoldStyle("manual"),s.on("change",i.bind(function(){this._ignoreAceChange||this._updateValueFromAce(s.getValue())},this));var o=u;s.setMode(new o),e.setTheme(p),e.setShowPrintMargin(!1),e.renderer.setShowGutter(!1),e.renderer.setPadding(20),e.renderer.setScrollMargin(20,20),e.setHighlightActiveLine(!1),e.setHighlightSelectedWord(!1),e.setBehavioursEnabled(!1),e.commands.removeCommands(["showSettingsMenu","goToNextError","goToPreviousError","centerselection","gotoline","fold","unfold","toggleFoldWidget","toggleParentFoldWidget","foldall","foldOther","unfoldall","findnext"," findprevious","selectOrFindNext","selectOrFindPrevious","find","overwrite","togglerecording","replaymacro","jumptomatching","selecttomatching","removeline","duplicateSelection","sortlines","togglecomment","toggleBlockComment","modifyNumberUp","modifyNumberDown","replace","copylinesup","movelinesup","copylinesdown","movelinesdown","cut_or_delete","blockoutdent","blockindent","splitline","transposeletters","touppercase","tolowercase","expandtoline","joinlines","inverSelection"]),e.commands.addCommand({name:"uncommand",bindKey:{win:"",mac:"Ctrl-A|Ctrl-B|Ctrl-D|Ctrl-E|Ctrl-F|Ctrl-H|Ctrl-K|Ctrl-N|Ctrl-P|Ctrl-V"},exec:function(){return!0},readOnly:!0})}});e.exports=m},{"../services/preview_service":59,"../templates/html_field.tpl":66,"app/components/code_editor/theme/post_form":10,"app/vendor/ace":"4e8++S",lodash:"K2RcUv","prima/events":261,"prima/lib/translate":288,"prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],124:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/lib/translate"),r=t("../templates/id3_editor.tpl"),a=o.extend({className:"id3-editor",events:{"input .id3-editor--input":"_onChangeInput","change .id3-editor--input":"_onChangeInput"},template:r,initialize:function(t){this.options=t=i.extend({},t),i.extend(this,i.pick(t,["post","user"]))},_onChangeInput:function(t){var e=s(t.currentTarget);this.post.set(e.attr("name"),e.val())},serialize:function(){var t={id3Fields:i.pick(this.post.toJSON(),"trackTitle","trackArtist","trackAlbum"),id3FieldLabel:{trackTitle:n("Track"),trackArtist:n("Artist"),trackAlbum:n("Album")}};return t},render:function(){return this.$el.html(this.template(this.serialize())),this}});e.exports=a},{"../templates/id3_editor.tpl":67,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":288,"prima/view":318}],125:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/mixins/accessor"),r=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),l=t("./plaintext_editor"),h=t("../templates/inline_embed_field.tpl"),d=o.extend({className:"post-form--inline-embed-field",template:h,mixins:[n,r,a],initialize:function(t){this.options=i.extend({},this.defaults,t)},show:function(){this.inlineEmbedInput.setEditorValue(""),this.inlineEmbedInput.focus();var t=this.options.calculateWidth();this.$el.add(this.inlineEmbedInput.element).width(t),this.$el.addClass("open")},hide:function(){this.$el.removeClass("open")},getCurrentValue:function(){return this.inlineEmbedInput?this.inlineEmbedInput.getEditorValue():""},createSubViews:function(){var t=i.extend({placeholder:this.options.placeholder,name:"inlineEmbedInput",forceSingleLine:!0,syncWithModel:!1,onChange:i.bind(this._onInputChange,this),onClientEvent:i.bind(this._onInputClientEvent,this)});this.inlineEmbedInput=this.subViews.inlineEmbedInput=new l(t)},_set_field_state_default:function(){s(this.inlineEmbedInput.editor.element).removeClass("invalid")},_set_field_state_invalid:function(){s(this.inlineEmbedInput.editor.element).addClass("invalid")},_onInputChange:function(t){this.getCurrentValue()!==this.get("embedCode")&&this._set_field_state_default(),t&&"paste"===t.type&&this.options.submitEmbedCode()},_onInputClientEvent:function(t){if("keydown"===t.type)switch(t.which||t.keyCode){case 27:t.preventDefault(),t.stopImmediatePropagation(),this.options.returnFocus(),this.hide();break;case 13:t.preventDefault(),t.stopImmediatePropagation(),this.options.submitEmbedCode()}},beforeRender:function(){this.$el.html(this.template()),this.createSubViews()},render:function(){return this.attachSubViews(),this}});e.exports=d},{"../templates/inline_embed_field.tpl":68,"./plaintext_editor":136,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],126:[function(t,e){"use strict";var i=t("lodash"),s=t("./base"),o=t("../id3_editor"),n=t("../album_art_uploader"),r=t("app/components/remove-button"),a=t("./audio_player_shim"),l=t("../../templates/media/audio.tpl"),h=s.extend({className:"audio-media-container media-container",defaults:i.defaults({url:"",service:"",albumArt:"",type:"",id:""},s.prototype.defaults),events:{mouseenter:"_onHoverRemoveButton",mouseleave:"_onHoverRemoveButton"},template:l,beforeTeardown:function(){return delete this.audioPlayer,this.$el.removeClass(this.post.get("service")),this.$el.empty(),this},_onHoverRemoveButton:function(t){var e="mouseover"===t.type||"mouseenter"===t.type;this.js$("removeButton").toggleClass("active",e)},beforeRender:function(){this.removeButton=this.subViews.removeButton=new r({onClick:i.bind(function(){this.trigger("media:remove",this)},this),buttonClass:"top-right"}),this.$el.addClass(this.post.get("service")),"direct"===this.post.get("service")&&(this.post.canEditMedia()&&(this.id3Editor=this.subViews.id3Editor=new o(this.options),this.albumArtUploader=this.subViews.albumArtUploader=new n(i.defaults({url:this.post.get("albumArt")||""},this.options))),this.audioPlayer=this.subViews.audioPlayer=new a({extra_classes:null,post_id:"",service:"upload",lightbox:!1,preview:this.post.canEditMedia(),cover:this.post.get("albumArt"),tracks:[{stream_url:this.post.get("url"),cover:this.post.get("albumArt"),track:this.post.get("trackTitle"),artist:this.post.get("trackArtist"),album:this.post.get("trackAlbum")}]}))},afterRender:function(){this.listenTo(this.post,"change:url change:service",function(t){this.$el.removeClass(t.previous("service")),this.teardown().render()}),this.renderSubViews(),this.trigger("media:ready",this)}});e.exports=h},{"../../templates/media/audio.tpl":69,"../album_art_uploader":115,"../id3_editor":124,"./audio_player_shim":127,"./base":128,"app/components/remove-button":182,lodash:"K2RcUv"}],127:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/subviewable"),n=t("prima/utils/getpath"),r=n("window.Tumblr.AudioPlayer"),a=s.extend({mixins:[o],initialize:function(t){this.options=i.extend({},t)},teardown:function(){return this.audioPlayer.unbind_events(),this.$el.empty(),delete this.audioPlayer,this},render:function(){r||(r=n("window.Tumblr.AudioPlayer"));var t=i.defaults({replace:null,append_to:null,prepend_to:this.$el},this.options);return this.audioPlayer=new r(t),this.options.preview&&this.audioPlayer.$container.addClass("has_art"),this.$el.toggleClass("audio-player--preview-player",this.options.preview),this}});e.exports=a},{lodash:"K2RcUv","prima/mixins/subviewable":296,"prima/utils/getpath":308,"prima/view":318}],128:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=i.template(""),l=s.extend({className:"media-container",template:a,mixins:[o,n,r],defaults:{canEditMedia:!0},defaultOptions:{fullWidthPosts:!1},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),i.extend(this,i.pick(t,["post","user","uploads","dragEvents"])),i.isFunction(this.afterInitialize)&&this.afterInitialize.apply(this,arguments)},serialize:function(){return this.toJSON()},teardown:function(){return this.stopListening(),this},render:function(){return this.$el.html(this.template(this.serialize())),this.$el.toggleClass("full-width",this.options.fullWidthPosts),this.attachSubViews(),this}});e.exports=l},{lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],129:[function(t,e){"use strict";var i=t("lodash"),s=t("app/components/photoset/views/photo"),o=t("app/components/remove-button"),n=s.prototype.template,r=t("../../templates/media/edit_photo.tpl"),a=s.extend({className:"photoset--photo media-container",events:i.extend({mouseenter:"_onHoverMediaContainer",mouseleave:"_onHoverMediaContainer","click [data-js-clickthroughUrlButton]":"_onClickClickthroughUrlButton","click [data-js-captionButton]":"_onClickCaptionButton"},s.prototype.events),defaults:i.extend({enableClickthroughUrl:!1,hasClickthroughUrl:!1,enableCaption:!1,hasCaption:!1,isActive:!1},s.prototype.defaults),template:function(t){return n(t)+r(t)},_onHoverMediaContainer:function(t){clearTimeout(this._removeButtonActive);var e="mouseover"===t.type||"mouseenter"===t.type;e?(this.set("isActive",!0),this.trigger("photoset:hover",this,this.photo)):this._removeButtonActive=i.delay(i.bind(function(){this.set("isActive",!1)},this),500)},_onClickClickthroughUrlButton:function(t){this.photo.trigger("photo:editClickthroughUrl",this.photo,t.currentTarget)},_onClickCaptionButton:function(t){this.photo.trigger("photo:editCaption",this.photo,t.currentTarget)},_updateOverlayButtons:function(){this.js$("clickthroughUrlButton").css("display",this.get("enableClickthroughUrl")?"block":"none"),this.js$("captionButton").css("display",this.get("enableCaption")?"block":"none"),this.js$("clickthroughUrlButton").toggleClass("active",this.get("hasClickthroughUrl")),this.js$("captionButton").toggleClass("active",this.get("hasCaption"))},addStateListeners:function(){this.listenTo(this,"change:isActive",function(t,e){this.js$("removeButton").toggleClass("active",e),this.js$("mediaOverlay").toggleClass("active",e)}),this.listenTo(this,"photoset:unhover",function(){this.set("isActive",!1)}),this.listenTo(this,"change:enableClickthroughUrl change:enableCaption",this._updateOverlayButtons),this.listenTo(this,"change:hasClickthroughUrl change:hasCaption",this._updateOverlayButtons),this.listenTo(this.photos,"add remove",function(){this.photos.length>1?this.js$("sortable").attr("draggable",!0):this.js$("sortable").removeAttr("draggable")}),this.post&&this.listenTo(this.post,"change:linkthrough",function(t,e){this.set("hasClickthroughUrl",!!e)}),this.listenTo(this.photo,"change:caption",function(t,e){this.set("hasCaption",!!e)})},beforeRender:function(){var t=this.photos.length>1;this.set("enableClickthroughUrl",!t),this.set("enableCaption",t),this.set("hasClickthroughUrl",this.post?!!this.post.get("linkthrough"):!1),this.set("hasCaption",!!this.photo.get("caption")),this.removeButton=this.subViews.removeButton=new o({onClick:i.bind(function(){this.photoset.removePhoto(this.photo.id)},this),buttonClass:"top-right"}),this.addStateListeners()},afterRender:function(){s.prototype.afterRender.apply(this,arguments),this.photos.length>1&&this.js$("sortable").attr("draggable",!0),this._updateOverlayButtons()}});e.exports=a},{"../../templates/media/edit_photo.tpl":70,"app/components/photoset/views/photo":36,"app/components/remove-button":182,lodash:"K2RcUv"}],130:[function(t,e){"use strict";var i=t("lodash"),s=t("./base"),o=t("prima/lib/translate"),n=t("app/components/photoset"),r=t("app/components/photoset/models/photo"),a=t("app/components/photoset/views/editable_photoset"),l=t("app/components/webcam"),h=t("./edit_photo"),d=t("prima/mixins/promisifyevents"),c=t("../overlay_input"),u=t("../../templates/media/photo.tpl"),p=s.extend({className:"media-container photo-media-container",template:u,mixins:[d],defaults:i.defaults({canPreview:!0,showPhotoBooth:!1},s.prototype.defaults),afterInitialize:function(){this.addStateListeners(),this._updatePhotosetView=i.debounce(this.updatePhotosetView,50)},addStateListeners:function(){this.listenTo(this.post.photos,"add",this._onPhotosAdd),this.listenTo(this.post.photos,"remove",this._onPhotosRemove),this.listenTo(this,"change:showPhotoBooth",function(t,e){e?(this._createPhotoBooth(),this.js$("photoset").css("display","none")):(this.stopListening(this.photobooth),this.photobooth.remove(),this.js$("photoset").css("display",""))})},updatePhotosetView:function(){this.photoset.model.fixLayout(),this.photoset.indexView.trigger("update",this.photoset.model.photos,this.photoset.model.get("layout"))},_onPhotosAdd:function(t){this.post.set("linkthrough",""),t=this._preparePhotosetPhotoModel(t),this.photoset.model.add(t),this._updatePhotosetView()},_onPhotosRemove:function(t){this.post.set("linkthrough",""),this.photoset.model.remove(t.id),this.updatePhotosetView()},_preparePhotosetPhotoModel:function(t){i.isFunction(t.toJSON)&&(t=t.toJSON()),t.url=t.displayUrl;var e=i.keys(r.prototype.defaults);return e.unshift("id"),i.pick(t,e)},_syncPostToPhotoset:function(t){t||(t=this.photoset.model);var e=this.post.photos.map(this._preparePhotosetPhotoModel,this);t.photos.reset(e),t.set("layout",this.post.get("layout"))},_createPhotoBooth:function(){var t=this.photobooth=new l;t.render(),this.listenTo(t,"webcam:image",function(t){t&&t.base64&&this.post.photos.unshift({photoRaw:t.base64.split("base64,")[1],base64:t.base64,isSelfie:!0,isSelfieGif:t.isGif||!1,height:t.height,width:t.width})}),this.listenTo(t,"webcam:reset",function(){this.post.photos.shift()}),this.listenTo(t,"webcam:close",function(){this.post.photos.shift(),this.trigger("webcam:close")}),this.js$("photobooth").append(t.getElement())},_createPhotoset:function(){var t={dynamic:!0,padding:this.options.fullWidthPosts?2:5,width:this.options.fullWidthPosts?540:500};this.get("canEditMedia")&&(t.PhotosetView=a,t.PhotoView=h,t.post=this.post);var e=this.photoset=new n(t);return this._syncPostToPhotoset(e.model),this.get("canEditMedia")&&(this.listenTo(this.photoset,"change:layout",function(t,e){this.post.set("layout",e)}),this.listenTo(this.photoset,"sort",function(t){this.post.photos.setIdOrder(t.pluck("id"))}),this.listenTo(this.photoset,"photo:remove",function(t,e,i){this.set("layout",i),this.post.photos.remove(e)}),this.listenTo(this.photoset.indexView,"photoset:predrag",function(){this.overlayPopover&&this.overlayPopover.teardown()}),this.listenTo(this.photoset,"photo:editClickthroughUrl",this._createClickthroughUrlPopover),this.listenTo(this.photoset,"photo:editCaption",this._createCaptionPopover),this.listenTo(this.photoset,"change:caption",function(t,e){var i=this.post.photos.get(t.id);i&&i.set("caption",e)})),this.photoset.model.fixLayout(),e.render(),this.js$("photoset").append(e.getElement()),this.get("canEditMedia")&&this.listenTo(this.dragEvents,"drop",this._onDrop),e},_createClickthroughUrlPopover:function(t,e){this.overlayPopover&&(this.overlayPopover=this.overlayPopover.remove());var s=this.overlayPopover=new c({pinnedTarget:e,pinnedTargetContainer:this.photoset.getElement(),value:this.post.get("linkthrough"),placeholder:"http://..."});s.render(),this.listenTo(s,"change:value",function(t,e){e=i.trim(e||""),this.post.set("linkthrough",e)}),this.listenToOnce(s,"close",function(){this.stopListening(s),delete this.overlayPopover})},_createCaptionPopover:function(t,e){this.overlayPopover&&(this.overlayPopover=this.overlayPopover.remove());var s=this.overlayPopover=new c({pinnedTarget:e,pinnedTargetContainer:this.photoset.getElement(),maxLength:200,value:t.get("caption"),placeholder:o("Add a caption...")});s.render(),this.listenTo(s,"change:value",function(e,s){t.set("caption",i.trim(s||""))}),this.listenToOnce(s,"close",function(){this.stopListening(s),delete this.overlayPopover})},_onDrop:function(t){if(!i.isEmpty(this.$el.find(t.target))){t.preventDefault();var e=i.result(t.originalEvent.dataTransfer,"files");e&&this.trigger("media:addFiles",e)}},beforeTeardown:function(){this.photobooth&&(this.stopListening(this.photobooth),this.photobooth.remove()),delete this.photobooth,this.photoset&&(this.stopListening(this.photoset),this.photoset.remove()),delete this.photoset,this.overlayPopover&&(this.overlayPopover.remove(),this.stopListening(this.overlayPopover)),delete this.overlayPopover},afterRender:function(){this.js$("photobooth",!0),this.js$("photoset",!0),this._createPhotoset(),this.photobooth=!1,this.trigger("media:ready",this),this.renderSubViews()}});e.exports=p},{"../../templates/media/photo.tpl":71,"../overlay_input":134,"./base":128,"./edit_photo":129,"app/components/photoset":26,"app/components/photoset/models/photo":27,"app/components/photoset/views/editable_photoset":35,"app/components/webcam":195,lodash:"K2RcUv","prima/lib/translate":288,"prima/mixins/promisifyevents":294}],131:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("prima/utils/delayed"),r=t("./base"),a=t("prima/mixins/promisifyevents"),l=t("components/crt/player"),h=t("prima/lib/translate"),d=t("../../utils/scale_to_width"),c=t("app/components/remove-button"),u=t("../../templates/media/video.tpl"),p=t("../../templates/media/video_upload.tpl"),m=t("../../templates/media/video_embed.tpl"),g=t("../../templates/media/video_error.tpl"),f=r.extend({className:"media-container video-media-container",events:{mouseenter:"_onHoverRemoveButton",mouseleave:"_onHoverRemoveButton"},template:u,mixins:[a],defaults:i.defaults({canPreview:!0,file:!1,embed:!1,width:!1,height:!1},r.prototype.defaults),afterInitialize:function(){this.addStateListeners()},addStateListeners:function(){this.listenTo(this,"change",this._onChangeVideo),this.listenTo(this.post,"change:preuploadUrl",this._onChangePreuploadUrl)},_onHoverRemoveButton:function(t){var e="mouseover"===t.type||"mouseenter"===t.type;this.js$("removeButton").toggleClass("active",e)},_onChangeVideo:function(){(this.hasChanged("file")||this.hasChanged("embed")||this.hasChanged("canPreview"))&&(this.hasChanged("file")?this.attributes.embed=!1:this.hasChanged("embed")&&(this.attributes.file=!1),this.hasChanged("canPreview")||(this.canPreview=!0),this.isRendered()&&(this.teardown(),this.render(),this.addStateListeners()))},_onChangePreuploadUrl:function(t,e){this._updateUploadPreview(e,this.get("file"))},_updateUploadPreview:function(t,e){var i=e&&e.name?'"'+e.name+'"':"";t?(this.js$("previewIcon").removeClass("video-uploading").addClass("video-check"),this.js$("previewMessage").html(h("Your video %1$s has been uploaded",i))):(this.js$("previewIcon").removeClass("video-check").addClass("video-uploading"),this.js$("previewMessage").html(h("Uploading your video %1$s",i)))},_createVideoPlayer:function(t){if(!this.get("canPreview"))return this.js$("video").html(p({icon:"",message:""})),void this._updateUploadPreview(this.post.get("preuploadUrl"),t);var e=this.options.fullWidthPosts?540:500,s=this.get("width"),n=this.get("height"),r=s&&n?d(s,n,e):{width:e};i.extend(r,{file:t});var a=this.player=new l(document.createElement("video"),{attributes:{watch:!1},vjsOptions:r}),h=!1,c=this.whenEvent(a,"ready");return c.then(i.bind(function(){a.player.on("error",i.bind(function(){h=!0,this.set("canPreview",!1),this.trigger("media:ready",this)},this))},this)),o.join(this.whenEvent(a,"change:loaded"),c).then(i.bind(function(){if(!h){this.js$("video").append(a.$el);var t={width:"auto",height:"auto"},i=a.$video.prop("videoWidth"),s=a.$video.prop("videoHeight");i&&s&&(t=d(i,s,e)),a.$el.css(t),this.trigger("media:ready",this)}},this)),a.render(),a},_createVideoEmbed:function(){var t=function(t){return s('<a href="'+t.get("blog_url")+'"></a>').prop("hostname")}(this.user.getChannel(this.post.get("tumblelog"))),e=this.get("embed");this.options.fullWidthPosts&&e.isNativeVideo&&(e.embedCode=e.embedCode.replace(/\/500\//,"/540/"));var o=i.extend({tumblelogHostname:t},e);this.js$("video").html(m(o)),this.options.fullWidthPosts&&this._scaleElementWidth(this.js$("video").find("iframe"),540),"inline"===e.embedRenderContext?n(function(){this.trigger("media:ready",this)},250,this)():this.trigger("media:ready",this)},_scaleElementWidth:function(t,e){if(t instanceof s||(t=s(t)),t&&t.length){var i=t.attr("width"),o=t.attr("height"),n=i&&o?d(i,o,e):{width:e};t.attr(n)}},beforeTeardown:function(){this.player&&this.player.teardown(),delete this.player},beforeRender:function(){this.removeButton=this.subViews.removeButton=new c({onClick:i.bind(function(){this.trigger("media:remove",this)},this),buttonClass:"top-right"})},afterRender:function(){this.js$("video",!0),this.renderSubViews(),this.player=!1,this.get("file")?this._createVideoPlayer(this.get("file")):this.get("embed")?i.isEmpty(this.get("embed"))?(this.js$("video").html(g()),this.trigger("media:ready",this)):this._createVideoEmbed(this.get("embed")):this.trigger("media:ready",this)}});e.exports=f},{"../../templates/media/video.tpl":72,"../../templates/media/video_embed.tpl":73,"../../templates/media/video_error.tpl":74,"../../templates/media/video_upload.tpl":75,"../../utils/scale_to_width":112,"./base":128,"app/components/remove-button":182,"components/crt/player":218,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":288,"prima/mixins/promisifyevents":294,"prima/utils/delayed":306,when:"RG2dij"}],132:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=(t("prima/lib/logger"),t("app/components/upload")),r=t("./plaintext_editor"),a=t("app/components/remove-button"),l=t("./tooltip"),h=t("prima/mixins/accessor"),d=t("prima/mixins/subviewable"),c=t("prima/mixins/selectorcache"),u=t("../templates/media_dropzone.tpl"),p=s(document),m=o.extend({className:"media-dropzone-container media-container",template:u,mixins:[h,d,c],defaults:{droppable:!1,showInput:!1,toggleDropzone:!1,dropzoneText:"",enableUpload:!0,enableUrl:!0,uploadIcon:"",uploadText:"",uploadTooltip:"",urlIcon:!1,urlText:"",urlTooltip:"",url:"",urlPlaceholder:"http://..."},defaultOptions:{uploadOptions:{},modelKey:!1,urlParser:!1,documentDrag:!0,parseOnUpload:!1,parseOnInput:!1,parseOnEnter:!0,parseOnPaste:!0,inputDebounceTime:250,fullWidthPosts:!1},events:{mouseenter:"_onHoverMediaContainer",mouseleave:"_onHoverMediaContainer","click [data-show-tooltip]":"_onClickShowTooltip","click [data-js-mediaUrl]":"_focusUrlInput"},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),i.isString(t.dropzoneFineprint)&&(t.dropzoneFineprint=[t.dropzoneFineprint]),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),i.defaults(this.attributes,{defaultBehavior:this.get("enableUpload")?"upload":"url",dropzoneBehavior:this.get("enableUpload")?"upload":"url",splitDropzone:this.get("enableUpload")&&this.get("enableUrl")}),this.upload=new n(t.uploadOptions),t.modelKey&&this.listenTo(this.upload,"change:url",this._onUploadUrlChange),this.listenTo(this.upload,"add",function(t){this.trigger("upload:start",t)}),this.listenTo(this.upload,"complete",function(t,e){this.trigger("upload:complete",e)}),this.listenTo(this.upload,"error",function(t,e){this.trigger("upload:error",e)}),this.listenTo(this.upload,"allComplete",function(t){this.trigger("uploads:allComplete",t)}),this.listenTo(this,"change:droppable",function(t,e){this.js$("dropzone").toggleClass("droppable",e)}),this.listenTo(this,"change:showInput",function(t,e){e?(this.js$("dropzone").addClass("show-input"),this._onUrlInputChange()):(this.js$("dropzone").removeClass("show-input"),this.js$("dropzone").height(""),this.get("defaultBehavior")!==this.get("dropzoneBehavior")&&this.set("dropzoneBehavior",this.get("defaultBehavior")))}),this.listenTo(this,"change:toggleDropzone",function(t,e){e?(this.js$("dropzone").addClass("toggle-dropzone"),this.js$("mediaUploadText").text(this.get("dropzoneText")),this.js$("mediaUrlText").text(this.get("dropzoneText"))):(this.js$("dropzone").removeClass("toggle-dropzone"),this.js$("mediaUploadText").text(this.get("uploadText")),this.js$("mediaUrlText").text(this.get("urlText")))}),this.listenTo(this,"change:dropzoneBehavior",function(t,e){this.js$("dropzone").removeClass("toggle-dropzone-upload toggle-dropzone-url").addClass("toggle-dropzone-"+e)}),this.__updateUrlFromInput=i.debounce(this._updateUrlFromInput,this.options.inputDebounceTime),this.__onDragOver=i.bind(this._onDragOver,this),this.__onDragLeave=i.bind(this._onDragLeave,this)},urlParser:function(t,e){return i.isFunction(this.options.urlParser)?this.options.urlParser(t,this,e):void 0},addFiles:function(t){return this.upload.addFiles(t)},_addDragStartListener:function(){s(document).on("dragover.dropzone dragenter.dropzone",this.__onDragOver)},_removeDragStartListener:function(){s(document).off("dragover.dropzone dragenter.dropzone",this.__onDragOver)},_addDragEndListener:function(){s(document).on("mouseout.dropzone",this.__onDragLeave)},_removeDragEndListener:function(){s(document).off("mouseout.dropzone",this.__onDragLeave)},_onDragOver:function(){this._dragging=!0,this.set("droppable",!0),this._removeDragStartListener(),this._addDragEndListener()},_onDragLeave:function(){this._dragging=!1,this.set("droppable",!1),this._addDragStartListener(),this._removeDragEndListener()},_onClickShowTooltip:function(t){var e=this.$(t.currentTarget).data("showTooltip"),s=i.result(this,e);s&&s instanceof l&&!s.isOrWasRecentlyRendered()&&s.render()},_focusUrlInput:function(t){return this.js$("removeButton").is(t.target)||this.js$("removeButton").find(t.target).length?!0:(this.set("showInput",!0),void(this.urlInput&&this.urlInput.focus()))},_onUploadUrlChange:function(t,e){this.model&&(this.model.set(this.options.modelKey,e),this.options.parseOnUpload&&this.urlParser(e,"upload"))},_updateUrlFromInput:function(){var t=this.urlInput?this.urlInput.getEditorValue():"";t=t.replace(/\u200B/g,""),this.set("url",t)},_onUrlInputChange:function(){this.urlInput&&this.get("showInput")&&(this.js$("dropzone").height(this.urlInput.$el.height()),this.__updateUrlFromInput())},_onUrlInputClientEvent:function(t){if("keydown"===t.type)switch(t.which||t.keyCode){case 27:t.preventDefault(),t.stopImmediatePropagation(),this.set("showInput",!1),this.urlInput.setEditorValue(""),this.urlInput.blur();break;case 13:this.options.parseOnEnter&&!t.shiftKey?(t.preventDefault(),t.stopImmediatePropagation(),this._updateUrlFromInput(),this.urlParser(this.get("url"),"enter")):this.options.parseOnInput&&(this.urlParser(this.get("url")),this.listenToOnce(this,"change:url",function(t,e){this.urlParser(e,"input")}));break;default:this.options.parseOnInput&&(this.urlParser(this.get("url")),this.listenToOnce(this,"change:url",function(t,e){this.urlParser(e,"input")}))}},_onUrlInputPasteEvent:function(){i.delay(i.bind(function(){this.options.parseOnPaste&&(this._updateUrlFromInput(),this.urlParser(this.get("url"),"paste"))},this),0)},_onHoverMediaContainer:function(t){clearTimeout(this._removeButtonActive);var e="mouseover"===t.type||"mouseenter"===t.type;
e?this.js$("removeButton").addClass("active"):this._removeButtonActive=i.delay(i.bind(function(){this.js$("removeButton").removeClass("active")},this),500)},serialize:function(){return i.mapValues(this.toJSON(),function(t,e){return i.isFunction(t)&&e.match(/^(upload|url)(Icon|Text|Tooltip)$/)?t():t},this)},beforeTeardown:function(){this.upload.getElement().detach(),this.subViews.upload=void 0,p.off("keydown.postForm.dropzone keyup.postForm.dropzone")},afterTeardown:function(){this.uploadTooltip&&this.uploadTooltip.remove(),this.urlTooltip&&this.urlTooltip.remove(),delete this.uploadTooltip,delete this.urlTooltip,delete this.urlInput,delete this.urlInput,delete this.removeButton,this._removeDragStartListener(),this._removeDragEndListener()},beforeRender:function(){if(this.subViews.upload=this.upload.indexView,this.get("enableUrl")){var t={placeholder:this.get("urlPlaceholder"),name:"url",syncWithModel:!1,onChange:i.bind(this._onUrlInputChange,this),onClientEvent:i.bind(this._onUrlInputClientEvent,this),pasteHook:i.bind(this._onUrlInputPasteEvent,this)};i.defaults(t,i.pick(this.options,i.keys(t))),this.urlInput=this.subViews.urlInput=new r(t),this.removeButton=this.subViews.removeButton=new a({onClick:i.bind(function(){this.set("showInput",!1),this.urlInput.setEditorValue("")},this),buttonClass:"top-right"})}p.on("keydown.postForm.dropzone keyup.postForm.dropzone",i.bind(function(t){switch(t.which||t.keyCode){case 18:var e=this.get("defaultBehavior"),i="url"===e?"upload":"url";"keydown"===t.type?this.set("dropzoneBehavior",i):this.get("showInput")||this.set("dropzoneBehavior",e)}},this)),this.options.documentDrag&&this._addDragStartListener()},afterRender:function(){this.$el.toggleClass("full-width",this.options.fullWidthPosts),this.get("enableUrl")&&this.urlInput.setEditorValue(this.get("url")||""),this.get("enableUpload")&&this.get("uploadTooltip")&&(this.uploadTooltip=new l({className:"dropzone-tooltip-popover",sanitize:!1,text:i.result(this.attributes,"uploadTooltip")}),this.uploadTooltip.setPinnedTarget(this.js$("uploadTooltip"))),this.get("enableUrl")&&this.get("urlTooltip")&&(this.urlTooltip=new l({className:"dropzone-tooltip-popover",sanitize:!1,text:i.result(this.attributes,"urlTooltip")}),this.urlTooltip.setPinnedTarget(this.js$("urlTooltip"))),this.renderSubViews()},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this}});e.exports=m},{"../templates/media_dropzone.tpl":76,"./plaintext_editor":136,"./tooltip":162,"app/components/remove-button":182,"app/components/upload":192,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/logger":268,"prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],133:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),r=t("../models/mention"),a=t("prima/mixins/accessor"),l=t("prima/mixins/popoverbase"),h=t("prima/mixins/selectorcache"),d=t("../templates/mention_dropdown.tpl"),c=function(){},u=o.extend({className:"popover--mention-dropdown",defaults:{currentKeyedChoice:-1,currentMousedChoice:-1,interactive:!1,lastResults:{},debugMode:!1},mixins:[a,h,l],template:d,initialize:function(){this.model=new r,this.listenTo(this,"change:lastResults",this.preRender),c=i.bind(c,this)},preRender:function(t,e){var i=(e.blogs||[]).length;c("MentionDropdown - PreRender with %d results.",i),this.set({currentKeyedChoice:-1,currentMousedChoice:-1,interactive:!1}),i?(this._rendered&&this.teardown(!0),this.set("numSuggestions",i),this.render(e)):this.trigger("dropdown:empty")},render:function(t){return c("MentionDropdown - Render"),this.$el.html(this.template(t)),this.trigger("dropdown:render"),n.trigger("postForms:dismissListener:suspend"),this},afterRender:function(){s(".item-option",this.$el).on("click",i.bind(this.handleMouseClick,this)),s(".item-option",this.$el).on("mouseover",i.bind(this.handleMouseOver,this)),this.$el.on("mouseout",i.bind(this.handleMouseOut,this))},teardown:function(t){return this.$el.remove(),t||this.set({interactive:!1,lastResults:{}}),n.trigger("postForms:dismissListener:resume"),this},updateMentionDropdown:function(t,e){c("MentionDropdown - fetch callback",e),this.set("lastResults",e)},cycleUp:function(){this._cycle(-1)},cycleDown:function(){this._cycle(1)},_cycle:function(t){var e=this.get("currentKeyedChoice"),s=this.get("currentMousedChoice"),o=i.isNumber(s)&&-1!==s,n=o?s:e,r=this.get("numSuggestions"),a=(n+t)%r;r&&(this.set({currentKeyedChoice:0>a?r-1:a,currentMousedChoice:-1}),this.styleMenuItems(),this.set("interactive",this.get("currentKeyedChoice")>=0),this.trigger("dropdown:menuInteraction",!0))},styleMenuItems:function(t){var e,o=t&&"mouseout"!==t.type,n=this.get("currentKeyedChoice");i.each(s(".item-option",this.$el),function(i,r){o?s(i).toggleClass("cycled",t.currentTarget===i):(s(i).toggleClass("cycled",r===n),r===n&&(e=s(i)))},this)},handleMouseOver:function(t){var e=s(t.currentTarget).index(".item-option");this.styleMenuItems(t),this.set({interactive:!0,currentMousedChoice:e}),this.trigger("dropdown:menuInteraction",!0)},handleMouseOut:function(t){var e=-1!==this.get("currentKeyedChoice");this.styleMenuItems(t),this.set({interactive:e,currentMousedChoice:-1}),this.trigger("dropdown:menuInteraction",e)},handleMouseClick:function(t){this.set("interactive",!0),s(t.currentTarget).addClass("cycled"),this.trigger("dropdown:confirm")},getCurrentBlogChoice:function(){var t=this.get("lastResults");if(!this._rendered||i.isEmpty(t)||!("blogs"in t))return!1;var e=this.get("currentMousedChoice"),s=this.get("currentKeyedChoice"),o=0;return e>=0?o=e:s>=0&&(o=s),t.blogs[o]},getBlogChoice:function(t){var e=this.get("lastResults");return!1===i.isEmpty(e)&&"blogs"in e&&e.blogs[t]?e.blogs[t]:!1}});e.exports=u},{"../models/mention":45,"../templates/mention_dropdown.tpl":77,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/mixins/accessor":289,"prima/mixins/popoverbase":293,"prima/mixins/selectorcache":295,"prima/view":318}],134:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").animate,r=t("app/components/post_form_builder/utils/transition_speed"),a=t("prima/lib/translate"),l=t("prima/view"),h=t("prima/mixins/selectorcache"),d=t("prima/mixins/accessor"),c=t("prima/mixins/popoverbase"),u=t("../templates/overlay_input.tpl"),p=l.extend({className:"overlay-input-popover",mixins:[h,d,c],template:u,events:{"keydown [data-js-input]":"_onKeyDown","input [data-js-input]":"_onInput","keyup [data-js-input]":"_onInput","change [data-js-input]":"_onInput","click [data-js-confirm]":"_onClickConfirm"},defaultOptions:{updateValueOnInput:!1,updateValueOnClose:!0},defaults:{value:"",placeholder:"",maxLength:2048,confirmText:a("Done")},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.$pinnedContainer=s(t.pinnedTargetContainer)},_onKeyDown:function(t){switch(t.which||t.keyCode){case 13:this._onClickConfirm();break;case 27:t.stopPropagation(),this.teardown()}},_onInput:function(){this.options.updateValueOnInput&&this._updateValueFromInput()},_onClickConfirm:function(){this._updateValueFromInput(),this.teardown()},_updateValueFromInput:function(){var t=this.js$("input").val();this.set("value",t)},openAnimation:function(t){i.isNumber(t)||(t=r(100)),this._startWidth=this.$pinned.outerWidth(),this.js$("popover").width(this._startWidth);var e=this.$pinned.position().left;return this._offsetLeft=i.isEmpty(this.$pinnedContainer)?0:this.$pinnedContainer.offset().left-this.$pinned.offset().left+e||0,this.setShift(i.defaults({x:this._offsetLeft},this.getShift())),o.all([n(this.$pinned,{opacity:0},{display:"none",duration:t}),n(this.js$("confirm"),{opacity:1},{duration:t}),n(this.js$("popover"),{marginLeft:this._offsetLeft,width:this._targetWidth},{duration:t})])},pinnedRect:function(){var t=this.$pinned.css("display");this.$pinned.css("display","block");var e=c.properties.defaults.pinnedRect.apply(this,arguments);return this.$pinned.css("display",t),e},closeAnimation:function(t){return i.isNumber(t)||(t=r(100)),o.all([n(this.$pinned,{opacity:1},{display:"block",duration:t}),n(this.js$("confirm"),{opacity:0},{duration:t}),n(this.js$("popover"),{marginLeft:0,width:this._startWidth},{duration:t})])},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this._targetWidth=i.isEmpty(this.$pinnedContainer)?520:this.$pinnedContainer.outerWidth()-20,this.setPinnedSide(!1),i.defer(i.bind(function(){this.openAnimation().then(i.bind(function(){this.js$("input").focus()},this))},this)),this},teardown:function(){return this.options.updateValueOnClose&&this._updateValueFromInput(),this.stopListening(),this.closeAnimation().then(i.bind(function(){this.remove()},this)),this}});e.exports=p},{"../templates/overlay_input.tpl":78,"app/components/post_form_builder/utils/transition_speed":175,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":288,"prima/mixins/accessor":289,"prima/mixins/popoverbase":293,"prima/mixins/selectorcache":295,"prima/view":318,"velocity-animate":"lWl/mc",when:"RG2dij"}],135:[function(t,e){"use strict";var i=t("lodash"),s=t("./media_dropzone"),o=t("./webcam_button"),n=t("app/components/webcam/utils/get_user_media"),r=s.extend({events:i.extend({"click [data-js-webcamButton]":"_onClickWebcamButton"},s.prototype.events),_onClickWebcamButton:function(){this.trigger("webcam:show")},afterRender:function(){if(s.prototype.afterRender.apply(this,arguments),n){var t=this.subViews.webcamButton=new o;t.render().$el.appendTo(this.js$("mediaUpload").children(".split-cell-inner"))}}});e.exports=r},{"./media_dropzone":132,"./webcam_button":166,"app/components/webcam/utils/get_user_media":201,lodash:"K2RcUv"}],136:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),r=t("ligature").PlainTextEditor,a=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("prima/mixins/accessor"),d=t("../templates/plaintext_editor.tpl"),c=o.extend({defaults:{placeholder:"",name:"",syncWithModel:!0,forceSingleLine:!1},events:{},mixins:[h,a,l],template:d,initialize:function(t){if(this.set(t),this.onChange=t.onChange||i.noop,this.onClientEvent=t.onClientEvent||i.noop,this.pasteHook=t.pasteHook||i.noop,this.get("syncWithModel")){var e=this.get("name");this.$el.attr("data-name",e),this.listenToOnce(this.model,"change:"+e,this.updateEditorFromModel)}},_initializeEditor:function(t,e){var i={placeholder:e,onChange:this._composeOnChange(),onClientEvent:this._composeOnClientEvent(),pasteHook:this.pasteHook,runIFrameSanitization:!0,forceSingleLine:this.get("forceSingleLine"),filterRules:{elements:["p","br"],attributes:{},remove_contents:["style","noscript","script","meta"],protocols:{}}};this.editor=new r(t,i)},_composeOnChange:function(){var t=[this.onChange],e=this;return this.get("syncWithModel")&&t.unshift(this.updateModelFromEditor),function(s){i.each(t,function(t){t.call(e,s)})}},_composeOnClientEvent:function(){var t=this.onClientEvent,e=this;return function(i){n.trigger("plainTextEditor:onClientEvent",i,e.editor),t.call(this,i)}},render:function(){this.$el.html(this.template());var t=this.js$("plainTextEditor").get(0);if(this._initializeEditor(t,this.get("placeholder")),this.get("syncWithModel")){var e=this._modelValue().length>0;e&&this.set("placeholder",!1),this.updateEditorFromModel()}return this},teardown:function(){return this.$el.empty(),delete this.editor,this},serialize:function(){var t=i.extend({__:__},this.attributes);return t},getEditorValue:function(){return this.editor?this.editor.getData(!0):null},setEditorValue:function(t){this.editor&&this.editor.setData(t)},updateModelFromEditor:function(){if(!this.editor)return!1;var t=this.get("name"),e=this.getEditorValue();""!==e?s(this.editor.element).addClass("has-text"):s(this.editor.element).removeClass("has-text"),this.model.get(t)!==e&&this.model.set(t,e)},updateEditorFromModel:function(t,e){var i=this.getEditorValue();e="undefined"!=typeof t&&"undefined"!=typeof e?e:this._modelValue(),e||(e=""),e!==i&&this.setEditorValue(e)},_modelValue:function(){return this.model.get(this.get("name"))||""},focus:function(){var t=this;i.defer(function(){t.editor&&t.editor.element.focus()})},blur:function(){var t=this;i.defer(function(){t.editor&&t.editor.element.blur()})},enable:function(){s(this.editor.element).attr("contenteditable",!0)},disable:function(){s(this.editor.element).attr("contenteditable",!1)}});e.exports=c},{"../templates/plaintext_editor.tpl":79,jquery:"HlZQrA",ligature:325,lodash:"K2RcUv","prima/events":261,"prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],137:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").animate,r=t("prima/utils/sequence-with-context"),a=t("prima/lib/translate"),l=t("prima/view"),h=t("prima/events"),d=t("prima/mixins/subviewable"),c=t("prima/mixins/selectorcache"),u=t("prima/mixins/accessor"),p=t("./avatar"),m=t("./tumblelog_select"),g=t("./post_settings"),f=t("./tag_editor"),_=t("./editor_buttons"),v=t("./social_buttons"),b=t("./save_post_button"),y=t("./reblog_as_button"),w=t("./allow_answers"),x=t("./error_bar"),k=t("./post_type_form/_create"),C=t("../templates/post_form.tpl"),S=l.extend({className:"post-form",stickyClassName:"sticky",stickyFooterBottomMargin:0,stickyFooterPosition:null,defaults:{useMediaReady:!1,showFooter:!0,enabled:!0,locked:!1,saving:!1},events:{"click [data-js-clickableClose]":"_onClickClose","click [data-js-clickableSave]":"_onClickSave",keydown:"_onKeyDown"},mixins:[d,c,u],template:C,initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.user=t.user,this.post=t.post,this.uploads=t.uploads,this.dragEvents=t.dragEvents,i.extend(this.attributes,i.pick(this.post.attributes,["mode"])),this.set("isFixFooterEnabled",!1),this.__onBeforeUnload=i.bind(this._onBeforeUnload,this)},_targetHandlesDrag:function(t){var e=s(t);return i.isEmpty(e.closest(".editable-photoset"))&&i.isEmpty(e.closest(".media-dropzone"))&&i.isEmpty(e.closest("input"))&&i.isEmpty(e.closest('[contenteditable="true"]'))?!1:!0},_onDragOver:function(t){this._targetHandlesDrag(t.target)&&!i.isEmpty(t.originalEvent.dataTransfer.files)&&(t.originalEvent.dataTransfer.dropEffect="copy"),t.preventDefault()},_onDrop:function(t){this._targetHandlesDrag(t.target)||t.preventDefault()},_onModelChange:function(){this.subViews.errorBar.hideErrorBar()},_onChangeShowFooter:function(t,e){this.isRendered()&&this.js$("footer").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeEnabled:function(t,e){e?this.$el.removeClass("no-pointer-events"):this.$el.addClass("no-pointer-events")},_onChangeLocked:function(t,e){e?this.$$(".post-form--guard").addClass("visible"):this.$$(".post-form--guard").removeClass("visible")},_onClickClose:function(){h.trigger("postForms:close")},_onClickSave:function(){this.save()},_onReblogAs:function(t){this.post.set("type",t),this.trigger("postForms:changePostType")},_onTextEditorClientEvent:function(t,e){if(("input"===t.type||"keydown"===t.type)&&e){if(this.fixFooterPosition(),!this.isFooterSticky())return;var i=e.getCurrentElement();if(i&&0===s(i).closest("[data-js-bottom]").length){var o=s(window).height()-i.getBoundingClientRect().bottom,n=this.js$("bottom").height()+this.stickyFooterBottomMargin,r=o-n;if(0>r){var a=this.$el.closest(".post-forms-modal");a.length>0?a[0].scrollTop-=r:window.scrollBy(0,-r)}}}},getRect:function(){var t=this.$el.css("display");this.$el.css("display","block");var e=this.$el.offset(),i={};return i.offsetTop=e.top,i.offsetLeft=e.left,i.offsetHeight=this.$el.outerHeight(),i.offsetWidth=this.$el.outerWidth(),this.$el.css("display",t),i},measureHeight:function(){if(!this.isRendered())return void 0;var t=this.$el.css("display");this.$el.css("display","block");var e=this.$el.outerHeight();return this.$el.css("display",t),e},animateShow:function(t,e){t||(t=0),e||(e=0),t||this.js$("container-outer").css("opacity",1);var i=[n(this.js$("container-outer"),{opacity:[1,0]},{duration:t}),n(this.js$("container-inner"),{translateY:[0,10]},{duration:t,delay:e})];return this.options.isModal&&i.push(n(this.js$("margin"),{opacity:[1,0]},{duration:t})),this.avatar&&this.avatar.updateViewState(),o.all(i)},animateHide:function(t,e){t||(t=0),e||(e=0),t||this.js$("container-outer").css("opacity",0),this.options.isModal||this.avatar.resetAvatar();var i=[n(this.js$("container-outer"),{opacity:[0,1]},{duration:t}),n(this.js$("container-inner"),{translateY:[10,0]},{duration:t,delay:e})];return this.options.isModal&&i.push(n(this.js$("margin"),{opacity:[0,1]},{duration:t})),o.all(i)},forceHidden:function(){return this.js$("container-outer").css("opacity",0),this.options.isModal&&this.js$("margin").css("opacity",0),n(this.js$("container-inner"),{translateY:[10,10]},{duration:0}),this},save:function(){var t;h.trigger("postForms:saving"),this.subViews.errorBar.hideErrorBar();var e=r([function(){!1===this.model.isValid()},function(){this.set({enabled:!1,locked:!0,saving:!0})},function(){},function(){return t=this.model.save(this.options)},function(){this.set({enabled:!1,locked:!0,saving:!1,saved:!0})}],this).then(i.bind(function(e){if(e=e.filter(function(t){return t}),e.length&&(e=e[0]),i.isEmpty(e.errors)){if(h.trigger("postForms:saved",{},t),"reblog"===this.model.get("mode")){var s=this.model.get("reblog_id"),o=window.Tumblr.Posts.find({id:s});o&&o.updateReblogControl()}}else{var n=[];for(var r in e.errors)n.push(e.errors[r]);this.set({enabled:!0,locked:!1,saving:!1,saved:!1});var a=n.join("<br>");this.subViews.errorBar.showErrorBar(a),h.trigger("postForms:error")}},this));return e["catch"](i.bind(function(t){this.set({enabled:!0,locked:!1,saving:!1,saved:!1}),h.trigger("postForms:error")},this)),e},createSubViews:function(){var t=["fullWidthPosts","popoverContainer","dragEvents"],e=i.extend({user:this.user,post:this.post,uploads:this.uploads,model:this.model},i.pick(this.options,t),this.attributes),s="new"===this.post.get("mode")?null:this.post.get("tumblelog");this.avatar=this.subViews.avatar=new p(i.extend(this.options.isModal?{}:{determineViewState:!1,showSubavatar:this.user.getChannel(s).get("show_author_avatar"),avatarUrl:this.user.getChannel(s).get("avatar_url")},e)),this.tumblelogSelect=this.subViews.tumblelogSelect=new m(e),this.postSettings=this.subViews.postSettings=new g(e),this.tagEditor=this.subViews.tagEditor=new f(e),this.editorButtons=this.subViews.editorButtons=new _(e),this.socialButtons=this.subViews.socialButtons=new v(e),this.savePostButton=this.subViews.savePostButton=new b(e),this.postTypeForm=this.subViews.postTypeForm=k(e),this.set("useMediaReady",this.postTypeForm.get("hasMediaView")),this.listenTo(this.postTypeForm,"media:ready",function(){var t=i.toArray(arguments);t.unshift("media:ready"),this.trigger.apply(this,t)}),this.postTypeForm.has("showCaption")&&(this.set("showFooter",this.postTypeForm.get("showCaption")),this.listenTo(this.postTypeForm,"change:showCaption",function(t,e){this.set("showFooter",e)})),this.listenTo(h,"postForms:tumblelogSelectDropdown:open",function(){this.trigger("checkScrollSize"),this.trigger("pauseScrollHelper")}),this.listenTo(h,"postForms:tumblelogSelectDropdown:close",function(){this.trigger("checkScrollSize",!0),this.trigger("resumeScrollHelper")}),this.post.allowsReblogAs()&&(this.reblogAsButton=this.subViews.reblogAsButton=new y(e),this.listenTo(this.reblogAsButton,"reblogAs:type",this._onReblogAs)),this.subViews.allowAnswers=new w(e),this.subViews.errorBar=new x},addStateListeners:function(){this.listenTo(this,"change:showFooter",this._onChangeShowFooter),this.listenTo(this,"change:enabled",this._onChangeEnabled),this.listenTo(this,"change:locked",this._onChangeLocked),this.listenTo(this.model,"change",this._onModelChange),this.listenTo(h,"postForms:enableFixFooter",this.enableFixFooter),this.listenTo(h,"postForms:modalView:scroll",this.fixFooterPosition),this.listenTo(h,"DOMEventor:flatscroll",this.fixFooterPosition),this.listenTo(h,"DOMEventor:flatresize",this.fixFooterPosition),this.listenTo(h,"postForms:resized",this.fixFooterPosition),this.listenTo(h,"richTextEditor:onClientEvent",this._onTextEditorClientEvent),this.listenTo(h,"plainTextEditor:onClientEvent",this._onTextEditorClientEvent),this.listenTo(this.dragEvents,"dragover",this._onDragOver),this.listenTo(this.dragEvents,"drop",this._onDrop),this.listenTo(this.tagEditor,"postForms:focusOnNextEditor",this.focusOnNextEditor)},serialize:function(){return this.toJSON()},beforeRender:function(){this.dragEvents.start(),this.createSubViews(),this.addStateListeners(),s(window).on("beforeunload",this.__onBeforeUnload)},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this},afterRender:function(){this.get("showFooter")||this.js$("footer").css({display:"none",opacity:0}),this.renderSubViews()},enableFixFooter:function(){this.set("isFixFooterEnabled",!0)},fixFooterPosition:function(){if(this.get("isFixFooterEnabled")){var t=null,e=s(window).height(),i=s(window).width(),o=960,n=this.$el,r=n[0],a=e-r.getBoundingClientRect().bottom,l=this.js$("bottom"),h=l[0],d=e-h.getBoundingClientRect().bottom,c=s(this.subViews.allowAnswers.$el),u="none"===c.css("display")?0:c.outerHeight();if(this.isFooterSticky()){var p=l.height()+this.stickyFooterBottomMargin;(o>i||a+this.js$("blank-bar").height()+u>=p)&&(t=!1)}else i>=o&&d<=this.stickyFooterBottomMargin&&(t=!0);null!==t&&(this.js$("container-inner").css("transform",""),n.toggleClass(this.stickyClassName,t)),this.changeBottomPosition()}},unFixFooterPosition:function(){s(this.$el).removeClass(this.stickyClassName)},isFooterSticky:function(){return s(this.$el).hasClass(this.stickyClassName)},changeBottomPosition:function(){var t=this.js$("header"),e=this.js$("bottom"),i=this.isFooterSticky();i&&null===this.stickyFooterPosition&&(this.stickyFooterPosition=e.height()+this.stickyFooterBottomMargin);var o=s(window).height()-t[0].getBoundingClientRect().bottom,n=i&&o<=this.stickyFooterPosition;e.toggleClass("unfixed",n)},teardown:function(){return this.dragEvents.stop(),this.stopListening(),s(window).off("beforeunload",this.__onBeforeUnload),this},remove:function(){return this.teardown(),l.prototype.remove.apply(this,arguments)},_onKeyDown:function(t){this.focusOnNextEditor(t)},focusOnNextEditor:function(t){if(9===t.keyCode){var e=this.$el.find(".editor[contenteditable]:visible"),i=s.inArray(t.target,e);if(-1!==i){t.preventDefault();var o=(i+(t.shiftKey?-1:1))%e.length;0>o&&(o+=e.length),s(e[o]).focus()}}},_onBeforeUnload:function(){if(this.model.deepHasChanged(this.get("initialPostState"))){var t="If you leave this page before saving, your post will be discarded.";return"edit"===this.model.get("mode")&&(t="If you leave this page before saving, all your edits will be discarded."),a(t)}}});e.exports=S},{"../templates/post_form.tpl":80,"./allow_answers":116,"./avatar":119,"./editor_buttons":121,"./error_bar":122,"./post_settings":139,"./post_type_form/_create":142,"./reblog_as_button":152,"./save_post_button":156,"./social_buttons":158,"./tag_editor":159,"./tumblelog_select":163,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/lib/translate":288,"prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/utils/sequence-with-context":315,"prima/view":318,"velocity-animate":"lWl/mc",when:"RG2dij"}],138:[function(t,e){"use strict";var i=t("prima/view"),s=t("../templates/post_preview.tpl"),o=i.extend({template:s,initialize:function(t){this.options=t},render:function(){return this.$el.html(this.template(this.options)),this}});e.exports=o},{"../templates/post_preview.tpl":81,"prima/view":318}],139:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/mixins/subviewable"),o=t("prima/mixins/selectorcache"),n=t("../templates/post_settings.tpl"),r=t("./post_settings_dropdown"),a=i.extend({className:"post-form--post-settings-button",events:{"click [data-js-clickablePostSettingsCog]":"togglePostSettingsDropdown"},mixins:[s,o],template:n,initialize:function(t){this.options=t||{}},render:function(){return this.$el.html(this.template()),this.createDropdown(),this},createDropdown:function(){var t=_.extend(this.options,{shift:{x:0,y:10},model:this.options.post,identifier:"postForms:postSettingsDropdown"});this.postSettingsDropdown=new r(t),this.postSettingsDropdown.setPinnedTarget(this.js$("postSettingsCog"))},togglePostSettingsDropdown:function(){this.postSettingsDropdown.isOrWasRecentlyRendered()||this.postSettingsDropdown.render()}});e.exports=a},{"../templates/post_settings.tpl":82,"./post_settings_dropdown":140,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],140:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/translate"),n=t("prima/events"),r=t("app/components/tooltip"),a=t("app/components/dialog"),l=t("prima/mixins/accessor"),h=t("prima/mixins/selectorcache"),d=t("prima/mixins/popoverbase"),c=t("app/mixins/tumblrselect"),u=t("../templates/post_settings_dropdown.tpl"),p=s.extend({className:"popover--post-settings-dropdown",defaults:{textFields:["customUrl","sourceUrl","postDate"],checkboxFields:["allowPhotoReplies","htmlMode"],selectFields:["editorType"]},mixins:[l,h,d,c],template:u,initialize:function(t){this.options=t=i.extend({},t),i.extend(this,i.pick(t,["post","user","uploads"]))},render:function(){this.$el.html(this.template(this.serialize())),this.setupTextInputFields(),this.setupCheckboxInputFields(),this.setupSelectFields(),this.js$("htmlMode").prop("checked","rich"!==this.model.get("editorType"));var t=new r({selector:"#htmlModeHelp",class_name:"html-mode-tooltip",placement:"right"});return t.render(),this.delegateEvents(),n.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return this.$el.remove(),n.trigger("postForms:dismissListener:resume"),this},serialize:function(){return this.model.toJSON()},setupTextInputFields:function(){i.each(this.get("textFields"),function(t){var e=this["$"+t]=this.js$(t);return"sourceUrl"===t&&this.model.isReblog()?void e.attr("readonly",!0):void e.on("keydown keyup",i.bind(function(t){var i=t.which||t.keyCode;"keyup"===t.type?this.model.set(e.attr("name"),e.val()):13===i&&this.teardown()},this))},this)},setupCheckboxInputFields:function(){i.each(this.get("checkboxFields"),function(t){var e=this["$"+t]=this.js$(t),s=e.attr("name");e.prop("checked",!!this.model.get(s)),e.on("change",i.bind(function(){var o="_onChange"+i.camelize("-"+t);i.isFunction(this[o])?this[o]():this.model.set(s,e.prop("checked"))},this))},this)},setupSelectFields:function(){i.each(this.get("selectFields"),function(t){var e=this["$"+t]=this.js$(t),s=e.attr("name");this.setUpSelector(e),e.children('[value="'+this.model.get(s)+'"]').attr("selected",!0),e.trigger("change"),e.on("change",i.bind(function(){var o="_onChange"+i.camelize("-"+t);i.isFunction(this[o])?this[o]():this.model.set(s,e.val())},this))},this)},setupInputListeners:function(){var t=this.get("checkboxFields");i.each(this.get("inputSelectorNames"),function(e){var s=this["$"+e];s.on("change",i.bind(function(){var i=-1!==t.indexOf(e)?s.prop("checked"):s.val();this.model.set(s.attr("name"),i)},this))},this)},_onChangeHtmlMode:function(){var t=this.js$("htmlMode").prop("checked")?"html":"rich";this.js$("editorType").val(t).trigger("change")},_onChangeEditorType:function(){var t=this.model.get("editorType"),e=this.js$("editorType").val();if(!t)return void this.model.set("editorType",this.user.get("defaultEditorType")||"rich");if(t!==e)if("rich"!==t&&"rich"===e&&this.model.get("htmlEdited")){var s={text:o("%1$sGoing back to normal?%2$sYou might lose any code that doesn't get along with our text editor%3$s",'<h3 class="header_confirm">',"</h3><small>","</small>"),keycommand_maintain:!0};a.confirm(s,i.bind(function(){this.js$("editorType").blur(),this.model.set({htmlEdited:!1,editorType:e}),this._delayedClose()},this))}else i.defer(i.bind(function(){this.model.set("editorType",e)},this)),this._delayedClose()},_delayedClose:function(t){i.isNumber(t)||(t=300),i.delay(i.bind(function(){this.teardown()},this),t)}});e.exports=p},{"../templates/post_settings_dropdown.tpl":83,"app/components/dialog":12,"app/components/tooltip":188,"app/mixins/tumblrselect":210,lodash:"K2RcUv","prima/events":261,"prima/lib/translate":288,"prima/mixins/accessor":289,"prima/mixins/popoverbase":293,"prima/mixins/selectorcache":295,"prima/view":318}],141:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/mixins/accessor"),r=t("prima/mixins/subviewable"),a=t("../../templates/post_type_form/_audio_search_results.tpl"),l=o.extend({defaults:{currentChoice:-1,serviceResults:{}},events:{"click .clear-results":"clearResults","click .result":"_clickedChoice","mouseover .result":"resetCurrentChoice"},mixins:[n,r],template:a,initialize:function(){this.listenTo(this,"change:serviceResults",function(t){t.trigger("searchResults:updated",t._getResultCount())}),this.listenTo(this,"change:currentChoice",this._styleResults)},updateResultsForService:function(t){var e=this.get("serviceResults"),s=i.clone(e);s[t.service]=t.tracks,this.set("serviceResults",s),!1===i.isEqual(e,t)&&(this.resetCurrentChoice(),this.teardown(),this.render())},handleMenuCommand:function(t){var e=s(".result",this.$el),i=this.get("currentChoice");if("confirm"===t){if(-1!==i){var o=s(e[this.get("currentChoice")]).attr("data-href");this.trigger("searchResults:select",o)}}else{var n="cycleUp"===t?-1:1,r=(this.get("currentChoice")+n+e.length)%e.length;this.set("currentChoice",r)}},render:function(){var t=i.extend(i.pick(this.attributes,"serviceResults"),{resultCount:this._getResultCount()});return this.$el.html(this.template(t)),this},teardown:function(){return this.$el.empty(),this},reset:function(){this.set("serviceResults",{})},resetCurrentChoice:function(){this.set("currentChoice",-1)},clearResults:function(){this.trigger("searchResults:clear")},_clickedChoice:function(t){var e=s(t.currentTarget).attr("data-href");this.trigger("searchResults:select",e)},_getResultCount:function(){return i.reduce(this.get("serviceResults"),function(t,e){return t+(i.isArray(e)?e.length:0)},0)},_styleResults:function(t,e){i.each(s(".result",t.$el),function(t,i){s(t).toggleClass("cycled",i===e)})}});e.exports=l},{"../../templates/post_type_form/_audio_search_results.tpl":84,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/subviewable":296,"prima/view":318}],142:[function(t,e){"use strict";var i=t("lodash"),s={text:t("./text"),photo:t("./photo"),link:t("./link"),quote:t("./quote"),chat:t("./chat"),audio:t("./audio"),video:t("./video"),note:t("./note")},o=t("./text"),n=function(t){var e;i.isPlainObject(t)?e=t.model:(e=t,t={model:e});var n=s[e.get("type")]||o;return new n(t)};e.exports=n},{"./audio":143,"./chat":145,"./link":146,"./note":147,"./photo":148,"./quote":149,"./text":150,"./video":151,lodash:"K2RcUv"}],143:[function(t,e){"use strict";var i=t("lodash"),s=t("./base"),o=t("prima/lib/translate"),n=(t("prima/lib/logger"),t("../../templates/post_type_form/audio.tpl")),r=t("../plaintext_editor"),a=t("./_audio_search_results"),l=t("../audio_uploader"),h=t("../media/audio"),d=t("../confirm_tos"),c=t("../richtext_editor"),u=t("../reblog_tree"),p=t("../../services/audio_search_service"),m=t("app/components/dialog"),g=s.extend({defaults:i.defaults({maxSearchResults:4,showSearchField:!0,showAudioUploader:!0,showSearchResultList:!1,hasMediaView:!0,hasMedia:!1,showTos:!1,showCaption:!1},s.prototype.defaults),template:n,afterInitialize:function(){this.searchService=new p,"new"!==this.post.get("mode")&&this.set({hasMedia:!0,showCaption:!0,showSearchField:!1,showAudioUploader:!1,showSearchResultList:!1})},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"audio-search-field",placeholder:o("Search for a song or paste a URL"),name:"search",forceSingleLine:!0,onClientEvent:i.bind(this.handleSearchMenuKeys,this)},t),s=i.extend({},t),n={className:"audio-search-results-field"},p=i.extend({url:this.post.get("url"),service:this.post.get("service"),albumArt:this.post.get("albumArt"),canEditMedia:this.post.canEditMedia(),fullWidthPosts:this.options.fullWidthPosts},t);
this.post.get("bandcamp")&&i.extend(p,this.post.get("bandcamp"));var m=i.extend({},t),g=i.extend({className:"caption-field",name:"caption",placeholder:"Write something..."},t);this.searchField=this.subViews.searchField=new r(e),this.audioUploader=this.subViews.audioUploader=new l(s),this.searchResultList=this.subViews.searchResultList=new a(n),this.mediaPreview=this.subViews.mediaPreview=new h(p),this.confirmTos=this.subViews.confirmTos=new d(m),this.caption=this.subViews.caption=new c(g),"reblog"===this.post.get("mode")&&(this.reblogTree=this.subViews.reblogTree=new u(t))},addStateListeners:function(){this.listenTo(this.audioUploader,"upload:start",this._onFileUploadStart),this.listenTo(this.audioUploader,"upload:complete",this._onFileUploadComplete),this.listenTo(this.audioUploader,"upload:error",this._onFileUploadError),this.searchResultList.listenTo(this.searchService,"searchResults:fetched",this.searchResultList.updateResultsForService),this.listenTo(this.searchService,"audioEmbedData:fetched",this._onAudioEmbedDataFetched),this.searchResultList.listenTo(this.searchField,"searchField:menuKey",this.searchResultList.handleMenuCommand),this.listenTo(this.searchResultList,"searchResults:updated",function(t){var e=i.isEmpty(this.post.get("url"))&&t>0;this.set("showSearchResultList",e)}),this.listenTo(this.searchResultList,"searchResults:select",this.setAudioContentFromUrl),this.searchField.listenTo(this.searchResultList,"searchResults:clear",function(){this.setEditorValue(""),this.focus()}),this.listenTo(this.mediaPreview,"media:ready",function(){var t=i.toArray(arguments);t.unshift("media:ready"),this.trigger.apply(this,t)}),this.post.canEditMedia()&&this.listenTo(this.mediaPreview,"media:remove",this.removeMedia),this.listenTo(this.post,"change:search",i.debounce(this._onChangeSearchInput,200)),this.listenTo(this,"change:showSearchField",this._onChangeShowSearchField),this.listenTo(this,"change:showAudioUploader",this._onChangeShowAudioUploader),this.listenTo(this,"change:showSearchResultList",this._onChangeShowSearchResultList),this.listenTo(this,"change:hasMedia",this._onChangeHasMedia),this.listenTo(this,"change:showTos",this._onChangeShowTos),this.listenTo(this,"change:showCaption",this._onChangeShowCaption)},removeMedia:function(){"direct"===this.post.get("service")&&this.searchField.setEditorValue(""),this.post.softReset();var t=i.isEmpty(this.post.get("search"));this.set({hasMedia:!1,showSearchField:!0,showSearchResultList:!t,showAudioUploader:t,showTos:!1}),this.mediaPreview.set({url:"",service:""}),this.js$("confirmTos").attr("checked",!!this.post.get("confirmTos")),i.isEmpty(this.post.get("caption"))&&i.isEmpty(this.post.get("tags"))&&this.set("showCaption",!1),this.searchField.focus()},_onChangeShowSearchField:function(t,e){this.searchField.$el.css({display:e?"block":"none",opacity:e?1:0})},_onChangeShowAudioUploader:function(t,e){this.audioUploader.$el.css({display:e?"block":"none",opacity:e?1:0})},_onChangeShowSearchResultList:function(t,e){this.searchResultList.$el.css({display:e?"block":"none",opacity:e?1:0})},_onChangeHasMedia:function(t,e){this.isRendered()&&this.mediaPreview.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeShowTos:function(t,e){this.isRendered()&&this.js$("tos").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeShowCaption:function(t,e){this.isRendered()&&this.js$("caption").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},setAudioContent:function(t,e,s){i.isObject(t)&&(s=t,t=""),s=i.extend({preuploadUrl:"",url:(t||"").replace(/\u200B/g,""),service:e},s),("bandcamp"!==e||s.id&&s.type)&&(this.mediaPreview.set(s),this.post.set(i.pick(s,["url","preuploadUrl","service","albumArt","preuploadAlbumArt","trackTitle","trackArtist","trackAlbum"])))},setAudioContentFromUrl:function(t,e,s){e||(e=this.searchService.getServiceByUrl(t)),s||(s={}),this.setAudioContent(t,e,s),this.set({hasMedia:!0,showCaption:!0,showSearchField:!1,showSearchResultList:!1,showAudioUploader:!1,showTos:!i.isEmpty(s.preuploadUrl)}),this.caption.focus()},_onChangeSearchInput:function(t,e){e=(e||"").replace(/\u200B/g,"");var s=i.isEmpty(e)?!1:this.searchService.getServiceByUrl(e);s?("direct"===s?this.setAudioContentFromUrl(e,s):this.searchService.getData(e,s),this.post.unset("search")):i.isEmpty(e)?(this.searchResultList.reset(),this.set("showAudioUploader",this.get("showSearchField"))):(i.forEach(this.searchService.searchServices,function(t){this.searchService.search(t,e)},this),this.set("showAudioUploader",!1))},_onAudioEmbedDataFetched:function(t,e,s){i.isObject(t)&&(s=t,t=s.url),this.setAudioContentFromUrl(t,e,s)},handleSearchMenuKeys:function(t){var e,i=["keyup","keydown"],s={13:"confirm",38:"cycleUp",40:"cycleDown"};return t=t||window.event,-1!==i.indexOf(t.type)&&(e=t.which||t.keyCode,e in s)?("keydown"===t.type&&13===e&&t.stopImmediatePropagation(),this.searchResultList.isRendered()&&"keyup"!==t.type&&(this.searchField.trigger("searchField:menuKey",s[e]),t.preventDefault()),!1):void 0},_onFileUploadStart:function(){},_onFileUploadComplete:function(t){var e={preuploadUrl:t.get("url")},s=t.get("album_art_url");s&&(e.preuploadAlbumArt=!0,e.albumArt=s);var o=t.get("id3");i.isObject(o)&&(e.trackTitle=o.Title,e.trackArtist=o.Artist,e.trackAlbum=o.Album),this.setAudioContentFromUrl(e.preuploadUrl,"direct",e)},_onFileUploadError:function(t){var e=t.get("error")||o("Error uploading audio");i.isArray(e)&&(e=e.join("</p><p>")),m.alert("<p>"+e+"</p>")},afterRender:function(){this.renderSubViews(),i.forEach({showSearchField:this.searchField,showAudioUploader:this.audioUploader,showSearchResultList:this.searchResultList,hasMedia:this.mediaPreview},function(t,e){this.get(e)||t.$el.css({display:"none",opacity:0})},this),this.get("showTos")||this.js$("tos").css({display:"none",opacity:0}),this.get("showCaption")||this.js$("caption").css({display:"none",opacity:0})}});e.exports=g},{"../../services/audio_search_service":54,"../../templates/post_type_form/audio.tpl":85,"../audio_uploader":118,"../confirm_tos":120,"../media/audio":126,"../plaintext_editor":136,"../reblog_tree":154,"../richtext_editor":155,"./_audio_search_results":141,"./base":144,"app/components/dialog":12,lodash:"K2RcUv","prima/lib/logger":268,"prima/lib/translate":288}],144:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=i.template(""),l=s.extend({template:a,mixins:[o,n,r],defaults:{hasMediaView:!1},defaultOptions:{fullWidthPosts:!1},initialize:function(t){if(this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),!t.post)throw new Error("PostFormView requires a Post model!");if(!t.user)throw new Error("PostFormView requires a User model");i.extend(this,i.pick(t,["post","user","uploads"])),i.isFunction(this.afterInitialize)&&this.afterInitialize.apply(this,arguments)},createSubViews:function(){},subViewOptions:function(){return i.extend({},i.pick(this.options,"fullWidthPosts","dragEvents"),i.pick(this,"model","uploads","user","post"))},addStateListeners:function(){},serialize:function(){return i.extend({canEditMedia:this.post.canEditMedia()},this.post.toJSON(),this.toJSON())},teardown:function(){return this.stopListening(),this},beforeRender:function(){this.createSubViews(),this.addStateListeners()},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this}});e.exports=l},{lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],145:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/lib/translate"),n=t("./base"),r=t("ligature").SelectionPersistence,a=t("../plaintext_editor"),l=t("../../templates/post_type_form/chat.tpl"),h=n.extend({template:l,placeholders:["%1$sFirefighter:%2$s That's the way the cookie crumbles.%3$s%1$sButler:%2$s It falls on me to reassemble the cookie.","%1$sStockbroker:%2$s I need a vacation.%3$s%1$sTourist:%2$s I'm already on one.%3$s%1$sStockbroker:%2$s Get out of my office.","%1$sAbbott:%2$s Who is the man on first base?%3$s%1$sCostello:%2$s That's what I'm telling you!%3$s%1$sAbbott:%2$s I'm unqualified to manage a baseball team.","%1$sRick:%2$s Our problems don't amount to a hill of beans in this crazy world.%3$s%1$sIlsa:%2$s Great, now I'm hungry for beans.","%1$sPresident Garfield:%2$s I declare war on Mondays.","%1$sAlbert Einstein:%2$s Energy equals mass times the speed of light squared.%3$s%1$sCop:%2$s Tell it to the judge.","%1$sAxl:%2$s Welcome to the jungle.%3$s%1$sCustomer:%2$s We'd like a table for two, please.%3$s%1$sAxl:%2$s Your table is right this way.","%1$sElton:%2$s It seems to me you've lived your life like a candle in the wind.%3$s%1$sCandle:%2$s What can I say? I'm a real risk-taker.","%1$sTourist:%2$s Could you give us directions to Olive Garden?%3$s%1$sNew Yorker:%2$s No, but I could give you directions to an actual Italian restaurant.","%1$sTourist:%2$s Could you give me directions to the Olive Garden?%3$s%1$sNew Yorker:%2$s The one in Times Square or the one on 6th Ave?%3$s%1$sTourist:%2$s I don't know, I'm not from around here.","%1$sPangloss:%2$s Could you give me directions to the Olive Garden?%3$s%1$sCandide:%2$s No, but we can cultivate our own garden.%3$s%1$sPangloss:%2$s That sounds rational to me.","%1$sCharles Dickens:%2$s It was the best of mimes, it was the worst of mimes.%3$s%1$sMime:%2$s ..."],afterInitialize:function(){this.user.get("language")&&"en_US"!==this.user.get("language")?(this._placeholders=i.filter(this.placeholders,function(t){return o(t)!==t}),i.isEmpty(this._placeholders)&&(this._placeholders=this.placeholders)):this._placeholders=this.placeholders},randomPlaceholder:function(){var t=i.sample(this._placeholders||this.placeholders);return o(t,"<b>","</b>","<br>")},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"title-field",name:"title",isResizable:!0,placeholder:o("Title"),allowLinebreaks:!1},t),s=i.extend({className:"chat-field normal",name:"chat",placeholder:this.randomPlaceholder(),onChange:i.bind(function(t){t&&t.keyCode&&13!==t.keyCode&&this.formatText()},this),convertNewlinesToLinebreaks:!0},t);this.title=this.subViews.title=new a(e),this.chat=this.subViews.chat=new a(s)},afterRender:function(){return this.renderSubViews(),this.subViews.chat.focus(),this.model.get("chat")&&this.formatText(),this},formatText:function(){this.subViews.chat.getEditorValue()&&this.formatTextNode(this.subViews.chat.$el.find(".editor-plaintext").get(0))},formatTextNode:function(t){if(t){if(3!==t.nodeType)return void i.each(t.childNodes,i.bind(function(t){this.formatTextNode(t)},this));if(this.stripZeroWidthSpaceFromNode(t),"B"===t.parentNode.tagName)return void this.cleanBoldNode(t.parentNode);if(!(s(t).prev().length>0&&"BR"!==s(t).prev()[0].tagName)){var e=/^([^(:|\n)]+:)/,o=t.nodeValue.match(e);if(o){var n=this.subViews.chat.$el.find(".editor-plaintext"),a=r.saveSelection(n.get(0)),l=t.parentNode;if(i.isObject(l)){var h=o[0];t.nodeValue=t.nodeValue.replace(e,"");var d=document.createElement("b");d.innerHTML=h,l.insertBefore(d,t)}r.restoreSelection(a)}}}},cleanBoldNode:function(t){if("B"===t.tagName)if(t.childNodes.length>1)for(;t.childNodes.length>1&&t.innerHTML.match(/<br\s*[\/]?>/);)t.parentNode.insertBefore(t.firstChild,t);else{var e=t.firstChild;if(-1===e.nodeValue.indexOf(":"))return void this.unwrapNode(t);var i=/:(.+)$/,s=e.nodeValue.match(i);if(s){var o=this.subViews.chat.$el.find(".editor-plaintext"),n=r.saveSelection(o.get(0)),a=s[1],l=document.createTextNode(a);e.nodeValue=e.nodeValue.replace(/:(.+)$/,":"),t.parentNode.insertBefore(l,t.nextSibling),r.restoreSelection(n)}}},unwrapNode:function(t){var e=this.subViews.chat.$el.find(".editor-plaintext"),i=r.saveSelection(e.get(0)),s=t.parentNode,o=t.firstChild,n=o.nodeValue;n&&(s.insertBefore(o,t.nextSibling),s.normalize()),t.remove(),this.formatTextNode(s),r.restoreSelection(i)},stripZeroWidthSpaceFromNode:function(t){var e=/\u200B/;if(t&&3===t.nodeType&&t.nodeValue.match(e)){var i=this.subViews.chat.$el.find(".editor-plaintext"),s=r.saveSelection(i.get(0));t.nodeValue=t.nodeValue.replace(e,""),r.restoreSelection(s)}}});e.exports=h},{"../../templates/post_type_form/chat.tpl":86,"../plaintext_editor":136,"./base":144,jquery:"HlZQrA",ligature:325,lodash:"K2RcUv","prima/lib/translate":288}],146:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("./base"),n=t("../../templates/post_type_form/link.tpl"),r=t("../plaintext_editor"),a=t("../richtext_editor"),l=t("../reblog_tree"),h=t("app/components/remove-button"),d=t("../../services/open_graph_service"),c=t("../../utils/validation"),u=o.extend({className:"post-composer_link-post",events:{"mouseenter .media-container":"_onHoverRemoveButton","mouseleave .media-container":"_onHoverRemoveButton"},template:n,defaults:i.defaults({hasMediaView:!0,hasMedia:!1,showUrl:!0,showTitle:!1,showCaption:!1,ogFetchPending:!1,isUserTitle:!1,isUserCaption:!1},o.prototype.defaults),afterInitialize:function(){this._ogService=new d,"new"!==this.model.get("mode")&&this.set({showTitle:!0,showCaption:!0})},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"link-title-field",name:"title",isResizable:!1,placeholder:s("Enter a title"),forceSingleLine:!0},t),o=i.extend({className:"url-field",name:"url",isResizable:!1,placeholder:s("Paste a link"),forceSingleLine:!0},t),n=i.extend({className:"caption-field",name:"caption",placeholder:s("Add a caption...")},t);this.title=this.subViews.title=new r(e),this.url=this.subViews.url=new r(o),this.caption=this.subViews.caption=new a(n),this.removeButton=this.subViews.removeButton=new h({buttonClass:"top-right"}),"reblog"===this.model.get("mode")&&(this.reblogTree=this.subViews.reblogTree=new l(t))},addStateListeners:function(){this.post.canEditMedia()&&this.listenTo(this.removeButton,"remove",this.removeMedia),"reblog"!==this.model.get("mode")&&(this.listenTo(this.post,"change:url",i.debounce(this._onChangeUrl,200)),this.listenTo(this.post,"change:title",this._onChangeTitle),this.listenTo(this.post,"change:caption",this._onChangeCaption)),this.listenTo(this,"change:showTitle",this._onChangeShowTitle),this.listenTo(this,"change:hasMedia",this._onChangeHasMedia),this.listenTo(this,"change:showCaption",this._onChangeShowCaption)},_onChangeTitle:function(){this.get("ogFetchPending")||this.set("isUserTitle",!0)},_onChangeCaption:function(){this.get("ogFetchPending")||this.set("isUserCaption",!i.isEmpty(this.post.get("caption")))},_onHoverRemoveButton:function(t){var e="mouseover"===t.type||"mouseenter"===t.type;this.js$("removeButton").toggleClass("active",e)},afterRender:function(){this.renderSubViews(),this.post.canEditMedia()?this.url.focus():(this.title.disable(),this.url.disable()),this.get("showTitle")||this.title.$el.css({display:"none",opacity:0}),this.get("hasMedia")||this.removeButton.$el.css({display:"none",opacity:0}),this.get("showCaption")||this.js$("caption").css({display:"none",opacity:0}),this.options.fullWidthPosts&&this.$el.find(".media-container").addClass("full-width"),"new"!==this.model.get("mode")&&this._updateWithGraphInfo({url:this.model.get("url"),image:this.model.get("thumbnail")}),this.trigger("media:ready")},_onChangeUrl:function(t,e){if(!this.get("ogFetchPending")){if(i.isEmpty(e))return void this.removeMedia();if(e=e.trim(),!c.isUrl(e)){var s="http://"+e;if(!c.isUrl(s))return;e=s}this.set("ogFetchPending",!0),this._ogService.fetchOpenGraphData(e).then(i.bind(this._updateWithGraphInfo,this),i.bind(this._onOpenGraphFail,this))}},_updateWithGraphInfo:function(t){var e=t.url||this.post.previousAttributes().url,s=function(t){return t.replace(/^https?:\/\/(www.)?/,"")},o=this.model.previousAttributes().url||"",n=s(o)!==s(e);this.$el.addClass("loaded"),this.set({hasMedia:!0,showTitle:!0,showCaption:!0}),n&&((!this.get("isUserTitle")||i.isEmpty(this.post.get("title")))&&(t.title?this.title.setEditorValue(t.title,!0):this.title.setEditorValue("")),(!this.get("isUserCaption")||i.isEmpty(this.post.get("caption")))&&(t.description?this.caption.setEditorValue("<p>"+t.description+"</p>",!0):this.caption.setEditorValue(""))),this.model.set("url",e),t.image?(this.js$("linkeditor").addClass("has-image"),this.js$("urlimage").css("background-image","url("+t.image+")"),this.model.set("thumbnail",t.image)):(this.js$("linkeditor").removeClass("has-image"),this.js$("urlimage").css("background-image","")),this.set("ogFetchPending",!1)},_onOpenGraphFail:function(){this.set("ogFetchPending",!1)},removeMedia:function(){this.stopListening(),this.post.softReset(),this.get("isUserCaption")||(this.post.set("caption",""),this.caption.setEditorValue("")),i.forEach({title:this.title,url:this.url,caption:this.caption},function(t){t.updateEditorFromModel()},this),this.addStateListeners(),this.set({hasMedia:!1,showTitle:!1,isUserTitle:!1}),i.isEmpty(this.post.get("caption"))&&(this.set("isUserCaption",!1),i.isEmpty(this.post.get("tags"))&&this.set("showCaption",!1)),this.$el.removeClass("loaded"),this.url.focus()},_onChangeShowTitle:function(t,e){this.title.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeHasMedia:function(t,e){this.isRendered()&&this.removeButton.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeShowCaption:function(t,e){this.isRendered()&&this.js$("caption").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})}});e.exports=u},{"../../services/open_graph_service":58,"../../templates/post_type_form/link.tpl":87,"../../utils/validation":114,"../plaintext_editor":136,"../reblog_tree":154,"../richtext_editor":155,"./base":144,"app/components/remove-button":182,lodash:"K2RcUv","prima/lib/translate":288}],147:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("./base"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/accessor"),a=t("../ask_field"),l=t("../richtext_editor"),h=t("../reblog_tree"),d=t("../../templates/post_type_form/note.tpl"),c=o.extend({events:{},mixins:[n,r],template:d,className:"post-composer_note-post",createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"answer-field",name:"answer",placeholder:s("Write something...")},t),o=i.extend({className:"caption-field",name:"caption",placeholder:s("Write something...")},t);this.askField=this.subViews.askField=new a(t),this.model.get("is_reblog")?(this.reblogTree=this.subViews.reblogTree=new h(t),this.caption=this.subViews.caption=new l(o)):this.answerField=this.subViews.answerField=new l(e)},afterRender:function(){return this.renderSubViews(),this.model.get("is_reblog")?this.subViews.caption.focus():this.subViews.answerField.focus(),this}});e.exports=c},{"../../templates/post_type_form/note.tpl":88,"../ask_field":117,"../reblog_tree":154,"../richtext_editor":155,"./base":144,lodash:"K2RcUv","prima/lib/translate":288,"prima/mixins/accessor":289,"prima/mixins/subviewable":296}],148:[function(t,e){"use strict";var i=t("lodash"),s=t("./base"),o=t("app/components/dialog"),n=(t("prima/lib/logger"),t("prima/lib/translate")),r=t("prima/utils/url"),a=t("prima/lib/data"),l="FileReader"in window&&"readAsDataURL"in FileReader.prototype,h=t("../../utils/validation"),d=t("../../models/photo"),c=t("../media/photo"),u=t("../photo_media_dropzone"),p=t("../richtext_editor"),m=t("../reblog_tree"),g=t("../../templates/post_type_form/photo.tpl"),f=2048,_=s.extend({template:g,defaults:i.defaults({hasMediaView:!0,hasMedia:!1,canAddMedia:!0,showPhotoBooth:!1,showCaption:!1},s.prototype.defaults),afterInitialize:function(){this._urlParser=i.debounce(i.bind(this._photoUrlParser,this),100),(!this.post.photos.isEmpty()||this.post.isReblog())&&this.set({hasMedia:!0,showCaption:!0}),this.set("canAddMedia",this.post.canEditMedia()&&this.post.canAddPhotos())},_photoUrlParser:function(t,e){if(t=i.trim(t),t&&t.length<f&&h.isUrl(t)){var s=new d;this.listenTo(s,"photo:readUrl",function(t,i){t&&this.post.canAddPhotos()&&(this.post.photos.push(i),e.urlInput.setEditorValue(""),e.urlInput.blur(),e.set({showInput:!1,dropzoneBehavior:"url",defaultBehavior:"url"}))}),s.set("externalUrl",t)}},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({canEditMedia:this.post.canEditMedia()},t),s=i.extend({toggleDropzone:this.get("hasMedia"),dropzoneText:n("Add another"),uploadIcon:"dropzone-add-photo-icon",uploadText:n("Upload photos"),urlIcon:"dropzone-add-url-icon",urlText:n("Add photo from web"),urlParser:this._urlParser,uploadOptions:{}},t);i.extend(s.uploadOptions,{name:"photo",maxUploadSize:10485760,uploadPattern:/^image\/(?:.*)$/i,accept:"image/*",url:"/svc/post/upload_photo",fileUpload:{multiple:!0}});var o=i.extend({className:"caption-field",name:"caption",placeholder:n("Add a caption...")},t);this.mediaPreview=this.subViews.mediaPreview=new c(e),this.mediaComposer=this.subViews.mediaComposer=new u(s),this.caption=this.subViews.caption=new p(o),"reblog"===this.post.get("mode")&&(this.reblogTree=this.subViews.reblogTree=new m(t))},addStateListeners:function(){this.listenTo(this.mediaComposer,"upload:start",this._onFileUploadStart),this.listenTo(this.mediaComposer,"upload:complete",this._onFileUploadComplete),this.listenTo(this.mediaComposer,"upload:error",this._onFileUploadError),this.listenTo(this.mediaComposer,"webcam:show",function(){this.set("showPhotoBooth",!0)}),this.listenTo(this.post.photos,"add",this._onAddPhotos),this.listenTo(this.post.photos,"remove",this._onRemovePhotos),this.listenTo(this.mediaPreview,"media:ready",function(){var t=i.toArray(arguments);t.unshift("media:ready"),this.trigger.apply(this,t)}),this.listenTo(this.mediaPreview,"media:addFiles",function(t){this.mediaComposer.addFiles(t)}),this.listenTo(this.mediaPreview,"webcam:close",function(){this.set("showPhotoBooth",!1)}),this.listenTo(this,"change:hasMedia",this._onChangeHasMedia),this.listenTo(this,"change:canAddMedia",this._onChangeCanAddMedia),this.listenTo(this,"change:showPhotoBooth",this._onChangeShowPhotoBooth),this.listenTo(this,"change:showCaption",this._onChangeShowCaption)},_onAddPhotos:function(){this.set({hasMedia:!this.post.photos.isEmpty(),canAddMedia:this.post.canAddPhotos()}),i.isEmpty(this.post.get("caption"))&&i.isEmpty(this.post.get("tags"))?this.set("showCaption",this.get("hasMedia")):this.set("showCaption",!0),this.mediaComposer.set({toggleDropzone:!this.post.photos.isEmpty()})},_onRemovePhotos:function(){this.set({hasMedia:!this.post.photos.isEmpty()||this.get("showPhotoBooth"),canAddMedia:this.post.canAddPhotos()}),this.mediaComposer.set({toggleDropzone:!this.post.photos.isEmpty()})},_onChangeHasMedia:function(t,e){this.isRendered()&&this.mediaPreview.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeCanAddMedia:function(t,e){this.isRendered()&&(this.mediaPreview.$el.toggleClass("photo-media-container--can-add",e),this.mediaComposer.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0}))},_onChangeShowPhotoBooth:function(t,e){this.isRendered()&&(this.mediaPreview.set("showPhotoBooth",e),this.mediaPreview.$el.toggleClass("photo-media-container--show-photobooth",e),e?(this.mediaPreview.$el.css({display:"block",opacity:1}),this.mediaComposer.$el.css({display:"none",opacity:0})):(this._onChangeHasMedia(this,this.get("hasMedia")),this._onChangeCanAddMedia(this,this.get("canAddMedia"))))},_onChangeShowCaption:function(t,e){this.isRendered()&&this.js$("caption").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onFileUploadStart:function(t){this.uploads.add(t);var e=t.get("file");this.mediaPreview.set({file:e,canEditMedia:!0});var i=new d;l?this.listenTo(i,"photo:readFile",function(t,e){t&&this.post.canAddPhotos()&&(this.post.photos.push(e),this.mediaComposer.set({dropzoneBehavior:"upload",defaultBehavior:"upload"}))}):this.listenTo(i,"change:preuploadUrl",function(t,e){e&&(this.stopListening(t,"change:preuploadUrl"),this.post.canAddPhotos()&&(this.post.photos.push(t),this.mediaComposer.set({dropzoneBehavior:"upload",defaultBehavior:"upload"})))}),t.set("postPhoto",i),i.set("upload",t),i.set("file",e)},_onFileUploadComplete:function(t){var e=t.get("postPhoto");e&&(t.get("url")?e.set("preuploadUrl",t.get("url")):(o.alert("<p>"+[t.get("original_filename"),n(t.get("error"))].join("</p><p>")+"</p>"),this.post.photos.remove(e)))},_onFileUploadError:function(t){t.messages&&o.alert("<p>"+i.pluck(t.messages,"message").join("</p><p>")+"</p>")},afterRender:function(){this.checkUrl(),this.renderSubViews(),this.get("canAddMedia")?this.mediaPreview.$el.addClass("photo-media-container--can-add"):this.mediaComposer.$el.css({display:"none",opacity:0}),this.get("hasMedia")||this.mediaPreview.$el.css({display:"none",opacity:0}),this.get("showCaption")||this.js$("caption").css({display:"none",opacity:0})},checkUrl:function(){var t=r.getParameter("src"),e=r.getParameter("caption"),i=r.getParameter("tags");r.isAbsoluteUrl(t)||(t=a.get("Context.hosts.assets_host")+t),"edit"!==this.model.get("mode")&&t&&e&&i&&(this._photoUrlParser(t,this.mediaComposer),this.model.set("caption",e),this.model.set("tags",i.split(",")),window.Backbone.history.navigate("/new/photo",{replace:!0}))}});e.exports=_},{"../../models/photo":47,"../../templates/post_type_form/photo.tpl":89,"../../utils/validation":114,"../media/photo":130,"../photo_media_dropzone":135,"../reblog_tree":154,"../richtext_editor":155,"./base":144,"app/components/dialog":12,lodash:"K2RcUv","prima/lib/data":263,"prima/lib/logger":268,"prima/lib/translate":288,"prima/utils/url":317}],149:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("../../utils/string_helpers"),n=t("./base"),r=t("../plaintext_editor"),a=t("../richtext_editor"),l=t("../../templates/post_type_form/quote.tpl"),h=n.extend({defaults:i.defaults({fontSizes:["extra_large","large","medium","small"]},n.prototype.defaults),template:l,afterInitialize:function(){this.listenTo(this.model,"change:quote",this.updateQuoteSize)},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"quote-field",name:"quote",placeholder:"&ldquo;"+s("Quote")+"&rdquo;"},t),o=i.extend({className:"source-field",name:"source",placeholder:s("Source")},t);this.quote=this.subViews.quote=new r(e),this.source=this.subViews.source=new a(o)},afterRender:function(){return this.renderSubViews(),this.updateQuoteSize(this.model,this.model.get("quote")||""),this.quote.focus(),this.quote.editor.isEmpty()&&this.quote.editor.setData(""),this.cleanQuote(),this},teardown:function(){return this.$el.empty(),this},updateQuoteSize:function(t,e){if("string"==typeof e){var i=e.length;this._setQuoteSize(20>i?"extra_large":81>i?"large":300>i?"medium":"small")}},_setQuoteSize:function(t){var e=this.quote.$el;e.hasClass(t)||(e.removeClass(this.get("fontSizes").join(" ")),e.addClass(t))},cleanQuote:function(){var t=this.model.get("quote");t&&this.model.set("quote",o.stripHtml(t,!1))}});e.exports=h},{"../../templates/post_type_form/quote.tpl":90,"../../utils/string_helpers":113,"../plaintext_editor":136,"../richtext_editor":155,"./base":144,lodash:"K2RcUv","prima/lib/translate":288}],150:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("./base"),n=t("../plaintext_editor"),r=t("../reblog_tree"),a=t("../richtext_editor"),l=t("../../templates/post_type_form/text.tpl"),h=o.extend({events:{},template:l,createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"title-field",name:"title",placeholder:s("Title")},t),o=i.extend({className:"caption-field",name:"body",placeholder:s("Write something...")},t);this.title=this.subViews.title=new n(e),this.body=this.subViews.body=new a(o),"reblog"===this.model.get("mode")&&(this.reblogTree=this.subViews.reblogTree=new r(t))},teardown:function(){return this.$el.empty(),this}});e.exports=h},{"../../templates/post_type_form/text.tpl":91,"../plaintext_editor":136,"../reblog_tree":154,"../richtext_editor":155,"./base":144,lodash:"K2RcUv","prima/lib/translate":288}],151:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("moment"),n=t("./base"),r=t("app/components/dialog"),a=(t("prima/lib/logger"),t("prima/lib/flags")),l=t("prima/lib/translate"),h=t("../../services/embed_data"),d=t("../../utils/camelize_keys"),c=function(){return s.browser.chrome?".mp4,.mov,.wmv,video/*":s.browser.mozilla?"video/*":""}(),u=t("../media/video"),p=t("../media_dropzone"),m=t("../confirm_tos"),g=t("../richtext_editor"),f=t("../reblog_tree"),_=t("../../templates/post_type_form/video.tpl"),v=n.extend({template:_,defaults:i.defaults({hasMediaView:!0,hasMedia:!1,showTos:!1,showCaption:!1},n.prototype.defaults),afterInitialize:function(){this._urlParser=i.debounce(i.bind(this._embedCodeParser,this),100),this.post.getEmbedData()&&this.set({hasMedia:!0,showCaption:!0})},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({embed:this.post.getEmbedData(),canEditMedia:this.post.canEditMedia()},t),s=i.extend({url:this.post.get("embedCode"),showInput:!i.isEmpty(this.post.get("embedCode")),embed:this.post.getEmbedData(),uploadIcon:"dropzone-add-video-icon",uploadText:l("Upload a video"),uploadTooltip:function(){var e=1e3*t.user.get("videoSecondsRemaining");return"<p>"+["<strong>"+l("Upload a video")+"</strong>",l("%1$s minutes of video remaining today.",o.utc(e).format("m:ss")),l("%1$s max per file.","100MB")].join("</p><p>")+"</p>"},urlIcon:"dropzone-add-url-icon",urlText:l("Add video from web"),urlParser:this._urlParser,uploadOptions:{}},t);i.extend(s.uploadOptions,{name:"video",maxUploadSize:a.bool("ignore_video_upload_limits")?!1:104857600,uploadPattern:/^video\/(?:.*)$/i,accept:c,url:"/svc/post/upload_video"});var n=i.extend({},t),r=i.extend({className:"caption-field",name:"caption",placeholder:l("Add a caption...")},t);this.mediaPreview=this.subViews.mediaPreview=new u(e),this.mediaComposer=this.subViews.mediaComposer=new p(s),this.confirmTos=this.subViews.confirmTos=new m(n),this.caption=this.subViews.caption=new g(r),"reblog"===this.post.get("mode")&&(this.reblogTree=this.subViews.reblogTree=new f(t))},addStateListeners:function(){this.listenTo(this.mediaComposer,"upload:start",this._onFileUploadStart),this.listenTo(this.mediaComposer,"upload:complete",this._onFileUploadComplete),this.listenTo(this.mediaComposer,"upload:error",this._onFileUploadError),this.listenTo(this.mediaPreview,"media:ready",function(){var t=i.toArray(arguments);t.unshift("media:ready"),this.trigger.apply(this,t)}),this.post.canEditMedia()&&this.listenTo(this.mediaPreview,"media:remove",this.removeMedia),this.listenTo(this,"change:hasMedia",this._onChangeHasMedia),this.listenTo(this,"change:showTos",this._onChangeShowTos),this.listenTo(this,"change:showCaption",this._onChangeShowCaption)},removeMedia:function(){this.post.softReset(),this.set({hasMedia:!1,showTos:!1}),this.mediaPreview.set({file:!1,embed:!1}),this.js$("confirmTos").attr("checked",!!this.post.get("confirmTos")),i.isEmpty(this.post.get("caption"))&&i.isEmpty(this.post.get("tags"))&&this.set("showCaption",!1)},_onChangeHasMedia:function(t,e){this.isRendered()&&(e?(this.mediaComposer.$el.css({display:"none",opacity:0}),this.mediaPreview.$el.css({display:"block",opacity:1})):(this.mediaPreview.$el.css({display:"none",opacity:0}),this.mediaComposer.$el.css({display:"block",opacity:1})))},_onChangeShowTos:function(t,e){this.isRendered()&&this.js$("tos").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeShowCaption:function(t,e){this.isRendered()&&this.js$("caption").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onFileUploadStart:function(t){this.uploads.add(t);var e=t.get("file");this.mediaPreview.set({file:e,canEditMedia:!0}),this.listenToOnce(this.mediaPreview,"media:ready",function(){this.set({hasMedia:!0,showTos:!0,showCaption:!0}),this.caption.focus()})},_onFileUploadComplete:function(t){var e=t.get("file"),i="portrait"===t.get("orientation");
this.mediaPreview.set({file:e,canEditMedia:!0,width:t.get(i?"height":"width"),height:t.get(i?"width":"height")}),this.post.set({preuploadUrl:t.get("key"),preuploadKey:t.get("ch")})},_onFileUploadError:function(t){r.alert("<p>"+i.pluck(t.messages,"message").join("</p><p>")+"</p>")},_embedCodeParser:function(t){if(this._embedCodeParsing&&this._embedCodeParsing.abortEmbedCodeParse(),!i.isEmpty(i.trim(t))){var e=!1,s=this._parseEmbedCode=h.parseEmbedData(t).then(i.bind(function(s){e||(this._embedCodeParsing=!1),this.listenToOnce(this.mediaPreview,"media:ready",function(){this.set({hasMedia:!0,showCaption:!0}),this.caption.focus()}),this.mediaPreview.set(i.extend({embed:d(s),canEditMedia:!0},i.pick(s,["width","height"]))),this.post.set({embedCode:t})},this),function(t){});return s.abortEmbedCodeParse=function(){e=!0},s}},afterRender:function(){this.renderSubViews(),this.get("hasMedia")?this.mediaComposer.$el.css({display:"none",opacity:0}):this.mediaPreview.$el.css({display:"none",opacity:0}),this.get("showTos")||this.js$("tos").css({display:"none",opacity:0}),this.get("showCaption")||this.js$("caption").css({display:"none",opacity:0})}});e.exports=v},{"../../services/embed_data":55,"../../templates/post_type_form/video.tpl":92,"../../utils/camelize_keys":109,"../confirm_tos":120,"../media/video":131,"../media_dropzone":132,"../reblog_tree":154,"../richtext_editor":155,"./base":144,"app/components/dialog":12,jquery:"HlZQrA",lodash:"K2RcUv",moment:333,"prima/lib/flags":"f/LVtH","prima/lib/logger":268,"prima/lib/translate":288}],152:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=t("../templates/reblog_as_button.tpl"),l=t("./reblog_as_dropdown"),h=s.extend({className:"post-form--reblog-as-button",events:{"click [data-js-clickableReblogSelect]":"toggleReblogAsDropdown"},mixins:[o,n,r],template:a,initialize:function(t){t=i.extend(t||{},{shift:{x:-5,y:10},identifier:"reblogAsDropdown"}),this.post=t.post,this.reblogAsDropdown=new l(t);var e="reblogAs:type";this.listenToOnce(this.reblogAsDropdown,e,function(){this.trigger.apply(this,i.union([e],arguments))})},render:function(){return"reblog"===this.post.get("mode")&&(this.$el.html(this.template({post:this.post})),this.reblogAsDropdown.setPinnedTarget(this.js$("clickableReblogSelect")),this.attachSubViews()),this},toggleReblogAsDropdown:function(t){var e=i.isBoolean(t)?t:!this.reblogAsDropdown.isOrWasRecentlyRendered();e&&this.reblogAsDropdown.render()}});e.exports=h},{"../templates/reblog_as_button.tpl":93,"./reblog_as_dropdown":153,lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],153:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),r=t("prima/lib/translate"),a=t("prima/mixins/accessor"),l=t("prima/mixins/popoverbase"),h=t("../templates/reblog_as_dropdown.tpl"),d=o.extend({className:"popover--reblog-as-dropdown",events:{"click .item-option":"setReblogType"},mixins:[a,l],template:h,initialize:function(t){this.post=t.post},reblogAsTypes:function(){return s.transform(this.post.get("can_reblog_as"),function(t,e){t[e]=r(s.capitalize(e))},{})},render:function(){return this.delegateEvents(),this.$el.html(this.template(this.serialize())),n.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return this.$el.remove(),n.trigger("postForms:dismissListener:resume"),this},serialize:function(){return{postType:this.post.get("type"),postReblogAsTypes:this.reblogAsTypes()}},setReblogType:function(t){var e=i(t.currentTarget).data("reblogAsType");e!==this.post.get("type")&&this.trigger("reblogAs:type",e),this.teardown()}});e.exports=d},{"../templates/reblog_as_dropdown.tpl":94,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/lib/translate":288,"prima/mixins/accessor":289,"prima/mixins/popoverbase":293,"prima/view":318}],154:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/translate"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=t("prima/mixins/accessor"),l=t("../templates/reblog_tree.tpl"),h=t("app/components/remove-button"),d=s.extend({className:"post-reblog-tree",events:{"click .btn-toggle-reblog":"toggleRemoveReblogTree"},mixins:[n,r,a],template:l,render:function(){return this.removeButton=this.subViews.removeButton=new h({tooltip:o("Remove reblogs"),buttonClass:"btn-remove-tree btn-toggle-reblog"}),this.$el.html(this.template(this.serialize())),this.attachSubViews(),this},teardown:function(){return this.$el.empty(),this},serialize:function(){return{showReblogTree:!i.isUndefined(this.model.get("reblog_tree"))&&this.model.get("reblog_tree"),post:this.model}},toggleRemoveReblogTree:function(t){var e=this.$(t.currentTarget),i=e.closest(".control-reblog-tree"),s=this.model.has("remove_reblog_tree")&&this.model.get("remove_reblog_tree")===!0;this.model.set("remove_reblog_tree",!s),i.toggleClass("removed",!s)}});e.exports=d},{"../templates/reblog_tree.tpl":95,"app/components/remove-button":182,lodash:"K2RcUv","prima/lib/translate":288,"prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],155:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("app/components/dialog"),r=(t("prima/lib/logger"),t("prima/lib/translate")),a=t("ligature").RichTextEditor,l=t("../services/mention_support"),h=t("../services/inline_embed_support"),d=t("./mention_dropdown"),c=t("./html_field"),u=t("app/components/upload"),p=t("prima/mixins/subviewable"),m=t("prima/mixins/selectorcache"),g=t("prima/mixins/accessor"),f=t("../templates/richtext_editor.tpl"),_=t("prima/lib/data"),v=t("../utils/validation"),b=t("prima/utils/image/loader"),y=t("prima/utils/image/filereader"),w=t("prima/utils/image/canvas"),x=t("prima/events"),k=1080,C=o.extend({defaults:{placeholder:"",name:"",syncWithModel:!0,supportImages:!0,supportInlineEmbeds:!0,supportMentions:!0,inlineMediaWidthFull:540,inlineMediaWidthReblog:250},events:{},mixins:[g,p,m],template:f,initialize:function(t){t||(t=i.extend({},t)),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.hosts=_.get("Context/hosts"),this.uploads=t.uploads,this.editor=null,i.forEach(["onChange","onClientEvent","onImageAdded","pasteHook"],function(e){var s=t[e]||this[e];this[e]=i.isFunction(s)?i.bind(s,this):i.noop},this);var e=this.get("name");e&&this.get("syncWithModel")&&(this.$el.attr("data-name",e),this.listenTo(this.model,"change:editorType",this._onChangeEditorType),"rich"===this.model.get("editorType")&&this.listenToOnce(this.model,"change:"+e,this.updateEditorFromModel))},_onChangeEditorType:function(t,e){var i=t.previous("editorType");"rich"===i&&this.updateModelFromEditor(),this.updateEditorType(e,!0)},_initializeEditor:function(t,e){var s={placeholder:e,flattenBlocks:!0,onChange:this._composeOnChange(),onClientEvent:this.onClientEvent,onImageAdded:this.onImageAdded,inlineControlsOptions:{onTrayOpen:i.bind(this.onInlineControlsTrayOpen,this),onTrayClose:i.bind(this.onInlineControlsTrayClose,this)},pasteHook:this.pasteHook,runIFrameSanitization:!1,filterRules:{elements:["a","b","i","ul","ol","li","p","h2","blockquote","img","iframe","figure","br"],attributes:{a:["href","title","class"],img:["src","alt"],iframe:["src","width","height"],blockquote:["class"],figure:["class","data-provider","data-url","data-orig-width","data-orig-height","data-embed-code"]},remove_contents:["style","noscript","script","meta"],protocols:{a:{href:["http","https","mailto"]}}},mediaKillerMarkup:'<div class="btn-killer icon_close"></div>',mediaMoverMarkup:'<div class="btn-mover icon_drag"></div>'};this.editor=new a(t,s),this.inlineControlNode=!1,this.get("supportImages")&&this._initializeImageSupport(),this.inlineEmbedSupport=!1,this.get("supportInlineEmbeds")&&this._initializeInlineEmbedSupport(),this.mentionSupport=!1,this.get("supportMentions")&&this._initializeMentionSupport(),this.updateEditorType()},_composeOnChange:function(){var t=[this.onChange],e=this;return this.get("syncWithModel")&&t.unshift(this.updateModelFromEditor),function(){x.trigger("postForms:resized"),i.each(t,function(t){t.call(e)})}},pasteHook:function(t,e){var i=t.getData("text/plain"),s=i.trim();return v.isImageUrl(s)&&!e?(this.insertImageFromUrl(s,i),!0):void 0},_initializeImageSupport:function(){this.imageUploader=new u({name:"image",maxUploadSize:10485760,uploadPattern:/^image\/(?:.*)$/i,accept:"image/*",url:"/svc/post/upload_text_image"});var t=s('<div class="control add-image"></div>');t.on("mousedown",i.bind(function(t){1===t.which&&this.editor.staticControls.hide()},this)),t.append('<input type="file" accept="image/*">'),t.on('change input[type="file"]',i.bind(function(e){var o=s(e.target),n=i.toArray(o.prop("files"));i.forEach(n,function(t){this.insertImageFromFile(t)},this),o.remove(),t.append('<input type="file" accept="image/*">'),this.editor.inlineControls.close()},this)),this.editor.inlineControls.addToTray(t),this.listenTo(this.imageUploader,"error",this._onFileUploadError)},_onFileUploadError:function(t,e){var i=e.get("error")||r("Error uploading photo");n.alert("<p>"+i+"</p>")},insertImageFromUrl:function(t,e){e||(e=t),b.load(t).then(i.bind(function(t){var e=s("<img/>"),i=e.get(0);e.attr("src",t.src),this.updateModelFromEditor(),this.editor.insertMedia(i)},this),i.bind(function(){this.editor.insertData(e)},this))},insertImageFromFile:function(t){if(!y.canReadFiles()){var e=s("<img/>"),o=e.get(0);return this.editor.insertMedia(o),void this.onImageAdded(o,t)}y.read(t).then(i.bind(function(t){var e=s("<img/>");e.attr("src",t.objectUrl||t.base64);var i=e.get(0);this.editor.insertMedia(i),this.onImageAdded(i,t.file)},this),function(){})},onImageAdded:function(t,e){if(e.type.match(/image\/(jpg|jpeg|png)/i)){var o=s(t),n=o.css("display")||"";o.css("display","none"),y.read(e).then(i.bind(function(t){t.rotation||o.css("display",n),b.load(t.objectUrl||t.base64).then(i.bind(function(e){var i=w.drawScaledAndRotated(o,e.width,e.height,t.rotation,t.mirrored,k);o.attr("src",i.toDataURL(t.file.type)),o.css("display",n)},this))},this))}var r=function(i){i.get("file")===e&&(this.imageUploadReplace(t,i),this.stopListening(this.imageUploader,"add",r))};this.listenTo(this.imageUploader,"add",r),this.imageUploader.addFiles([e])},imageUploadReplace:function(t,e){var o=s(t);this.listenTo(e,"change:complete change:error",function(t){var e=t.get("url");return i.has(t.changed,"error"),e?(b.load(e).then(i.bind(function(t){x.trigger("postForms:resized"),o.attr("src",t.src),this.updateModelFromEditor()},this)),void this.stopListening(t,"change:complete change:error")):void o.remove()})},onInlineControlsTrayOpen:function(t){this.inlineEmbedSupport&&(this.inlineControlNode=this.editor.getCurrentElement(),this.inlineEmbedSupport.trayClosed(t))},onInlineControlsTrayClose:function(t){this.inlineControlNode=!1,this.inlineEmbedSupport&&this.inlineEmbedSupport.trayOpened(t)},_initializeMentionSupport:function(){var t=["tumblelog"];i.isArray(this.editor.config.linkConfig.bypassClasses||!1)&&(t=i.union(this.editor.config.linkConfig.bypassClasses,t)),this.editor.linkControl.bypassClasses=t,this.mentionPopover=new d({shift:{x:10,y:20},teardownOnEscape:!1,identifier:"postForms:mentionDropdown"}),this.mentionSupport=new l(this.editor,this.mentionPopover),this.getEditorValue=i.compose(this.mentionSupport.stripGhost,this.getEditorValue)},_initializeInlineEmbedSupport:function(){this.inlineEmbedSupport=new h(this,this.editor),this.editor.config.filterForSetData=i.bind(function(t){return this.inlineEmbedSupport.addEmbedPlaceholders(t)},this),this.editor.config.filterForGetData=i.bind(function(t){return this.inlineEmbedSupport.removeEmbedPlaceholders(t)},this)},beforeRender:function(){this.htmlField=this.subViews.htmlField=new c({model:this.model,name:this.get("name")})},render:function(){var t=this._modelValue().length>0;t&&this.set("placeholder",!1),this.$el.html(this.template());var e=this.js$("richTextEditor").get(0);return this._initializeEditor(e,this.get("placeholder")),t&&"rich"===this.get("editorType")&&this.updateEditorFromModel(),this.attachSubViews(),this},teardown:function(){return this.$el.empty(),this.imageUploader&&(this.stopListening(this.imageUploader),this.imageUploader.teardown(),delete this.imageUploader),delete this.mentionSupport,delete this.inlineEmbedSupport,this},serialize:function(){var t=i.extend({__:r},this.attributes);return t},getEditorValue:function(){return this.editor?this.editor.getData(!0):null},setEditorValue:function(t,e,i){this.editor&&this.editor.setData(t,e,i)},updateModelFromEditor:function(){if(!this.editor)return!1;var t=this.get("name"),e=this.getEditorValue();this.model.get(t)!==e&&this.model.set(t,e)},updateEditorFromModel:function(t,e){var i=this.getEditorValue();e="undefined"!=typeof t?e:this._modelValue(),e||(e=""),e!==i&&e.trim()&&this.setEditorValue(e,!0)},updateEditorType:function(t,e){t||(t=this.model.get("editorType"));var i=s(this.editor.wrapper);if("rich"===t){this.htmlField.hide();var o=this.model.get("hasSeenHtml");this.setEditorValue(this._modelValue(),!0,o),i.show(),this.focus()}else i.hide(),this.htmlField.updateValueFromModel(),e&&this.htmlField.set("editedSincePreview",!0),this.htmlField.show(),this.htmlField.showSource(!0),this.model.set("hasSeenHtml",!0);x.trigger("postForms:resized")},_modelValue:function(){return this.model.get(this.get("name"))||""},focus:function(){this.editor.element.focus()}});e.exports=C},{"../services/inline_embed_support":56,"../services/mention_support":57,"../templates/richtext_editor.tpl":96,"../utils/validation":114,"./html_field":123,"./mention_dropdown":133,"app/components/dialog":12,"app/components/upload":192,jquery:"HlZQrA",ligature:325,lodash:"K2RcUv","prima/events":261,"prima/lib/data":263,"prima/lib/logger":268,"prima/lib/translate":288,"prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/utils/image/canvas":310,"prima/utils/image/filereader":311,"prima/utils/image/loader":312,"prima/view":318}],156:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/translate"),n=t("prima/events"),r=t("prima/mixins/accessor"),a=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("../templates/save_post_button.tpl"),d=t("./save_post_dropdown"),c=t("components/knight-rider-loader"),u=s.extend({className:"post-form--save-button",events:{"click [data-js-clickableSaveDropdown]":"toggleSavePostDropdown"},mixins:[r,a,l],template:h,initialize:function(t){t=i.extend(t||{},{shift:{x:0,y:10},identifier:"postForms:savePostDropdown"}),this.savePostDropdown=new d(t),this.set("initialPostPseudoState",this.model.get("pseudoState")),this.listenTo(n,"postForms:savePostDropdown:close",function(){this.toggleSavePostDropdown(!1)})},render:function(){return this.$el.html(this.template()),this.loader=this.subViews.loader=new c,this.adjustLabel(),this.savePostDropdown.setPinnedTarget(this.js$("clickableSaveDropdown")),this.attachSubViews(),this.loader.render(),this},afterRender:function(){this.listenTo(this.model,"change validate",this.adjustLabel),this.listenTo(n,"postForms:saving",this.showLoader),this.listenTo(n,"postForms:error",this.hideLoader)},showLoader:function(){this.toggleLoader(!0)},hideLoader:function(){this.toggleLoader(!1)},toggleLoader:function(t){var e=!!t;this.$el.css({width:e?this.$el.width():"",height:e?this.$el.height():""}),this.loader.set("loading",e),this.js$("clickableSaveDropdown").toggle(!e),this.js$("clickableSave").toggle(!e)},toggleSavePostDropdown:function(t){var e=i.isBoolean(t)?t:!this.savePostDropdown.isOrWasRecentlyRendered();e&&this.savePostDropdown.render(),this.updateButtonState()},updateButtonState:function(){var t=this.model.isValid()&&!this.savePostDropdown.isRendered(),e=this.js$("clickableSave");e.toggleClass("disabled",!t),e.prop("disabled",!t)},adjustLabel:function(){var t=this.js$("clickableSave"),e=function(t,e){return o("reblog"===t?"Reblog":"edit"===t&&"published"===e?"Save":"Post")},i=function(t,e){return o("edit"===t&&"private"===e?"Save":"Post privately")},s=this.model.get("pseudoState"),n=this.get("initialPostPseudoState"),r=this.model.get("mode"),a="published"===s?e(r,n):"queued"===s?o("Queue"):"scheduled"===s?o("Schedule"):"draft"===s?o("Save draft"):"private"===s?i(r,n):o("Post");this.updateButtonState(),t.text(a)}});e.exports=u},{"../templates/save_post_button.tpl":97,"./save_post_dropdown":157,"components/knight-rider-loader":235,lodash:"K2RcUv","prima/events":261,"prima/lib/translate":288,"prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],157:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/lib/translate"),r=t("prima/events"),a=t("prima/mixins/accessor"),l=t("prima/mixins/subviewable"),h=t("prima/mixins/selectorcache"),d=t("prima/mixins/popoverbase"),c=t("./post_preview"),u=t("../templates/save_post_dropdown.tpl"),p=o.extend({className:"popover--save-post-dropdown",events:{"click [data-js-preview]":"triggerPostPreview","click [data-js-publish]":"setOptionPublish","click [data-js-draft]":"setOptionDraft","click [data-js-private]":"setOptionPrivate","click [data-js-queue]":"setOptionQueue","click [data-js-schedule]":"setOptionSchedule","input [data-js-scheduleText]":"scheduleInputUpdated","keypress [data-js-scheduleText]":"checkScheduleComplete"},mixins:[a,l,h,d],postStateOptions:["published","queued","scheduled","draft","private"],template:u,initialize:function(t){this.user=t.user},render:function(){return this.delegateEvents(),this._updateViewAttributes(),this.$el.html(this.template(this.serialize())),this._updateViewElements(),r.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return this.$el.remove(),r.trigger("postForms:dismissListener:resume"),this},serialize:function(){var t=s.extend({__:n},this.attributes);return t},_updateViewAttributes:function(){this.set({showPreview:!0,state:this.model.get("pseudoState"),activeOptions:"edit"===this.model.get("mode")&&this.model.get("createdPost")?["published","private"]:this.postStateOptions})},_updateViewElements:function(){"scheduled"===this.model.get("state")?this.js$("scheduleText").val(this.model.get("publish_on")):i("[data-js-scheduleText]",this.$el).hide(),this.js$("preview").toggleClass("disabled",!this.model.isValid())},triggerPostPreview:function(){this.model.isValid()&&(this._previewPost(),this.teardown())},setOptionPublish:function(){this._unSchedule(),this.model.set({state:"published",is_private:!1}),this.teardown()},setOptionDraft:function(){this._unSchedule(),this.model.set("state","draft"),this.teardown()},setOptionPrivate:function(){this._unSchedule(),this.model.set({state:"private",is_private:!0}),this.teardown()},setOptionQueue:function(){this._unSchedule(),this.model.set("state","queued"),this.teardown()},setOptionSchedule:function(){if(!this.scheduling){this.scheduling=!0,this._selectOption(this.js$("schedule")),this.model.set("state","scheduled");var t=this.js$("scheduleText");if(!t.value){var e=t.attr("placeholder");t.val(e),this.model.set("publish_on",e)}this.js$("scheduleText").show()}},scheduleInputUpdated:function(t){this.model.set("publish_on",t.target.value)},checkScheduleComplete:function(t){13===t.which&&this.teardown()},_selectOption:function(t){this.js$("options").children().removeClass("icon_checkmark"),t.addClass("icon_checkmark")},_unSchedule:function(){this.scheduling=!1,this.model.set("publish_on","")},_previewPost:function(){var t=this.model.get("tumblelog"),e=new c({action:this.user.getChannel(t).get("blog_url")+"post/preview",inputs:this.model.toJSON({url:"/svc/post/update",forServer:!0})}),i=e.render().$el.find("form");i.css({"pointer-events":"none",overflow:"hidden",position:"absolute",bottom:0,right:0,width:1,height:1,opacity:0}).appendTo("body").submit().remove()}});e.exports=p},{"../templates/save_post_dropdown.tpl":98,"./post_preview":138,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/lib/translate":288,"prima/mixins/accessor":289,"prima/mixins/popoverbase":293,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],158:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/subviewable"),n=t("prima/mixins/selectorcache"),r=t("prima/mixins/accessor"),a=t("../templates/social_buttons.tpl"),l=t("./tweet_dropdown"),h=s.extend({className:"post-forms--social-buttons",events:{"click [data-js-shareButtonLabel]":"toggleShareButtons","mouseenter [data-js-twitterLabel]":"mouseEnterEvent"},mixins:[o,n,r],services:["facebook","twitter"],template:a,initialize:function(t){t=i.extend(t||{},{shift:{x:90,y:10},identifier:"postForms:tweetDropdown"}),this.user=t.user,this.tweetDropdown=new l(t),this.listenTo(this.model,"change:state",this.updateSharingOnStateChange),this.listenTo(this.model,"change:tumblelog",this._initializeSharing),this._initializeSharing()},_initializeSharing:function(){this.states={};var t=this.model.get("mode"),e=this.model.get("tumblelog"),i=this.user.getChannel(e),s="edit"===t?this.model.get("send_to_fbog"):i.get("facebook_opengraph_send_posts"),o="edit"===t?this.model.get("send_to_twitter"):i.get("twitter_send_posts");this.setSharing({facebook:i.get("can_send_to_facebook"),twitter:i.get("can_send_to_twitter"),facebookOn:!!s,twitterOn:!!o})},render:function(){return this.$el.html(this.template(this.get("lastSettings"))),this._updateModelWithShareSettings(),this.js$("twitterCheckbox").attr("checked",!!this.model.get("send_to_twitter")),this.js$("facebookCheckbox").attr("checked",!!this.model.get("send_to_fbog")),this.tweetDropdown.setPinnedTarget(this.js$("tweetDropdownPin")),this.shouldShowSocialIcons()||this.clearAllShareSettings(),this},mouseEnterEvent:function(t){t.preventDefault(),(t.currentTarget!==this.js$("twitterLabel").get(0)||this.$(t.currentTarget).parent().hasClass("checked"))&&this.toggleTweetDropdown(!0)},toggleTweetDropdown:function(t){t?!1===this.tweetDropdown.isRendered()&&this.tweetDropdown.render():this.tweetDropdown.teardown()},shouldShowSocialIcons:function(){var t=this.model;return"new"===t.get("mode")||"reblog"===t.get("mode")||"published"!==t.get("state")&&"private"!==t.get("state")},clearAllShareSettings:function(){i.each(this.services,i.bind(function(t){this.clearShareSetting(t,!0)},this))},clearShareSetting:function(t,e){this.js$(t+"checkbox").prop("checked",!1),e?this.js$(t+"label").parent().removeClass("checked").addClass("hidden"):this.js$(t+"label").parent().removeClass("checked hidden")},setShareSetting:function(t,e){e?"off"!==this.states[t]&&(this.js$(t+"label").parent().removeClass("hidden").addClass("checked"),this.js$(t+"checkbox").prop("checked",!0)):(this.js$(t+"label").parent().removeClass("checked hidden"),this.js$(t+"checkbox").prop("checked",!1))},setSharing:function(t){i.each(this.services,i.bind(function(e){t[e]?t[e+"On"]||"on"===this.states[e]?this.setShareSetting(e,!0):this.clearShareSetting(e):this.clearShareSetting(e,!0)},this)),this.set("lastSettings",t)},updateSharingOnStateChange:function(t){"private"===t.get("pseudoState")&&t.changed.is_private?this.clearAllShareSettings():this.setSharing(this.get("lastSettings"))},toggleShareButtons:function(t){t.preventDefault();var e=this.$(t.currentTarget),i=e.parent("li"),s=i.data("service");i.toggleClass("checked"),i.hasClass("checked")?(i.hasClass("twitter")&&this.toggleTweetDropdown(!0),this.states[s]="on"):(this.toggleTweetDropdown(!1),this.states[s]="off"),this._updateModelWithShareSettings()},_updateModelWithShareSettings:function(){this.model.set("send_to_fbog",this.js$("facebook").hasClass("checked")),this.model.set("send_to_twitter",this.js$("twitter").hasClass("checked"))}});e.exports=h},{"../templates/social_buttons.tpl":99,"./tweet_dropdown":165,lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],159:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/lib/translate"),r=t("prima/mixins/accessor"),a=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("./plaintext_editor"),d=t("./tag_suggest"),c=t("../templates/tag_editor.tpl"),u=t("./tag_label"),p=o.extend({className:"post-form--tag-editor",defaults:{maxTagLength:140,suggestMinLength:2,showSuggestPopover:!1,editorHistory:[]},mixins:[r,a,l],template:c,initialize:function(t){this.options=t=i.pick(t,"post","user","model"),i.extend(this,i.pick(t,"post","user"))},createSubViews:function(){var t=i.extend({placeholder:n("#tags"),name:"tagInput",forceSingleLine:!0,onClientEvent:i.bind(this.handleInputKeys,this)},this.options),e={post:this.post,user:this.user,shift:{x:0,y:15},identifier:"postForms:tagSuggest"};this.tagInput=this.subViews.tagInputField=new h(t),this.tagSuggest=new d(e)},beforeRender:function(){this.createSubViews(),this.addTagEditorListeners()},render:function(){return this.$el.html(this.template()),this.attachSubViews(),this},afterRender:function(){this.$tagInputGhost=this.js$("tagInputGhost"),this.$tagInputFieldWrapper=this.js$("tagInputFieldWrapper"),this.tagSuggest.setPinnedTarget(this.$tagInputGhost),this.renderSubViews(),s(this.tagInput.editor.element).on("blur",i.bind(this.submitTag,this)),"edit"===this.model.get("mode")&&i.each(this._postTags(),function(t){this.addTagLabel(t)},this)},addTagEditorListeners:function(){this.listenTo(this.model,"change:tagInput",this.handleTagInput),this.listenTo(this.model,"change:tags",this.adjustTagLabels),this.listenTo(this.tagInput,"tagInput:submitTag",this.submitTag),this.listenTo(this.tagSuggest,"tagSuggest:submitTag",this.submitTag),this.listenTo(this.tagInput,"tagInput:backspace",this.handleBackspace),this.tagSuggest.listenTo(this,"tagEditor:fetchSuggestions",this.tagSuggest.fetchSuggestions),this.tagSuggest.listenTo(this.tagInput,"tagInput:cycleUp",this.tagSuggest.cycleUp),this.tagSuggest.listenTo(this.tagInput,"tagInput:cycleDown",this.tagSuggest.cycleDown),this.tagSuggest.listenTo(this.tagInput,"tagInput:dismissSuggestions",this.tagSuggest.dismiss)},handleInputKeys:function(t){var e,i=["keyup","keydown","keypress"],s={keydown:{38:"tagInput:cycleUp",40:"tagInput:cycleDown",8:"tagInput:backspace",9:"tagInput:submitTag",13:"tagInput:submitTag"},keypress:{44:"tagInput:submitTag"}};if(-1!==i.indexOf(t.type))if(t=t||window.event,e=t.which||t.keyCode,"keydown"===t.type||"keypress"===t.type)e in s[t.type]?(this.tagInput.trigger(s[t.type][e],t),8!==e&&(t.preventDefault(),t.stopImmediatePropagation())):this.tagInput.getEditorValue().length>=this.get("maxTagLength")&&(t.preventDefault(),t.stopImmediatePropagation());else if(e in s.keypress||e in s.keydown&&8!==e)return!1},handleTagInput:function(t,e){var i=e&&e.length>=this.get("suggestMinLength");i?this.trigger("tagEditor:fetchSuggestions",e,this._postTags()):this.tagInput.trigger("tagInput:dismissSuggestions"),this.$tagInputGhost.text(e)},handleBackspace:function(){0===this.tagInput.getEditorValue().length&&this._postTags().length&&this.removeLastTag()},submitTag:function(t){if(t&&"blur"===t.type){if(this.tagInput.editor.setPlaceholder(this.placeholder),this.tagSuggest.get("interactive"))return}else this.tagInput.editor.setPlaceholder(!1);var e=this.tagSuggest.get("interactive")?this.tagSuggest.getCycledTag():this.tagInput.getEditorValue();if(""===e)return void this.trigger("postForms:focusOnNextEditor",t);var s=this._postTags();e=e.toString().replace(/[,#]/g,""),e.match(/<.*>/)&&(e=e.replace(/[<>]/g,function(t){return i.escape(t)}));var o=e.match(/"/g),n=o?o.length:0;if(n%2===1){var r=e.lastIndexOf('"');e=e.replace(/"/g,function(t,e){return e===r?'"':""})}else n>0&&(e=e.replace(/"/g,""));if(e=e.trim().substr(0,this.get("maxTagLength")),this.clearInput(),e.length&&-1===s.indexOf(e)){s.push(e),this.model.set("tags",s);var a=t?t.which||t.keyCode:!1;if(a===!1||"focusout"!==t.type&&(9!==a||!t.shiftKey))return this.tagInput.focus(),!1}},removeTag:function(t){var e=t.attributes.label,s=this._postTags();s.length<=1&&this.tagInput.editor.setPlaceholder(this.placeholder),this.model.set("tags",i.without(s,e))},removeLastTag:function(){i.findLast(this._tagLabels(),function(t){return!i.isEmpty(t._events)}).triggerDelete()},adjustTagLabels:function(t,e){var s=t.previousAttributes().tags.length<e.length,o=s?e[e.length-1]:i.first(i.difference(t.previousAttributes().tags,e));if(i.isEmpty(this._tagLabels()))i.each(e,function(t){this.addTagLabel(t)},this);else if(s)this.addTagLabel(o);else{var n=i.findLast(this._tagLabels(),function(t){return t.attributes.label===o});n.remove()}},addTagLabel:function(t){var e=new u({attributes:{label:t}});this.$tagInputFieldWrapper.before(e.render().el),this.listenToOnce(e,"tagLabel:delete",this.removeTag)},clearInput:function(){this.tagInput.trigger("tagInput:dismissSuggestions"),this.tagInput.setEditorValue("")},_postTags:function(){return i.clone(this.model.get("tags"))},_tagLabels:function(){return i.filter(this._listeningTo,function(t){return t.constructor.prototype===u.prototype})}});e.exports=p},{"../templates/tag_editor.tpl":100,"./plaintext_editor":136,"./tag_label":160,"./tag_suggest":161,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":288,"prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],160:[function(t,e){"use strict";var i=t("prima/view"),s=i.extend({className:"tag-label",events:{click:"triggerDelete"},tagName:"span",render:function(){return this.$el.text(this.attributes.label),this},triggerDelete:function(){this.trigger("tagLabel:delete",this)}});e.exports=s},{"prima/view":318}],161:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),r=t("../models/tag_suggestion"),a=t("prima/mixins/accessor"),l=t("prima/mixins/popoverbase"),h=t("prima/mixins/selectorcache"),d=t("../templates/tag_suggest.tpl"),c=o.extend({className:"popover--tag-suggest",defaults:{currentKeyedChoice:-1,currentMousedChoice:-1,interactive:!1,numSuggestions:0,suggestPending:!1,lastResults:{}},mixins:[a,h,l],template:d,initialize:function(t){this.model=new r(t),this.post=t.post,this.listenTo(this.model,"error",this._fetchSuggestionsError),this.listenTo(this,"change:lastResults",this.preRender)},preRender:function(t,e){var s=i.reduce(e.results,function(t,e){return t+(i.isArray(e)?e.length:0)},0);this.set({currentKeyedChoice:-1,interactive:!1});var o=this.get("suggestPending");s>0&&o!==!1&&-1===this.post.get("tags").indexOf(o)&&this.render()},render:function(){return this.$el.html(this.template(this.get("lastResults"))),n.trigger("postForms:dismissListener:suspend"),this},afterRender:function(){this.$tagSuggestWrapper=this.js$("tagSuggestWrapper"),s(".item-option",this.$el).on("click",i.bind(this.selectCurrentCycledChoice,this)),s(".item-option",this.$el).on("mouseover",i.bind(this.handleMouseOver,this)),this.$el.on("mouseout",i.bind(this.handleMouseOut,this))},teardown:function(){return this.$el.remove(),n.trigger("postForms:dismissListener:resume"),this},cycleUp:function(){this._cycle(-1)},cycleDown:function(){this._cycle(1)},_cycle:function(t){var e=this.get("currentKeyedChoice"),s=this.get("currentMousedChoice"),o=i.isNumber(s)&&-1!==s,n=o?s:e,r=(n+t)%this.get("numSuggestions");this.get("numSuggestions")&&(this.set({currentKeyedChoice:r>=0?r:-1,currentMousedChoice:-1}),this.styleMenuItems(),this.set("interactive",this.get("currentKeyedChoice")>=0))},getCycledTag:function(){return s(".item-option.cycled",this.$el).data("tag")},selectCurrentCycledChoice:function(t){this.set("interactive",!0),s(t.currentTarget).addClass("cycled"),this.trigger("tagSuggest:submitTag")},styleMenuItems:function(t){var e,o=t&&"mouseout"!==t.type,n=this.get("currentKeyedChoice");i.each(s(".item-option",this.$el),function(i,r){o?s(i).toggleClass("cycled",t.currentTarget===i):(s(i).toggleClass("cycled",r===n),r===n&&(e=s(i)))
},this),o||-1===n||this.cycleScroll(e)},cycleScroll:function(t){var e=parseInt(t.position().top,10),i=e+parseInt(t.height(),10),s=parseInt(t.outerHeight(),10),o=parseInt(this.$tagSuggestWrapper.height(),10),n=parseInt(this.$tagSuggestWrapper.scrollTop(),10);i>o?this.$tagSuggestWrapper.scrollTop(n+s):0>e&&this.$tagSuggestWrapper.scrollTop(e+n)},handleMouseOver:function(t){this.styleMenuItems(t),this.set({interactive:!0,currentMousedChoice:s(t.currentTarget).index(".item-option")})},handleMouseOut:function(t){this.styleMenuItems(t),this.set({interactive:-1!==this.get("currentKeyedChoice"),currentMousedChoice:-1})},fetchSuggestions:i.debounce(function(t,e){var s={query:t,success:i.bind(this.renderQueryResults,this),existing:e};this.set("suggestPending",t),this.model.fetch(s)},100),_fetchSuggestionsError:i.noop,renderQueryResults:function(t,e,i){var s=this.finalResultsFilter(t.attributes.tagSuggestions,i.existing);this.set("numSuggestions",s.userTags.length+s.suggestions.length),this._rendered&&this.teardown(),this.set("lastResults",{results:s,queryRegex:new RegExp(this.model._escapeRegex(i.query),"i")})},finalResultsFilter:function(t,e){return i.mapValues(t,function(t){return i.difference(t,e)})},dismiss:function(){this.teardown(),this.set({interactive:!1,suggestPending:!1,lastResults:{}})}});e.exports=c},{"../models/tag_suggestion":51,"../templates/tag_suggest.tpl":101,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/mixins/accessor":289,"prima/mixins/popoverbase":293,"prima/mixins/selectorcache":295,"prima/view":318}],162:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=t("prima/mixins/popoverbase"),l=t("../templates/tooltip.tpl"),h=s.extend({className:"tooltip-popover",mixins:[o,n,r,a],template:l,defaults:{sanitize:!0,text:""},initialize:function(t){t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults)))},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this._popoverBase.pinnedSide="none",this._popoverBase.shift.x=4+this.$pinned.width(),this._popoverBase.shift.y=8,this},teardown:function(){return this.$el.remove(),this}});e.exports=h},{"../templates/tooltip.tpl":102,lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/popoverbase":293,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],163:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=t("../templates/tumblelog_select.tpl"),l=t("./tumblelog_select_dropdown"),h=s.extend({defaults:{modeRequiresDropdown:!0},events:{"click [data-js-clickableTumblelogLabel]":"toggleTumblelogSelectDropdown"},mixins:[o,n,r],template:a,initialize:function(t){this.options=t||{},this.listenTo(this.model,"change:tumblelog",this.adjustLabel),this.set("modeRequiresDropdown","edit"!==this.model.get("mode"))},render:function(){return this.$el.html(this.template({post:this.model})),this.adjustLabel(),this.createDropdown(),this},createDropdown:function(){var t=i.extend(this.options,{shift:{x:0,y:10},identifier:"postForms:tumblelogSelectDropdown"});this.get("modeRequiresDropdown")&&(this.tumblelogSelectDropdown=new l(t),this.tumblelogSelectDropdown.setPinnedTarget(this.js$("tumblelogSelectPin")))},toggleTumblelogSelectDropdown:function(){this.get("modeRequiresDropdown")&&(this.tumblelogSelectDropdown.isOrWasRecentlyRendered()||this.tumblelogSelectDropdown.render())},adjustLabel:function(){this.js$("tumblelogLabel").text(this.model.get("tumblelog"))}});e.exports=h},{"../templates/tumblelog_select.tpl":103,"./tumblelog_select_dropdown":164,lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],164:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/events"),n=t("../utils/avatar_size"),r=t("prima/mixins/accessor"),a=t("prima/mixins/selectorcache"),l=t("prima/mixins/popoverbase"),h=t("app/lib/currentuser"),d=t("../templates/tumblelog_select_dropdown.tpl"),c=s.extend({className:"popover--tumblelog-select-dropdown",events:{"click [data-js-tumblelogChoice]":"selectBlog"},mixins:[r,a,l],template:d,defaultOptions:{size:128},defaults:{tumblelog:!1},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),this.user=t.user||h(),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.get("tumblelog")||this.set("tumblelog",this.user.getChannel().get("name"))},render:function(){return this.delegateEvents(),this.$el.html(this.template(this.serialize())),o.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return this.$el.remove(),o.trigger("postForms:dismissListener:resume"),this},serialize:function(){var t=this.toJSON();return t.channels=this.user.channels.map(function(t){return i.extend({avatarUrl:n(t.get("avatar_url"),this.options.size)},t.toJSON())},this),t},selectBlog:function(t){var e=this.$(t.currentTarget).index();this.model.set("tumblelog",this.user.channels.at(e).get("name")),this.teardown()}});e.exports=c},{"../templates/tumblelog_select_dropdown.tpl":104,"../utils/avatar_size":107,"app/lib/currentuser":209,lodash:"K2RcUv","prima/events":261,"prima/mixins/accessor":289,"prima/mixins/popoverbase":293,"prima/mixins/selectorcache":295,"prima/view":318}],165:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/translate"),n=t("prima/events"),r=t("../utils/string_helpers"),a=t("prima/mixins/accessor"),l=t("prima/mixins/subviewable"),h=t("prima/mixins/selectorcache"),d=t("prima/mixins/popoverbase"),c=t("../templates/tweet_dropdown.tpl"),u=s.extend({className:"popover--tweet-dropdown",defaults:{focused:!1},events:{"keyup [data-js-customTweet]":"updateTweetLengthCount","click [data-js-customTweet]":"updateTweetLengthCount","click [data-js-dismissTweet]":"teardown",keydown:"detectEscape"},mixins:[a,l,h,d],template:c,initialize:function(){this.listenTo(this.model,"change",this._updateCustomTweetFromModel)},render:function(){return this.delegateEvents(),this.$el.html(this.template(i.extend({post:this.model},this.serialize()))),this.$customTweet=this.js$("customTweet"),this.$tweetLength=this.js$("tweetLength"),this.model.get("custom_tweet")&&this.$customTweet.val(this.model.get("custom_tweet")),n.trigger("postForms:dismissListener:suspend"),this},afterRender:function(){i.defer(i.bind(function(){this._setCaret(this.$customTweet)},this))},teardown:function(){return this.remove(),n.trigger("postForms:dismissListener:resume"),this},serialize:function(){var t=i.extend({__:o},this.attributes);return t},_modelHasCustomTweet:function(){var t=this.model.get("custom_tweet");return t&&!t.match(/^\s+\[URL\]$/gi)},_updateCustomTweetFromModel:function(){if(!this._modelHasCustomTweet()&&this.$customTweet){var t=this._extractPostContent(),e="",i=" [URL]",s=110,o="";switch(this.model.get("type")){case"text":case"chat":o=t.one&&t.two?t.one+" - "+t.two:t.one?t.one:t.two;break;case"photo":case"video":case"audio":o=t.two;break;case"note":o=t.one;break;case"link":o=t.one&&t.three?t.one+" - "+t.three:t.one?t.one:t.three?t.three:this.parseUrl(t.two,"host");break;case"quote":var n=r.truncate(t.one,s-5,"");o=""+n+"",n===t.one&&t.two&&o.length<s-5&&(o+=" - "+t.two)}o||(i=i.trim(),o="");var a=e+r.truncate(o,s,"")+i;this.$customTweet.val(a),this._updateModelWithCustomTweet()}},_extractPostContent:function(){return{one:r.stripHtml(this.model.getAttributeFromGeneric("one")),two:r.stripHtml(this.model.getAttributeFromGeneric("two")),three:r.stripHtml(this.model.getAttributeFromGeneric("three"))}},updateTweetLengthCount:function(t){switch(t.keyCode){case 17:case 18:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 91:case 93:return!1}var e=this.$customTweet.scrollTop(),i=this.$customTweet.val(),s=i.match(/\[URL\]$/gi),o=s?24*s.length:0,n=140-i.length-o;1>n&&(s?i.match(/ \[URL\]$/)?(i=i.replace(/ \[URL\]$/,""),i=r.truncate(i,140-o,""),i+=" [URL]"):i=r.truncate(i,140-o,""):i=r.truncate(i,140,""),n=0),this.$customTweet.val(i),this.$tweetLength.text(n),this.$tweetLength.addClass("active"),s&&0===n&&this.$customTweet.setSelectionRange&&this.$customTweet.setSelectionRange(i.indexOf("[URL]")-1,i.indexOf("[URL]")-1),this.$customTweet.scrollTop(e),this._updateModelWithCustomTweet()},_setCaret:function(t){var e=t.get(0),i=0,s=t.val().indexOf("[URL]")-1;if(i>s&&(t.val(" "+t.val()),s=1),e.setSelectionRange)e.focus();else if(e.createRange){var o=e.createRange();o.setStart("character",i),o.setEnd("character",i),o.select()}else t.focus()},_updateModelWithCustomTweet:function(){var t=this.$customTweet.val();this.model.set("custom_tweet",i.isEmpty(t)?void 0:t)},detectEscape:function(t){27===t.keyCode&&(t.stopPropagation(),this.teardown())}});e.exports=u},{"../templates/tweet_dropdown.tpl":105,"../utils/string_helpers":113,lodash:"K2RcUv","prima/events":261,"prima/lib/translate":288,"prima/mixins/accessor":289,"prima/mixins/popoverbase":293,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],166:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate").animate,o=t("prima/view"),n=t("prima/mixins/accessor"),r=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),l=t("../templates/webcam_button.tpl"),h=o.extend({className:"webcam-button-container",template:l,events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave"},mixins:[n,r,a],wink:function(t){!i.isUndefined(t)||(t=!this.js$("smiley").hasClass("icon_postforms_selfie_wink")),this.js$("smiley").toggleClass("icon_postforms_selfie_wink",t),this.js$("smiley").toggleClass("icon_postforms_selfie",!t)},_onMouseEnter:function(){var t=100;s(this.js$("text"),"stop"),s(this.js$("text"),{opacity:1},{duration:t});var e=this.js$("smiley").outerWidth()+this.js$("text").outerWidth();s(this.$el,"stop"),s(this.$el,{marginLeft:-Math.round(.5*e),width:e},{duration:t}).then(i.bind(function(){this._winkTimeout=i.delay(i.bind(function(){this.wink(!0),this._winkTimeout=i.delay(i.bind(function(){this.wink(!1)},this),100)},this),400)},this))},_onMouseLeave:function(){var t=100;clearTimeout(this._winkTimeout),this.wink(!1),s(this.js$("text"),"stop"),s(this.js$("text"),{opacity:0},{duration:t});var e=this.js$("smiley").outerWidth();s(this.$el,"stop"),s(this.$el,{marginLeft:-Math.round(.5*e),width:e},{duration:t}).then(i.bind(function(){}))},render:function(){return this.$el.html(this.template()),this},teardown:function(){return clearTimeout(this._winkTimeout),this}});e.exports=h},{"../templates/webcam_button.tpl":106,lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318,"velocity-animate":"lWl/mc"}],167:[function(t,e){"use strict";var i=(t("prima/utils/exposer"),t("prima/utils/haspath"),t("lodash")),s=t("jquery"),o=t("when"),n=t("prima/utils/sequence-with-context"),r=t("prima/mixins/promisifyevents"),a=t("prima/component"),l=t("prima/events"),h=t("prima/lib/domeventor"),d=(t("prima/lib/logger"),t("backbone")),c=(t("./utils/transition_speed"),t("./utils/scroll_helper")),u=t("./utils/save_hook"),p=t("./utils/post_form_container_type"),m="/dashboard",g=t("prima/lib/translate"),f=s("body"),_=t("app/components/post_form"),v=t("app/components/dialog"),b=t("app/lib/currentuser"),y=t("app/components/post_form/models/post"),w=t("app/components/post_form/services/embed_data"),x=t("./views/glass"),k=t("./views/modal"),C=t("./views/container"),S=t("./views/post_buttons"),T=a.extend({name:"PostFormBuilder",initialize:function(){var t=this.getOwnData();this.baseRoute=t.baseRoute,this.currentChannel=t.currentChannel,this.fullWidthPosts=t.fullWidthPosts||!1,this._addGlobalEventListeners(),this.user=b(),this.user.channels.reset(t.channels),this.user.set(t.limits),this.user.set(t.dashboardSettings),this.user.set("language",t.language||"en_US"),w.setEmbedRegexes(t.embedRegexes),this.glass=new x,this.modal=new k,this.modalContainer=new C({className:"post-form-modal-content",animateHeightWithContent:!0}),this.modal.setContentSubView(this.modalContainer),this.postButtons=new S({el:"#new_post"}),this.postButtonsContainer=new C({el:this.postButtons.$el.parent(),originalContent:this.postButtons,transitionBackground:!0,animateHeightWithContent:!0,useLoader:!1}),this.scrollHelper=new c,this.saveHook=new u(i.extend({$postButtonsContainer:this.postButtonsContainer.$el,$latestPostEl:this.postButtonsContainer.$el.next()},t)),this.legacyEvents(),this._updateData=i.once(this.updateData),this.render()},updateData:function(){var t=s.ajax({url:"/svc/post/get_post_form_builder_data",type:"POST",with_form_key:!0,data:{}});return t.then(i.bind(function(t){var e=t.response;return i.forEach(e.channels,function(t){var e=t.name?this.user.getChannel(t.name):!1;e&&e.set(i.omit(t,"name"))},this),this.user.set(e.limits),e},this))},legacyEvents:function(){var t={"postForms:closed":["post:form:hide","keycommands:resume"],"postForms:saved":["post:form:success"],"postForms:opened":["keycommands:suspend"]};i.forEach(t,function(t,e){this.listenTo(l,e,function(){var e=i.toArray(arguments);i.each(t,function(t){l.trigger.apply(l,[].concat(t,e))})})},this)},_addGlobalEventListeners:function(){this.listenTo(l,"postForms:open",this.createPostForm),this.listenTo(l,"postForms:new",this._createPostFormNew),this.listenTo(l,"postForms:edit",this._createPostFormEdit),this.listenTo(l,"postForms:reblog",this._createPostFormReblog),this.listenTo(l,"postForms:saved",this.destroyPostForm),this._registerDismissListener(),this.listenTo(l,"postForms:dismissListener:suspend",function(){this._toggleDismissListener(!1)}),this.listenTo(l,"postForms:dismissListener:resume",function(){this._toggleDismissListener(!0)})},_toggleDismissListener:function(t){this.stopListening(l,"postForms:close"),t&&this._registerDismissListener()},_registerDismissListener:function(){this.listenTo(l,"postForms:close",this.dismissPostForm)},createInlineContainer:function(t){return t?new C({el:t.parent(),originalContent:t,transitionBackground:!0}):!1},_createPostFormNew:function(t){return this.createPostForm(t)},_createPostFormEdit:function(t){return t.postEl&&(t.containerView=this.createInlineContainer(t.postEl),t.postFormType=p.inline),this.createPostForm(t)},_createPostFormReblog:function(t){return this.createPostForm(t)},createPostForm:function(t){if(this.postForm)return this.destroyPostForm(t).then(i.bind(function(){return this.createPostForm(t)},this));t=i.extend({updateURL:!0,glass:!0,postFormType:p.modal},t),i.defaults(t,{containerView:t.postFormType===p.inline?this.postButtonsContainer:null}),t.post||(t.post=this._createPostModel(t)),t.url||(t.url=this._postFormUrl(t.post)),t.containerView===this.postButtonsContainer&&this.postButtons.setPostType(t.post.get("type")),this._updateData();var e=t.postFormType===p.modal,s=this.postForm=new _({fullWidthPosts:this.fullWidthPosts,isModal:e,popoverContainer:e?this.modal.$el:f,post:t.post}),r=this.postFormContainer=t.containerView||this.modalContainer;if(!r)throw new Error("No post form container!");this.listenTo(s,"pauseScrollHelper",this.pauseScrollHelper),this.listenTo(s,"resumeScrollHelper",this.resumeScrollHelper),r.isRendered()||r.render(),r.setPostFormComponent(s);var a=i.once(i.bind(function(){return t.glass?this.glass.show():o.resolve()},this)),c=n([function(){return o.join(r.prepare(a),s.whenRendered(!0))},function(){return s.disable(),r.attach(a)},function(){return t.updateURL&&d.history.navigate(t.url,{replace:!0}),function(){var t=h.rect(),o=t.windowScrollTop,n=t.windowHeight,a=s.getRect(),d=a.offsetHeight,c=r.$el.offset().top,u=c+d,p=20,m=n>d+2*p,g=this.scrollHelper.calculateScrollTop(c-p,u+p,n,m),f=400,_=e?this.modal.$el:void 0;r===this.postButtonsContainer&&g>o&&n>d&&(g=o),this.previousScrollPosition=e?!1:o,this.scrollHelper.scrollToPosition(g,f,_),this.listenTo(l,"Photoset:dragScroll",function(t,e){i.isNumber(e)||(e=50);var s=h.rect().windowScrollTop+t;this.scrollHelper.scrollToPosition(s,e,_)}),this.listenTo(l,"Photoset:scrollToRow",function(t,e,s){i.isNumber(s)||(s=50),t+=0,this.scrollHelper.checkScrollBounds(!1,{keepInside:!0,contentPadding:70,contentRect:{offsetTop:t,offsetHeight:e}})})}.call(this),r.showPostForm(a)},function(){return a()},function(){s.enable()}],this).then(function(){return l.trigger("postForms:opened"),s});return t.postFormType===p.inline&&c.then(i.bind(function(){this.scrollHelper.start({el:r.$el})},this)),c.catch(function(t){t instanceof Error&&i.defer(function(){throw t})}),c},dismissPostForm:function(){var t=this.postForm.initialPostState,e=this.postForm.post;e.deepHasChanged(t)?this._buildDismissPrompt():this.destroyPostForm()},_buildDismissPrompt:function(){var t={text:i.sprintf("<h3>%s</h3>",g("Discard edits to this post?")),text_ok:g("Discard")};v.confirm(t,i.bind(function(){this.destroyPostForm(),l.trigger("postForms:dismissListener:resume")},this),function(){i.defer(function(){l.trigger("postForms:dismissListener:resume")})}),l.trigger("postForms:dismissListener:suspend")},destroyPostForm:function(t,e){t=i.extend({updateURL:!0,url:this.baseRoute,glass:!0},t),this.scrollHelper.stop();var s=this.postForm,r=this.postFormContainer;this.postForm=null,this.postFormContainer=null,this.stopListening(s),this.stopListening(l,"Photoset:dragScroll");var a=i.once(i.bind(function(){return t.glass?this.glass.hide():o.resolve()},this)),h=!!s.postForm.get("saved"),c=n([function(){h&&this.saveHook.preExecute(e)},function(){s&&s.disable()},function(){s&&s.postForm.unFixFooterPosition()},function(){return function(){if(this.previousScrollPosition!==!1){var t=this.previousScrollPosition,e=400;this.scrollHelper.scrollToPosition(t,e)}}.call(this),r?r.hidePostForm(a).then(function(){r.teardown()}):void 0},function(){s&&s.remove(),t.updateURL&&d.history.navigate(t.url,{replace:!0})},function(){return a()},function(){h&&e&&(this.saveHook.$inlinePostEl=r.$el,this.saveHook.execute(e))}],this).then(function(){return l.trigger("postForms:closed"),s});return c.catch(function(t){t instanceof Error&&i.defer(function(){throw t})}),c},pauseScrollHelper:function(){this.scrollHelper&&this.scrollHelper.pause()},resumeScrollHelper:function(){this.scrollHelper&&this.scrollHelper.resume()},_createPostModel:function(t){return"string"==typeof t&&(t={postType:t}),new y(t.reblogId?{lookupData:{reblog_id:t.reblogId,reblog_key:t.reblogKey},tumblelog:this.currentChannel,mode:"reblog",editorType:this.user.get("defaultEditorType"),pt:t.pt,contextData:{baseRoute:this.baseRoute},loggingData:t.loggingData}:t.editId?{lookupData:{post_id:t.editId,channel_id:t.channelId||this.currentChannel},tumblelog:t.channelId||this.currentChannel,editorType:this.user.get("defaultEditorType"),contextData:{baseRoute:this.baseRoute},mode:"edit",loggingData:t.loggingData}:{type:t.postType||t.type||"text",tumblelog:this.currentChannel,editorType:this.user.get("defaultEditorType"),contextData:{baseRoute:this.baseRoute},mode:"new",loggingData:t.loggingData})},_postFormUrl:function(t){if(t){if(t.has("lookupData")){var e=t.get("lookupData");return e.reblog_id?this._reblogPostUrl(e.reblog_id,e.reblog_key):e.post_id?this._editPostUrl(e.post_id):this._newPostUrl(t.get("type"))}return t.has("reblog_id")?this._reblogPostUrl(t.get("reblog_id"),t.get("reblog_key")):t.has("id")?this._editPostUrl(t.get("id")):this._newPostUrl(t.get("type"))}return this._newPostUrl("text")},_newPostUrl:function(t){var e=this.baseRoute!==m?this.baseRoute:"";return e+"/new/"+t},_editPostUrl:function(t){return"/edit/"+t},_reblogPostUrl:function(t,e){return"/reblog/"+t+"/"+e},render:function(){return this.glass.render().$el.appendTo("body"),this.modal.render().$el.appendTo("body"),this}},{containerType:function(t){return p[t]}});r.applyTo(T.prototype),e.exports=T},{"./utils/post_form_container_type":172,"./utils/save_hook":173,"./utils/scroll_helper":174,"./utils/transition_speed":175,"./views/container":176,"./views/container_content":177,"./views/glass":178,"./views/modal":180,"./views/post_buttons":181,"app/components/dialog":12,"app/components/post_form":41,"app/components/post_form/models/post":49,"app/components/post_form/services/embed_data":55,"app/lib/currentuser":209,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/component":260,"prima/events":261,"prima/lib/domeventor":265,"prima/lib/logger":268,"prima/lib/translate":288,"prima/mixins/promisifyevents":294,"prima/utils/exposer":307,"prima/utils/haspath":309,"prima/utils/sequence-with-context":315,when:"RG2dij"}],168:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.extend({endpoint:"/svc/post/%s/%s/%d",parse:function(t){return{dashboardHTML:t.trim()}},sync:function(t,e,o){if("read"!==t)throw new Error("The DashboardPostFetch model may only READ from server!");if(o=i.defaults(o||{},{pageRoot:!1,direction:!1,refPostID:!1}),!1===(o.pageRoot&&o.direction&&o.refPostID))throw new Error(i.sprintf("All post fetch params must be passed: pageRoot [%s], direction [%s], and refPostID [%s]",o.pageRoot,o.direction,o.refPostID));return i.defaults(o,{dataType:"html",emulateHTTP:!0,url:i.sprintf(this.endpoint,o.pageRoot,o.direction,o.refPostID)}),s.prototype.sync.call(this,t,e,o)}});e.exports=o},{lodash:"K2RcUv","prima/model":298}],169:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+="",transitionBackground&&(__p+='<div class="post-transition-background"></div>'),__p+="",originalContent&&(__p+='<div data-subview="originalContent"></div>'),__p+='<div data-subview="loader"></div><div data-subview="postForm"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],170:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="Knight-Rider-loader ',loading&&(__p+="animate"),__p+='"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],171:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="v-center-outer"><div class="v-center-inner"><div class="v-center-content"><div data-subview="content"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],172:[function(t,e){"use strict";var i={modal:1,inline:2};e.exports=i},{}],173:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/events"),n=t("../models/dashboard_post_fetch"),r=function(){var t={preExecute:function(){return"queue"===this.contextData.contextPage?(s(window).off("beforeunload"),void(window.location=this.contextData.baseRoute)):void 0},execute:function(t){this.saveResponse=t.responseJSON;var e=!this.saveResponse.post.is_edit&&!this.saveResponse.post.is_reblog,i="post_dashboard_html"in this.saveResponse;e?this._fetchMorePosts():i&&this._updateInline(),this._displayNotification(t.responseJSON)},_fetchMorePosts:function(){var t=this.contextData.baseRoute.replace(/^\/|\/$/g,""),e=this.contextData.$latestPostEl.find(".post").data("post-id")||this.contextData.$postButtonsContainer.next().find(".post").data("post-id"),s=new n;s.fetch({pageRoot:t,direction:"before",refPostID:e,success:i.bind(this._fetchSuccess,this),error:this._fetchFailure})},_fetchSuccess:function(t){var e=s(t.get("dashboardHTML"));e.insertAfter(this.contextData.$postButtonsContainer),this.contextData.$latestPostEl=e,o.trigger("posts:load")},_fetchFailure:function(){console.error("Failed loading dashboard HTML after successful post submission.")},_updateInline:function(){var t=s(this.saveResponse.post_dashboard_html.trim());this.$inlinePostEl.replaceWith(t.eq(0)),o.trigger("posts:load")},_displayNotification:function(t){var e=this.contextData.baseRoute.split("/"),s=e[1]||"",n=t.message,r=i.parseInt(this.contextData.notificationDelay),a={url:t.post_tumblelog.post_url,tumblelog:{name:t.post_tumblelog.name_or_id,url:t.post_tumblelog.url,avatar:t.post_tumblelog.avatar}};(!t.created_post||t.post.is_reblog||t.fastCompose||"tagged"===s.toLowerCase())&&i.delay(function(){o.trigger("postForms:saveHook:toast",n,a)},r)}},e=function(e){this.contextData=i.defaults(e||{},{notificationDelay:250}),i.extend(this,t)};return e}();e.exports=r},{"../models/dashboard_post_fetch":168,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261}],174:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("velocity-animate").animate,n=t("../utils/transition_speed"),r=t("prima/class"),a=t("backbone"),l=t("prima/lib/domeventor"),h=t("prima/events"),d=(t("prima/lib/logger"),s("html")),c=r.extend({defaults:{keepInside:!1,scrollSpeedMs:250,triggerPadding:-50,contentPadding:20,debounceMs:200},start:function(t){return this._running&&this.stop(),this._running=!0,t&&!i.isPlainObject(t)&&(t={el:t}),this.options=t=i.extend({},this.defaults,t),this.$el=s(t.el),this.updateContentRect(),this.listenTo(h,"DOMEventor:flatscroll",this.checkScrollBounds),this},stop:function(){return this._running=!1,this._scrollTop=!1,this.cancelEnforceScrollBounds(),this.stopListening(),this},pause:function(){this._running&&(this._ignoreScroll=!0)},resume:function(){this._running&&this._ignoreScroll&&(this._ignoreScroll=!1,this.checkScrollBounds())},updateContentRect:function(){this.contentRect||(this.contentRect={}),this.lastContentRect&&(this.lastContentRect.offsetTop=this.contentRect.offsetTop,this.lastContentRect.offsetLeft=this.contentRect.offsetLeft,this.lastContentRect.offsetHeight=this.contentRect.offsetHeight,this.lastContentRect.offsetWidth=this.contentRect.offsetWidth);var t=this.$el.offset();return this.contentRect.offsetTop=t.top,this.contentRect.offsetLeft=t.left,this.contentRect.offsetHeight=this.$el.outerHeight(),this.contentRect.offsetWidth=this.$el.outerWidth(),this.lastContentRect||(this.lastContentRect=i.clone(this.contentRect)),this.contentRect},calculateScrollTop:function(t,e,i,s){return s?t:e-i},checkScrollBounds:function(t,e){if(!this._ignoreScroll){e=e?i.extend({},this.defaults,this.options,e):this.options,t||(t=l.rect());var s,o,n=e.contentRect||this.updateContentRect(),r=e.triggerPadding||0,a=e.contentPadding||0,h=n.offsetHeight,d=n.offsetTop,c=d+h,u=t.windowHeight,p=Math.max(0,t.windowScrollTop),m=p+u;return e.keepInside?(s=p-d,o=c-m):(s=p-c,o=d-m),o>r?(this._scrollTop=this.calculateScrollTop(d-a,c+a,u,h+2*a>u),this.enforceScrollBounds(e),!0):s>r?(this._scrollTop=this.calculateScrollTop(d-a,c+a,u,e.bottom||u>h+2*a),this.enforceScrollBounds(e),!0):(this._scrollTop=!1,this.cancelEnforceScrollBounds(),!1)}},enforceScrollBounds:function(t){var e=null!=t.scrollTop?t.scrollTop:this._scrollTop,s=t.scrollSpeedMs,o=t.debounceMs,n=t.container;o?this._enforceTimeout||(this._enforceTimeout=i.delay(i.bind(function(){null==t.scrollTop&&(e=this._scrollTop),this.scrollTop!==!1&&this.scrollToPosition(e,s,n)},this),o)):this.scrollToPosition(e,s,n)},cancelEnforceScrollBounds:function(){this._enforceTimeout,clearTimeout(this._enforceTimeout),this._enforceTimeout=!1},scrollToPosition:function(t,e,s){this._ignoreScroll=!0,o(d,"stop"),o(d,"scroll",{offset:t,container:s,duration:n(e||this.defaults.scrollSpeedMs)}).then(i.bind(function(){this._ignoreScroll=!1},this))}});i.extend(c.prototype,a.Events),e.exports=c},{"../utils/transition_speed":175,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/class":258,"prima/events":261,"prima/lib/domeventor":265,"prima/lib/logger":268,"velocity-animate":"lWl/mc"}],175:[function(t,e){"use strict";var i=1,s=function(t){return t*i};s.get=function(){return i},s.set=function(t){i=t},e.exports=s},{}],176:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("velocity-animate").animate,n=t("prima/utils/sequence-with-context"),r=t("../utils/transition_speed"),a=t("prima/events"),l=t("prima/mixins/promisifyevents"),h=t("prima/view"),d=(t("prima/lib/logger"),t("prima/mixins/subviewable")),c=t("prima/mixins/selectorcache"),u=t("prima/mixins/accessor"),p=t("./container_content"),m=t("./loader"),g=t("../templates/container.tpl"),f=h.extend({mixins:[d,c,u,l],template:g,defaultOptions:{animateDuringPrepare:!0,animateHeightWithContent:!1,startHeight:null,useLoader:!0,loaderDelay:250,transitionBackground:!1},defaults:{minHeight:!1,pretransition:!1,midtransition:!1},initialize:function(t){t instanceof h&&(t={postForm:t}),this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),t.postForm&&this.setPostForm(t.postForm),this.listenTo(this,"change:minHeight",this._onChangeMinHeight),this.listenTo(this,"change:pretransition",this._onChangePretransition),this.listenTo(this,"change:midtransition",this._onChangeMidtransition)},_onChangeMinHeight:function(t,e){o(this.$el,"stop"),e||i.isNumber(e)?o(this.$el,{"min-height":e},{duration:r(Math.min(Math.max(250,e),750))}):(e=i.parseInt(this.$el.css("min-height"),10)||0,o(this.$el,{"min-height":[0,e]},{duration:r(Math.min(Math.max(250,e),750))}).then(i.bind(function(){this.$el.css("min-height","")},this)))},_onChangePretransition:function(t,e){e?this.$el.addClass("post-form-container-pretransition"):this.$el.removeClass("post-form-container-pretransition")},_onChangeMidtransition:function(t,e){e?this.$el.addClass("post-form-container-transition"):this.$el.removeClass("post-form-container-transition")},setPostFormComponent:function(t){return this._postFormComponent!==t?(this._postFormComponent&&this.stopListening(this._postFormComponent),this._postFormComponent=t,this.postForm=t.postForm,this):void 0},prepare:function(t){return this.isRendered()||this.render(),this.trigger("prepared",this),this.loadingDelay=i.delay(i.bind(function(){this.loader&&this.options.useLoader&&this.loader.set("loading",!0)},this),this.options.loadingDelay),this.options.animateDuringPrepare&&(this._hideOriginalContent=this.hideOriginalContent(t).then(i.bind(function(){return this._hideOriginalContent=!1,this},this))),s.resolve(this)},attach:function(){return this.loader&&(clearTimeout(this.loadingDelay),this.loader.set("loading",!1)),this.set("pretransition",!0),this.postForm.forceHidden(),this.attachSubView(this.postForm,"postForm"),s.resolve(this)},hideOriginalContent:function(t){var e=this.options.startHeight||this.originalContent.measureHeight(),i=this.postForm.measureHeight();return e||this.options.originalContent||(e=i),n([function(){null!=e&&this.$el.css("height",e),this.set("midtransition",!0),this.originalContent.set("enabled",!1)},function(){return s.join(t(),this.originalContent.animateHide(r(100)))}],this)},showPostForm:function(t){var e=this.options.startHeight||this.originalContent.measureHeight(),i=this.postForm.measureHeight();return e||this.options.originalContent||(e=i),n([function(){return this.options.animateHeightWithContent||this.originalContent.get("hidden")?void 0:this._hideOriginalContent||this.hideOriginalContent(t)},function(){var n=[];return this.options.animateHeightWithContent&&!this.originalContent.get("hidden")&&n.push(this._hideOriginalContent||this.hideOriginalContent(t)),null==i||null==e||(i===e?this.$el.height(i):n.push(o(this.$el,{height:[i,e]},{duration:r(150),easing:[.4,1.3,.7,1]}))),s.all(n)},function(){return this.set("placeholder",!1),this.postForm.animateShow(r(100))},function(){this.set("pretransition",!1),this.set("midtransition",!1),this.$el.css("height",""),a.trigger("postForms:enableFixFooter")}],this)},hidePostForm:function(t){var e=this.postForm.measureHeight(),i=this.originalContent.measureHeight();return i||this.options.originalContent||(i=e),n([function(){this.$el.css("height",e),this.set("midtransition",!0)
},function(){return this.postForm.animateHide(r(100))},function(){if(this.set("pretransition",!0),null==i||null==e);else{if(i!==e)return o(this.$el,{height:[i,e]},{duration:r(100),easing:[0,0,.6,1]});this.$el.height(i)}},function(){return s.join(t(),this.originalContent.animateShow(r(50)))},function(){this.set("midtransition",!1),this.set("pretransition",!1),this.$el.css("height",""),this.originalContent.set("enabled",!0)}],this)},serialize:function(){return{originalContent:!!this.options.originalContent,transitionBackground:this.options.transitionBackground}},beforeRender:function(){this.loader||(this.loader=new m),this.originalContent||(this.originalContent=this.options.originalContent instanceof p?this.options.originalContent:new p({el:this.options.originalContent})),this.originalContent.$el.detach()},render:function(){return this.$el.html(this.template(this.serialize())),this.subViews.originalContent=this.originalContent,this.subViews.loader=this.loader,this.subViews.postForm=this.postForm,this.attachSubViews(),this},afterRender:function(){return this.$el.addClass("post-forms-above-glass"),this.renderSubViews()},beforeTeardown:function(){return this.subViews.loader=void 0,this},afterTeardown:function(){return this.$el.removeClass("post-forms-above-glass post-form-container-pretransition post-form-container-transition"),this.loader&&(this.loader.remove(),this.loader=void 0),this.$el.children(".post-transition-background").remove(),delete this.postForm,this.trigger("torndown",this),this.teardownSubViews()}});e.exports=f},{"../templates/container.tpl":169,"../utils/transition_speed":175,"./container_content":177,"./loader":179,lodash:"K2RcUv","prima/events":261,"prima/lib/logger":268,"prima/mixins/accessor":289,"prima/mixins/promisifyevents":294,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/utils/sequence-with-context":315,"prima/view":318,"velocity-animate":"lWl/mc",when:"RG2dij"}],177:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate").animate,o=t("prima/view"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/accessor"),a=o.extend({defaults:{hidden:!1,enabled:!0},mixins:[n,r],initialize:function(t){this.set("hasContent",t&&t.el),this.originalCSS=this._getCSS(["opacity","display"]),this.listenTo(this,"change:enabled",this._onChangeEnabled)},_getCSS:function(t){var e={};return i.forEach(t,function(t){e[t]=this.$el.css(t)},this),e},_onChangeEnabled:function(t,e){e?this.$el.removeClass("no-pointer-events"):this.$el.addClass("no-pointer-events")},measureHeight:function(){if(!this.get("hasContent"))return void 0;var t=this.$el.css("display");this.$el.css("display","block");var e=this.$el.outerHeight();return this.$el.css("display",t),e},animateShow:function(t,e){return t||(t=0),e||(e=0),s(this.$el,{opacity:1},{display:"block",duration:t,delay:e}).then(i.bind(function(){this.set("hidden",!1)},this))},animateHide:function(t,e){return t||(t=0),e||(e=0),s(this.$el,{opacity:0},{display:"none",duration:t,delay:e}).then(i.bind(function(){this.set("hidden",!0)},this))},render:function(){return this},teardown:function(){return this.$el.css(this.originalCSS),this}});e.exports=a},{lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/subviewable":296,"prima/view":318,"velocity-animate":"lWl/mc"}],178:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate").animate,o=t("prima/view"),n=t("../utils/transition_speed"),r=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),l=t("prima/mixins/accessor"),h=o.extend({className:"post-forms-glass",mixins:[r,a,l],initialize:function(t){this.options=t=i.extend({active:!1,visible:!1},t),this.set({active:!!t.active,visible:!!t.visible}),this.$el.css(this.get("visible")?{opacity:1,display:"block"}:{opacity:0,display:this.get("active")?"block":"none"}),this.listenTo(this,{"change:active":this._changeActive,"change:visible":this._changeVisible})},show:function(t){return this.set("active",!(null!=t&&!t)),this.attributes.visible&&this._showing?this._showing:(this.attributes.visible=!0,this._show())},hide:function(t){return this.set("active",!(null==t&&!t)),!this.attributes.visible&&this._hiding?this._hiding:(this.attributes.visible=!1,this._hide())},_show:function(){var t=this._showing=s(this.$el,{opacity:1},{duration:n(150),display:"block"});return t},_hide:function(){var t=this._hiding=s(this.$el,{opacity:0},{duration:n(150),display:this.get("active")?"block":"none"});return t},_changeActive:function(t,e){e?this.$el.addClass(this.className+"_active active"):(this.$el.removeClass(this.className+"_active active"),!this._changing||i.has(this.changed,"visible")||this.get("visible")||this.$el.css("display","none"))},_changeVisible:function(t,e){e?(this.$el.addClass(this.className+"_visible visible"),this._show()):(this.$el.removeClass(this.className+"_visible visible"),this._hide())},render:function(){return this}});e.exports=h},{"../utils/transition_speed":175,lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318,"velocity-animate":"lWl/mc"}],179:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/mixins/subviewable"),o=t("prima/mixins/selectorcache"),n=t("prima/mixins/accessor"),r=t("../templates/loader.tpl"),a=i.extend({className:"post-forms-loader",mixins:[s,o,n],template:r,initialize:function(t){this.listenTo(this,"change:loading",this._onChangeLoading),this.set("loading",t&&t.loading)},_onChangeLoading:function(t,e){this.isRendered()&&(e?(this.$el.addClass("loading"),this.$$(".Knight-Rider-loader").addClass("animate")):(this.$el.removeClass("loading"),this.$$(".Knight-Rider-loader").removeClass("animate")))},render:function(){return this.$el.html(this.template(this.attributes)),this}});e.exports=a},{"../templates/loader.tpl":170,"prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],180:[function(t,e){"use strict";var i=t("jquery"),s=t("velocity-animate").animate,o=t("prima/events"),n=t("prima/view"),r=t("../utils/transition_speed"),a=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("prima/mixins/accessor"),d=t("../templates/modal.tpl"),c=n.extend({className:"post-forms-modal",mixins:[a,l,h],template:d,events:{scroll:"_onScroll"},initialize:function(t){this.set("visible",t&&t.visible),this.$el.css(this.get("visible")?{opacity:1,display:"block"}:{opacity:0,display:"none"}),this.$body=i("body"),this.listenTo(this,"change:visible",this._toggleVisible)},show:function(){return this.attributes.visible=!0,this._show()},hide:function(){return this.attributes.visible=!1,this._hide()},setContentSubView:function(t){return this.subViews.content&&(this.stopListening(this.subViews.content),this.subViews.content.remove()),this.subViews.content=t,this.listenTo(t,"prepared",this._onSubViewPrepare),this.listenTo(t,"torndown",this._onSubViewTeardown),this.isRendered()&&this.attachSubView("content"),this},_onScroll:function(){o.trigger("postForms:modalView:scroll")},_onSubViewPrepare:function(){this.show()},_onSubViewTeardown:function(){this.hide()},_show:function(){this._disableBodyScroll(),this.$el.css("display","block");var t=s(this.$el,{opacity:1},{duration:r(100),display:"block"});return t},_hide:function(){this._enableBodyScroll();var t=s(this.$el,{opacity:0},{duration:r(100),display:"none"});return t},_toggleVisible:function(t,e){e?(this.$el.addClass(this.className+"_visible visible"),this._show()):(this.$el.removeClass(this.className+"_visible visible"),this._hide())},_disableBodyScroll:function(){this.$body.css("overflow","hidden")},_enableBodyScroll:function(){this.$body.css("overflow","")},render:function(){return this.$el.html(this.template(this.attributes)),this.attachSubViews(),this}});e.exports=c},{"../templates/modal.tpl":171,"../utils/transition_speed":175,jquery:"HlZQrA","prima/events":261,"prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318,"velocity-animate":"lWl/mc"}],181:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("velocity-animate").animate,n=t("./container_content"),r=t("prima/mixins/selectorcache"),a=t("prima/mixins/accessor"),l=t("prima/events"),h=t("../utils/post_form_container_type"),d=n.extend({mixins:[r,a],events:{"click [data-js-text]":"_onClickNewPost","click [data-js-photo]":"_onClickNewPost","click [data-js-quote]":"_onClickNewPost","click [data-js-link]":"_onClickNewPost","click [data-js-chat]":"_onClickNewPost","click [data-js-audio]":"_onClickNewPost","click [data-js-video]":"_onClickNewPost"},setPostType:function(t){this.postType=t},animateShow:function(t,e){return t||(t=0),e||(e=0),this.$el.css({display:"block",opacity:1}),function(i){var n=this.js$(i),r=n.children("i"),a=n.children(".new_post_label_text"),l=this.$$(".new_post_label").not(n),h=l.children("i"),d=l.children(".new_post_label_text"),c=[o(h,{scale:1,translateY:[0,10],opacity:1},{duration:t,delay:e}),o(d,{translateY:[0,10],opacity:1},{duration:t,delay:e})];return n.length&&r.length&&c.push(o(r,{scale:[1,1.5],translateY:[0,0],opacity:1},{duration:t,delay:e}),o(a,{translateY:[0,0],opacity:1},{duration:t,delay:e})),s.all(c)}.call(this,this.postType)},animateHide:function(t,e){t||(t=0),e||(e=0),function(i){var n=this.js$(i),r=n.children("i"),a=n.children(".new_post_label_text"),l=this.$$(".new_post_label").not(n),h=l.children("i"),d=l.children(".new_post_label_text"),c=[o(h,{scale:[1,1],translateY:[10,0],opacity:0},{duration:t,delay:e}),o(d,{translateY:[10,0],opacity:0},{duration:t,delay:e})];return n.length&&r.length&&c.push(o(r,{scale:[1.5,1],translateY:[0,0],opacity:0},{duration:t,delay:.5*t+e}),o(a,{translateY:[0,0],opacity:0},{duration:t,delay:e})),s.all(c)}.call(this,this.postType).then(i.bind(function(){this.$el.css({display:"none",opacity:0})},this))},_onClickNewPost:function(t){if(t.stopPropagation(),t.preventDefault(),this.get("enabled")){var e=t.currentTarget.getAttribute("data-post-endpoint")||t.currentTarget.getAttribute("data-post-type");l.trigger("postForms:open",{postType:e,postFormType:h.inline})}}});e.exports=d},{"../utils/post_form_container_type":172,"./container_content":177,lodash:"K2RcUv","prima/events":261,"prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"velocity-animate":"lWl/mc",when:"RG2dij"}],182:[function(t,e){"use strict";var i=t("./views/remove-button.js");e.exports=i},{"./views/remove-button.js":184}],183:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="remove-button '+(null==(__t=buttonClass)?"":_.escape(__t))+'"><span class="icon"></span></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],184:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=t("../templates/remove-button.tpl"),l=s.extend({events:{click:"_onClick"},template:a,mixins:[o,n,r],defaults:{dataJsName:"removeButton",buttonClass:""},initialize:function(t){t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.onClick=t.onClick},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this.get("dataJsName")&&this.$$(".remove-button").attr("data-js-"+this.get("dataJsName"),""),this},_onClick:function(){i.isFunction(this.onClick)?this.onClick(this):this.trigger("remove")}});e.exports=l},{"../templates/remove-button.tpl":183,lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],185:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/component"),n=t("prima/events"),r=t("prima/mixins/keycommands"),a=t("./views/fast_compose"),l=o.extend({name:"switcher",mixins:[r],keycommands:{"keydown:alt+c":"macFastCompose","keydown:z+c":"winFastCompose"},loggingData:{},initialize:function(){this.$body=i("body"),this.$glass=null,this.suspended=!1,this.bindEvents()},bindEvents:function(){this.listenTo(n,"keycommands:suspend",this.suspend),this.listenTo(n,"keycommands:resume",this.resume),this.listenTo(n,"fastCompose:close:complete",this.dismissFastCompose),this.listenTo(n,"fastCompose:dismiss",this.dismissFastCompose),this.listenTo(n,"fastCompose:init",this.initFastCompose)},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},macFastCompose:function(t){"MacIntel"===navigator.platform&&this.initFastCompose(t)},winFastCompose:function(t){"Win32"===navigator.platform&&this.initFastCompose(t)},initFastCompose:function(t){this.suspended||this.fastCompose||(this.determineSource(t),this.fastCompose=new a({loggingData:this.loggingData}),this.$body.append(this.fastCompose.render().el),this.showPlexi(),this.fastCompose.open(),n.trigger("fastCompose:init:complete"))},dismissFastCompose:function(){this.fastCompose&&(this.hidePlexi(),this.fastCompose.teardown(),this.fastCompose=null),n.trigger("fastCompose:dismiss:complete")},showPlexi:function(){this.$glass=i("<div>",{"class":"glass show"}).appendTo(this.$body),s.defer(s.bind(function(){this.$glass.addClass("blue")},this)),n.trigger("drawer:suspend")},hidePlexi:function(){this.$glass.remove(),this.$glass=null,n.trigger("drawer:resume")},determineSource:function(t){this.loggingData.source="fast-compose",t&&(t.originalEvent instanceof KeyboardEvent?this.loggingData.source="keycommand":t.loggingData&&t.loggingData.source&&(this.loggingData.source=t.loggingData.source))}});e.exports=l},{"./views/fast_compose":187,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":260,"prima/events":261,"prima/mixins/keycommands":291}],186:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="post-tab-switching"><div class="tab-post-types count-'+(null==(__t=Object.keys(fastComposeIcons).length)?"":_.escape(__t))+'">',_.each(fastComposeIcons,function(t,e){__p+='<div class="tab-post-type item" data-index="'+(null==(__t=e)?"":__t)+'" data-post-type="'+(null==(__t=t.name)?"":__t)+'"><div class="post-type-icon icon-'+(null==(__t=t.name)?"":__t)+'"><i class="post-type-icon-overlay"></i></div><div class="post-type-name"><span class="post-type-name-span">'+(null==(__t=t.label)?"":__t)+"</span></div></div>"}),__p+="</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],187:[function(t,e){"use strict";var s=t("jquery"),o=t("lodash"),n=t("velocity-animate"),r=t("prima/lib/data"),a=t("prima/view"),l=t("prima/events"),h=t("prima/mixins/keycommands"),d=t("app/components/post_form_builder"),c=t("../templates/fast_compose.tpl"),u=a.extend({template:c,className:"fast-compose",fastComposeIcons:{1:{name:"text",label:"Text"},2:{name:"photo",label:"Photo"},3:{name:"quote",label:"Quote"},4:{name:"link",label:"Link"},5:{name:"chat",label:"Chat"},6:{name:"audio",label:"Audio"},7:{name:"video",label:"Video"}},events:{"click .post-tab-switching .tab-post-type":"clickCreate","mouseover .post-tab-switching .tab-post-type":"mouseoverIcon","click .post-tab-switching":"close"},mixins:[h],keycommands:{"keydown:c":"nextIcon","keydown:shift+c":"previousIcon","keydown:tab":"nextIcon","keydown:shift+tab":"previousIcon","keydown:right":"nextIcon","keydown:left":"previousIcon","keydown:enter":"enterCreate","keydown:escape":"close"},initialize:function(t){this.attributes=o.extend({fastComposeIcons:this.fastComposeIcons},t),this.$body=s("body"),this.$glass=null,this.postTabIndex=null,this.$plexiInstance=s('.plexi[data-token="body-plexi"]'),this.resumeKeycommandsOnClose=!0,this.tabSwitching=s(),this.postTypes=s(),this.currentPostType=s(),this.bindEvents()},bindEvents:function(){this.listenTo(l,"DOMEventor:keydown:tab",this.disableKey),this.listenTo(l,"DOMEventor:keydown:shift+tab",this.disableKey)},render:function(){return this.$el.append(this.template(this.attributes)),a.prototype.render.apply(this,arguments)},open:function(){o.defer(o.bind(function(){this.show()},this))},show:function(){l.trigger("keycommands:suspend"),this.tabSwitching=s(".post-tab-switching"),this.postTypes=this.$el.find(".tab-post-type");var t=50;for(i=0;7>i;i++){var e=this.postTypes.eq(i),o=e.find(".post-type-icon"),r=e.find(".post-type-name");n.animate(o,{opacity:["1","0"],translateY:["0px","15px"]},{duration:150,delay:i*t}),n.animate(r,{opacity:["1","0"],translateY:["0px","-15px"]},{duration:150,delay:i*t})}this.tabSwitching.addClass("finish-animating")},enterCreate:function(){var t=this.$el.find(".selected");if(t.length){var e=t.attr("data-post-type");this.createNew(e),this.close()}},clickCreate:function(t){var e=t.currentTarget.attributes["data-post-type"].value;this.createNew(e)},disableKey:function(t){t.preventDefault()},mouseoverIcon:function(t){this.currentPostType.removeClass("selected"),this.postTabIndex=t.currentTarget.attributes["data-index"].value},nextIcon:function(){null==this.postTabIndex||this.postTabIndex>=7?this.postTabIndex=1:this.postTabIndex++,this.currentPostType.removeClass("selected"),this.currentPostType=this.postTypes.eq(this.postTabIndex-1),this.currentPostType.addClass("selected")},previousIcon:function(){null==this.postTabIndex||this.postTabIndex<=1?this.postTabIndex=7:this.postTabIndex--,this.currentPostType.removeClass("selected"),this.currentPostType=this.postTypes.eq(this.postTabIndex-1),this.currentPostType.addClass("selected")},createNew:function(t){this.resumeKeycommandsOnClose=!1,r.has("Components/PostFormBuilder")&&(this.postFormBuilder=new d),this.postFormBuilder?l.trigger("postForms:open",{updateURL:!1,postFormType:d.containerType("modal"),postType:t,loggingData:this.attributes.loggingData}):l.trigger("fastCompose:create",{type:t,loggingData:this.attributes.loggingData})},close:function(){var t=50;for(i=0;7>i;i++){var e=Math.floor((i+1)/2);i%2==0&&(e=-e),e+=3;var s=this.postTypes.eq(e),o=n.animate(s,{opacity:["0","1"],translateY:["-500px","0px"]},{duration:150,delay:i*t});i>=6&&o.then(function(){l.trigger("fastCompose:close:complete")})}},teardown:function(){this.resumeKeycommandsOnClose&&l.trigger("keycommands:resume"),this.remove()}});e.exports=u},{"../templates/fast_compose.tpl":186,"app/components/post_form_builder":167,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/lib/data":263,"prima/mixins/keycommands":291,"prima/view":318,"velocity-animate":"lWl/mc"}],188:[function(t,e){"use strict";var i=(t("jquery"),t("prima/component")),s=t("./views/tooltip"),o=i.extend({name:"ToolTip",class_name:"tumblr_tooltip",initialize:function(t){this.toolTipView=new s(t)}});e.exports=o},{"./views/tooltip":190,jquery:"HlZQrA","prima/component":260}],189:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="dot_tooltip_wrapper '+(null==(__t=placement)?"":_.escape(__t))+" "+(null==(__t=class_name)?"":_.escape(__t))+'" style="left:'+(null==(__t=left_css)?"":_.escape(__t))+'"><div class="dot_tooltip"><div class="tooltip_top">'+(null==(__t=text)?"":__t)+"</div>",premium?(__p+='<div class="tooltip_bottom"><ul class="tumblelog_list"><li class="item"><a href="http://'+(null==(__t=url)?"":__t)+'" class="call_to_action follow_list_item_blog blog'+(null==(__t=following?"":" has_follow_button")?"":__t)+'" target="blank"><div class="hide_overflow '+(null==(__t=following?"":" has_follow_button")?"":__t)+'"><span class="tumblelog_title"><? // todo: fix stupid mismatch between class and content ?>'+(null==(__t=name)?"":__t)+'<span><br><small class="tumblelog_name">'+(null==(__t=title)?"":__t)+'</small></span></span></div><div class="avatar" style="background-image:url(\''+(null==(__t=avatar_url)?"":__t)+'\')"><img src="'+(null==(__t=avatar_url)?"":__t)+'" class="avatar_img" alt=""></div></a>',following||(__p+=' <a class="follow" href="/follow/'+(null==(__t=name)?"":__t)+'" data-tumblelog-name="'+(null==(__t=name)?"":__t)+'" data-follow-source="FOLLOW_SOURCE_DOT_POPOVER" title="Follow"><span class="icon_plus follow_icon"></span></a>'),__p+="</li></ul></div>"):searchLink&&searchText&&(__p+='<div class="tooltip_bottom"><a class="call_to_action" href="'+(null==(__t=searchLink)?"":_.escape(__t))+'"><span class="icon_search tooltip_left"></span>'+(null==(__t=searchText)?"":_.escape(__t))+' <span class="icon_arrow_carrot_right tooltip_right"></span></a></div>'),__p+="</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],190:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),r=t("../templates/dot-tooltip.tpl"),a=t("app/models/tumblelog"),l=t("app/components/dialog"),h=o.extend({class_name:"tumblr_tooltip",template:r,events:{"click .follow":"follow","click .item":"posts_click"},defaults:{selector:"",class_name:"",offset:"50%",placement:"up"},initialize:function(t){this.options=t||{},this.options.selector=i.trim((t.selector||this.defaults.selector)+" "),this.options.class_name=t.class_name||this.defaults.class_name,this.options.offset=t.offset||this.defaults.offset,this.options.placement=t.placement||this.defaults.placement,this.tooltips=i(this.options.selector+"[data-tooltip]"),this.tooltips.on("mouseenter.tumblr_dot_link",s.bind(this.show,this)),this.tooltips.on("mouseleave.tumblr_dot_link",s.bind(this.hide,this)),this.tooltips.on("click.blog",s.bind(this.click_thru,this)),this.tooltips.on("click.tooltip",".new_tooltip_bottom",s.bind(this.click_tooltip_search,this)),this.tooltips.on("remove",i.proxy(this.remove,this))},show:function(t){var e=i(t.currentTarget);this.$dot=e,this.tooltip_template_data={tooltip:e.data("tooltip"),tooltip_search_text:e.data("tooltip-search-text"),tooltip_link:e.find(".tumblr_dot_link").attr("href"),premium:e.data("tooltip-premium")||"",premium_url:e.data("tooltip-premium-url")||"",premium_name:e.data("tooltip-premium-name")||"",premium_title:e.data("tooltip-premium-title")||"",premium_avatar_url:e.data("tooltip-premium-avatar")||"",premium_following:e.data("tooltip-premium-is_following")||""},this.is_premium=this.tooltip_template_data.premium,this.is_premium&&(this.model=this.model||new a({name:this.tooltip_template_data.premium_name,pt:e.data("pt")}));var s=i(this.tooltip(this.tooltip_template_data));e.append(s),this.setElement(s),this.delegateEvents(),s.removeClass("is_closed").addClass("is_open"),n.trigger("useraction:hover:dot",this.ads_generate_payload("hover"))},hide:function(t){var e=i(t.currentTarget),o=e.find("."+this.class_name);o.removeClass("is_open").addClass("is_closed"),o.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",s.bind(function(t){this.remove(t)},this))},remove:function(t){i(t.currentTarget).remove()},posts_click:function(t){n.trigger("useraction:click:dot_blog",this.ads_generate_payload("posts")),t.preventDefault(),i(t.target).hasClass("follow_icon")||n.trigger("temp:peepr:open:tumblelog",this.$dot.data("tooltip-premium-name"))},click_thru:function(){n.trigger("useraction:click:dot",this.ads_generate_payload("click_thru"))},ads_generate_payload:function(t){return{loggingData:{postData:{"serve-id":this.$dot.data("serve-id"),pt:this.is_premium?this.model.get("pt"):""},userAction:t}}},follow:function(t){t.preventDefault();var e=this.$el.find(".follow");this.model.save_following({following:!0},{source:e.data("follow-source"),pt:this.model.get("pt")}).fail(function(){l.alert("Sorry, we seem to be having technical trouble. Please try again later.")}),e.addClass("follow_poof"),this.tooltip_template_data.premium_following=!0},tooltip:function(t){return this.class_name="dot_tooltip_wrapper",this.attributes={text:t.tooltip,placement:this.options.placement,class_name:this.options.class_name,left_css:this.options.offset,searchText:t.tooltip_search_text,searchLink:t.tooltip_link,premium:t.premium,url:t.premium_url,name:t.premium_name,title:t.premium_title,avatar_url:t.premium_avatar_url,following:t.premium_following},this.template(this.attributes)},click_tooltip_search:function(){n.trigger("Capture:push","tumblr_dot_usage","click",{click_location:"tooltip_search"})}});e.exports=h},{"../templates/dot-tooltip.tpl":189,"app/components/dialog":12,"app/models/tumblelog":212,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/view":318}],191:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/collection"),o=t("../models/upload"),n=t("when"),r=s.extend({model:o,_listenToUploadModel:function(t){this.listenTo(t,"change",this._onUploadModelChange)},_stopListeningToUploadModel:function(t){this.stopListening(t)},_onUploadModelChange:function(t){i.has(t.changed,"complete")&&this.trigger("complete",this,t),i.has(t.changed,"error")&&t.get("error")&&this.trigger("error",this,t),i.has(t.changed,"complete")&&this.allComplete()&&this.trigger("allComplete",this)},add:function(t){return i.isArray(t)?i.forEach(t,this._listenToUploadModel,this):this._listenToUploadModel(t),s.prototype.add.apply(this,arguments)},remove:function(t){return i.isArray(t)?i.forEach(t,this._stopListeningToUploadModel,this):this._stopListeningToUploadModel(t),s.prototype.remove.apply(this,arguments)},removeIncomplete:function(t){var e=this.where({uploading:!1,complete:!1});return this.remove(e,t)},removeFailed:function(t){var e=this.filter(function(t){return t.get("error")});return this.remove(e,t)},allComplete:function(){return this.length?this.every(function(t){return t.get("complete")}):!1},getProgress:function(){var t=0,e=0;return this.forEach(function(i){i.get("error")&&(t+=i.get("bytesLoaded")||0,e+=i.get("bytesTotal")||0)}),e?t/e:0},promise:function(){if(this.allComplete())return n.resolve(this);var t=n.promise(i.bind(function(t,e){var s,o;s=i.bind(function(){this.stopListening(this,"uploads:allComplete",s),this.stopListening(this,"uploads:error",o),t.apply(this,arguments)},this),o=i.bind(function(){this.stopListening(this,"uploads:allComplete",s),this.stopListening(this,"uploads:error",o),e.apply(this,arguments)},this),this.listenToOnce(this,"uploads:allComplete",s),this.listenToOnce(this,"uploads:error",o)},this));return t}});e.exports=r},{"../models/upload":193,lodash:"K2RcUv","prima/collection":259,when:"RG2dij"}],192:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/fileupload"),n=t("./collections/uploads"),r=(t("./models/upload"),s.extend({name:"Upload",initialize:function(t){t=i.extend({},t),this.collection=t.collection||(t.collection=new n),this.indexView=new o(t),this.listenTo(this.collection,"all",this._relayCollectionEvent)},_relayCollectionEvent:function(){this.trigger.apply(this,arguments)},addFiles:function(t){return this.indexView.add({files:t})},promise:function(){return this.indexView.promise()},teardown:function(){return this.remove()},remove:function(){return this.indexView.remove(),this.stopListening(),this},render:function(){return this.indexView.render(),this},getElement:function(){return this.indexView.$el}}));e.exports=r},{"./collections/uploads":191,"./models/upload":193,"./views/fileupload":194,lodash:"K2RcUv","prima/component":260}],193:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.extend({defaults:{url:"",file:null,error:!1,uploading:!1,complete:!1,bytesLoaded:0,bytesTotal:0},initialize:function(t,e){this.options=i.extend({},e),this.options.jqXHR&&this.setUploadRequest(this.options.jqXHR)},setUploadRequest:function(t){return this.jqXHR=t,t.then(function(){}),t},_uploadDone:function(){this.set({error:!1,uploading:!1,complete:!0})},_uploadFail:function(){this.set({error:!0,uploading:!1,complete:!1})},cancelUpload:function(){var t;return this.jqXHR&&(t=this.jqXHR.abort(),this.jqXHR=null),t},getProgress:function(){return this.get("bytesTotal")?this.get("bytesLoaded")/this.get("bytesTotal"):0}});e.exports=o},{lodash:"K2RcUv","prima/model":298}],194:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/mixin"),n=t("when"),r=t("prima/lib/translate"),a=t("../collections/uploads"),l=t("../models/upload"),h=t("prima/utils/recontextify"),d=t("prima/utils/getpath"),c=["add","submit","send","done","fail","always","progress","progressall","start","stop","change","paste","drop","dragover","chunksend","chunkdone","chunkfail","chunkalways"],u=["add","send","progress","active","enable","disable"],p=s.extend({tagName:"input",attributes:{type:"file"},defaults:{name:"photo",maxUploadSize:!1,uploadPattern:!1,mediaType:"image",message:{cancel:"Canceled upload",error:"Upload error",filesize:"The file is too big. Squish it down, and try again!",filetype:"This is not valid %1$s file."},fileUpload:{singleFileUploads:!0,limitConcurrentUploads:1,sequentialUploads:!1,autoUpload:!0,formData:[],dataType:"json",dropZone:null,pasteZone:null}},_createUploadModel:function(t){var e=new l(t);return this.collection.add(e),e},_createUploadModelForFile:function(t,e){e=i.extend({file:t},e);var s=this._createUploadModel(e);return t._uploadModel=s,s},initialize:function(t){if(this.options=i.merge({},this.defaults,t),this.options.url&&(this.options.fileUpload.url=this.options.url),this.collection=this.options.collection?this.options.collection:new a,!this.options.fileUpload.url)throw new Error("Upload requires an endpoint URL");this.$el.prop("tabindex",-1),this.options.fileUpload.multiple&&this.$el.prop("multiple",!0),this.options.accept&&this.$el.prop("accept",this.options.accept);var e=i.merge({},this._fileUploadWrap);i.forEach(c,function(t){i.isFunction(e.defaults[t])||(e.defaults[t]=i.noop)},this);var s=new o(e);s.applyTo(this.options.fileUpload),i.forEach(c,function(t){this.options.fileUpload[t]=h(this.options.fileUpload[t],this)},this),this.$el.attr("name",this.options.name).fileupload(this.options.fileUpload),this._fileUpload=this.$el.data("blueimp-fileupload"),i.forEach(u,function(t){this[t]=function(){var e=i.toArray(arguments);e.unshift(t),this._fileUploadInvoke.apply(this,e)}},this)},_fileUploadInvoke:function(t){return this._fileUpload[t].apply(this._fileUpload,i.rest(arguments))},validateFile:function(t,e){e||(e=this.options);var s=[];return e.maxUploadSize&&t.size>e.maxUploadSize&&s.push({type:"filesize",message:i.sprintf(e.message.filesize,e.maxUploadSize)}),e.uploadPattern&&t.type&&!e.uploadPattern.test(t.type)&&s.push({type:"filetype",message:i.sprintf(e.message.filetype,e.mediaType)}),s},upload:function(t){this.add({files:[t]})},cancel:function(){var t;return this.jqXHR?(t=this.jqXHR.abort(),this.jqXHR=null):t=n.reject(this.options.message.cancel),t},_forMatchingFiles:function(t,e){var s=i.rest(arguments);this.collection.forEach(function(o){if(i.contains(t,o.get("file"))){var n=i.clone(s);n[0]=o,e.apply(this,n)}},this)},promise:function(){return this.collection.promise()},_fileUploadWrap:{defaults:{change:function(t){this._fileUpload.options.replaceFileInput&&this.setElement(t)},add:function(t,e,s){var o=s.files[0],n=this.validateFile(o),r=this._createUploadModelForFile(o);if(!i.isEmpty(n)){var a={errorType:"validation",messages:n,file:o};return this.collection.trigger("invalid",a),r.set("error",i.pluck(n,"message")),this.trigger("error",a),!1}}},before:{},after:{done:function(t,e,s){var o,n=d(s,"result.meta.status"),a=d(s,"result.response"),l=d(s,"result.errors");if(200!==n||i.isEmpty(a)){var h=function(){return a&&a.msg?a.msg:i.isArray(l)?i.isEmpty(l)?r("Woops :("):l:l.join(" ")}();o={error:h,uploading:!1}}else i.isArray(a)&&(a=a[0]),o=i.extend({complete:!0,uploading:!1},a);this._forMatchingFiles(s.files,function(t,e){t.set(e)},o)},fail:function(t,e,i){var s;s="abort"===i.errorThrown?{uploading:!1}:{error:this.options.message.error,uploading:!1},this._forMatchingFiles(i.files,function(t,e){t.set(e)},s)},progress:function(t,e,i){this._forMatchingFiles(i.files,function(t,e){t.set(e)
},{bytesLoaded:i.loaded,bytesTotal:i.total})}},around:{add:function(t,e,s,o){var n=t.apply(this,i.rest(arguments));return n===!1||s.isDefaultPrevented()?!1:((o.autoUpload||o.autoUpload!==!1&&this._fileUpload.options.autoUpload)&&o.process().done(i.bind(function(){this.jqXHR=o.submit()},this)),n)},send:function(t,e,s,o){o.with_form_key=!0;var n=t.apply(this,i.rest(arguments));if(n){this._forMatchingFiles(o.files,function(t,e){t.set(e)},{uploading:!0});var r={files:o.files};this.collection.trigger("send",r),this.trigger("send",r)}return n}}}});e.exports=p},{"../collections/uploads":191,"../models/upload":193,lodash:"K2RcUv","prima/lib/mixin":286,"prima/lib/translate":288,"prima/utils/getpath":308,"prima/utils/recontextify":314,"prima/view":318,when:"RG2dij"}],195:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/webcam"),n=t("./utils/get_user_media"),r=s.extend({name:"Webcam",initialize:function(t){this.options=t=i.extend({},t),this.indexView=new o(t),this.listenTo(this.indexView,"all",this._relayViewEvent);var e=["teardown","render","remove"].concat(r.prototype.commands||[]);i.forEach(e,function(t){var e=this.indexView;this[t]=function(){return e[t].apply(e,arguments),this}},this)},_relayViewEvent:function(){this.trigger.apply(this,arguments)},getElement:function(){return this.indexView.$el},getHeightForWidth:function(t){return this.indexView.get("width")?t*this.indexView.get("height")/this.indexView.get("width"):0}},{hasUserMediaSupport:function(){return!!n}});e.exports=r},{"./utils/get_user_media":201,"./views/video_stream":203,"./views/webcam":204,lodash:"K2RcUv","prima/component":260}],196:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-js-inner class="countdown-timer--inner"><div data-js-ticks class="countdown-timer--ticks"></div><div data-js-inner class="countdown-timer--fill"><div class="mask-static-half"><div class="fill"></div></div><div class="mask-rotating-half"><div data-js-rotator class="fill"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],197:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<video class="video-stream--video" width="'+(null==(__t=retina?2*width:width)?"":_.escape(__t))+'" height="'+(null==(__t=retina?2*height:height)?"":_.escape(__t))+'"></video><div data-js-novideo class="video-stream--no-video"><div data-subview="loader"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],198:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-sizer class="webcam--sizer" style="padding-top:'+(null==(__t=ratio)?"":_.escape(__t))+'"><div class="webcam--container"><div data-js-videostreamcontainer class="webcam--container-layer"><div data-subview="videoStream"></div></div><div data-js-previewcontainer class="webcam--container-layer" style="display:'+(null==(__t=showPreviewContainer?"block":"none")?"":_.escape(__t))+'"><canvas data-js-canvas width="'+(null==(__t=retina?2*width:width)?"":_.escape(__t))+'" height="'+(null==(__t=retina?2*height:height)?"":_.escape(__t))+'" class="webcam--canvas"></canvas></div><div data-js-controlcontainer class="webcam--container-layer"><div data-subview="webcamControls"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],199:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-overlaybuttons class="media-overlay">',enableFlash&&(__p+='<div data-js-flashbutton class="button webcam--flash-button '+(null==(__t=flash?"active":"")?"":_.escape(__t))+'"><div class="icon"></div></div>'),__p+="",enableRemove&&(__p+='<div data-subview="removeButton"></div>'),__p+='</div><div data-js-primarybutton class="big-button webcam--primary-button"><div data-js-snapbuttongroup="countdownTimer" class="big-button-group"><div data-subview="countdownTimer"></div></div><div data-js-snapbuttongroup="snapButton" class="big-button-group"><div data-js-snapbutton class="button webcam--snap-button"><div class="icon"></div></div>',enableGifMode&&(__p+='<div data-js-gifbutton class="button webcam--gif-button"><div class="icon"></div></div>'),__p+='</div><div data-js-snapbuttongroup="processing" class="big-button-group"><div data-js-processingbutton class="button webcam--processing-button"><div class="icon"></div></div></div><div data-js-snapbuttongroup="retakeButton" class="big-button-group"><div data-js-retakebutton class="button webcam--retake-button"><div class="icon"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],200:[function(t,e){"use strict";var i=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL;e.exports=i},{}],201:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery").browser,o=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;s.mozilla&&Math.floor(s.version)>=20&&(o=navigator.mozGetUserMedia),o&&(o=i.bind(o,navigator)),e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],202:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").hook,r=t("velocity-animate").animate,a=t("prima/view"),l=t("prima/mixins/accessor"),h=t("prima/mixins/subviewable"),d=t("prima/mixins/selectorcache"),c=t("../templates/countdown_timer.tpl"),u=a.extend({className:"countdown-timer",template:c,mixins:[l,h,d],defaults:{duration:3e3,ticks:1},initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults)))},start:function(t,e){i.isNumber(t)||(t=this.get("duration")),i.isNumber(e)||(e=this.get("ticks")),this.set({duration:t,ticks:e}),this._generateTickMarks(e),this.stop(),this.trigger("countdown:start"),this.js$("inner").removeClass("half-past"),this._halfPastTimeout=i.delay(i.bind(function(){this.js$("inner").addClass("half-past")},this),Math.floor(t/2));var s=0;return o.join(o.promise(i.bind(function(o){clearInterval(this._tickerInterval),this._tickerInterval=setInterval(i.bind(function(){this.trigger("countdown:tick",s++,e),s>=e&&(clearInterval(this._tickerInterval),o())},this),t/e)},this)),r(this.js$("rotator"),{rotateZ:["360deg","0deg"]},{easing:"linear",duration:t})).then(i.bind(function(){this.trigger("countdown:complete")},this))},stop:function(){clearTimeout(this._halfPastTimeout),clearInterval(this._tickerInterval),r(this.js$("rotator"),"stop")},teardown:function(){return clearTimeout(this._halfPastTimeout),clearInterval(this._tickerInterval),this.stopListening(),this},remove:function(){return this.teardown(),a.prototype.remove.apply(this,arguments)},_generateTickMarks:function(t){i.isNumber(t)||(t=this.get("ticks")),this.js$("ticks").empty(),t>1&&i.forEach(i.range(t),function(e){var i=s('<div class="countdown-timer--tick"></div>');n(i,"rotateZ",360*e/t+"deg"),n(i,"translateY","-50%"),this.js$("ticks").append(i)},this)},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this._generateTickMarks(),this.attachSubViews(),this}});e.exports=u},{"../templates/countdown_timer.tpl":196,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318,"velocity-animate":"lWl/mc",when:"RG2dij"}],203:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("velocity-animate").animate,n=t("prima/view"),r=t("../utils/create_object_url"),a=t("../utils/get_user_media"),l=t("prima/mixins/accessor"),h=t("prima/mixins/subviewable"),d=t("prima/mixins/selectorcache"),c=t("../templates/video_stream.tpl"),u=t("components/knight-rider-loader"),p=n.extend({className:"video-stream",template:c,mixins:[l,h,d],defaultOptions:{video:!0,audio:!1},defaults:{width:500,height:375,retina:!0,mirrored:!0,needsPermission:!0,running:!1},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults)))},_onChangeRetina:function(t,e){this.$video.attr(e?{width:2*this.get("width"),height:2*this.get("height")}:{width:this.get("width"),height:this.get("height")})},_onChangeMirrored:function(t,e){this.$el.toggleClass("mirrored",e)},_onChangeRunning:function(t,e){this.loader&&this.loader.set("animate",!e),o(this.js$("noVideo"),"stop"),o(this.js$("noVideo"),{opacity:e?0:1},{display:e?"none":"block",delay:e?50:0,duration:100})},startStream:function(){if(!a)throw new Error("VideoStream: Cannot initialize without getUserMedia support");return a(i.pick(this.options,["audio","video"]),i.bind(this._onStreamReady,this),i.bind(this._onStreamError,this))},stopStream:function(){this.set("running",!1),this.streamURL=null,this.stream&&(this.stream.stop(),this.stream=null)},_onStreamReady:function(t){this.set("needsPermission",!1),this.stream=t,this.streamURL=r(this.stream),this._playVideoSteam()},_onStreamError:function(t){this.stopStream(),this.trigger("error",t)},_playVideoSteam:function(){this.video&&this.streamURL&&(this.video.src=this.streamURL,this.$video.one("loadeddata",i.bind(function(){this.set("running",!0)},this)),this.video.play())},remove:function(){s(this.video).remove(),n.prototype.apply(this,arguments)},teardown:function(){return this.stopStream(),this.stopListening(),this},beforeRender:function(){this.loader=this.subViews.loader=new u({loading:!this.get("running")}),this.listenTo(this,"change:retina",this._onChangeRetina),this.listenTo(this,"change:mirrored",this._onChangeMirrored),this.listenTo(this,"change:running",this._onChangeRunning)},render:function(){return this._onChangeMirrored(this,this.get("mirrored")),this.$el.html(this.template(this.toJSON())),this.attachSubViews(),this.$video=this.$(".video-stream--video"),this.video=this.$video.get(0),this._playVideoSteam(),this}});e.exports=p},{"../templates/video_stream.tpl":197,"../utils/create_object_url":200,"../utils/get_user_media":201,"components/knight-rider-loader":235,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318,"velocity-animate":"lWl/mc"}],204:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").animate,r=t("prima/view"),a=t("app/vendor/gif.js"),l=t("prima/utils/image/loader"),h=t("prima/utils/image/filereader"),d=t("prima/utils/image/canvas"),c=t("prima/mixins/accessor"),u=t("prima/mixins/subviewable"),p=t("prima/mixins/selectorcache"),m=t("../templates/webcam.tpl"),g=t("./video_stream"),f=t("./webcam_controls"),_=250,v=300,b=s(document),y=r.extend({className:"webcam",template:m,mixins:[c,u,p],defaults:{width:500,height:375,retina:!0,mirrored:!0,enabled:!0,needsPermission:!0,showControls:!1,flash:!0,showPreviewContainer:!1,defaultTimer:3e3,timePerFrame:1e3,gifFrameCount:4,gifSpeed:200,enableFlash:!0,enableGifMode:!0,enableRemove:!0},commands:["toggleFlash","toggleMirrored","snap","gif","flash","gifStart","gifSnap","gifComplete","retake","close"],initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this._WebcamControlsView=t.WebcamControlsView||f},_onChangeEnabled:function(t,e){e?this.videoStream.startStream():this.videoStream.stopStream()},_onChangeNeedsPermission:function(t,e){var i=200;e||clearTimeout(this._delayedPermissionCheck),n(this.$arrow,"stop"),n(this.$arrow,{opacity:e?1:0},{display:e?"block":"none",duration:i})},_onChangeShowControls:function(t,e){var i=200;n(this.js$("controlContainer"),"stop"),n(this.js$("controlContainer"),{opacity:e?1:0},{display:e?"block":"none",duration:i})},_onChangeShowPreviewContainer:function(t,e){e?this.js$("previewContainer").css("display","block"):(this.js$("previewContainer").children("img").remove(),this.js$("previewContainer").css("display","none"))},startStream:function(){this.set("enabled",!0)},stopStream:function(){this.set("enabled",!1)},snap:function(t){this._snapFrame(t).then(i.bind(function(t){this.set("showPreviewContainer",!0),this.trigger("webcam:image",t),this.webcamControls.trigger("webcam:snapped")},this))},gif:function(t,e){i.isNumber(t)||(t=this.get("gifFrameCount")),i.isNumber(e)||(e=this.get("timePerFrame")),this.gifStart();var s=0;clearInterval(this._gifInterval),this._gifInterval=setInterval(i.bind(function(){s++,this.gifSnap(s>=t),s>=t&&clearInterval(this._gifInterval)},this),e)},gifStart:function(){this._frameBuffer=[]},gifSnap:function(t,e){this._snapFrame(e).then(i.bind(function(){var e=this.js$("canvas"),i=e.get(0),s=document.createElement("canvas");s.width=.5*(i.width||e.width()),s.height=.5*(i.height||e.height()),d.drawElToCanvas(this.js$("canvas"),s),this._frameBuffer.push(s),t&&this.gifComplete()},this))},gifComplete:function(t){i.isNumber(t)||(t=this.get("gifSpeed"));var e=new a({workers:3,quality:1});i.forEach(this._frameBuffer,function(i){e.addFrame(i,{delay:t})},this),e.on("finished",i.bind(function(t){h.read(t).then(i.bind(function(t){l.load(t.base64).then(i.bind(function(t){var e=s('<img data-js-gif class="webcam--preview-image"/>');e.attr("src",t.src),this.js$("previewContainer").append(e),i.extend(t,{base64:t.src,isGif:!0}),this.trigger("webcam:image",t),this.webcamControls.showSnapButtonGroup("retakeButton"),this.set("showPreviewContainer",!0)},this))},this))},this)),e.render(),delete this._frameBuffer},retake:function(){this.set("showPreviewContainer",!1),this.trigger("webcam:reset")},close:function(){this.trigger("webcam:close")},_snapFrame:function(t){!i.isUndefined(t)||(t=this.get("flash"));var e=i.bind(this.flash,this),s=i.bind(this.grabVideoFrame,this);return o.promise(function(o){t?(e(),i.delay(function(){o(s())},.5*v)):o(s())})},grabVideoFrame:function(){d.drawElToCanvas(this.videoStream.video,this.js$("canvas"),this.get("mirrored"));var t=this.js$("canvas").get(0);return t?{width:t.width,height:t.height,base64:t.toDataURL("image/jpeg")}:{width:0,height:0,base64:null}},toggleFlash:function(t){!i.isUndefined(t)||(t=!this.get("flash")),this.set("flash",t)},toggleMirrored:function(t){!i.isUndefined(t)||(t=!this.get("mirrored")),this.set("mirrored",t)},flash:function(){return n(this.$flash,"stop"),this.$flash.css({display:"block",opacity:1}),n(this.$flash,{opacity:[0,1]},{display:"block",delay:v,duration:_}).then(i.bind(function(){this.$flash.css("display","none")},this))},_checkVideoStreamPermissions:function(){this._delayedPermissionCheck=i.delay(i.bind(function(){this.get("needsPermission")&&this._onChangeNeedsPermission(this,!0)},this),1e3),this.get("needsPermission")?(this.js$("controlContainer").css({display:"none",opacity:0}),this.listenToOnce(this.videoStream,"change:needsPermission",function(t,e){this.set("needsPermission",e)}),this.listenToOnce(this.videoStream,"change:running",function(t,e){clearTimeout(this._delayedPermissionCheck),e&&(this.set("needsPermission",!1),this.set("showControls",!0))})):this.set("showControls",!0)},serialize:function(){var t=this.toJSON();return t.ratio=(t.width?t.height/t.width*100:0)+"%",t},teardown:function(){return clearInterval(this._gifInterval),clearTimeout(this._delayedPermissionCheck),b.off("keydown.webcam keyup.webcam"),this.stopListening(),this.$flash&&this.$flash.remove(),delete this.$flash,this.$arrow&&this.$arrow.remove(),delete this.$arrow,this},remove:function(){return this.teardown(),r.prototype.remove.apply(this,arguments)},beforeRender:function(){var t=i.pick(this.attributes,i.keys(g.prototype.defaults)),e=i.pick(this.attributes,i.keys(this._WebcamControlsView.prototype.defaults));this.videoStream=this.subViews.videoStream=new g(t),this.webcamControls=this.subViews.webcamControls=new this._WebcamControlsView(e),this.$flash=s('<div class="webcam--flash"></div>').appendTo("body"),this.$arrow=s('<div class="webcam--permission-arrow"></div>').appendTo("body"),s.browser.mozilla&&this.$arrow.addClass("firefox"),this.set("needsPermission",!this.videoStream.get("running")),this.listenTo(this,"change:enabled",this._onChangeEnabled),this.listenTo(this,"change:needsPermission",this._onChangeNeedsPermission),this.listenTo(this,"change:showControls",this._onChangeShowControls),this.listenTo(this,"change:showPreviewContainer",this._onChangeShowPreviewContainer),this.listenTo(this.videoStream,"error",function(){this.close()}),this.listenTo(this,"change:flash",function(t,e){this.webcamControls.set("flash",e)}),this.listenTo(this,"change:mirrored",function(t,e){this.videoStream.set("mirrored",e),this.webcamControls.set("mirrored",e)}),this.listenTo(this.webcamControls,"webcam",function(t){if(i.contains(this.commands,t)){var e=this[t];i.isFunction(e)&&e.apply(this,i.rest(arguments))}}),b.on("keydown.webcam keyup.webcam",i.bind(function(t){switch(t.which||t.keyCode){case 16:this.set("flash","keyup"===t.type);break;case 18:"keydown"===t.type&&t.metaKey&&this.toggle("mirrored");break;case 91:case 92:case 93:"keydown"===t.type&&t.altKey&&this.toggle("mirrored")}},this))},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this._checkVideoStreamPermissions(),this.get("enabled")&&this.videoStream.startStream(),this}});e.exports=y},{"../templates/webcam.tpl":198,"./video_stream":203,"./webcam_controls":205,"app/vendor/gif.js":215,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/utils/image/canvas":310,"prima/utils/image/filereader":311,"prima/utils/image/loader":312,"prima/view":318,"velocity-animate":"lWl/mc",when:"RG2dij"}],205:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate").hook,o=t("velocity-animate").animate,n=t("prima/view"),r=t("prima/mixins/accessor"),a=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("./countdown_timer"),d=t("app/components/remove-button"),c=t("../templates/webcam_controls.tpl"),u=n.extend({className:"webcam-controls",template:c,events:{mouseenter:"_onHoverControls",mouseleave:"_onHoverControls","click [data-js-flashButton]":"_onClickFlashButton","click [data-js-snapButton]":"_onClickSnapButton","click [data-js-gifButton]":"_onClickGifButton","click [data-js-retakeButton]":"_onClickRetakeButton"},mixins:[r,a,l],defaults:{isActive:!1,flash:!0,mirrored:!0,defaultTimer:3e3,timePerFrame:1e3,gifFrameCount:4,enableFlash:!0,enableGifMode:!0,enableRemove:!0},initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults)))},_onHoverControls:function(t){clearTimeout(this._removeIsActive);var e="mouseover"===t.type||"mouseenter"===t.type;e?this.set("isActive",!0):this._removeIsActive=i.delay(i.bind(function(){this.set("isActive",!1)},this),500)},_onClickFlashButton:function(){this.trigger("webcam","toggleFlash",!this.get("flash"))},_onClickSnapButton:function(t){var e=!t.altKey;this.countdownTimer.stop(),this.listenToOnce(this,"webcam:snapped",function(){this.showSnapButtonGroup("retakeButton")});var s=this.get("defaultTimer");e?(this.showSnapButtonGroup("countdownTimer",0),this.countdownTimer.start(s,1).then(i.bind(function(){this.trigger("webcam","snap")},this))):this.trigger("webcam","snap")},_onClickGifButton:function(){this.countdownTimer.stop(),this.trigger("webcam","gifStart"),this.listenTo(this.countdownTimer,"countdown:tick",function(t,e){this.trigger("webcam","gifSnap",t+1>=e),e>t+1&&this.pulseButton()});var t=this.get("gifFrameCount"),e=this.get("timePerFrame");this.showSnapButtonGroup("countdownTimer",0),this.countdownTimer.start(t*e,t).then(i.bind(function(){this.stopListening(this.countdownTimer,"countdown:tick"),this.showSnapButtonGroup("processing")},this))},_onClickRetakeButton:function(){this.showSnapButtonGroup("snapButton"),this.trigger("webcam","retake")},pulseButton:function(){var t=1.5;s(this.js$("primaryButton"),"translateX","-50%"),s(this.js$("primaryButton"),"scale",t),o(this.js$("primaryButton"),"stop"),o(this.js$("primaryButton"),{scale:[1,t]},{duration:200})},showSnapButtonGroup:function(t,e){i.isNumber(e)||(e=100);var s=this.js$("snapButtonGroup").filter('[data-js-snapButtonGroup="'+t+'"]');if(!i.isEmpty(s)){var n=this.js$("snapButtonGroup").not(s);o(s,"stop"),o(n,"stop"),o(this.js$("primaryButton"),"stop"),o(s,{opacity:1},{display:"block",duration:e}),o(n,{opacity:0},{display:"none",duration:e}),this.js$("primaryButton").toggleClass("invert","processing"===t);var r=60;"snapButton"===t&&this.get("enableGifMode")&&(r=150),o(this.js$("primaryButton"),{width:r},{display:"block",duration:e})}},serialize:function(){return this.toJSON()},teardown:function(){return this},beforeRender:function(){this.countdownTimer=this.subViews.countdownTimer=new h,this.listenTo(this,"change:flash",function(t,e){this.js$("flashButton").toggleClass("active",e)}),this.removeButton=this.subViews.removeButton=new d({buttonClass:"active",onClick:i.bind(function(){this.trigger("webcam","close")},this)}),this.listenTo(this,"change:isActive",function(t,e){this.js$("overlayButtons").toggleClass("active",e)})},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this.showSnapButtonGroup("snapButton",0),this}});e.exports=u},{"../templates/webcam_controls.tpl":199,"./countdown_timer":202,"app/components/remove-button":182,lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318,"velocity-animate":"lWl/mc"}],"6dWAyf":[function(t,e){"use strict";var i=t("app/lib/currentuser"),s=t("app/router"),o=s.extend({routes:{},initialize:function(){this.user=i()}});e.exports=o},{"app/lib/currentuser":209,"app/router":214}],context:[function(t,e){e.exports=t("6dWAyf")},{}],208:[function(t,e){"use strict";var i=t("prima/utils/exposer");i({"Tumblr.Prima.Upload":t("app/components/upload"),"Tumblr.Prima.Ligature":t("ligature"),"Tumblr.Events":t("prima/events"),"Tumblr.Prima.Events":t("prima/events"),"Tumblr.Prima.Dialog":t("app/components/dialog"),"Tumblr.Dialog":t("app/components/dialog"),"Tumblr.PostMessageChannel":t("components/post_message_channel"),"Tumblr.Prima.DOMEventor":t("prima/lib/domeventor"),"Tumblr.Prima.gutterMediaManager":t("app/components/gutter_media_manager"),"Tumblr.Prima.Vendor.when":t("when"),"Tumblr.Prima.Vendor.sequence":t("when/sequence"),"Tumblr.log_lady":t("prima/lib/loglady"),"Tumblr.Prima.logLady":t("prima/lib/loglady"),"Tumblr.Prima.Models.Post":t("app/models/post"),"Tumblr.Prima.Models.Tumblelog":t("app/models/tumblelog"),"Tumblr.Prima.CrtPlayer":t("components/crt/player"),"Tumblr.Prima.BlogCard":t("app/components/blog_card"),"Tumblr.Prima.Url":t("prima/utils/url"),ace:t("app/vendor/ace"),"Tumblr.Prima.ToolTip":t("app/components/tooltip"),"Tumblr.Prima.SharePopover":t("components/popover/views/share-popover"),"Tumblr.Prima.utils.caniuse":t("prima/utils/caniuse"),"Tumblr.Prima.PostModerationPopover":t("components/popover/views/post_moderation_popover")}),e.exports=i},{"app/components/blog_card":3,"app/components/dialog":12,"app/components/gutter_media_manager":20,"app/components/tooltip":188,"app/components/upload":192,"app/models/post":211,"app/models/tumblelog":212,"app/vendor/ace":"4e8++S","components/crt/player":218,"components/popover/views/post_moderation_popover":242,"components/popover/views/share-popover":243,"components/post_message_channel":244,ligature:325,"prima/events":261,"prima/lib/domeventor":265,"prima/lib/loglady":280,"prima/utils/caniuse":302,"prima/utils/exposer":307,"prima/utils/url":317,when:"RG2dij","when/sequence":335}],209:[function(t,e){"use strict";var i,s=t("app/models/user"),o=t("prima/lib/data"),n=function(){if(null==i){var t=o.get("Context/userinfo");i=t&&t.name?new s(t):!1}return i};e.exports=n},{"app/models/user":213,"prima/lib/data":263}],210:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/mixin"),n=new o({setUpSelector:function(t){t.on("change",s.bind(this.__select_change,this))},__select_change:function(t){var e=i(t.currentTarget);this.__update_select(e)},__update_select:function(t){var e=t.siblings("label");e.text(t.find(":selected").text())}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/mixin":286}],211:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/model"),n=t("prima/events"),r=t("app/models/tumblelog"),a=t("app/components/dialog"),l=t("app/components/post-embed-code"),h=t("prima/lib/translate"),d=o.extend({defaults:{},endpoints:{like:"/svc/like",unlike:"/svc/unlike",reblog:"/fast_reblog",reply:"/svc/reply",publish:"/publish",queue:"/publish",destroy:"/svc/post/delete",promote:"/svc/promote",unpromote:"/svc/unpromote",answer:"/answer",deny:"/deny_submission",approve:"/approve_submission",remove_source:"remove_app_attribution"},initialize:function(){this._setTumblelog(),this._setReblogTumblelog()},_setTumblelog:function(){this.tumblelog=new r(i({name:this.get("tumblelog"),ignoring:!1,sponsor:this.get("sponsored"),following:this.get("following")}).omit(i.isUndefined).omit(i.isNull).value())},_setReblogTumblelog:function(){var t=this.get("reblog_source");t&&t.name&&(this.reblogTumblelog=new r(i({name:t.name,ignoring:!1,following:t.following}).omit(i.isUndefined).omit(i.isNull).value()))},_xhrRequest:function(t,e,o){o.init&&o.init();var n=s.ajax({data:e,type:"POST",url:t,with_form_key:!0});return n.done(i.bind(function(t){o[200]&&o[200].call(this,t)},this)),n.fail(i.bind(function(t){o[t.status]&&o[t.status].call(this,t.status)},this)),n.always(i.bind(function(){o.always&&o.always()},this)),n},_xhrSuccess:function(t){this.trigger(t+":success")},_xhrFailure:function(t){var e=new a;e.alert(h("Sorry, we seem to be having technical trouble.  Please try again later.")),this.trigger(t+":failure")},save:function(t,e,s){if(s||(s={}),this.endpoints[t]){var o={200:i.bind(this._xhrSuccess,this,t),401:i.bind(this._xhrFailure,this,t),404:i.bind(this._xhrFailure,this,t),403:i.bind(this._xhrFailure,this,t),500:i.bind(this._xhrFailure,this,t)};return this._xhrRequest(this.endpoints[t],e,i.defaults(s,o))}throw new Error("Missing endpoint url for "+t)},like:function(t){if(!this.get("is_mine")){if(this.get("liked")===!1){this.set("liked",!0);var e=this.likePayload(t,this.getLikeSource("like"));this.save("like",{data:e})}this.trigger("like:set",this),n.trigger("post:like:set",this.get("id"))}},unlike:function(){if(this.get("liked")===!0){this.set("liked",!1);var t=this.likePayload("mouse",this.getLikeSource("unlike"));this.save("unlike",{data:t})}this.trigger("unlike:set",this),n.trigger("post:unlike:set",this.get("id"))},toggleLike:function(){this.get("liked")?this.unlike():this.like()},getLikeSource:function(t){t=t||"like";var e="LIKE_";switch(t){case"unlike":e="UNLIKE_";break;case"reply":e="REPLY_";break;case"ignore":e="IGNORE_"}var i=location.pathname;return i.match(/^\/dashboard/)?e+"SOURCE_DASHBOARD":i.match(/^\/tagged/)?e+"SOURCE_TAG_PAGE":i.match(/^\/likes/)?e+"SOURCE_LIKES_PAGE":i.match(/^\/inbox/)?e+"SOURCE_INBOX":i.match(/^\/search/)?e+"SOURCE_SEARCH_RESULTS_PAGE":i.match(/^\/indash_blog\/peepr/)?e+this.getPeeprSource():e+"SOURCE_UNKNOWN"},getPeeprSource:function(){if(window.parent&&window.parent.location){var t=window.parent.location.pathname;if(t.match(/search/))return"SOURCE_SEARCH_PEEPR"}return"SOURCE_PEEPR"},getEmbedCode:function(t,e){var i={tumblelog_name:this.tumblelog?this.tumblelog.get("name"):"",post_id:this.get("id"),post_url:this.get("post_url")};t&&(i.language=t),e&&(i.width=e);var s=new l(i);return s.getCode()},likePayload:function(t,e){return t=t||"mouse",e=e||"LIKE_SOURCE_UNKNOWN",{id:this.get("id"),root_id:this.get("root_id"),key:this.get("reblog_key"),method:t,source:e,placement_id:this.get("placement_id")||!1,is_recommended:this.get("is_recommended")||"",pt:this.get("pt")}},reblog:function(t){t||(t={}),t=i.extend({oldPostFormData:{pt:this.get("pt"),type:this.get("type"),reblog_id:this.get("id"),detached:!0,reblog:!0,reblog_key:this.get("reblog_key")}},t,{reblogId:this.get("id"),reblogKey:this.get("reblog_key")}),n.trigger("postForms:reblog",t)},fastReblog:function(t){t||(t=!1),this.trigger("fastreblog:success",t);var e={reblog_key:this.get("reblog_key"),reblog_post_id:this.get("id"),queue:t,pt:this.get("pt")},s={200:i.bind(function(t){this.set("reblogged",!0),this.trigger("fastreblog:ajax:success",t.response)},this)};this.save("reblog",e,s)},reply:function(t){var e={reply_text:t,post_id:this.get("id"),tumblelog:this.get("tumblelog"),tumblelog_key:this.get("tumblelog_key"),source:this.getLikeSource("reply")},s={200:i.bind(function(){this.trigger("replied")},this)};return this.save("reply",{data:e},s)},destroy:function(){var t={post_id:this.get("id"),channel_id:this.get("tumblelog")};this.save("destroy",t)},publish:function(){this.save("publish",{id:this.get("id")})},promote:function(t){var e={tag:t,post_id:this.get("id"),reblog_key:this.get("reblog_key"),tumblelog_name:this.get("tumblelog")};return this.save("promote",e)},unpromote:function(t){var e={tag_id:t,post_id:this.get("id"),reblog_key:this.get("reblog_key"),tumblelog_name:this.get("tumblelog")};return this.save("unpromote",e)},queue:function(){var t={id:this.get("id"),queue:"queue"};this.save("queue",t)},removeSource:function(){var t={post_id:this.get("id"),tumblelog_id:this.get("tumblelog")};return this.save("remove_source",t)},approve:function(t){var e={id:this.get("id"),queue:t};return this.save("approve",e)},deny:function(){return this.save("deny",{pid:this.get("id")})},answer:function(t){var e={post_id:this.get("id"),tumblelog:this.get("tumblelog"),key:this.get("tumblelog_key"),answer_text:t};return this.save("answer",e)},embedFocus:function(){this.trigger("embed:focus",this)},updateReblogControl:function(t){this.trigger("reblog:success",t)},dismiss:function(){this.trigger("dismiss",this)}});e.exports=d},{"app/components/dialog":12,"app/components/post-embed-code":38,"app/models/tumblelog":212,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/lib/translate":288,"prima/model":298}],212:[function(t,e){"use strict";function i(t,e,i){var s=n.Deferred(),o={data:{tumblelog:t.get("name")}};i.placement_id&&(o.data.placement_id=i.placement_id),i.pt&&(o.data.pt=i.pt),i.source&&(o.data.source=i.source),i.context&&(o.data.context=i.context),i.tlt&&(o.data.tlt=i.tlt);var r=function(){i.wait||t.set({following:e.following},i)},a=function(o,n){i.wait||t.set({following:!e.following},i),s.reject(n)},l=function(){i.wait&&t.set({following:e.following},i),s.resolve()},h=e.following?"/svc/follow":"/svc/unfollow";return n.ajax({beforeSend:r,cache:!i.force,data:o,error:a,type:"POST",success:l,url:h,with_form_key:!0}),s.promise()}function s(t,e){var i=n.Deferred(),s={};r.has(e,"is_tumblelog_popover")&&(s.is_tumblelog_popover=e.is_tumblelog_popover),r.has(e,"is_user_mention")&&(s.is_user_mention=e.is_user_mention);var o=function(t,e){i.reject(e)},a=function(e){r.has(e,"highlighted_posts")||(e={highlighted_posts:e}),t.set(e),i.resolve()};return n.ajax({cache:!e.force,data:s,error:o,type:"GET",success:a,url:d(t),with_form_key:!0}),i.promise()}function o(t,e){return n.ajax({cache:!e.force,data:e.data,type:"GET",url:"/svc/tumblelog_popover/"+t,with_form_key:!0})}var n=t("jquery"),r=t("lodash"),a=t("when"),l=t("prima/events"),h=t("prima/singletonmodel"),d=function(){function t(t){return t.has("avatar_url")&&t.has("global_theme_params")}return function(e){return t(e)?"/svc/"+e.get("name")+"/posts/highlighted":"/svc/tumblelog_popover/"+e.get("name")}}(),c=h.extend({save_following:function(t,e){e||(e={}),t||(t={}),t.following=!!t.following;
var s=this;return e.force||s.get("following")!==t.following?i(s,t,e).then(r.bindKey(s,"save_following",t)):n.when(s.get("following"))},fetch_popover_data:function(t){t||(t={}),t.is_user_mention=!!t.is_user_mention,t.is_tumblelog_popover=!!t.is_tumblelog_popover;var e=this;return!t.force&&e.has("highlighted_posts")?n.when(e.get("highlighted_posts")):s(e,t).then(r.bindKey(e,"fetch_popover_data",void 0))},toggle_spam:function(){return n.ajax({url:"/spam/toggle",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},toggle_nsfw:function(){return n.ajax({url:"/nsfw/toggle",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},toggle_suspended:function(){return n.ajax({url:"/suspended/toggle",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},follow:function(t){this.save_following({following:!0},t)},_unfollow:function(t){this.save_following({following:!1},t)},requestUnfollow:function(t){var e=a.defer();return e.promise.then(r.bind(this._unfollow,this,t)).catch(r.noop),e},ignore:function(){return n.ajax({url:"/svc/ignore/add",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},unignore:function(){return n.ajax({url:"/svc/ignore/remove",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},defaults:null,idAttribute:"name",initialize:function(){this.bindEvents()},bindEvents:function(){var t=this.get("name");this.on("change:following",function(){if(void 0!==this.previous("following")){var e=this.get("following")?"follow":"unfollow";l.trigger("tumblelog:"+e,{loggingData:t})}},this)},parse:function(t){return t},validate:function(){return!1},destroy:function(){return this},fetch:function(){return this},save:function(){return this},url:function(){},urlRoot:function(){}},{collection:null,modelFromToken:function(t){var e,i=c.getCollection(),s=n.Deferred(),r=i.findWhere({token:t});return r?s.resolve(r):(e={data:{is_user_mention:!0}},o(t,e).then(function(e){var i=new c(e);i.set({token:t}),s.resolve(i)},function(){s.reject()})),s.promise()}});c.collection=c.getCollection(),e.exports=c},{jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/singletonmodel":300,when:"RG2dij"}],213:[function(t,e){"use strict";var i=t("prima/singletonmodel"),s=t("prima/model"),o=t("../collections/tumblelogs"),n=i.extend({idAttribute:"name",initialize:function(t){this.channels=new o(t.channels)},getChannel:function(t){return null==t&&(t=this.get("primary")),this.channels.findWhere({name:t})},toJSON:function(){var t=s.prototype.toJSON.apply(this,arguments);return t.channels=this.channels.toJSON(),t},getChannelProperty:function(t,e){var i=this.getChannel(t);if(!(i&&"get"in i))return null;var s=i.get(e);return"undefined"==typeof s?null:s}});e.exports=n},{"../collections/tumblelogs":2,"prima/model":298,"prima/singletonmodel":300}],214:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=t("prima/router"),n=t("prima/lib/data"),r=t("./bootloader"),a=o.extend({logs:function(){return i.union([t("logs/instruments/embed"),t("logs/instruments/keycommands"),t("logs/instruments/help-form"),t("logs/instruments/video-player"),t("logs/instruments/login-register"),t("logs/instruments/nitro"),t("logs/instruments/electionday")],o.prototype.logs.apply(this))},constructor:function(){o.apply(this,arguments),this.startHistory(),this.initializeApp()},getName:function(){return this.name=n.get("Context/name"),i.sprintf("Context/%s",this.name)},initializeApp:function(){t("app/components/header"),t("app/components/footer")},startHistory:function(){s.History.started||i.isEmpty(this.routes)||(this.routeFound=s.history.start({pushState:"pushState"in window.history,hashChange:!1,root:this.root}))}},{Bootloader:r});e.exports=a},{"./bootloader":1,"app/components/footer":17,"app/components/header":21,backbone:"5kFNoY",lodash:"K2RcUv","logs/instruments/electionday":248,"logs/instruments/embed":249,"logs/instruments/help-form":251,"logs/instruments/keycommands":252,"logs/instruments/login-register":253,"logs/instruments/nitro":254,"logs/instruments/video-player":255,"prima/lib/data":263,"prima/router":299}],215:[function(t,e){"use strict";var i=t("gif.js/dist/gif").GIF,s=t("./inline-worker"),o=function(t){var e=s;return t||(t={}),t.workerScript||(t.workerScript=e),new i(t)};e.exports=o},{"./inline-worker":216,"gif.js/dist/gif":320}],216:[function(t,e){var i=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL;i&&(e.exports=i(new Blob(["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n(function(b){function a(b,d){if({}.hasOwnProperty.call(a.cache,b))return a.cache[b];var e=a.resolve(b);if(!e)throw new Error('Failed to resolve module '+b);var c={id:b,require:a,filename:b,exports:{},loaded:!1,parent:d,children:[]};d&&d.children.push(c);var f=b.slice(0,b.lastIndexOf('/')+1);return a.cache[b]=c.exports,e.call(c.exports,c,c.exports,f,b),c.loaded=!0,a.cache[b]=c.exports}a.modules={},a.cache={},a.resolve=function(b){return{}.hasOwnProperty.call(a.modules,b)?a.modules[b]:void 0},a.define=function(b,c){a.modules[b]=c},a.define('/gif.worker.coffee',function(d,e,f,g){var b,c;b=a('/GIFEncoder.js',d),c=function(a){var c,e,d,f;return c=new b(a.width,a.height),a.index===0?c.writeHeader():c.firstFrame=!1,c.setTransparent(a.transparent),c.setRepeat(a.repeat),c.setDelay(a.delay),c.setQuality(a.quality),c.addFrame(a.data),a.last&&c.finish(),d=c.stream(),a.data=d.pages,a.cursor=d.cursor,a.pageSize=d.constructor.pageSize,a.canTransfer?(f=function(c){for(var b=0,d=a.data.length;b<d;++b)e=a.data[b],c.push(e.buffer);return c}.call(this,[]),self.postMessage(a,f)):self.postMessage(a)},self.onmessage=function(a){return c(a.data)}}),a.define('/GIFEncoder.js',function(e,h,i,j){function c(){this.page=-1,this.pages=[],this.newPage()}function b(a,b){this.width=~~a,this.height=~~b,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.out=new c}var f=a('/TypedNeuQuant.js',e),g=a('/LZWEncoder.js',e);c.pageSize=4096,c.charMap={};for(var d=0;d<256;d++)c.charMap[d]=String.fromCharCode(d);c.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(c.pageSize),this.cursor=0},c.prototype.getData=function(){var d='';for(var a=0;a<this.pages.length;a++)for(var b=0;b<c.pageSize;b++)d+=c.charMap[this.pages[a][b]];return d},c.prototype.writeByte=function(a){this.cursor>=c.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=a},c.prototype.writeUTFBytes=function(b){for(var c=b.length,a=0;a<c;a++)this.writeByte(b.charCodeAt(a))},c.prototype.writeBytes=function(b,d,e){for(var c=e||b.length,a=d||0;a<c;a++)this.writeByte(b[a])},b.prototype.setDelay=function(a){this.delay=Math.round(a/10)},b.prototype.setFrameRate=function(a){this.delay=Math.round(100/a)},b.prototype.setDispose=function(a){a>=0&&(this.dispose=a)},b.prototype.setRepeat=function(a){this.repeat=a},b.prototype.setTransparent=function(a){this.transparent=a},b.prototype.addFrame=function(a){this.image=a,this.getImagePixels(),this.analyzePixels(),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.writePalette(),this.writePixels(),this.firstFrame=!1},b.prototype.finish=function(){this.out.writeByte(59)},b.prototype.setQuality=function(a){a<1&&(a=1),this.sample=a},b.prototype.writeHeader=function(){this.out.writeUTFBytes('GIF89a')},b.prototype.analyzePixels=function(){var g=this.pixels.length,d=g/3;this.indexedPixels=new Uint8Array(d);var a=new f(this.pixels,this.sample);a.buildColormap(),this.colorTab=a.getColormap();var b=0;for(var c=0;c<d;c++){var e=a.lookupRGB(this.pixels[b++]&255,this.pixels[b++]&255,this.pixels[b++]&255);this.usedEntry[e]=!0,this.indexedPixels[c]=e}this.pixels=null,this.colorDepth=8,this.palSize=7,this.transparent!==null&&(this.transIndex=this.findClosest(this.transparent))},b.prototype.findClosest=function(e){if(this.colorTab===null)return-1;var k=(e&16711680)>>16,l=(e&65280)>>8,m=e&255,c=0,d=16777216,j=this.colorTab.length;for(var a=0;a<j;){var f=k-(this.colorTab[a++]&255),g=l-(this.colorTab[a++]&255),h=m-(this.colorTab[a]&255),i=f*f+g*g+h*h,b=parseInt(a/3);this.usedEntry[b]&&i<d&&(d=i,c=b),a++}return c},b.prototype.getImagePixels=function(){var a=this.width,g=this.height;this.pixels=new Uint8Array(a*g*3);var b=this.image,c=0;for(var d=0;d<g;d++)for(var e=0;e<a;e++){var f=d*a*4+e*4;this.pixels[c++]=b[f],this.pixels[c++]=b[f+1],this.pixels[c++]=b[f+2]}},b.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4);var b,a;this.transparent===null?(b=0,a=0):(b=1,a=2),this.dispose>=0&&(a=dispose&7),a<<=2,this.out.writeByte(0|a|0|b),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},b.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},b.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},b.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes('NETSCAPE2.0'),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},b.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);var b=768-this.colorTab.length;for(var a=0;a<b;a++)this.out.writeByte(0)},b.prototype.writeShort=function(a){this.out.writeByte(a&255),this.out.writeByte(a>>8&255)},b.prototype.writePixels=function(){var a=new g(this.width,this.height,this.indexedPixels,this.colorDepth);a.encode(this.out)},b.prototype.stream=function(){return this.out},e.exports=b}),a.define('/LZWEncoder.js',function(e,g,h,i){function f(y,D,C,B){function w(a,b){r[f++]=a,f>=254&&t(b)}function x(b){u(a),k=i+2,j=!0,l(i,b)}function u(b){for(var a=0;a<b;++a)h[a]=-1}function A(z,r){var g,t,d,e,y,w,s;for(q=z,j=!1,n_bits=q,m=p(n_bits),i=1<<z-1,o=i+1,k=i+2,f=0,e=v(),s=0,g=a;g<65536;g*=2)++s;s=8-s,w=a,u(w),l(i,r);a:while((t=v())!=c){if(g=(t<<b)+e,d=t<<s^e,h[d]===g){e=n[d];continue}if(h[d]>=0){y=w-d,d===0&&(y=1);do if((d-=y)<0&&(d+=w),h[d]===g){e=n[d];continue a}while(h[d]>=0)}l(e,r),e=t,k<1<<b?(n[d]=k++,h[d]=g):x(r)}l(e,r),l(o,r)}function z(a){a.writeByte(s),remaining=y*D,curPixel=0,A(s+1,a),a.writeByte(0)}function t(a){f>0&&(a.writeByte(f),a.writeBytes(r,0,f),f=0)}function p(a){return(1<<a)-1}function v(){if(remaining===0)return c;--remaining;var a=C[curPixel++];return a&255}function l(a,c){g&=d[e],e>0?g|=a<<e:g=a,e+=n_bits;while(e>=8)w(g&255,c),g>>=8,e-=8;if((k>m||j)&&(j?(m=p(n_bits=q),j=!1):(++n_bits,n_bits==b?m=1<<b:m=p(n_bits))),a==o){while(e>0)w(g&255,c),g>>=8,e-=8;t(c)}}var s=Math.max(2,B),r=new Uint8Array(256),h=new Int32Array(a),n=new Int32Array(a),g,e=0,f,k=0,m,j=!1,q,i,o;this.encode=z}var c=-1,b=12,a=5003,d=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];e.exports=f}),a.define('/TypedNeuQuant.js',function(A,F,E,D){function C(A,B){function I(){o=[],q=new Int32Array(256),t=new Int32Array(a),y=new Int32Array(a),z=new Int32Array(a>>3);var c,d;for(c=0;c<a;c++)d=(c<<b+8)/a,o[c]=new Float64Array([d,d,d,0]),y[c]=e/a,t[c]=0}function J(){for(var c=0;c<a;c++)o[c][0]>>=b,o[c][1]>>=b,o[c][2]>>=b,o[c][3]=c}function K(b,a,c,e,f){o[a][0]-=b*(o[a][0]-c)/d,o[a][1]-=b*(o[a][1]-e)/d,o[a][2]-=b*(o[a][2]-f)/d}function L(j,e,n,l,k){var h=Math.abs(e-j),i=Math.min(e+j,a),g=e+1,f=e-1,m=1,b,d;while(g<i||f>h)d=z[m++],g<i&&(b=o[g++],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c),f>h&&(b=o[f--],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c)}function C(p,s,q){var h=2147483647,k=h,d=-1,m=d,c,j,e,n,l;for(c=0;c<a;c++)j=o[c],e=Math.abs(j[0]-p)+Math.abs(j[1]-s)+Math.abs(j[2]-q),e<h&&(h=e,d=c),n=e-(t[c]>>i-b),n<k&&(k=n,m=c),l=y[c]>>g,y[c]-=l,t[c]+=l<<f;return y[d]+=x,t[d]-=r,m}function D(){var d,b,e,c,h,g,f=0,i=0;for(d=0;d<a;d++){for(e=o[d],h=d,g=e[1],b=d+1;b<a;b++)c=o[b],c[1]<g&&(h=b,g=c[1]);if(c=o[h],d!=h&&(b=c[0],c[0]=e[0],e[0]=b,b=c[1],c[1]=e[1],e[1]=b,b=c[2],c[2]=e[2],e[2]=b,b=c[3],c[3]=e[3],e[3]=b),g!=f){for(q[f]=i+d>>1,b=f+1;b<g;b++)q[b]=d;f=g,i=d}}for(q[f]=i+n>>1,b=f+1;b<256;b++)q[b]=n}function E(j,i,k){var b,d,c,e=1e3,h=-1,f=q[i],g=f-1;while(f<a||g>=0)f<a&&(d=o[f],c=d[1]-i,c>=e?f=a:(f++,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3])))),g>=0&&(d=o[g],c=i-d[1],c>=e?g=-1:(g--,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3]))));return h}function F(){var c,f=A.length,D=30+(B-1)/3,y=f/(3*B),q=~~(y/w),n=d,o=u,a=o>>h;for(a<=1&&(a=0),c=0;c<a;c++)z[c]=n*((a*a-c*c)*m/(a*a));var i;f<s?(B=1,i=3):f%l!==0?i=3*l:f%k!==0?i=3*k:f%p!==0?i=3*p:i=3*j;var r,t,x,e,g=0;c=0;while(c<y)if(r=(A[g]&255)<<b,t=(A[g+1]&255)<<b,x=(A[g+2]&255)<<b,e=C(r,t,x),K(n,e,r,t,x),a!==0&&L(a,e,r,t,x),g+=i,g>=f&&(g-=f),c++,q===0&&(q=1),c%q===0)for(n-=n/D,o-=o/v,a=o>>h,a<=1&&(a=0),e=0;e<a;e++)z[e]=n*((a*a-e*e)*m/(a*a))}function G(){I(),F(),J(),D()}function H(){var b=[],g=[];for(var c=0;c<a;c++)g[o[c][3]]=c;var d=0;for(var e=0;e<a;e++){var f=g[e];b[d++]=o[f][0],b[d++]=o[f][1],b[d++]=o[f][2]}return b}var o,q,t,y,z;this.buildColormap=G,this.getColormap=H,this.lookupRGB=E}var w=100,a=256,n=a-1,b=4,i=16,e=1<<i,f=10,B=1<<f,g=10,x=e>>g,r=e<<f-g,z=a>>3,h=6,t=1<<h,u=z*t,v=30,o=10,d=1<<o,q=8,m=1<<q,y=o+q,c=1<<y,l=499,k=491,p=487,j=503,s=3*j;A.exports=C}),a('/gif.worker.coffee')}.call(this,this))\n//# sourceMappingURL=gif.worker.js.map\n// gif.worker.js 0.1.6 - https://github.com/jnordberg/gif.js\n\n},{}]},{},[1])"],{type:"text/javascript"})))},{}],217:[function(t,e){"use strict";var i=function(){},s=e.exports={};s.stringIsClean=function(t){for(var e=0;e<t.length;e++)if(t.charCodeAt(e)<32)return!1;return!0},s.parseNum=function(t,e,i,s){var o,n,r=">"===t;for(void 0===i&&(i=0),void 0===s&&(s=e.length-i),o=r?i:i+s-1;r?i+s>o:o>=i;r?o++:o--)n<<=8,n+=e.charCodeAt(o);return n},s.parseSnum=function(t,e,i,s){var o,n,r,a=">"===t;for(void 0===i&&(i=0),void 0===s&&(s=e.length-i),o=a?i:i+s-1;a?i+s>o:o>=i;a?o++:o--)void 0===r&&(r=128===(128&e.charCodeAt(o))),n<<=8,n+=r?255&~e.charCodeAt(o):e.charCodeAt(o);return r&&(n+=1,n*=-1),n},s.Rational=function(t,e){return this.num=t,this.den=e||1,this},s.Rational.prototype.toString=function(){return 0===this.num?""+this.num:1===this.den?""+this.num:1===this.num?this.num+" / "+this.den:this.num/this.den},s.Rational.prototype.asFloat=function(){return this.num/this.den},s.MetaGroup=function(t,e){return this.fieldName=t,this.description=e,this.metaProps={},this},s.MetaGroup.prototype._addProperty=function(t,e,i){var o=new s.MetaProp(t,e,i);this[o.fieldName]=o,this.metaProps[o.fieldName]=o},s.MetaGroup.prototype.toString=function(){return"[MetaGroup "+this.description+"]"},s.MetaProp=function(t,e,i){return this.fieldName=t,this.description=e,this.value=i,this},s.MetaProp.prototype.toString=function(){return""+this.value},s.JpegFile=function(t,e){var i=this._SOS;this.metaGroups={},this._binary_data=t,this.filename=e;var o,n,r,a,l,h,d,c=0,u=0;if(this._binary_data.slice(0,2)!==this._SOI_MARKER)throw new Error("Doesn't look like a JPEG file. First two bytes are "+this._binary_data.charCodeAt(0)+","+this._binary_data.charCodeAt(1)+".");for(c+=2;c<this._binary_data.length&&(o=this._binary_data.charCodeAt(c++),n=this._binary_data.charCodeAt(c++),u=c,o==this._DELIM)&&n!==i;){for(l=s.parseNum(">",this._binary_data,c,2),c+=l;c<this._binary_data.length;)if(o=this._binary_data.charCodeAt(c++),o==this._DELIM&&(r=this._binary_data.charCodeAt(c++),0!==r)){c-=2;break}a=c-u,this._markers[n]?(h=this._markers[n][0],d=this._markers[n][1]):(h="UNKN",d=void 0),d&&this[d](n,u+2)}if(void 0===this.general)throw Error("Invalid JPEG file.");return this},s.JpegFile.prototype.toString=function(){return"[JpegFile "+this.filename+" "+this.general.type+" "+this.general.pixelWidth+"x"+this.general.pixelHeight+" Depth: "+this.general.depth+"]"},s.JpegFile.prototype._SOI_MARKER="",s.JpegFile.prototype._DELIM=255,s.JpegFile.prototype._EOI=217,s.JpegFile.prototype._SOS=218,s.JpegFile.prototype._sofHandler=function(t,e){if(void 0!==this.general)throw Error("Unexpected multiple-frame image");this._addMetaGroup("general","General"),this.general._addProperty("depth","Depth",s.parseNum(">",this._binary_data,e,1)),this.general._addProperty("pixelHeight","Pixel Height",s.parseNum(">",this._binary_data,e+1,2)),this.general._addProperty("pixelWidth","Pixel Width",s.parseNum(">",this._binary_data,e+3,2)),this.general._addProperty("type","Type",this._markers[t][2])},s.JpegFile.prototype._JFIF_IDENT="JFIF\x00",s.JpegFile.prototype._JFXX_IDENT="JFXX\x00",s.JpegFile.prototype._EXIF_IDENT="Exif\x00",s.JpegFile.prototype._types={1:["BYTE",1],2:["ASCII",1],3:["SHORT",2],4:["LONG",4],5:["RATIONAL",8],6:["SBYTE",1],7:["UNDEFINED",1],8:["SSHORT",2],9:["SLONG",4],10:["SRATIONAL",8],11:["FLOAT",4],12:["DOUBLE",8]},s.JpegFile.prototype._tifftags={256:["Image width","ImageWidth"],257:["Image height","ImageLength"],258:["Number of bits per component","BitsPerSample"],259:["Compression scheme","Compression",{1:"uncompressed",6:"JPEG compression"}],262:["Pixel composition","PhotmetricInerpretation",{2:"RGB",6:"YCbCr"}],274:["Orientation of image","Orientation",{1:"Normal",2:"Reverse?",3:"Upside-down",4:"Upside-down Reverse",5:"90 degree CW",6:"90 degree CW reverse",7:"90 degree CCW",8:"90 degree CCW reverse"}],277:["Number of components","SamplesPerPixel"],284:["Image data arrangement","PlanarConfiguration",{1:"chunky format",2:"planar format"}],530:["Subsampling ratio of Y to C","YCbCrSubSampling"],531:["Y and C positioning","YCbCrPositioning",{1:"centered",2:"co-sited"}],282:["X Resolution","XResolution"],283:["Y Resolution","YResolution"],296:["Resolution Unit","ResolutionUnit",{2:"inches",3:"centimeters"}],273:["Image data location","StripOffsets"],278:["Number of rows per strip","RowsPerStrip"],279:["Bytes per compressed strip","StripByteCounts"],513:["Offset to JPEG SOI","JPEGInterchangeFormat"],514:["Bytes of JPEG Data","JPEGInterchangeFormatLength"],301:["Transfer function","TransferFunction"],318:["White point chromaticity","WhitePoint"],319:["Chromaticities of primaries","PrimaryChromaticities"],529:["Color space transformation matrix coefficients","YCbCrCoefficients"],532:["Pair of black and white reference values","ReferenceBlackWhite"],306:["Date and time","DateTime"],270:["Image title","ImageDescription"],271:["Make","Make"],272:["Model","Model"],305:["Software","Software"],315:["Person who created the image","Artist"],316:["Host Computer","HostComputer"],33432:["Copyright holder","Copyright"],34665:["Exif tag","ExifIfdPointer"],34853:["GPS tag","GPSInfoIfdPointer"]},s.JpegFile.prototype._exiftags={36864:["Exif Version","ExifVersion"],40960:["FlashPix Version","FlashpixVersion"],40961:["Color Space","ColorSpace"],37121:["Meaning of each component","ComponentsConfiguration"],37122:["Compressed Bits Per Pixel","CompressedBitsPerPixel"],40962:["Pixel X Dimension","PixelXDimension"],40963:["Pixel Y Dimension","PixelYDimension"],37500:["Manufacturer notes","MakerNote"],37510:["User comments","UserComment"],40964:["Related audio file","RelatedSoundFile"],36867:["Date Time Original","DateTimeOriginal"],36868:["Date Time Digitized","DateTimeDigitized"],37520:["DateTime subseconds","SubSecTime"],37521:["DateTimeOriginal subseconds","SubSecTimeOriginal"],37522:["DateTimeDigitized subseconds","SubSecTimeDigitized"],33434:["Exposure time","ExposureTime"],33437:["FNumber","FNumber"],34850:["Exposure program","ExposureProgram"],34852:["Spectral sensitivity","SpectralSensitivity"],34855:["ISO Speed Ratings","ISOSpeedRatings"],34856:["Optoelectric coefficient","OECF"],37377:["Shutter Speed","ShutterSpeedValue"],37378:["Aperture Value","ApertureValue"],37379:["Brightness","BrightnessValue"],37380:["Exposure Bias Value","ExposureBiasValue"],37381:["Max Aperture Value","MaxApertureValue"],37382:["Subject Distance","SubjectDistance"],37383:["Metering Mode","MeteringMode"],37384:["Light Source","LightSource"],37385:["Flash","Flash"],37386:["Focal Length","FocalLength"],37396:["Subject Area","SubjectArea"],41483:["Flash Energy","FlashEnergy"],41484:["Spatial Frequency Response","SpatialFrequencyResponse"],41486:["Focal Plane X Resolution","FocalPlaneXResolution"],41487:["Focal Plane Y Resolution","FocalPlaneYResolution"],41488:["Focal Plane Resolution Unit","FocalPlaneResolutionUnit"],41492:["Subject Location","SubjectLocation"],41493:["Exposure Index","ExposureIndex"],41495:["Sensing Method","SensingMethod"],41728:["File Source","FileSource"],41729:["Scene Type","SceneType"],41730:["CFA Pattern","CFAPattern"],41985:["Custom Rendered","CustomRendered"],41986:["Exposure Mode","Exposure Mode"],41987:["White Balance","WhiteBalance"],41988:["Digital Zoom Ratio","DigitalZoomRatio"],41989:["Focal length in 35 mm film","FocalLengthIn35mmFilm"],41990:["Scene Capture Type","SceneCaptureType"],41991:["Gain Control","GainControl"],41992:["Contrast","Contrast"],41993:["Saturation","Saturation"],41994:["Sharpness","Sharpness"],41995:["Device settings description","DeviceSettingDescription"],41996:["Subject distance range","SubjectDistanceRange"],42016:["Unique image ID","ImageUniqueID"],40965:["Interoperability tag","InteroperabilityIFDPointer"]},s.JpegFile.prototype._gpstags={0:["GPS tag version","GPSVersionID"],1:["North or South Latitude","GPSLatitudeRef"],2:["Latitude","GPSLatitude"],3:["East or West Longitude","GPSLongitudeRef"],4:["Longitude","GPSLongitude"],5:["Altitude reference","GPSAltitudeRef"],6:["Altitude","GPSAltitude"],7:["GPS time (atomic clock)","GPSTimeStamp"],8:["GPS satellites usedd for measurement","GPSSatellites"],9:["GPS receiver status","GPSStatus"],10:["GPS mesaurement mode","GPSMeasureMode"],11:["Measurement precision","GPSDOP"],12:["Speed unit","GPSSpeedRef"],13:["Speed of GPS receiver","GPSSpeed"],14:["Reference for direction of movement","GPSTrackRef"],15:["Direction of movement","GPSTrack"],16:["Reference for direction of image","GPSImgDirectionRef"],17:["Direction of image","GPSImgDirection"],18:["Geodetic survey data used","GPSMapDatum"],19:["Reference for latitude of destination","GPSDestLatitudeRef"],20:["Latitude of destination","GPSDestLatitude"],21:["Reference for longitude of destination","GPSDestLongitudeRef"],22:["Longitude of destination","GPSDestLongitude"],23:["Reference for bearing of destination","GPSDestBearingRef"],24:["Bearing of destination","GPSDestBearing"],25:["Reference for distance to destination","GPSDestDistanceRef"],26:["Distance to destination","GPSDestDistance"],27:["Name of GPS processing method","GPSProcessingMethod"],28:["Name of GPS area","GPSAreaInformation"],29:["GPS Date","GPSDateStamp"],30:["GPS differential correction","GPSDifferential"]},s.JpegFile.prototype._markers={192:["SOF0","_sofHandler","Baseline DCT"],193:["SOF1","_sofHandler","Extended sequential DCT"],194:["SOF2","_sofHandler","Progressive DCT"],195:["SOF3","_sofHandler","Lossless (sequential)"],197:["SOF5","_sofHandler","Differential sequential DCT"],198:["SOF6","_sofHandler","Differential progressive DCT"],199:["SOF7","_sofHandler","Differential lossless (sequential)"],200:["JPG",null,"Reserved for JPEG extensions"],201:["SOF9","_sofHandler","Extended sequential DCT"],202:["SOF10","_sofHandler","Progressive DCT"],203:["SOF11","_sofHandler","Lossless (sequential)"],205:["SOF13","_sofHandler","Differential sequential DCT"],206:["SOF14","_sofHandler","Differential progressive DCT"],207:["SOF15","_sofHandler","Differential lossless (sequential)"],196:["DHT",null,"Define Huffman table(s)"],204:["DAC",null,"Define arithmetic coding conditioning(s)"],208:["RST0",null,"Restart with modulo 8 count 0"],209:["RST1",null,"Restart with modulo 8 count 1"],210:["RST2",null,"Restart with modulo 8 count 2"],211:["RST3",null,"Restart with modulo 8 count 3"],212:["RST4",null,"Restart with modulo 8 count 4"],213:["RST5",null,"Restart with modulo 8 count 5"],214:["RST6",null,"Restart with modulo 8 count 6"],215:["RST7",null,"Restart with modulo 8 count 7"],216:["SOI",null,"Start of image"],217:["EOI",null,"End of image"],218:["SOS",null,"Start of scan"],219:["DQT",null,"Define quantization table(s)"],220:["DNL",null,"Define number of lines"],221:["DRI",null,"Define restart interval"],222:["DHP",null,"Define hierarchical progression"],223:["EXP",null,"Expand reference component(s)"],224:["APP0","_app0Handler","Reserved for application segments"],225:["APP1","_app1Handler"],226:["APP2",null],227:["APP3",null],228:["APP4",null],229:["APP5",null],230:["APP6",null],231:["APP7",null],232:["APP8",null],233:["APP9",null],234:["APP10",null],235:["APP11",null],236:["APP12",null],237:["APP13",null],238:["APP14",null],239:["APP15",null],240:["JPG0",null],241:["JPG1",null],242:["JPG2",null],243:["JPG3",null],244:["JPG4",null],245:["JPG5",null],246:["JPG6",null],247:["JPG7",null],248:["JPG8",null],249:["JPG9",null],250:["JPG10",null],251:["JPG11",null],252:["JPG12",null],253:["JPG13",null],254:["COM",null],1:["JPG13",null]},s.JpegFile.prototype._addMetaGroup=function(t,e){var i=new s.MetaGroup(t,e);return this[i.fieldName]=i,this.metaGroups[i.fieldName]=i,i},s.JpegFile.prototype._parseIfd=function(t,e,o,n,r,a,l){var h,d,c,u,p,m,g,f,_,v,b,y=s.parseNum(t,e,o+n,2);b=this._addMetaGroup(a,l);for(var w=0;y>w;w++)if(h=o+n+2+12*w,d=s.parseNum(t,e,h,2),u=s.parseNum(t,e,h+2,2),m=s.parseNum(t,e,h+4,4),g=s.parseNum(t,e,h+8,4),void 0!==this._types[u]){if(c=this._types[u][0],p=this._types[u][1],g=4>=p*m?h+8:o+g,"UNDEFINED"==c)f=void 0;else if("ASCII"==c)f=e.slice(g,g+m),f=f.split("\x00")[0],s.stringIsClean(f)||(f="");else{f=[];for(var x=0;m>x;x++,g+=p)("BYTE"==c||"SHORT"==c||"LONG"==c)&&f.push(s.parseNum(t,e,g,p)),("SBYTE"==c||"SSHORT"==c||"SLONG"==c)&&f.push(s.parseSnum(t,e,g,p)),"RATIONAL"==c&&(_=s.parseNum(t,e,g,4),v=s.parseNum(t,e,g+4,4),f.push(new s.Rational(_,v))),"SRATIONAL"==c&&(_=s.parseSnum(t,e,g,4),v=s.parseSnum(t,e,g+4,4),f.push(new s.Rational(_,v))),f.push();1===m&&(f=f[0])}r.hasOwnProperty(d)?b._addProperty(r[d][1],r[d][0],f):i("WARNING(jpegmeta.js): Unknown tag: ",d)}},s.JpegFile.prototype._jfifHandler=function(t,e){if(void 0!==this.jfif)throw Error("Multiple JFIF segments found");this._addMetaGroup("jfif","JFIF"),this.jfif._addProperty("version_major","Version Major",this._binary_data.charCodeAt(e+5)),this.jfif._addProperty("version_minor","Version Minor",this._binary_data.charCodeAt(e+6)),this.jfif._addProperty("version","JFIF Version",this.jfif.version_major.value+"."+this.jfif.version_minor.value),this.jfif._addProperty("units","Density Unit",this._binary_data.charCodeAt(e+7)),this.jfif._addProperty("Xdensity","X density",s.parseNum(">",this._binary_data,e+8,2)),this.jfif._addProperty("Ydensity","Y Density",s.parseNum(">",this._binary_data,e+10,2)),this.jfif._addProperty("Xthumbnail","X Thumbnail",s.parseNum(">",this._binary_data,e+12,1)),this.jfif._addProperty("Ythumbnail","Y Thumbnail",s.parseNum(">",this._binary_data,e+13,1))},s.JpegFile.prototype._app0Handler=function(t,e){var i=this._binary_data.slice(e,e+5);i==this._JFIF_IDENT?this._jfifHandler(t,e):i==this._JFXX_IDENT},s.JpegFile.prototype._app1Handler=function(t,e){var i=this._binary_data.slice(e,e+5);i==this._EXIF_IDENT&&this._exifHandler(t,e+6)},s.JpegFile.prototype._exifHandler=function(t,e){if(void 0!==this.exif)throw new Error("Multiple JFIF segments found");var i,o,n,r=this._binary_data.slice(e,e+2);if("II"===r)i="<";else{if("MM"!==r)throw new Error("Malformed TIFF meta-data. Unknown endianess: "+r);i=">"}if(o=s.parseNum(i,this._binary_data,e+2,2),42!==o)throw new Error("Malformed TIFF meta-data. Bad magic: "+o);if(n=s.parseNum(i,this._binary_data,e+4,4),this._parseIfd(i,this._binary_data,e,n,this._tifftags,"tiff","TIFF"),this.tiff.ExifIfdPointer&&this._parseIfd(i,this._binary_data,e,this.tiff.ExifIfdPointer.value,this._exiftags,"exif","Exif"),this.tiff.GPSInfoIfdPointer){if(this._parseIfd(i,this._binary_data,e,this.tiff.GPSInfoIfdPointer.value,this._gpstags,"gps","GPS"),this.gps.GPSLatitude){var a;a=this.gps.GPSLatitude.value[0].asFloat()+1/60*this.gps.GPSLatitude.value[1].asFloat()+1/3600*this.gps.GPSLatitude.value[2].asFloat(),"S"===this.gps.GPSLatitudeRef.value&&(a=-a),this.gps._addProperty("latitude","Dec. Latitude",a)}if(this.gps.GPSLongitude){var l;l=this.gps.GPSLongitude.value[0].asFloat()+1/60*this.gps.GPSLongitude.value[1].asFloat()+1/3600*this.gps.GPSLongitude.value[2].asFloat(),"W"===this.gps.GPSLongitudeRef.value&&(l=-l),this.gps._addProperty("longitude","Dec. Longitude",l)}}}},{}],218:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("scrollmonitor"),n=t("fastdom"),r=t("prima/class"),a=t("prima/mixins/accessor"),l=t("prima/lib/flags"),h=t("prima/events"),d=t("prima/utils/caniuse"),c=t("./plugins/videojs-crt"),u=r.extend({mixins:[a],defaults:{loaded:!1,paused:!0,muted:!1,autoplay:!1,_preload:!1,_preloadThreshold:10,loop:!0,autoheight:!1,watch:!0,duration:0,hideFullscreen:!1,_elapsed:0,_position:0,_startSeekJumpTime:null,minLoopDuration:1},classNames:{base:"crt-video crt-skin-default",autoplay:"crt-state-autoplaying",autoheight:"crt-autoheight",hideFullscreen:"crt-hide-fullscreen-toggle"},constructor:function(t,e){this._id=i.uniqueId("crtplayer"),this.initialize(t,e)},initialize:function(t,e){e||(e={}),i.isObject(e.attributes)&&this.set(e.attributes),this.video=t,this.$video=s(this.video);var o=this.$video.data("crt-options");this.$video.removeAttr("data-crt-options"),this.vjsOptions=i.defaults({crt:this,crtOptions:o},e.vjsOptions||{}),o&&o.duration&&this.set("duration",o.duration),n.write(function(){this.$video.addClass(this.classNames.base)},this)},render:function(){return n.write(function(){c(this.video,this.vjsOptions).then(i.bind(this.ready,this))},this),this},ready:function(t){this.player=t,this.el=t.player_.el(),this.$el=s(this.el),this.$post=this.$el.closest(".post"),this.playerID=this.player.id_,this.hasLooped=!1,this._bindEvents(),this.setAutoplayState(this.shouldAutoplay()),this.setMutedState(this.shouldAutoplay()),this.setLoopState(!0),this.setAutoheightState(),this.setFullscreenControl(!d.prop("requestFullscreen")),this.get("watch")&&this.setupWatcher(),h.trigger("CrtPlayer:ready",this),this.trigger("ready",this)},_bindEvents:function(){this.listenTo(h,"peepr:open",this.pause),this.listenTo(h,"post:form:show",this.pause),this.listenTo(h,"post:docked:afterRender",this.onDockedAfterRender),this.on("change:autoplay",this.onChangeAutoplay,this),this.on("change:autoheight",this.onChangeAutoheight,this),this.on("change:duration",this.onChangeDuration,this),this.on("change:loop",this.onChangeLoop,this),this.on("change:muted",this.onChangeMuted,this),this.player.on("loadedmetadata",i.bind(this.onLoadedMetadata,this)),this.player.on("durationchange",i.bind(this.onUpdateDuration,this)),this.player.on("play",i.bind(this.onPlay,this)),this.player.on("pause",i.bind(this.onPause,this)),this.player.on("ended",i.bind(this.onEnded,this)),this.player.on("fullscreenchange",i.bind(this.onFullscreenChange,this)),this.player.on("error",i.bind(this.onError,this))},setupWatcher:function(){this.watcher=o.create(this.el,-100),this.watcher.fullyEnterViewport(i.bind(function(){this.trigger("fullyEnterViewport")},this)),this.watcher.partiallyExitViewport(i.bind(function(){this.trigger("partiallyExitViewport")},this)),this.watcher.exitViewport(i.bind(function(){this.trigger("exitViewport"),this.shouldAutoplay()&&this.pause()
},this)),this.shouldAutoplay()&&this.$el.on("click.crtAutoPlay touchend.crtAutoPlay",i.bind(this.onClickPlayer,this))},onClickPlayer:function(t){s(t.target).closest(".vjs-mute-control").length||s(t.target).closest(".vjs-fullscreen-control").length?this.restart():this.pause(),this.set("autoplay",!1),this.set("muted",!1),this.$el.off("click.crtAutoPlay touchend.crtAutoPlay")},restart:function(){this.get("autoplay")&&(this.set("autoplay",!1),this.set("muted",!1),this.onTimeUpdate(),this.player.trigger({type:"restart",start:this.player.currentTime(),end:0}),this.player.currentTime(0))},pollTimeUpdate:function(){this.get("paused")||(this.onTimeUpdate(),setTimeout(i.bind(this.pollTimeUpdate,this),150))},shouldAutoplay:function(){return this.get("autoplay")&&!l.bool("is_mobile")&&this.get("duration")>this.get("minLoopDuration")&&this.$el.is(":visible")},play:function(t){t||(t={}),this.player.paused()&&(this.player.play(),t.skipLog||(t.type="userPlay",this.player.trigger(t)))},pause:function(t){t||(t={}),this.player.paused()||(this.player.pause(),t.skipLog||this.player.trigger("userPause"))},onPlay:function(){this.set("paused",!1),this.pollTimeUpdate()},onPause:function(){this.set("paused",!0)},onUpdateDuration:function(){this.get("duration")||this.set("duration",this.player.duration())},onLoadedMetadata:function(){this.set("loaded",!0)},onEnded:function(){this.get("loop")===!0?(this.play({skipLog:!0}),this.player.trigger("looped"),this.get("autoplay")||this.hasLooped||(this.hasLooped=!0)):(this.pause({skipLog:!0}),this.player.trigger("videoEnded"))},onError:function(){this.set("paused",!0),this.set("loop",!1),this.set("autoplay",!1)},onChangeAutoplay:function(t,e,i){this.setAutoplayState(e,i)},onChangeAutoheight:function(t,e){this.setAutoheightState(e)},onChangeDuration:function(){this.setLoopState(!0)},onChangeLoop:function(t,e){this.setLoopState(e)},onChangeMuted:function(t,e){this.player.muted(e)},onFullscreenChange:function(){this.$post.hasClass("docked")&&(this.player.isFullscreen()?(this.cached_top=this.$el.position().top,this.$el.css("top",0)):this.$el.css("top",this.cached_top))},onDockedAfterRender:function(t){i.isEmpty(t.embedID)||this.playerID===t.embedID&&this.player.trigger("CRTPlayer:updateDimensions")},setLoopState:function(t){i.isUndefined(t)&&(t=this.get("loop")),this.set("loop",t),"undefined"!=typeof this.get("duration")&&this.get("duration")<=this.get("minLoopDuration")&&this.set("loop",!1)},setMutedState:function(t){i.isUndefined(t)&&(t=this.get("muted")),this.set("muted",t)},setAutoplayState:function(t){i.isUndefined(t)&&(t=this.get("autoplay")),this.set("autoplay",t),this.toggleAttrClass("autoplay",t),!t&&this.get("duration")&&this.setLoopState(!0)},setAutoheightState:function(t){i.isUndefined(t)&&(t=this.get("autoheight")),this.set("autoheight",t),this.toggleAttrClass("autoheight",t)},setFullscreenControl:function(t){i.isUndefined(t)&&(t=this.get("hideFullscreen")),this.set("hideFullscreen",t),this.toggleAttrClass("hideFullscreen",t)},onTimeUpdate:function(){var t=.3,e=this.get("_position"),i=this.player.currentTime(),s=Math.abs(e-i);t>s&&this.set("_elapsed",this.get("_elapsed")+s),this.set("_position",i),this.set("_startSeekJumpTime",i)},getStartSeekJumpPosition:function(){return this.get("_startSeekJumpTime")},getPosition:function(){return Math.floor(this.get("_position"))},getElapsed:function(){return Math.floor(this.get("_elapsed"))},toggleAttrClass:function(t,e){this.classNames[t]&&n.write(function(){this.$el.toggleClass(this.classNames[t],e)},this)},teardown:function(){this.trigger("teardown",this),this.off(),this.stopListening(),this.watcher&&(this.watcher.destroy(),this.watcher=null),this.player&&(this.player.dispose(),this.player=null)}});e.exports=u},{"./plugins/videojs-crt":233,fastdom:319,jquery:"HlZQrA",lodash:"K2RcUv","prima/class":258,"prima/events":261,"prima/lib/flags":"f/LVtH","prima/mixins/accessor":289,"prima/utils/caniuse":302,scrollmonitor:"y33VHk"}],219:[function(t,e){"use strict";var i=t("video.js"),s=t("./templates/mute_toggle.tpl"),o=i.MuteToggle.extend({init:function(t,e){i.MuteToggle.prototype.init.call(this,t,e),this.addListeners(t)},addListeners:function(){this.on("click",this.onMuteClick)},onMuteClick:function(){this.player_.trigger("muteClicked")},createEl:function(){var t="vjs-mute-control vjs-control";return this.player_.options_.muted&&(t+=" vjs-vol-0"),i.Button.prototype.createEl.call(this,"div",{className:t,innerHTML:s()})},update:function(){var t=this.player_.volume(),e=3;0===t||this.player_.muted()?e=0:.33>t?e=1:.67>t&&(e=2),this.player_.muted()?"Unmute"!==this.el_.children[1].children[0].innerHTML&&(this.el_.children[1].children[0].innerHTML="Unmute"):"Mute"!==this.el_.children[1].children[0].innerHTML&&(this.el_.children[1].children[0].innerHTML="Mute");for(var s=0;4>s;s++)i.removeClass(this.el_,"vjs-vol-"+s);i.addClass(this.el_,"vjs-vol-"+e)}});e.exports=o},{"./templates/mute_toggle.tpl":232,"video.js":"AcVSFw"}],220:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("video.js"),n=o.CoreObject.extend({init:function(t,e){this.options=e||{},this.player=t,this.$player=s(this.player.el()),this._selectorCache(),this.player.on("dispose",i.bind(this.dispose,this)),this.initialize.apply(this,arguments)},_selectorCache:function(){this.$$=i.memoize(function(t){return this.$player.find(t)},i.identity),this.$$.remove=i.bind(function(t){delete this.$$.cache[t]},this),this.$$.clear=i.bind(function(){this.$$.cache={}},this)},initialize:function(){},dispose:function(){this.$$.clear(),this.$player.off()}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],221:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("video.js"),n=t("prima/utils/bindendevent").animation,r=o.Button.extend({init:function(){o.Button.prototype.init.apply(this,arguments),this.player().usingNativeControls()&&this.player().controls(!1)},createEl:function(){return o.Button.prototype.createEl.call(this,"div",{className:"vjs-big-play-button",innerHTML:'<span class="vjs-big-play-button-icon"></span><span class="vjs-big-pause-button-icon"></span></span><span aria-hidden="true"></span>',"aria-label":"play video"})},onClick:function(){this.$el=this.$el||i(this.el()),this.player_.userActive(!0),this.player().usingNativeControls()?this.player().paused()&&(this.player().play(),this.player().controls(!0)):this.togglePlay()},togglePlay:function(){n(this.$el,s.bind(function(){this.$el.removeClass("poof-play poof-pause")},this)),this.player().paused()?(this.player().play(),this.$el.removeClass("poof-pause").addClass("poof-play")):(this.player().pause(),this.$el.removeClass("poof-play").addClass("poof-pause"))}});e.exports=r},{jquery:"HlZQrA",lodash:"K2RcUv","prima/utils/bindendevent":301,"video.js":"AcVSFw"}],222:[function(t,e){"use strict";var i=t("video.js"),s=i.SeekBar.extend({onMouseMove:function(){i.SeekBar.prototype.onMouseMove.apply(this,arguments),this.update()},update:function(){if(this.el_){var t=this.getPercent(),e=this.handle,s=this.bar;isNaN(t)&&(t=0);var o=i.round(100*t,2)+"%";e.el().style.left=o,s.el().style.width=o}}});e.exports=s},{"video.js":"AcVSFw"}],223:[function(t,e){"use strict";var i=t("lodash"),s=t("./base/base-plugin"),o=s.extend({elSelector:".vjs-progress-holder",lastPlayPosition:0,currentPlayPosition:0,lastWaitedTime:0,buffering:!1,polling:!1,interval:100,initialize:function(){this.player.on("play",i.bind(this.startPolling,this)),this.player.on("ended",i.bind(this.stopPolling,this)),this.player.on("pause",i.bind(this.stopPolling,this))},checkBuffering:function(){this.currentPlayPosition=this.player.currentTime();var t=1/this.interval;if(!this.buffering&&this.currentPlayPosition<this.lastPlayPosition+t&&!this.player.paused()&&(this.lastWaitedTime=i.now(),this.$player.trigger("waiting"),this.buffering=!0),this.buffering&&this.currentPlayPosition>this.lastPlayPosition+t&&!this.player.paused()){var e=i.now()-this.lastWaitedTime;this.$player.trigger("stopwaiting",{timeWaited:e}),this.buffering=!1}this.lastPlayPosition=this.currentPlayPosition},tick:function(){this.polling&&(this.checkBuffering(),i.delay(i.bind(this.tick,this),this.interval))},startPolling:function(){this.polling||(this.polling=!0,this.tick())},stopPolling:function(){this.polling=!1}});e.exports=o},{"./base/base-plugin":220,lodash:"K2RcUv"}],224:[function(t){"use strict";var e=t("video.js"),i=t("prima/lib/translate");e.MediaError.defaultMessages={1:i("You aborted the video playback"),2:i("A network error caused the video download to fail part-way."),3:i("The video playback was aborted due to a corruption problem or because the video used features your browser did not support."),4:i("The video could not be loaded, either because the server or network failed or because the format is not supported."),5:i("The video is encrypted and we do not have the keys to decrypt it.")}},{"prima/lib/translate":288,"video.js":"AcVSFw"}],225:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/events"),n=t("./base/base-plugin"),r=n.extend({videoConversionLogged:!1,loggingInProgress:!1,startSeekTime:null,triggerElement:s(),initialize:function(){this.player.crt.on("ready",i.bind(function(){this.setPlayerData(),this.bindEvents(),this.cacheUnloadData()},this)),this.$doc=s(document)},setPlayerData:function(){this.playerData={id:this.player.crt.playerID,tech:this.player.techName,post_id:this.player.crt.$post.data("post-id"),duration:this.player.crt.get("duration")}},bindEvents:function(){this.$player.on("mousedown touchstart",i.bind(this.setTriggerElement,this)),this.player.on("userPlay",i.bind(this.onUserPlay,this)),this.player.on("play",i.bind(this.onVJSPlay,this)),this.player.on("userPause",i.bind(this.onUserPause,this)),this.player.on("pause",i.bind(this.onVJSPause,this)),this.player.on("looped",i.bind(this.onLooped,this)),this.player.on("videoEnded",i.bind(this.onVideoEnded,this)),this.player.on("restart",i.bind(this.onRestart,this)),this.player.on("muteClicked",i.bind(this.onMuteClicked,this)),this.player.on("fullscreenchange",i.bind(this.onFullscreenChange,this)),this.player.on("error",i.bind(this.onError,this)),this.player.on("seeking",i.bind(this.onSeeking,this)),this.player.on("resolutionchange",i.bind(this.onResolutionChange,this)),this.player.on("timeupdate",i.bind(this.onTimeUpdate,this)),this.$player.on("stopwaiting",i.bind(this.onStopWaiting,this))},triggerEvent:function(t,e){e=this._buildLoggingData(e),o.trigger("VideoPlayer:"+t,{loggingData:e})},_buildLoggingData:function(t){return t=i.extend({},this.playerData,t),t.elapsed=this.player.crt.getElapsed(),t.position=this.player.crt.getPosition(),t},setTriggerElement:function(t){this.triggerElement=s(t.target)},onLogComplete:function(){this.triggerElement=s()},cacheUnloadData:function(){this.triggerEvent("cacheUnload")},onError:function(){var t=this.player.error(),e="MEDIA_ERR_CUSTOM";if(t){switch(t.code){case 1:e="MEDIA_ERR_ABORTED";break;case 2:e="MEDIA_ERR_NETWORK";break;case 3:e="MEDIA_ERR_DECODE";break;case 4:e="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:e="MEDIA_ERR_ENCRYPTED"}this.triggerEvent("error",{code:t.code,name:e})}},onUserPlay:function(t){this.onPlay(!0,t)},onVJSPlay:function(t){this.onPlay(!1,t)},onPlay:function(t,e){if(t||0!==this.triggerElement.closest(".vjs-big-play-button").length||0!==this.triggerElement.closest(".vjs-play-control").length){var i=this.player.crt.get("autoplay"),s={};e.onDock&&(s.onDock=!0),this.logConversion({name:"CONVERSION_ACTION_HTML5_VIDEO",extra:{player:this.player.techName,player_version:2}}),this.triggerEvent(i?"autoplay":"play",s),this.onLogComplete()}},onUserPause:function(){this.onPause(!0)},onVJSPause:function(){this.onPause(!1)},onPause:function(t){(t||0!==this.triggerElement.closest(".vjs-big-play-button").length||0!==this.triggerElement.closest(".vjs-play-control").length)&&(this.triggerEvent("pause",this.playerData),this.onLogComplete())},onLooped:function(){this.triggerEvent("looped")},onVideoEnded:function(){this.triggerEvent("ended")},onRestart:function(t){var e=i.pick(t,["start","end"]);this.triggerEvent("restart",e)},onFullscreenChange:function(){this.triggerEvent("fullscreen",{fullscreen:this.player.isFullscreen()}),this.onLogComplete()},onMuteClicked:function(){this.triggerEvent("muted",{muted:this.player.muted()}),this.onLogComplete()},onSeeking:function(){0!==this.triggerElement.closest(".vjs-progress-control").length&&(this.startSeekTime||(this.startSeekTime=this.player.crt.getStartSeekJumpPosition()),this.$doc.one("mouseup.crtEvents touchend.crtEvents",i.bind(this.onSeeked,this)))},onSeeked:function(){if(this.startSeekTime){var t={start:this.startSeekTime,end:this.player.currentTime()};this.triggerEvent("seek",t),this.startSeekTime=null}},onTimeUpdate:function(){this.triggerEvent("timeupdate")},onResolutionChange:function(t){var e=i.pick(t,"resolution");this.triggerEvent("resolutionchange",e)},onStopWaiting:function(t,e){!e.timeWaited||e.timeWaited<2e3||this.triggerEvent("waiting",e)},logConversion:function(t){if(!this.videoConversionLogged&&!this.loggingInProgress){this.loggingInProgress=!0;var e=s.ajax({url:"/svc/log/conversion",type:"POST",contentType:"application/x-www-form-urlencoded",with_form_key:!0,data:"log="+JSON.stringify(t)});e.done(i.bind(this.onConversionSuccess,this)),e.fail(i.bind(this.onConversionFail,this))}},onConversionSuccess:function(){this.videoConversionLogged=!0,this.loggingInProgress=!1},onConversionFail:function(){this.loggingInProgress=!1}});e.exports=r},{"./base/base-plugin":220,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261}],226:[function(t,e){"use strict";var i=t("lodash"),s=t("video.js"),o=s.Component.extend({sdURL:null,hdURL:null,isUsingSD:!0,timeIntervalBinding:null,init:function(t,e){s.Component.prototype.init.call(this,t,e),this.addListeners(t)},addListeners:function(){this.on("click",this.toggleHDState)},createEl:function(){if(this.hdURL=this.player_.options_.crtOptions.hdUrl,!this.hdURL)return s.Component.prototype.createEl.call(this,"div",{});this.player_.addClass("vjs-has-hd-toggle");var t=s.Component.prototype.createEl.call(this,"div",{className:"vjs-hd-toggle vjs-sd vjs-menu-button vjs-control",innerHTML:"<span>HD</span>"});return t},currentSource:function(){return this.player_.currentSrc()},toggleSrc:function(){var t;this.isUsingSD?(this.sdURL=this.currentSource(),t=this.hdURL,s.removeClass(this.el_,"vjs-sd"),s.addClass(this.el_,"vjs-hd")):(t=this.sdURL,s.removeClass(this.el_,"vjs-hd"),s.addClass(this.el_,"vjs-sd")),this.isUsingSD=!this.isUsingSD,this.player_.src(t)},toggleHDState:function(){var t=this.player_.currentTime(),e=this.player_.paused(),s=this.player_.muted();this.player_.addClass("vjs-quality-toggling"),this.player_.trigger({type:"resolutionchange",resolution:this.isUsingSD?"hd":"sd"});i.delay(i.bind(function(){this.player_.pause(),this.toggleSrc(),this.player_.ready(function(){this.player_.one("loadedmetadata",i.bind(function(){this.player_.currentTime(t)},this)),this.timeIntervalBinding=i.bind(function(){this.player_.currentTime()-t>.1&&(this.player_.removeClass("vjs-quality-toggling"),this.player_.off("timeupdate",this.timeIntervalBinding),e&&(this.player_.pause(),this.player_.muted(s)))},this),this.player_.on("timeupdate",this.timeIntervalBinding),i.defer(i.bind(function(){this.player_.load(),s===!1&&e===!0&&this.player_.muted(!0),this.player_.play()},this))})},this),300)}});e.exports=o},{lodash:"K2RcUv","video.js":"AcVSFw"}],227:[function(t,e){"use strict";var i=t("jquery"),s=(t("lodash"),t("video.js")),o=t("./base/base-plugin"),n=o.extend({seeking:!1,render:function(){return this.$el=i('<div class="vjs-hover-handle vjs-slider-handle" aria-live="off"><span class="vjs-control-text"></span></div>'),this},afterRender:function(){this.$seekHandle=this.$$(".vjs-seek-handle")},update:function(t){t||(t={}),this.$time_el=this.$time_el||this.$el.find(".vjs-hover-handle-time");var e=t.hoverX||0,i=t.hoverTime||"0:00",o=s.formatTime(i);this.$time_el.html(o),this.$el.css("left",e+"px")}});e.exports=n},{"./base/base-plugin":220,jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],228:[function(t,e){"use strict";var i=t("jquery"),s=t("video.js"),o=t("./base/base-plugin"),n=o.extend({render:function(){return this.$el=i('<div class="vjs-hover-slider-time" aria-live="off"></div>'),this},update:function(t){t||(t={});var e=t.hoverX||0,i=t.hoverTime||"0:00",o=s.formatTime(i);this.$el.html(o),this.$el.css("left",e+"px")}});e.exports=n},{"./base/base-plugin":220,jquery:"HlZQrA","video.js":"AcVSFw"}],229:[function(t,e){"use strict";var i=(t("jquery"),t("lodash")),s=t("video.js"),o=t("./base/base-plugin"),n=t("./hover-slider-handle"),r=t("./hover-slider-time"),a=t("./progress-bar-tooltip"),l=o.extend({elSelector:".vjs-progress-holder",initialize:function(){this.children={},this.$el=this.$$(this.elSelector),this.slider_width=this.$el.width(),this.createChildren(),this.$player.on("mousemove.sliderHover",this.elSelector,i.bind(this.onMouseMove,this)),this.$player.on("mouseenter.sliderHover",this.elSelector,i.bind(this.onMouseEnter,this)),this.$player.on("mouseout.sliderHover",this.elSelector,i.bind(this.onMouseOut,this)),this.player.on("dispose",i.bind(this.dispose,this)),this.player.on("fullscreenchange",i.bind(this.onUpdateDimensions,this)),this.player.on("CRTPlayer:updateDimensions",i.bind(this.onUpdateDimensions,this))},onUpdateDimensions:function(){this.slider_width=this.$el.width()},createChildren:function(){this.children.hoverSliderHandle=new n(this.player),this.children.hoverSliderTime=new r(this.player),this.player.options_.crtOptions.filmstrip&&(this.$el.addClass("with-filmstrip"),this.children.progressBarTooltip=new a(this.player)),this.appendChildren()},appendChildren:function(){i.each(this.children,i.bind(function(t){this.$el.append(t.render().$el)},this))},updateChildren:function(t){i.each(this.children,function(e){e.update(t)})},onMouseMove:function(t){this.$el.removeClass("auto-hide");var e=s.findPosition(this.$el[0]),i=t.pageX-e.left,o=s.Slider.prototype.calculateDistance.apply(this.player.controlBar.progressControl,[t.originalEvent]),n=o*this.player.player().duration(),r=n/this.player.player().duration();0>i?i=0:i>this.slider_width&&(i=this.slider_width),this.updateChildren({hoverX:i,hoverTime:n,hoverPercent:r})},onMouseOut:function(){this.$el.addClass("auto-hide")},onMouseEnter:function(){this.$el.removeClass("auto-hide")},dispose:function(){i.each(this.children,function(t){i.result(t,"dispose")}),o.prototype.dispose.apply(this,arguments)}});e.exports=l},{"./base/base-plugin":220,"./hover-slider-handle":227,"./hover-slider-time":228,"./progress-bar-tooltip":231,jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],230:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("video.js"),n=o.Component.extend({isHidden:!0,init:function(t,e){o.Component.call(this,t,e),t.ready(s.bind(this.onReady,this))},onReady:function(){this.$player=i(this.player().el_),this.$el=i(this.el()),this.$loader=this.$el.find(".Knight-Rider-loader");var t=s.bind(this.hideLoader,this),e=s.bind(this.showLoader,this);this.player().on("waiting",e),this.player().on("canplay",t),this.player().on("canplaythrough",t),this.player().on("playing",t),this.player().on("seeking",e),this.player().on("seeked",t),this.player().on("ended",t),this.player().on("resolutionchange",e)},createEl:function(){return o.Component.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",innerHTML:'<div class="Knight-Rider-loader centered"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>',"aria-label":"loading"})},hideLoader:function(){return this.isHidden?this:(this.$loader.removeClass("animate"),this.$player.removeClass("vjs-loading"),this.isHidden=!0,this)},showLoader:function(){return this.isHidden?(this.$loader.addClass("animate"),this.$player.addClass("vjs-loading"),this.isHidden=!1,this):this},dispose:function(){o.Component.prototype.dispose.apply(this,arguments),this.$player=null,this.$el=null}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],231:[function(t,e){"use strict";var i=t("jquery"),s=(t("lodash"),t("video.js"),t("./base/base-plugin")),o=s.extend({filmstrip_thumbnail_count:10,render:function(){var t=this.player.options_.crtOptions.filmstrip,e=t.url,s=.5*t.width,o=.5*t.height,n=6;return this.$el=i('<div class="crt-progress-tooltip"></div>'),this.$thumbnail=i('<div class="crt-progress-tooltip-thumbnail"></div>'),this.$el.css({transform:"translateX(-50%)",width:s+n+"px",height:o+n+"px"}),this.$thumbnail.css({width:s+"px",height:o+"px","background-image":"url("+e+")","background-size":s*this.filmstrip_thumbnail_count+"px "+o+"px"}),this.$el.append(this.$thumbnail),this},update:function(t){t||(t={});var e=t.hoverX||0;this.$el.css("left",e+"px");var i=isNaN(t.hoverPercent)?0:100*t.hoverPercent,s=100/(this.filmstrip_thumbnail_count-1),o=Math.floor(i/this.filmstrip_thumbnail_count)*s;this.$thumbnail.css("background-position",o+"% 0%")}});e.exports=o},{"./base/base-plugin":220,jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],232:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="mute-icon"><div class="speaker"></div><div class="unmuted"></div><div class="muted"></div></div><div><span class="vjs-control-text">Mute</span></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],233:[function(t,e){"use strict";function i(t,e){function i(){var t=this;e.src?(t.src(e.src),l.resolve(t)):e.file?(a(e.file).then(function(e,i){return i?void l.reject(i):(t.src(e),void l.resolve(t))}),delete e.file):l.resolve(t)}var r=s.merge({},p(),e),l=n.defer();return o(t,r,i),l.promise}{var s=t("lodash"),o=t("video.js"),n=t("when"),r=t("prima/lib/data"),a=t("../utils/loadfile"),l=t("./hover-slider"),h=t("./detect-buffering"),d=t("./event-dispatcher");t("./error-messages")}o.BigPlayToggle=t("./big-play-toggle"),o.AnimatingMuteToggle=t("./animating-mute-toggle"),o.CrtSeekBar=t("./crt-seekbar"),o.LoadingSpinner=t("./loading-spinner"),o.HDToggle=t("./hd-toggle"),o.log=s.noop,o.log.error=s.noop,o.log.warn=s.noop,o.log.history=[];var c=function(t){this.crt=this.options_.crt,this.options_.crt=null,this.hoverSlider=new l(this,t),this.detectBuffering=new h(this,t),this.eventDispatcher=new d(this,t)};o.plugin("crt",c);var u,p=function(){var t=r.get("Context/hosts");return u||(u={children:["mediaLoader","posterImage","bigPlayToggle",{name:"controlBar",children:["playToggle","currentTimeDisplay","timeDivider","durationDisplay","remainingTimeDisplay",{name:"progressControl",children:["crtSeekBar"]},"fullscreenToggle","hDToggle","animatingMuteToggle","loadingSpinner"]},"errorDisplay"],plugins:{crt:{}},crtOptions:{filmstrip:!1,hdUrl:!1,duration:null},controls:!0,autoplay:!1,defaultVolume:.8,flash:{swf:t.assets_host+"/assets/src/scripts/vendor/video-js/video-js-swf-4.4.4.swf"},techOrder:["html5","flash"]}),u};e.exports=i},{"../utils/loadfile":234,"./animating-mute-toggle":219,"./big-play-toggle":221,"./crt-seekbar":222,"./detect-buffering":223,"./error-messages":224,"./event-dispatcher":225,"./hd-toggle":226,"./hover-slider":229,"./loading-spinner":230,lodash:"K2RcUv","prima/lib/data":263,"video.js":"AcVSFw",when:"RG2dij"}],234:[function(t,e){"use strict";function i(t){if(!FileReader)return!1;var e=s.defer(),i=new FileReader;return i.onload=function(t){e.resolve(t.target.result)},i.onerror=function(t){e.reject(t)},i.readAsDataURL(t),e.promise}var s=t("when");e.exports=i},{when:"RG2dij"}],235:[function(t,e){"use strict";var i=t("./views/knight-rider-loader-view.js");e.exports=i},{"./views/knight-rider-loader-view.js":237}],236:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="Knight-Rider-loader" data-js-knightrider><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],237:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/subviewable"),n=t("prima/mixins/selectorcache"),r=t("prima/mixins/accessor"),a=t("../templates/knight-rider-loader.tpl"),l=s.extend({className:"knight-rider-loader",mixins:[o,n,r],template:a,defaults:{loading:!1},initialize:function(t){t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.listenTo(this,"change:loading",this._onChangeLoading)},_onChangeLoading:function(t,e){this.$el.toggleClass("loading",e),this.js$("knightRider").toggleClass("animate",e),this.$el.toggle(e)},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this._onChangeLoading(this,this.get("loading")),this}});e.exports=l},{"../templates/knight-rider-loader.tpl":236,lodash:"K2RcUv","prima/mixins/accessor":289,"prima/mixins/selectorcache":295,"prima/mixins/subviewable":296,"prima/view":318}],238:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=t("prima/lib/translate"),n=s.extend({defaults:{flags:[{name:"nsfw",label:o("This should be filtered")},{name:"spam",label:o("This is spam")},{name:"general",label:i.sprintf(o("This violates Tumblr's %1$sCommunity Guidelines%2$s"),'<a class="community_guidelines_link" href="https://www.tumblr.com/policy/community" target="_blank">',"</a>")}],violations:[{name:"hate",label:o("Malicious speech")},{name:"minors",label:o("Harm to minors")},{name:"selfharm",label:o("Promotion or glorification of self-harm")},{name:"gore",label:o("Gore, mutilation, bestiality, or necrophilia")},{name:"attribution",label:o("Misattribution or non-attribution")},{name:"impersonation",label:o("Confusion or impersonation")},{name:"harassment",label:o("Harassment")}]}});e.exports=n},{lodash:"K2RcUv","prima/lib/translate":288,"prima/model":298}],239:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/model"),n=t("prima/lib/data"),r=t("prima/lib/flags"),a=t("app/components/post-embed-code"),l=o.extend({urlRoot:function(){var t=n.get("Context/hosts");return s.isEmpty(t)?"http://www.tumblr.com":t.www_host},defaults:{embed_code:"",form_key:i("#tumblr_form_key").attr("content"),has_facebook:!1,has_user:!1,is_private:!1,permalink_label:"",post_id:"",post_tiny_url:"",post_url:"",show_email:!0,show_embed:!0,show_facebook:!0,show_permalink:!0,show_twitter:!0,tumblelog_name:"",twitter_username:""},initialize:function(){this.get("embed_code")||this.set("embed_code",new a(this.toJSON()).getCode()),r.bool("enable_share_embed_code")||this.set("show_embed",!1)},shareEmail:function(t){return this.share("/svc/email_post",t)},shareTwitter:function(t){return this.share("/svc/share_to_twitter",t)},shareFacebook:function(t){return this.share("/svc/share_to_facebook",t)},facebookStatus:function(){return i.ajax({url:this.urlRoot()+"/svc/facebook_status",type:"post",data:{form_key:this.options.form_key}})},share:function(t,e){return e=e||[],e.push({name:"form_key",value:this.get("form_key")}),i.ajax({url:this.urlRoot()+t,type:"post",data:e,success:s.bind(function(){this.trigger("success")},this),error:s.bind(function(){this.trigger("error")},this)}),this}});e.exports=l},{"app/components/post-embed-code":38,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/data":263,"prima/lib/flags":"f/LVtH","prima/model":298}],240:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover moderation"><div class="popover_inner"><div class="popover_header">'+(null==(__t=__("Flag this post"))?"":__t)+'<a class="moderation_help_link" href="https://www.tumblr.com/docs/discovery#moderationheader" target="_blank"><span class="icon_help"></span></a></div><form class="popover_form" action="/svc/flag" method="post"><input type="hidden" name="tumblelog_name" value="'+(null==(__t=tumblelog)?"":__t)+'"> <input type="hidden" name="post_id" value="'+(null==(__t=post_id)?"":__t)+'"> <input type="hidden" name="root_id" value="'+(null==(__t=root_id)?"":__t)+'">',_.each(flags,function(t){__p+='<div class="popover_form_row">';var e="flag_"+t.name;__p+='<input type="radio" id="'+(null==(__t=e)?"":__t)+'" name="flag" value="'+(null==(__t=t.name)?"":__t)+'"><label for="'+(null==(__t=e)?"":__t)+'" class="form_label">'+(null==(__t=t.label)?"":__t)+"</label>","nsfw"===t.name&&safe_search&&(__p+='<div class="popover_form_row_help">'+(null==(__t=_.sprintf(__("Adult-oriented content is currently being hidden ( %1$s ) but this post still showed up."),'<i class="icon_lock_thick_12"></i>'))?"":__t)+"</div>"),__p+="</div>"}),__p+='<div class="violation_types_wrapper">',_.each(violations,function(t){__p+='<div class="popover_form_row">';var e="violation_"+t.name;__p+='<input type="radio" id="'+(null==(__t=e)?"":__t)+'" name="violation" value="'+(null==(__t=t.name)?"":__t)+'"><label for="'+(null==(__t=e)?"":__t)+'" class="form_label">'+(null==(__t=t.label)?"":__t)+"</label></div>"}),__p+='</div><div class="popover_form_row ignore"><label class="binary_switch"><input type="checkbox" name="flag_ignore" checked="checked"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label for="ignore">'+(null==(__t=_.sprintf(__("Ignore %1$s"),tumblelog))?"":__t)+'</label></div><button class="chrome red full_width submit_flag">'+(null==(__t=__("Flag"))?"":__t)+"</button></form></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],241:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover popover_menu popover_gradient popover_share_social"><div class="popover_inner"><ul class="share_options active" data-tumblelog-name="'+(null==(__t=tumblelog_name)?"":_.escape(__t))+'" data-post-id="'+(null==(__t=post_id)?"":_.escape(__t))+'" data-post-url="'+(null==(__t=post_url)?"":_.escape(__t))+'" data-post-tiny-url="'+(null==(__t=post_tiny_url)?"":_.escape(__t))+'">',is_private||(__p+="",show_permalink&&(__p+='<li class="share_permalink popover_menu_item"><a class="popover_menu_item_anchor" href="'+(null==(__t=post_url)?"":_.escape(__t))+'" target="_blank" class="external" title="'+(null==(__t=permalink_label)?"":_.escape(__t))+'">'+(null==(__t=permalink_label)?"":_.escape(__t))+'<i class="icon icon_arrow_carrot_right"></i></a></li>'),__p+="",show_embed&&(__p+='<li class="embed_post popover_menu_item"><a class="popover_menu_item_anchor" href="#">'+(null==(__t=__("Embed"))?"":_.escape(__t))+"</a></li>"),__p+="",show_email&&(__p+='<li class="share_email popover_menu_item"><a class="popover_menu_item_anchor" href="#">'+(null==(__t=__("Email"))?"":_.escape(__t))+"</a></li>"),__p+="",show_twitter&&(__p+='<li class="share_twitter popover_menu_item" data-twitter-username="'+(null==(__t=twitter_username)?"":_.escape(__t))+'"><a class="popover_menu_item_anchor" href="#">'+(null==(__t=__("Twitter"))?"":_.escape(__t))+"</a></li>"),__p+="",show_facebook&&(__p+='<li class="share_facebook popover_menu_item" data-has-facebook="'+(null==(__t=has_facebook?"1":"")?"":__t)+'"><a class="popover_menu_item_anchor" href="#">'+(null==(__t=__("Facebook"))?"":_.escape(__t))+"</a></li>"),__p+=""),__p+="</ul>",is_private||(__p+='<form method="post" class="share_form email_form" id="share_email_'+(null==(__t=post_id)?"":_.escape(__t))+'" novalidate><div class="form_wrapper"><div class="share_label" data-embed-label="'+(null==(__t=__("Embed"))?"":_.escape(__t))+'"></div><span class="cancel service icon_arrow_thin_left"></span><div class="input_group"><ul><li><input type="email" class="email_address" name="email_address" maxlength="100" placeholder="'+(null==(__t=__("Email"))?"":_.escape(__t))+'" title="'+(null==(__t=__("Email"))?"":_.escape(__t))+'"> <input type="hidden" name="post_id" value="'+(null==(__t=post_id)?"":_.escape(__t))+'"> <input type="hidden" name="tumblelog_name" value="'+(null==(__t=tumblelog_name)?"":_.escape(__t))+'"> <span class="cancel icon_close"></span></li><li><textarea name="message" class="share_message" maxlength="255" placeholder="'+(null==(__t=__("Message (Optional)"))?"":_.escape(__t))+'" title="'+(null==(__t=__("Message (Optional)"))?"":_.escape(__t))+'"></textarea><div class="character_count">140</div></li></ul></div>',show_embed&&(__p+='<div class="embed_code_wrapper"><textarea name="embed_code" class="embed_code_text" spellcheck="false" readonly="readonly">'+(null==(__t=embed_code)?"":_.escape(__t))+"</textarea></div>"),__p+="",has_user&&(__p+='<div class="reply_to" title="'+(null==(__t=__("Let them reply to"))?"":_.escape(__t))+'"><div class="menu_item_option"><label class="binary-switch"><input type="checkbox" id="allow_reply_to_'+(null==(__t=post_id)?"":_.escape(__t))+'" class="reply_to_input" name="allow_reply_to"> <span class="binary-switch-track"></span> <span class="binary-switch-button"></span></label></div><label class="menu_item_label" for="allow_reply_to_'+(null==(__t=post_id)?"":_.escape(__t))+'">'+(null==(__t=__("Let them reply to <span>"))?"":__t)+"</label></div>"),__p+='<div class="error_status"></div><button type="submit" class="flat-button blue email_submit" data-label-sending="'+(null==(__t=__("Sending..."))?"":_.escape(__t))+'" data-label="'+(null==(__t=__("Send"))?"":_.escape(__t))+'" disabled="disabled">'+(null==(__t=__("Send"))?"":_.escape(__t))+'</button></div></form><div class="status" data-sent="'+(null==(__t=__("Sent!"))?"":_.escape(__t))+'" data-error="'+(null==(__t=__("Error!"))?"":_.escape(__t))+'"><span class="status_message">'+(null==(__t=__("Sent!"))?"":_.escape(__t))+"</span></div>"),__p+="</div></div>";
return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],242:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),r=t("prima/lib/translate"),a=t("prima/mixins/popoverbase"),l=t("app/components/dialog"),h=t("../models/post_moderation_popover"),d=t("../templates/post_moderation.tpl"),c=o.extend({className:"popover--post-moderation",mixins:[a],template:d,events:{'change input[name="flag"]':"onChangeFlag",'change input[name="violation"]':"onChangeViolation",'change input[name="flag_ignore"]':"onChangeIgnore","change input":"onChangeForm",submit:"onSubmit"},selectedFlag:null,selectedViolation:null,ignore:!0,initialize:function(t){this.options=s.extend({},t),this.model=new h,this.postModel=this.options.post,this.tumblelog=this.postModel.tumblelog},cacheSelectors:function(){this.$form=this.$el.find("form"),this.$submitButton=this.$form.find(".submit_flag"),this.$violationsContainer=this.$form.find(".violation_types_wrapper"),this.$violationInputs=this.$violationsContainer.find("input")},onChangeViolation:function(t){var e=i(t.currentTarget);this.selectedViolation=e.val()},onChangeFlag:function(t){var e=i(t.currentTarget);this.selectedFlag=e.val()},onChangeForm:function(){this.toggleViolations(),this.$submitButton.prop("disabled",!this.isValid())},onChangeIgnore:function(t){var e=i(t.currentTarget);this.ignore=e.is(":checked"),this.ignore?this.tumblelog.ignore():this.tumblelog.unignore()},onSubmit:function(t){t.preventDefault();var e=this.$form.serializeArray(),o={};s.each(e,function(t){o[t.name]=t.value}),i.ajax({url:this.$form.attr("action"),type:this.$form.attr("method")||"POST",data:o,with_form_key:!0,success:s.noop,error:function(){var t=r("Sorry, we seem to be having technical trouble.  Please try again later.");l.alert(t)}}),this.teardown(),n.trigger("flagged:"+this.tumblelog.get("name"))},toggleViolations:function(){"general"===this.selectedFlag?this.$violationsContainer.show():(this.$violationsContainer.hide(),this.selectedViolation=null,this.$violationInputs.prop("checked",!1))},isValid:function(){if(!this.ignore){if(!this.selectedFlag)return!1;if("general"===this.selectedFlag&&!this.selectedViolation)return!1}return!0},serialize:function(){return{__:r,safe_search:i(".nsfw_filter_enabled").length,flags:this.model.get("flags"),violations:this.model.get("violations"),root_id:this.postModel.get("root_id"),post_id:this.postModel.get("id"),tumblelog:this.tumblelog.get("name"),ignore:this.ignore}},render:function(){return this.$el.html(this.template(this.serialize())),this.delegateEvents(),this.cacheSelectors(),this},reset:function(){this.selectedFlag=null,this.selectedViolation=null,this.ignore=!0},teardown:function(){return this.reset(),this.$el.remove(),this}});e.exports=c},{"../models/post_moderation_popover":238,"../templates/post_moderation.tpl":240,"app/components/dialog":12,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/lib/translate":288,"prima/mixins/popoverbase":293,"prima/view":318}],243:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),r=t("prima/utils/cookie"),a=t("prima/mixins/popoverbase"),l=t("../templates/share-popover.tpl"),h=t("../models/share-popover"),d=o.extend({className:"popover--post-share-popover",mixins:[a],template:l,defaults:{popoverData:{},forceSocialFallback:!1,forceEmailFallback:!1},events:{"click .embed_post":"__embedPostClick","click .share_email":"__emailTriggerClick","click .share_facebook":"__shareFacebookClick","click .share_twitter":"__shareTwitterClick","click .share_permalink":"__sharePermalinkClick","click .cancel":"__cancelClick","click .embed_code_text":"__embedCodeClick","input .email_address":"__emailFormInput","input .twitter .share_message":"__shareTwitterInput","change .reply_to_input":"__replyToChange","keydown .share_form":"__submitKeydown","submit .share_form":"__submit","focus textarea":"__suspendKeyCommands","blur textarea":"__resumeKeyCommands"},__embedPostClick:function(t){t.preventDefault(),this._showEmbedCode()},__emailTriggerClick:function(t){t.preventDefault(),this._toggleEmailForm()},__shareFacebookClick:function(t){t.preventDefault(),this._shareFacebook()},__shareTwitterClick:function(t){t.preventDefault(),this._shareTwitter()},__sharePermalinkClick:function(){this.resetAndHide()},__cancelClick:function(t){t.preventDefault(),this._cancelOrClose()},__embedCodeClick:function(t){i(t.currentTarget).select()},__emailFormInput:function(){var t=d.validateEmail(this.$emailAddress.val());this.$submitButton.attr("disabled",!t)},__shareTwitterInput:function(t){t.preventDefault();var e=d.validateTwitter(this.$shareMessage.val(),this.$characterCount);this.$submitButton.attr("disabled",!e)},__replyToChange:function(t){var e=i(t.currentTarget).is(":checked");r.set("share_popover_reply_to",e,31536e3)},__submitKeydown:function(t){13===t.keyCode&&(t.ctrlKey||t.metaKey||t.altKey)&&(t.preventDefault(),t.stopPropagation(),this.submitForm())},__submit:function(){return this.submitForm(),!1},__submitSuccess:function(){this.$status.show(),this._fadeoutPopover()},__submitError:function(){this.$errorStatus.html(this.errorText),this.$submitButton.html(this.$submitButton.data("label")),this.$submitButton.attr("disabled",!1),this.$errorStatus.addClass("active")},__suspendKeyCommands:function(){n.trigger("keycommands:suspend")},__resumeKeyCommands:function(){n.trigger("keycommands:resume")},_shareTwitter:function(){!this.options.forceSocialFallback&&this.twitterUsername?(this.$serviceCancel.show(),this.$submitButton.html("Tweet"),this.$shareForm.data("type","twitter"),this.$shareLabel.text("@"+this.twitterUsername),this.$shareMessage.val(" [URL]"),this.$shareForm.addClass("active"),this.$shareOptions.removeClass("active"),this.$shareMessage.get(0).setSelectionRange(0,0),this.$shareMessage.attr("placeholder",""),this.$submitButton.attr("disabled",!1),this.$shareForm.addClass("twitter"),d.validateTwitter(this.$shareMessage.val(),this.$characterCount),this.$shareForm.hasClass("active")&&this.placeholderSupported&&(this.$shareMessage.focus(),this.$shareMessage.get(0).setSelectionRange(0,0))):this._shareTwitterFallback()},_shareTwitterFallback:function(){window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(this.tinyUrl||this.url),"twitter-share-dialog","width=626,height=258"),this.resetAndHide()},_shareFacebook:function(){!this.options.forceSocialFallback&&this.share_to_facebook?this.model.facebookStatus().done(s.bind(this._shareFacebookSucces,this)).fail(s.bind(this._shareFacebookFallback,this)):this._shareFacebookFallback()},_shareFacebookSuccess:function(t){t?(this.$serviceCancel.show(),this.$submitButton.html(this.$submitButton.data("label")),this.$shareForm.data("type","facebook"),this.$shareLabel.text(t),this.$submitButton.attr("disabled",!1),this.$shareForm.addClass("facebook"),this.$shareOptions.toggleClass("active"),this.$shareForm.toggleClass("active"),this.$shareForm.hasClass("active")&&this.placeholderSupported&&this.$shareMessage.focus()):this._shareFacebookFallback()},_shareFacebookFallback:function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(this.url),"facebook-share-dialog","width=626,height=436"),this.resetAndHide()},_toggleEmailForm:function(){return this.options.forceEmailFallback||!this.model.get("has_user")?void this._emailFormFallback():(this.$submitButton.html(this.$submitButton.data("label")),this.$shareForm.data("type","email"),this.$shareOptions.toggleClass("active"),this.$shareForm.toggleClass("active"),this.$replyTo.addClass("active"),void(this.$shareForm.hasClass("active")&&this.$emailAddress.length&&this.$emailAddress.focus()))},_emailFormFallback:function(){var t="mailto:?body="+this.url;window.location.href=t},_showEmbedCode:function(){this.$serviceCancel.show(),this.$shareForm.data("type","embed"),this.$shareLabel.text(this.$shareLabel.data("embed-label")),this.$shareForm.addClass("active"),this.$shareOptions.removeClass("active"),this.$shareMessage.attr("placeholder",""),this.$shareForm.addClass("embed");var t=this.$shareForm.find(".embed_code_text");t.length&&t.select()},_fadeoutPopover:function(){setTimeout(s.bind(function(){this.$el.fadeOut(150,s.bind(this.resetAndHide,this))},this),1250)},_cancelOrClose:function(){var t=this.$emailAddress.val()||"";"email"===this.$shareForm.data("type")&&t.length?(this.$emailAddress.val(""),this.$submitButton.attr("disabled",!0)):this.resetForm()},initialize:function(t){this.options=s.extend({},this.defaults,t),this.model=new h(this.options.popoverData),this.listenTo(this.model,"error",this.__submitError),this.listenTo(this.model,"success",this.__submitSuccess)},cacheSelectors:function(){this.$shareForm=this.$(".share_form"),this.$shareLabel=this.$(".share_label"),this.$replyTo=this.$(".reply_to"),this.$shareOptions=this.$(".share_options"),this.$submitButton=this.$("button.email_submit"),this.$emailAddress=this.$(".email_address"),this.$shareMessage=this.$(".share_message"),this.$embedCode=this.$(".embed_code_text"),this.$characterCount=this.$(".character_count"),this.$serviceCancel=this.$(".cancel.service"),this.$status=this.$(".status"),this.$errorStatus=this.$(".error_status"),this.$statusMessage=this.$(".status_message"),this.$replyToInput=this.$(".reply_to_input"),this.sentText=this.$status.data("sent")||"",this.errorText=this.$status.data("error")||"",this.$(".share_twitter").length&&(this.twitterUsername=this.$(".share_twitter").data("twitter-username")),this.url=this.$shareOptions.data("post-url"),this.tinyUrl=this.$shareOptions.data("post-tiny-url"),this.tumblelogName=this.$shareOptions.data("tumblelog-name"),this.postId=this.$shareOptions.data("post-id")},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.cacheSelectors(),this.$replyToInput.prop("checked","true"===r.get("share_popover_reply_to")),this},resetForm:function(){this.$serviceCancel.hide(),this.$submitButton.html(this.$submitButton.data("label")),this.$submitButton.attr("disabled",!0),this.$emailAddress.val(""),this.$shareMessage.val(""),this.$shareMessage.attr("placeholder",this.$shareMessage.attr("title")),this.$shareOptions.addClass("active"),this.$shareForm.removeClass("active"),this.$shareForm.removeClass("facebook"),this.$shareForm.removeClass("twitter"),this.$shareForm.removeClass("embed"),this.$status.hide(),this.$statusMessage.html(this.sentText),this.$replyTo.removeClass("active"),this.$errorStatus.removeClass("active"),this.$el.show()},resetAndHide:function(){this.resetForm(),this.teardown()},submitForm:function(){var t=this.$shareForm.serializeArray();switch(this.$shareForm.data("type")){case"facebook":this.model.shareFacebook(t);break;case"twitter":this.model.shareTwitter(t);break;default:this.model.shareEmail(t)}this.$submitButton.attr("disabled",!0),this.$submitButton.html(this.$submitButton.data("label-sending"))},teardown:function(){return this.$el.remove(),this}},{placeholderSupport:function(){var t=document.createElement("input");return"placeholder"in t},validateEmail:function(t){var e=/\S+@\S+\.\S+/;return e.test(t)},validateTwitter:function(t,e){var i=t.match(/\[URL\]/gi),s=i?24*i.length:0,o=140-t.length-s,n=e&&e.length?e:!1;return n&&(n.removeClass("character-limit").html(o),10>o&&n.addClass("character-limit")),0>o||140===o?!1:!0}});e.exports=d},{"../models/share-popover":239,"../templates/share-popover.tpl":241,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/mixins/popoverbase":293,"prima/utils/cookie":305,"prima/view":318}],244:[function(t,e){"use strict";function i(t){return"string"==typeof t||t&&"object"==typeof t&&"[object String]"==u.call(t)||!1}function s(){var t=new m;return t.cid=g,g+=1,f[t.cid]=t,t}function o(t,e){for(var i,s=_.length-1;s>=0;s--)_[s].message_callback(t,e);for(s=v.length-1;s>=0;s--)i=v[s],i&&i.shouldRespond&&i.shouldRespond(t,e)&&i.cb(t,e)}function n(t){var e=this;if(t.cid_response&&t.cid_response in f){var i=f[t.cid_response];i.resolve.call(null,e,t.response),delete f[t.cid_response]}}function r(t){if(t||(t={}),!(h&&h.stringify&&h.parse))throw"Must have JSON parsing and stringify";if(t.iframe&&(t.window=t.iframe.contentWindow,!t.origin)){var e=t.iframe.src,i=e.match(/^(http(?:s)?:\/\/[\w_\-\.]+(?::\d+)?)\/?/);i&&(t.origin=i[1])}this.namespace=t.namespace?t.namespace+":":"",this.origin=t.origin||"*",this.responders={_method_callback_responder:n,_syn:c(this._syn,this)},this._on_connected=new p,this._unanswered_calls={},this.on_connection(c(this.enable_sending_post_message,this)),_.push(this),t.window&&this.setWindow(t.window)}function a(t,e,i){i||(i=this.origin),t.postMessage(e,i)}var l=t("prima/utils/clean-window-object"),h=l("JSON",function(t){return t&&t.stringify}),d=[].slice,c=function(t,e){return function(){return t.apply(e,arguments)}},u=Object.prototype.toString,p=t("./utils/one_time_event"),m=t("./utils/deferred"),g=1,f={},_=[],v=[];!function(){var t=window.addEventListener?"addEventListener":"attachEvent",e=window[t],i="attachEvent"===t?"onmessage":"message";e(i,function(t){var e;if("string"==typeof t.data){try{t.data&&"{"===t.data[0]&&(e=h.parse(t.data))}catch(i){}e&&e.method&&o(t,e)}},!1)}(),r.prototype.setWindow=function(t){if(t){this.window=t;var e=this.call("_syn");e.then(c(function(t,e){"ack"===e&&this._is_connected()},this))}},r.on=function(t,e){var i;i="*"===t?function(){return!0}:"*"===t[t.length-1]?function(e,i){return 0===i.method.indexOf(t.substring(0,t.length-2))}:function(e,i){return i.method===t},v.push({shouldRespond:i,cb:e})},r.off=function(t){for(var e,i=v.length-1;i>=0;i--)if(v[i].cb===t){e=i;break}return e&&e>-1?(v.splice(e,1),!0):!1},r.prototype.match_origin=function(t){return"*"===this.origin?!0:this.origin===t},r.prototype.message_callback=function(t,e){var s;if((!this.window||t.source===this.window)&&this.match_origin(t.origin)){if(e.method&&e.method.slice(0,this.namespace.length)===this.namespace&&(s=e.method.slice(this.namespace.length,e.method.length)),e.args&&i(e.args))try{e.args=h.parse(e.args)}catch(o){return}this.call_responder(s,t,e)}},r.prototype.call_responder=function(t,e,i){var s,o;if(t){if(i.args||(i.args=[]),o=this.responders[t],!o)return this._unanswered_calls[t]||(this._unanswered_calls[t]=[]),void this._unanswered_calls[t].push(arguments);s=o.apply(e,i.args),i.cid&&"_method_callback_responder"!==t&&this.send_to_window(e.source,"_method_callback_responder",{cid_response:i.cid,response:s})}},r.prototype._syn=function(){return this._is_connected(),"ack"},r.prototype._is_connected=function(){this.connected||(this.connected=!0,this._on_connected.trigger(this))},r.prototype.on_connection=function(){return this._on_connected.push.apply(this._on_connected,arguments),this},r.prototype.method=function b(t){var e=this,b=function(){var i=1<=arguments.length?d.call(arguments,0):[];return i.unshift(t),e.send.apply(e,i)};return b},r.prototype.call=function(){var t=1<=arguments.length?d.call(arguments,0):[];return this.window?(t.unshift(this.window),this.call_on_window.apply(this,t)):void console.warn("no window specified on channel")},r.prototype.call_on_window=function(t,e){var i=3<=arguments.length?d.call(arguments,2):[],o=s();try{var n=h.stringify({method:this.namespace+e,args:i,cid:o.cid});"_syn"===e||"_method_callback_responder"===e?a.call(this,t,n):this.send_post_message(t,n)}catch(r){o.reject(r)}return o.promise()},r.prototype.send=function(){var t=1<=arguments.length?d.call(arguments,0):[];return this.window?(t.unshift(this.window),this.send_to_window.apply(this,t)):void console.warn("no window specified on channel")},r.prototype.send_to_window=function(t,e){var i=3<=arguments.length?d.call(arguments,2):[],s=h.stringify({method:this.namespace+e,args:i});"_syn"===e||"_method_callback_responder"===e?a.call(this,t,s):this.send_post_message(t,s)},r.prototype.send_post_message=function(){this._delayed_sent_messages||(this._delayed_sent_messages=[]),this._delayed_sent_messages.push(arguments)},r.prototype.enable_sending_post_message=function(){if(this.send_post_message=a,this._delayed_sent_messages){for(var t=0;t<this._delayed_sent_messages.length;t+=1)a.apply(this,this._delayed_sent_messages[t]);delete this._delayed_sent_messages}},r.prototype.listening_to=function(t){return t in this.responders},r.prototype.listen_to=function(t,e,s){if(i(t)){if(t in this.responders)return void console.warn("already listening to this method, turn it off first");if(s&&(e=c(e,s)),this.responders[t]=e,this._unanswered_calls[t]){var o,n=this._unanswered_calls[t];delete this._unanswered_calls[t];for(var r=0;r<n.length;r+=1)o=n[r],this.call_responder.apply(this,o)}}else{var a=t;for(t in a)a.hasOwnProperty(t)&&this.listen_to(t,a[t],s)}},r.prototype.stop_listen_to=function(t){return"_method_callback_responder"===t?void console.warn("cannot disable the method callback responder"):void delete this.responders[t]},e.exports=r},{"./utils/deferred":245,"./utils/one_time_event":246,"prima/utils/clean-window-object":303}],245:[function(t,e){"use strict";function i(){this._on_resolved=new n,this._on_rejected=new n,this.then=o(this.then,this),this.fail=o(this.fail,this),this.resolve=o(this.resolve,this),this.reject=o(this.reject,this)}var s=[].slice,o=function(t,e){return function(){return t.apply(e,arguments)}},n=t("./one_time_event");i.prototype.then=function(){return this._on_resolved.push.apply(this._on_resolved,arguments),this},i.prototype.success=i.prototype.then,i.prototype.fail=function(){return this._on_resolved.push.apply(this._on_rejected,arguments),this},i.prototype.resolve=function(){return this.resolved||this.rejected?void 0:(this._on_resolved.trigger.apply(this._on_resolved,arguments),this.resolved=!0,this)},i.prototype.reject=function(){return this.resolved||this.rejected?void 0:(this._on_rejected.trigger.apply(this._on_rejected,arguments),this.rejected=!0,this)},i.prototype.reject_timeout=function(){var t=1<=arguments.length?s.call(arguments,0):[],e=t.shift();return setTimeout(o(function(){this.reject.apply(this,t)},this),e),this},i.prototype.promise=function(){function t(){var t=this;this.fail=function(){return e.fail.apply(e,arguments),t},this.then=function(){return e.then.apply(e,arguments),t},this.success=this.then,this.reject_timeout=function(){return e.reject_timeout.apply(e,arguments),t},this.cid=e.cid}var e=this;return new t},e.exports=i},{"./one_time_event":246}],246:[function(t,e){"use strict";function i(){this.length=0}var s=[].slice,o=[].push;i.prototype={slice:s,indexOf:Array.prototype.indexOf},i.prototype.push=function(){if(this.triggered_with)for(var t=1<=arguments.length?s.call(arguments,0):[],e=0;e<t.length;e+=1)t[e].apply(null,this.triggered_with);return o.apply(this,arguments)},i.prototype.trigger=function(){var t=1<=arguments.length?s.call(arguments,0):[],e=this.length;this.triggered_with=t;for(var i=0;e>i;i+=1)this[i].apply(null,this.triggered_with);return this},e.exports=i},{}],247:[function(t,e){"use strict";var i=t("backbone"),s=t("lodash"),o=t("prima/class"),n=t("prima/events"),r=t("prima/lib/flags"),a=t("prima/lib/logger"),l=[];r.bool("cslogger_js")&&l.push(t("prima/lib/loglady/endpoints/cslogger")),l.push(t("prima/lib/loglady/endpoints/logladyphp"));var h=/^\/(.+)\/([gimy]*)$/,d=o.extend({constructor:function(){this._eventHandlers=[],this.setupEndpoints(),this.initialize(),a.log("Logs",this.logLadyKey);var t=s.result(this,"events")||{};s(t).each(this._addEventHandlerByString,this);var e=s.result(this,"eventBus");this.listenTo(e,"all",this._handleEvent)},logSpots:l,eventBus:n,_addEventHandlerByString:function(t,e){var i,s=e.match(h);if(s){var o=new RegExp(s[1],s[2]);i=function(t){var e=t.match(o);if(e){for(var i=new Array(e.length-1),s=0;s<e.length;s+=1)s>0&&(i[s-1]=e[s]);return i}}}else if("*"===e[e.length-1]){var n=e.substring(0,e.length-1);i=function(t){var e=t.indexOf(n);return 0===e?[t.substring(n.length,t.length)]:void 0}}else i=function(t){return t===e?[t]:null};this._addEventHandler(t,i)},_addEventHandler:function(t,e){this._eventHandlers.push({method:t,matcher:e})},_handleEvent:function(t,e){for(var i,o,n,r=this._eventHandlers.length-1;r>=0;r--)i=this._eventHandlers[r],n=i.callback||this[i.method],n&&(o=i.matcher.call(this,t,e),s.isArray(o)&&(e&&e.loggingData&&o.push(e.loggingData),n.apply(this,o)))},setupEndpoints:function(){var t=s.result(this,"logSpots");this.loggers=s(t).map(function(t){return t(this)},this).compact().value()},initialize:s.noop,log:function(){for(var t=this.loggers.length-1;t>=0;t--){var e=this.loggers[t];e.trigger.apply(e,arguments)}}},{start:function(){return this._setupInstance||(this._setupInstance=new this),this._setupInstance}});s.extend(d.prototype,i.Events),e.exports=d},{backbone:"5kFNoY",lodash:"K2RcUv","prima/class":258,"prima/events":261,"prima/lib/flags":"f/LVtH","prima/lib/logger":268,"prima/lib/loglady/endpoints/cslogger":273,"prima/lib/loglady/endpoints/logladyphp":278}],248:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logLadyKey:"election_day",events:{"election-day:*":"handleEvent","drawer:open:election-day":"handleDrawerOpen"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){e=e||{},this.log(t,e)},handleDrawerOpen:function(t,e){e=e||{},this.log("election-day:drawerOpen",e)}});e.exports=s},{"logs/instruments/base":247}],249:[function(t,e){"use strict";var i=t("lodash"),s=t("logs/instruments/base"),o=s.extend({logLadyKey:"dashboard_embed",events:{"/post:((?:un)?docked)/":"log","post:embed:stateChange":"logStateChange"},logStateChange:function(t,e){if(!i.isEmpty(e)&&e.state&&e.postID&&e.service){if("tumblr"===e.service)return;this.log(e.state,{service:e.service,post_id:e.postID})}}});e.exports=o},{lodash:"K2RcUv","logs/instruments/base":247}],250:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logLadyKey:"generic"});e.exports=s},{"logs/instruments/base":247}],251:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logLadyKey:"helpform",events:{"helpform:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});e.exports=s},{"logs/instruments/base":247}],252:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logLadyKey:"keycommands_trigger",events:{"keycommands:*":"handleEvent"},initialize:function(){this.hasLoggedJK=!1},handleEvent:function(t,e){if("jk"===t){if(this.hasLoggedJK)return;this.hasLoggedJK=!0}this.log(t,e)}});e.exports=s},{"logs/instruments/base":247}],253:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/lib/flags"),o=t("logs/instruments/base"),n=o.extend({logLadyKey:"loginregister",events:{"loginregister:*":"handleEvent"},initialize:function(){this.hasStartedFunnel=!1},logEnv:{actionType:"/login"===document.location.pathname?"login":"register",captchaType:s.bool("captcha_use_ayah")&&!i("body").hasClass("signup_login")?"ayah":"recaptcha"},handleEvent:function(t,e){if("beginFlow"===t){if(this.hasStartedFunnel)return;this.hasStartedFunnel=!0}this.log(t,e)}});e.exports=n},{jquery:"HlZQrA","logs/instruments/base":247,"prima/lib/flags":"f/LVtH"}],254:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logLadyKey:"nitro"});e.exports=s},{"logs/instruments/base":247}],255:[function(t,e){"use strict";var i=t("lodash"),s=t("logs/instruments/base"),o=s.extend({logLadyKey:"videoplayer",logEnv:{referrer:document.location.pathname},events:{"VideoPlayer:cacheUnload":"cacheUnloadLog","VideoPlayer:timeupdate":"updateLogCache","VideoPlayer:*":"log"},initialize:function(){this.excludedEvents=["cacheUnload","timeupdate"],this.unloadData={},i.each(this.loggers,function(t){t.before_unloaded=i.bind(this.beforeUnloaded,this)},this)},log:function(t){i.contains(this.excludedEvents,t)||s.prototype.log.apply(this,arguments)},cacheUnloadLog:function(t,e){this.unloadData[e.id]=e},beforeUnloaded:function(){i.each(this.unloadData,function(t){this.log("unload",t)},this)},updateLogCache:function(t,e){var s=["elapsed","position"];this.unloadData[e.id]=i.extend(this.unloadData[e.id],i.pick(e,s))}});e.exports=o},{lodash:"K2RcUv","logs/instruments/base":247}],256:[function(t,e){"use strict";var i=t("lodash"),s={loadedLogs:[],init:function(){},startLogs:function(t){i.each(t,function(t){var e=t.start();this.loadedLogs.push(e.logLadyKey)},this)},startLog:function(t){this.startLogs([t])}};e.exports=s},{lodash:"K2RcUv"}],257:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/class"),o=t("prima/lib/data"),n=t("prima/lib/logger"),r=t("prima/lib/translate"),a=t("prima/lib/templateutils"),l=t("logs/logging-manager"),h=s.extend({constructor:function(t){this.setup(t),this.initialize()},setup:function(t){o.setup(t),n.log("Exec","Bootstrap/Data"),r.setup(t.Translations),n.log("Exec","Bootstrap/Translations"),l.init(),n.log("Exec","Bootstrap/logs")},initialize:function(){throw new Error("No router defined")}});i.extend(i.templateSettings.imports,a),e.exports=h},{lodash:"K2RcUv","logs/logging-manager":256,"prima/class":258,"prima/lib/data":263,"prima/lib/logger":268,"prima/lib/templateutils":287,"prima/lib/translate":288}],258:[function(t,e){"use strict";function i(){}var s=t("backbone"),o=t("./lib/extendwithmixins");i.extend=s.Model.extend,o.applyTo(i),e.exports=i},{"./lib/extendwithmixins":267,backbone:"5kFNoY"}],259:[function(t,e){"use strict";var i=t("backbone"),s=t("./mixins/withformkeytrue"),o=t("./lib/extendwithmixins"),n=i.Collection.extend();s.applyTo(n.prototype),o.applyTo(n),e.exports=n},{"./lib/extendwithmixins":267,"./mixins/withformkeytrue":297,backbone:"5kFNoY"}],260:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=t("./class"),n=t("./lib/data"),r=(t("./lib/logger"),o.extend({name:!1,initialize:i.noop,constructor:function(t){this.cid=i.uniqueId("component"),this.options=t||(t={}),this.initialize.apply(this,arguments)},remove:function(){},getOwnData:function(){return n.get("Components/"+this.name)},render:function(){}}));i.extend(r.prototype,s.Events),e.exports=r},{"./class":258,"./lib/data":263,"./lib/logger":268,backbone:"5kFNoY",lodash:"K2RcUv"}],261:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=function(){};o.extend=s.Model.extend,i.extend(o.prototype,s.Events),o.prototype.trigger=function(t){return function(e,s){if(i.isObject(s)){s.loggingData||{}}return t.apply(this,arguments)}}(s.Events.trigger);var n=new o;e.exports=n},{backbone:"5kFNoY",lodash:"K2RcUv"}],262:[function(t,e){"use strict";function i(t){this._onClick=this._onClick.bind(this,t),document.addEventListener("click",this._onClick,!0)}var s=t("lodash"),o=t("jquery"),n=t("backbone");i.prototype._onClick=function(t,e){this.trigger(t===e.target||o.contains(t,e.target)?"click:inside":"click:outside")},i.prototype.remove=function(){return document.removeEventListener("click",this._onClick,!0),this.off(),this},s.extend(i.prototype,n.Events),e.exports=i},{backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv"}],263:[function(t,e){"use strict";function i(t){if(!n)throw new Error("Data hasn't been initialized with `setup`.");if(!r.isString(t))return null;var e=a(n,t.replace("/","."));return r(e).cloneDeep()}function s(t){if(!n)throw new Error("Data hasn't been initialized with `setup`.");return r.isString(t)?l(n,t.replace("/",".")):null}function o(t){n=r.isObject(t)?t:{}}var n,r=t("lodash"),a=t("../utils/getpath"),l=t("../utils/haspath");e.exports={get:i,has:s,setup:r.once(o)}},{"../utils/getpath":308,"../utils/haspath":309,lodash:"K2RcUv"}],264:[function(t,e){"use strict";function i(t){t=s.extend({entries:{},name:"Dictionary"},t),this._hadLastLookup=!1,this._entries=t.entries,this._name=t.name}var s=t("lodash"),o=(t("./logger"),function(t,e,i){null!=i||(i=this);var s=t.apply(i,e);return e=Array.prototype.slice.call(e,1),e.unshift(s),e});i.prototype.addEntries=function(t){return s.extend(this._entries,t),this},i.prototype.lookup=function(t){return s.has(this._entries,t)?(this._hadLastLookup=!0,this._entries[t]):(this._hadLastLookup=!1,t)},i.prototype.lookupWithFormatting=function(t){var e;return arguments.length>1?(e=this.lookup(s.sprintf.apply(this,arguments)),this._hadLastLookup||(e=s.sprintf.apply(this,o(this.lookup,arguments,this)))):e=this.lookup(t),e},i.prototype.get=function(t){var e=this.lookupWithFormatting.apply(this,arguments);return!this._hadLastLookup,e},i.prototype.getEntries=function(){return s(this._entries).cloneDeep()},e.exports=i},{"./logger":268,lodash:"K2RcUv"}],265:[function(t,e){"use strict";function i(){function t(){o(),d.trigger("DOMEventor:flatresize",p),e=!1}var e;u.on("resize.DOMEventor-nextResizeLoop",function(){e||(g(t),e=!0)})}function s(){function t(){i--||(m.documentHeight=p.documentHeight,p.documentHeight=c.height(),i=1),m.windowScrollTop=m.windowScrollY=p.windowScrollTop,p.windowScrollTop=p.windowScrollY=u.scrollTop(),d.trigger("DOMEventor:flatscroll",p),e=!1}var e,i=0;u.on("scroll.DOMEventor-nextScrollLoop",function(){e||(g(t),e=!0)})}function o(){m.documentHeight=p.documentHeight,p.documentHeight=c.height(),m.windowHeight=p.windowHeight,p.windowHeight=u.height(),m.windowWidth=p.windowWidth,p.windowWidth=u.width(),m.windowScrollTop=m.windowScrollY=p.windowScrollTop,p.windowScrollTop=p.windowScrollY=u.scrollTop()}function n(){var t=[],e={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"leftmeta",92:"rightmeta",93:"rightmeta",96:"num0",97:"num1",98:"num2",99:"num3",100:"num4",101:"num5",102:"num6",103:"num7",104:"num8",105:"num9",106:"multiply",107:"add",109:"subtract",110:"decimal",111:"devide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"forwardslash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebracket",222:"singlequote"};c.on("keydown.DOMEventor keyup.DOMEventor",function(i){var s=i.type;if("keyup"===s||"keydown"===s){var o=h(i.target),n=i.which;if(!((o.is("input")||o.is("textarea")||o.is("select"))&&n>=48&&90>=n)||i.metaKey||i.ctrlKey||i.altKey){n>=48&&90>=n&&"keydown"===s&&(t[n]=1);var r="";for(var a in t)"keydown"===s&&n!==parseInt(a,10)&&(r+=e[a]?e[a]+"+":"");var l=s+":"+(i.altKey&&18!==n?"alt+":"")+(i.ctrlKey&&17!==n?"ctrl+":"")+(i.metaKey&&91!==n&&92!==n&&93!==n?"meta+":"")+(i.shiftKey&&16!==n?"shift+":"")+(r||"")+(e[n]||"");d.trigger("DOMEventor:"+l,i,l),"keyup"===s&&(t=[])}}}),d.off("DOMEventor:startKeyboardObserver"),d.on("DOMEventor:stopKeyboardObserver",r)}function r(){c.off("keydown.DOMEventor keyup.DOMEventor"),d.on("DOMEventor:startKeyboardObserver",n),d.off("DOMEventor:stopKeyboardObserver")}function a(){o(),s(),i(),n(),d.on("DOMEventor:updateRect",o)}var l=t("lodash"),h=t("jquery"),d=t("../events"),c=h(document),u=h(window),p={},m={};p.documentHeight=m.documentHeight=null,p.windowHeight=m.windowHeight=null,p.windowWidth=m.windowHeight=null,p.windowScrollTop=m.windowScrollTop=null,p.windowScrollY=m.windowScrollY=null;var g=!Object.hasOwnProperty.call(window,"requestAnimationFrame")&&window.requestAnimationFrame||!Object.hasOwnProperty.call(window,"webkitRequestAnimationFrame")&&window.webkitRequestAnimationFrame||!Object.hasOwnProperty.call(window,"mozRequestAnimationFrame")&&window.mozRequestAnimationFrame||!Object.hasOwnProperty.call(window,"oRequestAnimationFrame")&&window.oRequestAnimationFrame||function(t){window.setTimeout(function(){t()},50)},f={init:l.once(a),rect:function(){return p},lastRect:function(){return m}};e.exports=f},{"../events":261,jquery:"HlZQrA",lodash:"K2RcUv"}],266:[function(t,e){"use strict";function i(t){function e(){n.removeEventListener("DOMContentLoaded",e),t()
}n.addEventListener("DOMContentLoaded",e)}function s(t){o||(o=/^loaded|^i|^c/.test(n.readyState)),o?setTimeout(t):i(t)}var o,n=document;e.exports=s},{}],267:[function(t,e){"use strict";function i(t){var e=n.apply(this,arguments);return o.has(t,"mixins")&&t.mixins.forEach(function(t){t.applyTo(e.prototype)}),e}function s(t){t.extend=i}var o=t("lodash"),n=t("backbone").Model.extend;e.exports.applyTo=s},{backbone:"5kFNoY",lodash:"K2RcUv"}],268:[function(t,e){"use strict";var i=t("lodash"),s=(t("./domready"),{}),o=function(){return s};s.log=o,s.logSaw=o,s.count=i.noop,s.echo=o,s.flush=o,s.flushCount=o,s.groupNameWithUrl=i.identity,e.exports=s},{"./domready":266,lodash:"K2RcUv"}],269:[function(t,e){"use strict";function i(t){this.watching={},this.pending_events=[],this.endpoint=t.endpoint,t.event_payload_name&&(this.event_payload_name=t.event_payload_name),t.event_filter&&(this.event_filter=t.event_filter),s.bindAll(this,"_flush_from_timeout"),this._flush_from_timeout();var e=t.EventClass||g;this.Log=m.extend({EventClass:e}),o(window).on("beforeunload.log_lady",s.bind(this._flush_on_unload,this))}var s=t("lodash"),o=t("jquery"),n=t("backbone"),r=(t("prima/lib/logger"),t("prima/lib/flags")),a=t("prima/utils/realnow"),l=a.getRealNow,h=t("../utils/extend-with-defaults"),d=t("../utils/uuid"),c=t("../utils/send-beacon"),u=[].slice,p=t("./config"),m=t("./log"),g=t("./logladyphp/event"),f=1e3;s.extend(i.prototype,n.Events,{initialize:s.noop,defaults:{flush_rate:15*f},min_flush_rate:function(){var t=s.map(this.watching,function(t){return s.result(t,"flush_rate")});return t.push(this.defaults.flush_rate),s.min(t)},set_flush_rate:function(t){return t&&(this.defaults.flush_rate=t),this.flush_rate=this.min_flush_rate(),this.flush_is_overdue()&&this._flush_from_timeout(),this.flush_rate},flush:function(){var t=this.build_payload();if(!(t[this.event_payload_name].length<1)&&r.bool("log_lady"))return c(this.endpoint,t,!this.unloading),this.last_flush_at=l(),!0},_flush_on_unload:function(){this._flush_timeout&&clearTimeout(this._flush_timeout),this._trigger_unloads(),this.unloading=!0,this.flush()},_trigger_unloads:function(){var t;for(var e in this.watching)t=this.watching[e],"function"==typeof t.unloaded&&t.unloaded()},_flush_from_timeout:function(){this._flush_timeout&&clearTimeout(this._flush_timeout);var t=this.flush();t!==!1&&(this._flush_timeout=setTimeout(this._flush_from_timeout,this.flush_rate))},flush_is_overdue:function(){this.last_flush_at||(this.last_flush_at=l());var t=l()-this.last_flush_at;return t>this.flush_rate},watch:function(){var t,e,i,o=u.apply(arguments);for(i=0;i<o.length;i++)t=o[i],this.is_valid(t)&&(t.log_lady=this,this.watching[t.log_key]&&(e=this.watching[t.log_key],e&&s.isFunction(e.replaced)&&e.replaced(t)),this.watching[t.log_key]=t);return this.set_flush_rate(),this},pending_log_events:function(){var t=this.pending_events;return this.pending_events=[],t},event_payload_name:"events",event_filter:function(){return!0},build_payload:function(){var t=s.merge({},this.watching,[this]),e=("loglady - "+this.endpoint,this._should_prima_log,s(t).collect(function(t){return t.pending_log_events()}).flatten().filter(this.event_filter).collect(function(t){return t.json}).value()),i={};return i[this.event_payload_name]=e,i},is_valid:function(t){var e=!!t;return e&&(e=s.result(t,"log_key")),e&&(e=s.result(t,"uuid")),e&&(e=s.isFunction(t.pending_log_events)),e},log:function(t,e){if(t){if(!(t in this.watching)){e&&e.log_key&&console.warn("log key gets overridden by log name");var i=p("keys",t);e=s.extend({},i,e,{log_key:t});var o=new this.Log(e);this.watch(o)}return this.watching[t]}},new_uuid:d}),i.extend=h,i.Log=m,e.exports=i},{"../utils/extend-with-defaults":283,"../utils/send-beacon":284,"../utils/uuid":285,"./config":271,"./log":275,"./logladyphp/event":277,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/flags":"f/LVtH","prima/lib/logger":268,"prima/utils/realnow":313}],270:[function(t,e){"use strict";var i,s=t("prima/lib/data"),o=function(){return i||(i=s.get("Components/LogLady")),i};e.exports=o()},{"prima/lib/data":263}],271:[function(t,e){"use strict";function i(){for(var t,e=n.apply(arguments),i=o,r=0;r<e.length;r++){if(t=e[r],!i||!s.has(i,t))return;i=i[t]}return i}var s=t("lodash"),o=t("./bootstrap"),n=[].slice;e.exports=i},{"./bootstrap":270,lodash:"K2RcUv"}],272:[function(t,e){"use strict";function i(t){return o.isString(t)?t:JSON.stringify(t)}function s(t,e,s){this.name=e,this.log_key=o.result(t,"log_key"),this.data=s||null;var n=a(),h=o.result(t,"generate_relative_id"),d=o.result(t,"env"),c=t.uuid,u={category:this.log_key},p=8,m=new Array(p);m[0]=i(n),m[1]=i(l),m[2]=i(c),m[3]=i(h),m[4]=i(r.getElapsed(n)),m[5]=i(e),m[6]=i(s),m[7]=i(d),u.fields=m,this.json=u}var o=t("lodash"),n=t("prima/utils/cookie"),r=t("prima/utils/realnow"),a=r.getRealNow,l=n.get("tmgioct");e.exports=s},{lodash:"K2RcUv","prima/utils/cookie":305,"prima/utils/realnow":313}],273:[function(t,e){"use strict";function i(t){var e=s.result(t,"logLadyKey"),i=s.result(t,"logEnv");if(e){var n=s.result(t,"logOptions")||{};return i&&(n.env=i),o.log(e,n)}}var s=t("lodash"),o=t("./logger");e.exports=i},{"./logger":274,lodash:"K2RcUv"}],274:[function(t,e){"use strict";var i=t("../base"),s=t("./event"),o=new i({EventClass:s,event_payload_name:"payload",event_filter:function(){return!0},endpoint:"/services/cslog"});e.exports=o},{"../base":269,"./event":272}],275:[function(t,e){"use strict";function i(t,e){t.uuid?(e=t,t=e.uuid):e||!t||s.isString(t)||(e=t,t=void 0),this.options=s.extend({},this.defaults,e),delete this.options.log_key,delete this.options.env,delete this.options.uuid,a(this,"uuid",t||this._generate_uuid()),e.env||(e.env={}),s.each(e.flags,function(t){e.env.flags||(e.env.flags={}),e.env.flags[t]=n.bool(t)}),a(this,"env",e.env),this.log_key=e.log_key||this.log_key,this.events=[],this.event_count=0,this.pending_events=[],this.event_counts={},this.started_at||(this.started_at=this.options.started_at||r.getRealNow()),delete this.options.started_at,this.initialize(e),this.options.init_event&&this.trigger("init")}var s=t("lodash"),o=t("backbone"),n=t("prima/lib/flags"),r=(t("prima/lib/logger"),t("prima/utils/realnow")),a=t("../utils/define-immutable-property"),l=t("../utils/extend-with-defaults"),h=t("../utils/uuid"),d=t("./config"),c=t("./logladyphp/event");s.extend(i.prototype,o.Events,{EventClass:c,initialize:s.noop,_generate_uuid:function(){return d("default_session")||h()},defaults:{init_event:!0,keep_counts:!1},pending_log_events:function(){var t=this.pending_events;return this.pending_events=[],t},generate_relative_id:function(){return this.event_count},unloaded:function(t){t||(t={}),t=this.before_unloaded(t)||{},this.options.keep_counts&&s.extend(t,{event_counts:this.event_counts}),s.isEmpty(t)||this.trigger("unload",t)},before_unloaded:function(t){return t},replaced:function(t){this.before_replaced(t);for(var e=this.pending_log_events();e.length;)this.log_lady.pending_events.push(e.shift())},before_replaced:s.noop,trigger:function(t,e){var i=new this.EventClass(this,t,e);return this.options.keep_counts&&"init"!==t&&"unload"!==t&&(this.event_counts[t]||(this.event_counts[t]=0),this.event_counts[t]++),this.event_count+=1,this.pending_events.push(i),o.Events.trigger.call(this,t,i,this),this}}),i.extend=l,e.exports=i},{"../utils/define-immutable-property":282,"../utils/extend-with-defaults":283,"../utils/uuid":285,"./config":271,"./logladyphp/event":277,backbone:"5kFNoY",lodash:"K2RcUv","prima/lib/flags":"f/LVtH","prima/lib/logger":268,"prima/utils/realnow":313}],276:[function(t,e){"use strict";var i=t("lodash"),s=t("../config"),o=i.keys(s("keys"));e.exports=function(t){return o.indexOf(t.log_key)>=0}},{"../config":271,lodash:"K2RcUv"}],277:[function(t,e){"use strict";function i(t,e,i){this.name=e,this.log_key=s.result(t,"log_key"),this.data=i||null;var o=n(),a=s.result(t,"generate_relative_id"),l=s.result(t,"env"),h=t.uuid,d={};d.log_key=this.log_key,d.uuid=h,d.event=this.name,d.ts=o,a!==!1&&void 0!==a&&(d.rid=a),d.elapsed=d.ts-r,d.data=this.data,d.env=l,this.json=d}var s=t("lodash"),o=t("prima/utils/realnow"),n=o.getRealNow,r=o.realStartedAt;e.exports=i},{lodash:"K2RcUv","prima/utils/realnow":313}],278:[function(t,e){"use strict";function i(t){var e=s.result(t,"logLadyKey"),i=s.result(t,"logEnv");if(e){var n=s.result(t,"logOptions")||{};return i&&(n.env=i),o.log(e,n)}}var s=t("lodash"),o=t("./logger");e.exports=i},{"./logger":279,lodash:"K2RcUv"}],279:[function(t,e){"use strict";var i=t("prima/events"),s=t("../base"),o=t("./event"),n=t("./event-filter"),r=new s({EventClass:o,event_payload_name:"events",event_filter:n,endpoint:"/svc/log/lady"});i.on("Capture:push",function(t,e,i){r.log(t,{init_event:!1}).trigger(e,i)}),e.exports=r},{"../base":269,"./event":277,"./event-filter":276,"prima/events":261}],280:[function(t,e){"use strict";var i=t("./endpoints/logladyphp/logger");e.exports=i},{"./endpoints/logladyphp/logger":279}],281:[function(t,e){"use strict";function i(t){var e,s;Object.freeze(t);for(s in t)e=t[s],t.hasOwnProperty(s)&&null!==e&&"object"==typeof e&&!Object.isFrozen(e)&&i(e)}e.exports=i},{}],282:[function(t,e){"use strict";function i(t,e,i){s.isObject(i)&&o(i),Object.defineProperty(t,e,{value:i,writeable:!1,enumerable:!0,configurable:!1})}var s=t("lodash"),o=t("./deepfreeze");e.exports=i},{"./deepfreeze":281,lodash:"K2RcUv"}],283:[function(t,e){"use strict";function i(t,e){var i,o=this;i=t&&s.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},s.extend(i,o,e);var n=function(){this.constructor=i};return n.prototype=o.prototype,i.prototype=new n,t.defaults&&(s.extend(i.prototype.defaults,t.defaults),delete t.defaults),t&&s.extend(i.prototype,t),i.__super__=o.prototype,i}var s=t("lodash");e.exports=i},{lodash:"K2RcUv"}],284:[function(t,e){"use strict";function i(t,e,i){return r(t,e),!!n.ajax({url:t,type:"POST",data:JSON.stringify(e),contentType:"application/json",async:i})}function s(t,e,s){r(t,e);var o=window.navigator.sendBeacon(t,JSON.stringify(e));return o||(o=i(t,e,s)),o}var o,n=t("jquery"),r=function(){};o=window.navigator&&window.navigator.sendBeacon?s:i,e.exports=o},{jquery:"HlZQrA"}],285:[function(t,e){"use strict";function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"===t?e:3&e|8;return i.toString(16)})}e.exports=i},{}],286:[function(t,e){"use strict";function i(t,e){h.each(e,function(e,i){var s=t[i];t[i]=function(){return e.apply(this,arguments),s.apply(this,arguments)}})}function s(t,e){h.each(e,function(e,i){var s=t[i];t[i]=function(){var t=s.apply(this,arguments);return e.apply(this,arguments),t}})}function o(t,e){h.each(e,function(e,i){var s=t[i];t[i]=function(){var t=h.toArray(arguments);return t.unshift(h.bind(s,this)),e.apply(this,t)}})}function n(t,e){h.each(e,function(e,i){var s=i in t?t[i]:!1;t[i]=function(){var t=h.toArray(arguments),i=s?h.bind(s,this):h.noop;return t.unshift(i),e.apply(this,t)}})}function r(t,e){h.defaults(t,e)}function a(t,e){h.extend(t,e)}function l(){this.mixins=h.filter(arguments,function(t){return t instanceof l}),this.properties=arguments[this.mixins.length]||{}}var h=t("lodash");l.prototype.mixins=null,l.prototype.properties=null,l.prototype.applyTo=function(t){var e=this.properties;r(t,e.defaults),a(t,e.extend),h.extend(t,h.omit(e,"before","after","around","onto","defaults","extend","applyTo")),h.invoke(this.mixins,"applyTo",t),i(t,e.before),s(t,e.after),o(t,e.around),n(t,e.onto),h.isFunction(e.applyTo)&&e.applyTo.apply(this,arguments)},l.before=i,l.after=s,l.around=o,l.onto=n,e.exports=l},{lodash:"K2RcUv"}],287:[function(t,e){"use strict";{var i=t("prima/lib/translate");t("prima/lib/logger")}e.exports={__:i}},{"prima/lib/logger":268,"prima/lib/translate":288}],288:[function(t,e){"use strict";function i(t){n.addEntries(s.isObject(t)?t:{})}var s=t("lodash"),o=t("./dictionary"),n=new o({name:"Translations"}),r=s.bind(n.get,n);r.setup=s.once(i),e.exports=r},{"./dictionary":264,lodash:"K2RcUv"}],289:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=t("../lib/mixin"),n=s.Model.prototype,r=new o({defaults:i.extend({},s.Events),get:n.get,has:n.has,set:n.set,unset:n.unset,clear:n.clear,hasChanged:n.hasChanged,changedAttributes:n.changedAttributes,previous:n.previous,toJSON:n.toJSON,toggle:function(t){this.set(t,!this.get(t))},_validate:i.constant(!0),before:{initialize:function(){var t=i.defaults({},i.result(this,"defaults"));this.attributes={},this.set(t),this.changed={}}}});e.exports=r},{"../lib/mixin":286,backbone:"5kFNoY",lodash:"K2RcUv"}],290:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/mixin"),o=new s({delegateObject:function(t){var e={},o={};t&&(i.each(t,function(t,i){"undefined"!=typeof t&&("function"==typeof t?e[i]=t:o[i]=t)},this),s.onto(this,e),i.extend(this,o))}});e.exports=o},{lodash:"K2RcUv","prima/lib/mixin":286}],291:[function(t,e){"use strict";var i=t("prima/lib/mixin"),s=t("prima/events"),o=t("lodash"),n=t("./registry"),r=new i({__bindKeycommands:function(){o.result(this,"keycommands")&&(o.each(o.result(this,"keycommands"),this.__bindKey,this),n.add({id:this.__keyId,keys:o.keys(o.result(this,"keycommands"))}))},__bindKey:function(t,e){this.listenTo(s,"DOMEventor:"+e,this.__keyFn)},__keyFn:function(t,e){n.shouldRun(e,this.__keyId)&&this[this.keycommands[e]].apply(this,arguments)},focusKeys:function(){n.focus(this.__keyId)},unfocusKeys:function(){n.unfocus(this.__keyId)},soloKeys:function(){n.solo(this.__keyId)},unSoloKeys:function(){n.unSolo(this.__keyId)},before:{initialize:function(){this.keycommands||(this.keycommands={}),this.__keyId=o.uniqueId("keycomms"),this.__bindKeycommands()},stopListening:function(){n.remove(this.__keyId)}}});e.exports=r},{"./registry":292,lodash:"K2RcUv","prima/events":261,"prima/lib/mixin":286}],292:[function(t,e){"use strict";var i=t("prima/class"),s=t("lodash"),o=i.extend({soloId:null,constructor:function(){this.keySets=[]},add:function(t){this.keySets.unshift(t)},remove:function(t){var e=this.getSetForId(t);e&&(this.unSolo(t),this.keySets=s.without(this.keySets,e))},focus:function(t){var e=this.getSetForId(t);e&&(this.keySets=s.without(this.keySets,e),this.keySets.unshift(e))},unfocus:function(t){var e=this.getSetForId(t);e&&(this.keySets=s.without(this.keySets,e),this.keySets.push(e))},solo:function(t){var e=this.getSetForId(t);e&&(this.soloId=t)},unSolo:function(t){this.soloId===t&&(this.soloId=null)},getSetForId:function(t){return this.keySets[s.findIndex(this.keySets,{id:t})]},getSetsWithKey:function(t){return s.where(this.keySets,{keys:[t]})},shouldRun:function(t,e){var i=this.getSetsWithKey(t);return this.soloId===e?!0:i.length>1?i[0].id===e:!0}});e.exports=new o},{lodash:"K2RcUv","prima/class":258}],293:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("../lib/mixin"),n=t("prima/events"),r=t("prima/mixins/subviewable"),a=!1,l=i("body"),h=t("prima/lib/clickoutside"),d=function(t){return s.noop},c=new o(r,{removeAutoTeardown:function(){this._popoverBase.clickOutside&&(this._popoverBase.clickOutside.remove(),this._popoverBase.clickOutside=null)},setupAutoTeardown:function(){this._rendered&&(this.removeAutoTeardown(),this._popoverBase.autoTeardown&&(this._popoverBase.clickOutside=new h(this.el),this._popoverBase.clickOutside.on("click:outside",this.onClickOutside,this)))},onClickOutside:function(){this._popoverBase.shouldTeardown?(this._popoverBase.lastAutoTeardown=s.now(),this.teardown()):this._popoverBase.shouldTeardown=!0},reposition:function(){var t=this.pinnedRect(),e={scrollTop:this.isContainerBody?0:this.$container.scrollTop(),scrollLeft:this.isContainerBody?0:this.$container.scrollLeft(),realTop:this.isContainerBody?0:this.$container.offset().top,realLeft:this.isContainerBody?0:this.$container.offset().left},i=this._popoverBase.shift,o=this._popoverBase.pinnedSide,n={},r={},a=this.$el.width(),l=null,h=null,d=null,c=null;this.debug("reposition: pinnedSide=%s, shift=%O, pinnedRect=%O",o,i,t),"top"===o||"bottom"===o?(s.extend(n,{left:t.left+Math.floor(t.width/2)+i.x}),r={top:t.top+e.scrollTop-i.y,bottom:t.top+e.scrollTop+t.height+i.y,left:t.left+e.scrollLeft-i.x,right:t.left+e.scrollLeft+t.width+i.x},r.center=(r.right-r.left)/2,l=e.realTop+r.top-this.$el.height(),h=e.realTop+r.bottom+this.$el.height(),"top"===o&&this._crossesViewportEdge("top",l)&&!this._crossesViewportEdge("bottom",h)&&(o="bottom"),"bottom"===o&&this._crossesViewportEdge("bottom",h)&&!this._crossesViewportEdge("top",l)&&(o="top"),"bottom"===o?s.extend(n,{top:r.bottom,transform:"translateX(-50%)"}):"top"===o&&s.extend(n,{top:r.top,transform:"translateX(-50%) translateY(-100%)"}),d=e.realLeft+(r.center+r.left)-a/2,c=e.realLeft+(r.center+r.left)+a/2,this._crossesViewportEdge("left",d)&&!this._crossesViewportEdge("right",c)&&s.extend(n,{left:this._popoverBase.minDistanceFromContainer+"px",transform:"top"===o?"translateX(0) translateY(-100%)":"translateX(0)"}),!this._crossesViewportEdge("left",d)&&this._crossesViewportEdge("right",c)&&s.extend(n,{left:"auto",right:this._popoverBase.minDistanceFromContainer+"px",transform:"top"===o?"translateX(0) translateY(-100%)":"translateX(0)"})):"left"===o||"right"===o?(s.extend(n,{top:t.top-i.y}),r={left:t.left+e.scrollLeft-i.x,right:t.left+e.scrollLeft+t.width+i.x},d=e.realLeft+r.left-this.$el.width(),c=e.realLeft+r.right+this.$el.width(),"left"===o&&this._crossesViewportEdge("left",d)&&!this._crossesViewportEdge("right",c)&&(o="right"),"right"===o&&this._crossesViewportEdge("right",c)&&!this._crossesViewportEdge("left",d)&&(o="left"),"left"===o?s.extend(n,{left:r.left,transform:"translateX(-100%) translateY(-50%)"}):"right"===o&&s.extend(n,{left:r.right,transform:"translateY(-50%)"})):s.extend(n,{top:t.top-i.y,left:t.left+i.x,transform:""}),s.extend(n,{transform:n.transform}),this.$el.css(n),this.debug("reposition: ad-hoc css %O",n),this.$el.removeClass("top bottom left right").addClass(o)},_crossesViewportEdge:function(t,e){var s=i(window),o={top:s.scrollTop(),left:s.scrollLeft(),right:s.scrollLeft()+s.width(),bottom:s.scrollTop()+s.height()};return this.debug("viewportCheck against %s side (%s) coordinate=[%s]",t,o[t],e),"top"===t?o.top>e:"bottom"===t?o.bottom<e:"left"===t?o.left>e:"right"===t?o.right<e:void 0},isRendered:function(){return this._rendered},isOrWasRecentlyRendered:function(){var t=this._popoverBase.lastAutoTeardown,e=s.now()-t;return 100>e||this._rendered},setPinnedSide:function(t){return this._popoverBase.pinnedSide=t,this},setPinnedTarget:function(t){return this.$pinned=i(t),this.debug("setPinnedTarget: %O",this.$pinned),this},setPopoverContainer:function(t){return this.$container=i(t),this.isContainerBody=this.$container.is(l),this.debug("setPopoverContainer: %O, isContainerBody=%s",this.$container,this.isContainerBody),this},setShift:function(t){if(!s.isObject(t)||!s.isNumber(t.x)||!s.isNumber(t.y))throw new Error("Popover shift needs to be: {Object} => x: {Number}, y: {Number}");return this._popoverBase.shift.x=t.x,this._popoverBase.shift.y=t.y,this},getShift:function(){return this._popoverBase.shift},_initializeDebugger:function(){this.debug=a?d(this):s.noop},defaults:{pinnedRect:function(){var t=this.$container.offset(),e=this.$pinned.offset(),i={};return i.height=this.$pinned.outerHeight(),i.width=this.$pinned.outerWidth(),i.top=Math.round(e.top-t.top),i.left=Math.round(e.left-t.left),i.bottom=Math.round(i.top+i.height),i.right=Math.round(i.left+i.width),this.debug("pinnedRect calculation: container %O, pinned %O, containerOffset %O, pinnedOffset %O",this.$container,this.$pinned,t,e),this.debug("pinnedRect results: height(pinnedOuterHeight)=%s, width(pinnedOuterWidth)=%s, top(pTop-cTop)=%s, left=(pLeft-cLeft)=%s, bottom(top+height)=%s, right(left+width)=%s",i.height,i.width,i.top,i.left,i.bottom,i.right),i}},after:{initialize:function(t){var e={identifier:"popover",pinnedSide:"bottom",className:"popover--base",autoTeardown:!0,teardownOnEscape:!0,minDistanceFromContainer:10,shift:{x:0,y:0},clickOutside:null,lastAutoTeardown:0,shouldTeardown:!0};this._popoverBase=s.defaults(s.pick(t||{},s.keys(e)),e),this._initializeDebugger(),this.setPinnedTarget(t.pinnedTarget||null),this.setPopoverContainer(t.popoverContainer||l)},render:function(){this.$el.addClass(this._popoverBase.className),this.$el.appendTo(this.$container);var t=this.$el.children().first(),e=t.width();t.width(e-e%2),this._popoverBase.autoTeardown&&this.setupAutoTeardown(),this.reposition(),this.isContainerBody&&(this.debug("DOMEventor subscribe: flatresize + flatscroll reposition active"),this.listenTo(n,"DOMEventor:flatresize",this.reposition),this.listenTo(n,"DOMEventor:flatscroll",this.reposition)),this._popoverBase.teardownOnEscape&&this.listenTo(n,"DOMEventor:keyup:escape",this.teardown),this.trigger("open",this),n.trigger(this._popoverBase.identifier+":open",this)},teardown:function(){this._popoverBase.teardownOnEscape&&this.stopListening(n,"DOMEventor:keyup:escape"),this.$el.off("mousewheel DOMMouseScroll"),this.removeAutoTeardown(),this.trigger("close",this),n.trigger(this._popoverBase.identifier+":close",this)}}});e.exports=c},{"../lib/mixin":286,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":261,"prima/lib/clickoutside":262,"prima/mixins/subviewable":296}],294:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("../lib/mixin"),n=new o({defaults:{whenEvent:function(t,e){return 1===arguments.length&&(e=t,t=this),s.promise(i.bind(function(i){this.listenToOnce(t,e,function(){i.call(void 0,arguments)})},this))}}});e.exports=n},{"../lib/mixin":286,lodash:"K2RcUv",when:"RG2dij"}],295:[function(t,e){"use strict";function i(t){return s.trim(t)}var s=t("lodash"),o=t("../lib/mixin"),n=function(t,e){return t=i(t),e&&s.isFunction(this.$$)&&delete this.$$.cache[t],t},r=function(t){return this.$$?(t=i(t),this.$(t)):void 0},a=function(t){this.$$&&(t=i(t),delete this.$$.cache[t])},l=function(t){return this.$$?(t=i(t),delete this.$$.cache[t],this.$(t)):void 0},h=function(){this.$$&&(s.forEach(this.$$.cache,function(t,e,i){delete i[e]}),this.$$.cache={})},d=function(t){return"[data-js-"+t+"]"},c=function(t){return function(){var t=s.memoize(s.bind(r,this),s.bind(n,this));t.update=s.bind(l,this),t.remove=s.bind(a,this),t.empty=s.bind(h,this);var e=function(e,i){return t(d(e),i)};return e.update=function(e){t.update(d(e))},e.remove=function(e){t.remove(d(e))},this.$$=t,this.js$=e,this.$$initialize=s.noop,t}.call(t)},u=new o({defaults:{$$cacheKeys:{},$$cacheSelectors:function(t){return"undefined"==typeof t&&(t=this.$$cacheKeys),s.forEach(t,function(t){this.$$.update(t)},this),this},$$initialize:function(){return c(this)},$$:function(){return c(this).apply(this,arguments)}},before:{initialize:function(){this.$$initialize()},render:function(){this.$$.empty()}},after:{setElement:function(){s.isFunction(this.$$.empty)&&this.$$.empty()},remove:function(){s.isFunction(this.$$.empty)&&this.$$.empty()},render:function(){s.isFunction(this.$$cacheSelectors)&&this.$$cacheSelectors()}}});e.exports=u},{"../lib/mixin":286,lodash:"K2RcUv"}],296:[function(t,e){"use strict";var i=t("lodash"),s=t("../lib/mixin"),o=new s({defaults:{teardown:function(){return this},beforeTeardown:function(){},afterTeardown:function(){return this.teardownSubViews()},render:function(){return this},beforeRender:function(){},afterRender:function(){return this.renderSubViews()},attachSubView:function(t,e){if(1===arguments.length)if("string"==typeof t){if(e=t,t=this.subViews[e],!t)return this}else e=t.$el.data("subview")||"";var i=this.$('[data-subview="'+e+'"]');return i.length>1&&(i=i.first()),t&&i.length&&(i.replaceWith(t.$el),t.$el.attr("data-subview",e)),this},attachSubViews:function(){return i.forEach(this.subViews,this.attachSubView,this),this},teardownSubViews:function(){return i.forEach(this.subViews,function(t,e){t&&i.isFunction(t.teardown)&&t.teardown(),this.subViews[e]=null},this),this.subViews={},this},renderSubViews:function(){return i.forEach(this.subViews,function(t){t&&i.isFunction(t.render)&&t.render()},this),this},isInitialized:function(){return this._initialized},isRendered:function(){return this._rendered},isRendering:function(){return this._rendering},isRemoved:function(){return this._removed}},around:{initialize:function(t){this._initialized=!1,this._rendering=!1,this._rendered=!1,this._removed=!1,this.subViews={};var e=t.apply(this,i.rest(arguments));return this._initialized=!0,e},teardown:function(t){var e=i.rest(arguments);i.isFunction(this.beforeTeardown)&&this.beforeTeardown.apply(this,e);var s=t.apply(this,e);return i.isFunction(this.afterTeardown)&&this.afterTeardown.apply(this,e),this._rendered=!1,s},render:function(t){var e=i.rest(arguments);this._rendering=!0,i.isFunction(this.beforeRender)&&this.beforeRender.apply(this,e);var s=t.apply(this,e);return i.isFunction(this.afterRender)&&this.afterRender.apply(this,e),this._rendering=!1,this._rendered=!0,s}},after:{remove:function(){this._removed=!0,this.subViews=null}}});e.exports=o},{"../lib/mixin":286,lodash:"K2RcUv"}],297:[function(t,e){"use strict";var i=t("../lib/mixin"),s=new i({before:{sync:function(t,e,i){i.with_form_key=!0}}});e.exports=s},{"../lib/mixin":286}],298:[function(t,e){"use strict";var i=t("backbone"),s=t("./mixins/withformkeytrue"),o=t("./lib/extendwithmixins"),n=i.Model.extend({});s.applyTo(n.prototype),o.applyTo(n),e.exports=n},{"./lib/extendwithmixins":267,"./mixins/withformkeytrue":297,backbone:"5kFNoY"}],299:[function(t,e){"use strict";var i=t("backbone"),s=t("prima/bootloader"),o=(t("prima/lib/logger"),t("logs/logging-manager")),n=i.Router.extend({root:"/",logs:function(){return[t("logs/instruments/generic")]},constructor:function(){o.startLogs(this.logs()),i.Router.apply(this,arguments)},getName:function(){return"Prima/Router"}},{Bootloader:s,bootloader:function(t){return new this.Bootloader(t)}});e.exports=n},{backbone:"5kFNoY","logs/instruments/generic":250,"logs/logging-manager":256,"prima/bootloader":257,"prima/lib/logger":268}],300:[function(t,e){"use strict";function i(t,e){function i(t,e){var i,o;if(!s.isObject(t))throw new Error("SingletonModel requires attributes");if(i=t[u],s.isEmpty(i)&&!s.isNumber(i))throw new Error('SingletonModel attributes require a "'+u+'"');if(o=d[i],c[i]++||(c[i]=1),o)s.keys(t).length>=2&&o.set(t,e),o.collection!==!0&&(o.collection=!0);else{d[i]=this;try{Object.defineProperty(this,"collection",{value:!0,configurable:!1,enumerable:!0,writable:!1})}finally{this.collection||(this.collection=!0)}this.constructor.__super__.constructor.call(this,t,e),h.add(this)}return o||this}function r(){return this.id}function a(){return h}function l(){0===--c[this.id]&&(delete d[this.id],delete c[this.id],h.remove(this))}t||(t={}),e||(e={});var h=new o.Collection,d=Object.create(null),c=Object.create(null),u=t.idAttribute||n.prototype.idAttribute;return t.constructor=i,t.release=l,t.toString=r,t.toJSON=t.toJSON||n.prototype.toJSON,e.getCollection=a,n.extend(t,e)}var s=t("lodash"),o=t("backbone"),n=t("./model");e.exports.extend=i},{"./model":298,backbone:"5kFNoY",lodash:"K2RcUv"}],301:[function(t,e){"use strict";function i(){var t,e,i={animation:null,transition:null},s=document.createElement("div"),o={animation:"animationend",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in o)if(void 0!==s.style[e]){i.animation=o[e];break}var n={transition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in n)if(void 0!==s.style[t]){i.transition=n[t];break}return i}function s(t,e){r.animation?n(t).one(r.animation,function(t){e(t)}):setTimeout(function(t){e(t)},0)}function o(t,e){r.transition?n(t).one(r.transition,function(t){e(t)}):setTimeout(function(t){e(t)},0)}var n=t("jquery"),r=i();e.exports={animation:s,transition:o}},{jquery:"HlZQrA"}],302:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/class"),o=s.extend({vendors:["moz","webkit","ms","o","khtml"],el:document.body||document.documentElement,get:i.memoize(function(t){return this._getProp(t)}),prop:function(t){return!!this.get(t)},_getProp:function(t){var e=!1;return"string"==typeof this.el[t]?t:"string"==typeof this._styles()[t]?t:(t=t.charAt(0).toUpperCase()+t.substr(1),i.forEach(this.vendors,function(i){"undefined"!=typeof this.el[i+t]&&(e=i+t),"undefined"!=typeof this._styles()[i+t]&&(e=i+t)},this),e)},_styles:i.memoize(function(){return this.el.style})});e.exports=new o},{lodash:"K2RcUv","prima/class":258}],303:[function(t,e){"use strict";function i(t,e){if(t in s)return s[t];var i=window[t];if(!e||!e(i)){var o=document.createElement("iframe");document.body.appendChild(o),i=o.contentWindow[t],document.body.removeChild(o)}return s[t]=i,i}var s={};e.exports=i},{}],304:[function(t,e){"use strict";function i(t,e,i){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)}function s(t){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function o(t,e,i){var s=Math.min(Math.min(t,e),i),o=Math.max(Math.max(t,e),i),n=o-s,r={h:6,s:o?(o-s)/o:0,v:o/255};return n?r.h+=o===t?(e-i)/n:o===e?2+(i-t)/n:4+(t-e)/n:r.h=0,r.h=60*r.h%360,r}function n(t,e,i){var s,o,n;if(e){s=o=n=0;var r=(t+360)%360/60,a=i*e,l=i-a,h=a*(1-Math.abs(r%2-1));1>r?(s=a,o=h):2>r?(s=h,o=a):3>r?(o=a,n=h):4>r?(o=h,n=a):5>r?(n=a,s=h):(n=h,s=a),s+=l,o+=l,n+=l}else s=o=n=i;return{r:Math.round(255*s),g:Math.round(255*o),b:Math.round(255*n)}}function r(t){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=s(t),i=o(e[0],e[1],e[2]);return i}function a(t,e,s){var o=n(t,e,s),r=i(o[0],o[1],o[2]);return r}function l(t,e){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var i,s,o,n=parseInt(t,16),r=0>e?0:255,a=0>e?-e:e,l=n>>16,h=n>>8&255,d=255&n;return i=Math.round((r-l)*a)+l,s=Math.round((r-h)*a)+h,o=Math.round((r-d)*a)+d,"#"+(16777216+65536*i+256*s+o).toString(16).slice(1)}function h(t){return"string"==typeof t&&(t=r(t)),t.s<.2&&t.v>.8?"#444":"#FFF"}function d(t,e,i){var s={upperBound:.8,lowerBound:.2,diffBound:.1,hueBound:15};c.extend(s,i);var o=s.upperBound,n=s.lowerBound,r=s.diffBound,a=s.hueBound,l=Math.abs(t.h-e.h),h=Math.abs(t.s-e.s),d=Math.abs(t.v-e.v);return r>=l&&r>=h&&r>=d?!0:r>=h&&r>=d&&(h>=o||n>=h&&d>=o||n>=d&&a>=l)?!0:!1}var c=t("lodash");e.exports={rgbToHex:i,hexToRgb:s,rgbToHsv:o,hsvToRgb:n,hexToHsv:r,hsvToHex:a,brighten:l,readable:h,compare:d}},{lodash:"K2RcUv"}],305:[function(t,e){"use strict";function i(t){return new RegExp(t+"=([^;]+)").test(decodeURIComponent(document.cookie))}function s(t){return new RegExp(t+"=([^;]+)").test(decodeURIComponent(document.cookie))?RegExp.$1:null}function o(t,e,i,s){"object"==typeof e&&(e=JSON.stringify(e));var o=encodeURIComponent(t)+"="+encodeURIComponent(e);if(l.isPlainObject(i)&&(s=i,i=s?s.expires:!1),s=l.extend({expires:i},c,s),s.expires instanceof Date)o+=";expires="+s.expires.toGMTString();else if("number"==typeof s.expires){var n=new Date;n.setTime(n.getTime()+1e3*s.expires),o+=";expires="+n.toGMTString()}s.path&&(o+=";path="+encodeURI(s.path)),s.secure&&(o+=";secure"),s.domain&&(o+=";domain="+encodeURI(s.domain)),document.cookie=o}function n(t){o(t,"",-1)}function r(t,e){var i=s(t);try{i=JSON.parse(i)}catch(o){return i}return e?d(i,e):i}function a(t,e,i,s){var n;l.isPlainObject(e)?(s=i,n=e):(n=r(t)||{},l.isPlainObject(n)||(n={}),h(n,e,i)),o(t,JSON.stringify(n),s)}var l=t("lodash"),h=t("./setpath"),d=t("./getpath"),c={path:"/",secure:!1,domain:""},u={has:i,get:s,set:o,unset:n,getHash:r,setHash:a};e.exports=u},{"./getpath":308,"./setpath":316,lodash:"K2RcUv"}],306:[function(t,e){"use strict";function i(t,e,i){return function(){i||(i=this);var s=arguments;return setTimeout(function(){t.apply(i,s)},e)}}e.exports=i},{}],307:[function(t,e){"use strict";function i(t,e){e=e||"Exposer";var i=window;s.each(t,function(t,s){if(n(i,s))throw new Error('"'+s+'" already exists');
o.log(e,"%s.%s",i,s),r(i,s,t)})}var s=t("lodash"),o=t("../lib/logger"),n=t("./haspath"),r=t("./setpath");e.exports=i},{"../lib/logger":268,"./haspath":309,"./setpath":316,lodash:"K2RcUv"}],308:[function(t,e){"use strict";function i(t,e){"string"==typeof t&&(e=t,t=window),e=e.split(".");for(var i;;){if(i=e.shift(),!(i in t))return;if(0===e.length)return t[i];t=t[i]}}e.exports=i},{}],309:[function(t,e){"use strict";function i(t,e){"string"==typeof t&&(e=t,t=window),e=e.split(".");for(var i;;){if(i=e.shift(),!(i in t))return!1;if(0===e.length)return!0;t=t[i]}}e.exports=i},{}],310:[function(t,e){"use strict";var i=t("jquery"),s=function(t,e,i){if(0===i)return 0;var s=null==i?e:e/i;return 2===arguments.length?Math.round(t*s):void 0},o=function(t,e,i){if(0===i)return 0;var s=null==i?e:e/i;return Math.round(t/s)},n=function(t,e,i,n){var r=t,a=e,l=t/e,h=i/n;return(t>i||e>n)&&(l>h?(r=i,a=o(r,l)):(a=n,r=s(a,l))),{width:r,height:a}},r=function(t,e,i,n,r,a){null!=r||(r=.5),null!=a||(a=.5);var l=0,h=0,d=t,c=e,u=t/e,p=i/n;return u>p?(d=s(e,p),l=Math.round(r*(t-d))):p>u&&(c=o(t,p),l=Math.round(a*(e-c))),{left:l,top:h,width:d,height:c}},a=function(t){var e;t instanceof i?(e=t,t=e.get(0)):e=i(t);var s=document.createElement("canvas");return s.width=t.width||e.width(),s.height=t.height||e.height(),s},l=function(t,e,s){var o;t instanceof i?(o=t,t=o.get(0)):o=i(t),e?e instanceof i&&(e=e.get(0)):e=a(t);var n=e.width,r=e.height,l=e.getContext("2d");return l.save(),s&&(l.translate(e.width,0),l.scale(-1,1)),l.drawImage(t,0,0,n,r),l.restore(),e},h=function(t,e,s,n,r,a){var l;t instanceof i?(l=t,t=l.get(0)):l=i(t);var h=90===n||270===n;h?a&&s>a&&(e=o(a,s,e),s=a):a&&e>a&&(s=o(a,e,s),e=a);var d=document.createElement("canvas");h?(d.width=s,d.height=e):(d.width=e,d.height=s);var c=d.getContext("2d");return c.save(),c.translate(.5*d.width,.5*d.height),c.rotate(n*Math.PI/180),r&&c.scale(-1,1),c.drawImage(t,-.5*e,-.5*s,e,s),c.restore(),d},d={widthForHeight:s,heightForWidth:o,maxSize:n,cropBox:r,createCanvasForEl:a,drawElToCanvas:l,drawScaledAndRotated:h};e.exports=d},{jquery:"HlZQrA"}],311:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("prima/class"),n="FileReader"in window&&"readAsDataURL"in FileReader.prototype,r=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL,a=[],l=t("app/vendor/jpegmeta").JpegFile,h=o.extend({constructor:function(t){null!=t&&this.read(t)},read:function(t,e){if(!i.isUndefined(e)||(e=!0),this.file=t,!t)return s.reject("No file to read");if(!n)return s.reject("FileReader is not supported");t.type.match(/image\/(jpg|jpeg)/i)||(e=!1);var o;return o=e&&"readAsBinaryString"in FileReader.prototype?this.readBinaryString(t).then(i.bind(function(e){try{var s=new l(e.binary,t.name);e.rotation=function(t){switch(t){case 1:return 0;case 2:return 0;case 3:return 180;case 4:return 180;case 5:return 270;case 6:return 90;case 7:return 90;case 8:return 270;default:return 0}}(s.tiff.Orientation.value),e.mirrored=function(t){switch(t){case 2:return!0;case 4:return!0;case 5:return!0;case 7:return!0;default:return!1}}(s.tiff.Orientation.value)}catch(o){}return this.readDataUrl(t).then(i.bind(function(t){return i.extend(e,t)},this))},this)):this.readDataUrl(t),this.promise=o,o},readDataUrl:function(t){var e=new FileReader;return"readAsDataURL"in e?s.promise(function(i,s){e.onload=function(t){var s=t.target.result;i(s),e.onload=null,e.onerror=null},e.onerror=function(){s(),e.onload=null,e.onerror=null},e.readAsDataURL(t)}).then(i.bind(this._onLoadDataUrl,this),i.bind(this._onError,this)):s.reject("FileReader.readAsDataURL is not supported")},_onLoadDataUrl:function(t){var e={base64:t,file:this.file};return r&&(e.objectUrl=r(this.file),a.push(e.objectUrl)),s.resolve(e)},readBinaryString:function(t){var e=new FileReader;return"readAsBinaryString"in e?s.promise(function(i,s){e.onload=function(t){var s=t.target.result;i(s),e.onload=null,e.onerror=null},e.onerror=function(){s(),e.onload=null,e.onerror=null},e.readAsBinaryString(t)}).then(i.bind(this._onLoadBinaryString,this),i.bind(this._onError,this)):s.reject("FileReader.readAsBinaryString is not supported")},_onLoadBinaryString:function(t){return s.resolve({binary:t,file:this.file})},_onError:function(t){return s.reject("Failed to read file")}},{read:function(t,e){var i=new h(t,e);return i.promise},canReadFiles:function(){return n}});e.exports=h},{"app/vendor/jpegmeta":217,lodash:"K2RcUv","prima/class":258,when:"RG2dij"}],312:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("prima/class"),n=o.extend({constructor:function(t){null!=t&&this.load(t)},load:function(t){if(this.src=t,!t)return s.reject("No URL to load");var e=this,o=s.promise(function(i,s){var o=new Image;o.src=t,e._img=o,o.onload=function(){i(o),o.onload=null,o.error=null},o.onerror=function(){s(o),o.onload=null,o.error=null},o.complete&&(o.naturalWidth||o.naturalHeight?"function"==typeof o.onload&&o.onload():"function"==typeof o.onerror&&o.onerror())});return this.promise=o=o.then(i.bind(this._onLoad,this),i.bind(this._onError,this)),o},_onLoad:function(t){return this._img===t?(this.width=t.naturalWidth,this.height=t.naturalHeight,this.src=t.src,this.loaded=!0,s.resolve({width:this.width,height:this.height,src:this.src})):this.promise},_onError:function(t){return this._img===t?(this.width=null,this.height=null,this.src=t.src,this.loaded=!1,s.reject(this.src+" failed to load")):this.promise}},{load:function(t){var e=new n(t);return e.promise}});e.exports=n},{lodash:"K2RcUv","prima/class":258,when:"RG2dij"}],313:[function(t,e){"use strict";var i,s=t("../lib/data"),o=t("./getpath"),n=function(t,e){var i=t&&t.timing&&t.timing.responseStart||Date.now();return function(){return e+(Date.now()-i)}}(window.performance,s.get("Context/time")),r={getRealNow:o("Tumblr.getRealNow"),realStartedAt:o("Tumblr.real_started_at"),startedAt:o("Tumblr.started_at")},a=function(){return i||(i=r.getRealNow?r:{getRealNow:n,realStartedAt:n(),startedAt:(new Date).getTime()}),i};e.exports=a(),e.exports.getElapsed=function(t){return t||(t=this.getRealNow()),t-this.realStartedAt}},{"../lib/data":263,"./getpath":308}],314:[function(t,e){"use strict";var i=function(t,e){return e||(e=this),function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this),t.apply(e,i)}};e.exports=i},{}],315:[function(t,e){"use strict";var i=t("lodash"),s=t("when/sequence"),o=function(t,e){t=i.map(t,function(t){return i.bind(t,this)},e||this);var o=Array.prototype.slice.call(arguments,1);return o[0]=t,s.apply(void 0,o)};e.exports=o},{lodash:"K2RcUv","when/sequence":335}],316:[function(t,e){"use strict";function i(t,e,i){"string"==typeof t&&(i=e,e=t,t=window),e=e.split(".");for(var s,o=e.pop();e.length;)s=e.shift(),t=s in t?t[s]:t[s]={};return t[o]=i}e.exports=i},{}],317:[function(t,e){"use strict";var i=t("lodash"),s={aElement:document.createElement("a"),acceptedProtocols:["http:","https:","tumblr:","mailto:"],parseUrl:function(t){if(!i.startsWith(t,"http"))throw new URIError("Missing protocol in URL to be parsed. Must be http or https");return this.aElement.setAttribute("href",t),{url:t,protocol:this.aElement.protocol,host:this.aElement.hostname,port:this.aElement.port,query:this.aElement.search,hash:this.aElement.hash,path:this.aElement.pathname}},parseTumblelogUrl:function(t){try{-1===t.indexOf("://")&&(t="http://"+t);var e=this.parseUrl(t),s=!1;if(i.endsWith(e.host,"tumblr.com")?s=e.host.match(/([a-zA-Z0-9-_]+)\.tumblr\.com/i):i.endsWith(e.host,"tumblr.net")?s=e.host.match(/([a-zA-Z0-9-_]+)\.[a-zA-Z0-9-_]+\.[a-zA-Z0-9-_]+\.tumblr.net/i):i.endsWith(e.host,"t.dev")&&(s=e.host.match(/([a-zA-Z0-9-_]+)\.t\.dev/i)),s){var o=s[1];if("www"===o)return!1;var n={tumblelog_name:o},r=e.path.match(/post\/([0-9]+)/i);return r&&(n.post_id=r[1]),n}return!1}catch(a){return!1}},isTumblelogUrl:function(t){return this.parseTumblelogUrl(t)===!1?!1:!0},hasAllowedProtocol:function(t){this.aElement.setAttribute("href",t);var e=this.aElement.protocol;if(":"===e&&(e=location.protocol),-1===this.acceptedProtocols.indexOf(e))throw new Error("Unsupported protocol detected in URL: "+t);return!0},isAbsoluteUrl:function(t){var e=new RegExp("^(?:[a-z]+:)?//","i");return!!e.test(t||"")},getParameter:function(t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}};e.exports=s},{lodash:"K2RcUv"}],318:[function(t,e){var i=t("backbone"),s=t("./lib/extendwithmixins"),o=i.View.extend();s.applyTo(o),e.exports=o},{"./lib/extendwithmixins":267,backbone:"5kFNoY"}],319:[function(t,e){!function(t){"use strict";function i(){this.frames=[],this.lastId=0,this.raf=s,this.batch={hash:{},read:[],write:[],mode:null}}{var s=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||function(t){window.clearTimeout(t)}}i.prototype.read=function(t,e){var i=this.add("read",t,e),s=i.id;this.batch.read.push(i.id);var o="reading"===this.batch.mode||this.batch.scheduled;return o?s:(this.scheduleBatch(),s)},i.prototype.write=function(t,e){var i=this.add("write",t,e),s=this.batch.mode,o=i.id;this.batch.write.push(i.id);var n="writing"===s||"reading"===s||this.batch.scheduled;return n?o:(this.scheduleBatch(),o)},i.prototype.defer=function(t,e,i){"function"==typeof t&&(i=e,e=t,t=1);var s=this,o=t-1;return this.schedule(o,function(){s.run({fn:e,ctx:i})})},i.prototype.clear=function(t){if("function"==typeof t)return this.clearFrame(t);var e=this.batch.hash[t];if(e){var i=this.batch[e.type],s=i.indexOf(t);delete this.batch.hash[t],~s&&i.splice(s,1)}},i.prototype.clearFrame=function(t){var e=this.frames.indexOf(t);~e&&this.frames.splice(e,1)},i.prototype.scheduleBatch=function(){var t=this;this.schedule(0,function(){t.batch.scheduled=!1,t.runBatch()}),this.batch.scheduled=!0},i.prototype.uniqueId=function(){return++this.lastId},i.prototype.flush=function(t){for(var e;e=t.shift();)this.run(this.batch.hash[e])},i.prototype.runBatch=function(){try{this.batch.mode="reading",this.flush(this.batch.read),this.batch.mode="writing",this.flush(this.batch.write),this.batch.mode=null}catch(t){throw this.runBatch(),t}},i.prototype.add=function(t,e,i){var s=this.uniqueId();return this.batch.hash[s]={id:s,fn:e,ctx:i,type:t}},i.prototype.run=function(t){var e=t.ctx||this,i=t.fn;if(delete this.batch.hash[t.id],!this.onError)return i.call(e);try{i.call(e)}catch(s){this.onError(s)}},i.prototype.loop=function(){var t=this,e=this.raf;this.looping||(e(function i(){var s=t.frames.shift();t.frames.length?e(i):t.looping=!1,s&&s()}),this.looping=!0)},i.prototype.schedule=function(t,e){return this.frames[t]?this.schedule(t+1,e):(this.loop(),this.frames[t]=e)},t=t||new i,"undefined"!=typeof e&&e.exports?e.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):window.fastdom=t}(window.fastdom)},{}],320:[function(){(function(t){function e(t,i){if({}.hasOwnProperty.call(e.cache,t))return e.cache[t];var s=e.resolve(t);if(!s)throw new Error("Failed to resolve module "+t);var o={id:t,require:e,filename:t,exports:{},loaded:!1,parent:i,children:[]};i&&i.children.push(o);var n=t.slice(0,t.lastIndexOf("/")+1);return e.cache[t]=o.exports,s.call(o.exports,o,o.exports,n,t),o.loaded=!0,e.cache[t]=o.exports}e.modules={},e.cache={},e.resolve=function(t){return{}.hasOwnProperty.call(e.modules,t)?e.modules[t]:void 0},e.define=function(t,i){e.modules[t]=i};var i=function(e){return e="/",{title:"browser",version:"v0.10.26",browser:!0,env:{},argv:[],nextTick:t.setImmediate||function(t){setTimeout(t,0)},cwd:function(){return e},chdir:function(t){e=t}}}();e.define("/gif.coffee",function(t){function i(t,e){return{}.hasOwnProperty.call(t,e)}function s(t,e){for(var i=0,s=e.length;s>i;++i)if(i in e&&e[i]===t)return!0;return!1}function o(t,e){function s(){this.constructor=t}for(var o in e)i(e,o)&&(t[o]=e[o]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t}var n,r,a,l,h;a=e("events",t).EventEmitter,n=e("/browser.coffee",t),h=function(t){function e(t){var e,i;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t);for(e in r)i=r[e],null!=this.options[e]?this.options[e]:this.options[e]=i}return o(e,t),r={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null},l={delay:500,copy:!1},e.prototype.setOption=function(t,e){return this.options[t]=e,null==this._canvas||"width"!==t&&"height"!==t?void 0:this._canvas[t]=e},e.prototype.setOptions=function(t){var e,s;return function(o){for(e in t)i(t,e)&&(s=t[e],o.push(this.setOption(e,s)));return o}.call(this,[])},e.prototype.addFrame=function(t,e){var i,s;null==e&&(e={}),i={},i.transparent=this.options.transparent;for(s in l)i[s]=e[s]||l[s];if(null!=this.options.width||this.setOption("width",t.width),null!=this.options.height||this.setOption("height",t.height),"undefined"!=typeof ImageData&&null!=ImageData&&t instanceof ImageData)i.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?i.data=this.getContextData(t):i.context=t;else{if(null==t.childNodes)throw new Error("Invalid image");e.copy?i.data=this.getImageData(t):i.image=t}return this.frames.push(i)},e.prototype.render=function(){var t,e;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(e){for(var i=function(){var t;t=[];for(var e=0;0<=this.frames.length?e<this.frames.length:e>this.frames.length;0<=this.frames.length?++e:--e)t.push(e);return t}.apply(this,arguments),s=0,o=i.length;o>s;++s)t=i[s],e.push(null);return e}.call(this,[]),e=this.spawnWorkers();for(var i=function(){var t;t=[];for(var i=0;e>=0?e>i:i>e;e>=0?++i:--i)t.push(i);return t}.apply(this,arguments),s=0,o=i.length;o>s;++s)t=i[s],this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},e.prototype.abort=function(){for(var t;;){if(t=this.activeWorkers.shift(),!(null!=t))break;console.log("killing active worker"),t.terminate()}return this.running=!1,this.emit("abort")},e.prototype.spawnWorkers=function(){var t;return t=Math.min(this.options.workers,this.frames.length),function(){var e;e=[];for(var i=this.freeWorkers.length;this.freeWorkers.length<=t?t>i:i>t;this.freeWorkers.length<=t?++i:--i)e.push(i);return e}.apply(this,arguments).forEach(function(t){return function(e){var i;return console.log("spawning worker "+e),i=new Worker(t.options.workerScript),i.onmessage=function(t){return function(e){return t.activeWorkers.splice(t.activeWorkers.indexOf(i),1),t.freeWorkers.push(i),t.frameFinished(e.data)}}(t),t.freeWorkers.push(i)}}(this)),t},e.prototype.frameFinished=function(t){return console.log("frame "+t.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t,s(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},e.prototype.finishRendering=function(){var t,e,i,s,o,n,r;o=0;for(var a=0,l=this.imageParts.length;l>a;++a)e=this.imageParts[a],o+=(e.data.length-1)*e.pageSize+e.cursor;o+=e.pageSize-e.cursor,console.log("rendering finished - filesize "+Math.round(o/1e3)+"kb"),t=new Uint8Array(o),n=0;for(var h=0,d=this.imageParts.length;d>h;++h){e=this.imageParts[h];for(var c=0,u=e.data.length;u>c;++c)r=e.data[c],i=c,t.set(r,n),n+=i===e.data.length-1?e.cursor:e.pageSize}return s=new Blob([t],{type:"image/gif"}),this.emit("finished",s,t)},e.prototype.renderNextFrame=function(){var t,e,i;if(0===this.freeWorkers.length)throw new Error("No free workers");return this.nextFrame>=this.frames.length?void 0:(t=this.frames[this.nextFrame++],i=this.freeWorkers.shift(),e=this.getTask(t),console.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(i),i.postMessage(e))},e.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},e.prototype.getImageData=function(t){var e;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),e=this._canvas.getContext("2d"),e.setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),this.getContextData(e)},e.prototype.getTask=function(t){var e,i;if(e=this.frames.indexOf(t),i={index:e,last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:"chrome"===n.name},null!=t.data)i.data=t.data;else if(null!=t.context)i.data=this.getContextData(t.context);else{if(null==t.image)throw new Error("Invalid frame");i.data=this.getImageData(t.image)}return i},e}(a),t.exports=h}),e.define("/browser.coffee",function(t){var e,i,s,o,n;o=navigator.userAgent.toLowerCase(),s=navigator.platform.toLowerCase(),n=o.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],i="ie"===n[1]&&document.documentMode,e={name:"version"===n[1]?n[3]:n[1],version:i||parseFloat("opera"===n[1]&&n[4]?n[4]:n[2]),platform:{name:o.match(/ip(?:ad|od|hone)/)?"ios":(o.match(/(?:webos|android)/)||s.match(/mac|win|linux/)||["other"])[0]}},e[e.name]=!0,e[e.name+parseInt(e.version,10)]=!0,e.platform[e.platform.name]=!0,t.exports=e}),e.define("events",function(t,e){i.EventEmitter||(i.EventEmitter=function(){});var s=e.EventEmitter=i.EventEmitter,o="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=10;s.prototype.setMaxListeners=function(t){this._events||(this._events={}),this._events.maxListeners=t},s.prototype.emit=function(t){if("error"===t&&(!this._events||!this._events.error||o(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var e=this._events[t];if(!e)return!1;if("function"!=typeof e){if(o(e)){for(var i=Array.prototype.slice.call(arguments,1),s=e.slice(),n=0,r=s.length;r>n;n++)s[n].apply(this,i);return!0}return!1}switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:var i=Array.prototype.slice.call(arguments,1);e.apply(this,i)}return!0},s.prototype.addListener=function(t,e){if("function"!=typeof e)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",t,e),this._events[t])if(o(this._events[t])){if(!this._events[t].warned){var i;i=void 0!==this._events.maxListeners?this._events.maxListeners:n,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}this._events[t].push(e)}else this._events[t]=[this._events[t],e];else this._events[t]=e;return this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(t,e){var i=this;return i.on(t,function s(){i.removeListener(t,s),e.apply(this,arguments)}),this},s.prototype.removeListener=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var i=this._events[t];if(o(i)){var s=i.indexOf(e);if(0>s)return this;i.splice(s,1),0==i.length&&delete this._events[t]}else this._events[t]===e&&delete this._events[t];return this},s.prototype.removeAllListeners=function(t){return t&&this._events&&this._events[t]&&(this._events[t]=null),this},s.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),o(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]}}),t.GIF=e("/gif.coffee")}).call(this,this)},{}],321:[function(t,e){var i=function(){function t(t,e){"number"==typeof t&&"number"==typeof e&&this.element.css({left:t+"px",top:e+"px"})}function e(){var t=this.element.get(0).getBoundingClientRect().left;0>t&&this.element.css("left","+="+-1*t+"px");var e=this.element.get(0).getBoundingClientRect().top;0>e&&this.element.css("top","+="+-1*e+"px")}var i=function(t){return this.element?(t=t||{},this.onShow=t.onShow||function(){},void(this.onHide=t.onHide||function(){})):(console.error("ControlBase requires an element"),null)};return i.prototype.hide=function(){this.element.hide(),this.isShown=!1,this.onHide&&this.onHide.call(this)},i.prototype.showOverTarget=function(t,i){var s=t-this.element.width()/2,o=i-this.element.height()-10;this.show(s,o),e.call(this)},i.prototype.show=function(e,i){t.call(this,e,i),this.element.show(),this.isShown=!0,this.onShow&&this.onShow.call(this)},i.prototype.size=function(t,e){t&&"number"==typeof t&&this.element.width(t),e&&"number"==typeof e&&this.element.width(e)},i}();e.exports=i},{}],322:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./sanitize"),n=function(){function t(t){t.normalize();for(var e=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,i.noop,!1);e.nextNode();){var o=e.currentNode,n=s(o).parent().is(t);n&&""!==o.nodeValue.trim()&&s(o).wrap("<p>")}s(t).children().each(function(){var t=s(this).get(0),e=t.nodeName===d,i=t.nodeName===c;u(t)||p(t)||e||i||s(this).wrap("<p>")})}function e(e){e.normalize(),t(e);var o=i.filter(s(e).find("*").toArray(),function(t){return u(t)||m(t)});s(e).empty(),i.each(o,function(t){var o=i.some(s(t).children().toArray(),function(t){return u(t)});a(t)||!m(t)&&o||s(e).append(t)})}function n(t){var e=g(t);e.shift();for(var i=e.shift();i&&!s(i).is("[contentEditable]");)s(i).contents().unwrap(),i=e.shift()}function r(t){if(t&&t.length){for(var e=t.shift(),i=!1;e;){var o=s(e).find("span");o.length&&(i=!0),o.contents().unwrap(),s(e).find("[style]").removeAttr("style"),e=t.shift()}return i}}function a(t,e){var i=s(t).text();e&&(i=i.replace(/\n|\r/gm,"").trim());var o=t&&t.nodeName===c;return""===i&&!p(t)&&!o}var l=["P","H2","BLOCKQUOTE","UL","OL"],h=["FIGURE","IFRAME","IMG","HR"],d="DIV",c="HR",u=function(t){return i.contains(l,t.nodeName)},p=function(t){return t&&i.contains(h,t.nodeName)},m=function(t){return"false"===s(t).attr("contenteditable")},g=function(t){return i.filter(t,function(t){return i.contains(l,t.nodeName)})},f=function(t){this.sanitizeConfig=t};return f.prototype.flattenBlocksDown=function(t){e(t)},f.prototype.unwrapParentBlocks=function(t){n(t)},f.prototype.scrubSpansAndStyles=function(t,e){r(t,e)},f.prototype.blockifyNodes=function(e){t(e)},f.prototype.isEmptyElement=function(t,e){return a(t,e)},f.prototype.filterHTML=function(t){var e=document.createElement("div");e.innerHTML=t;var i=new o(this.sanitizeConfig),s=i.clean_node(e),n=document.createElement("div");n.appendChild(s.cloneNode(!0));var r=n.innerHTML,a=r.replace(/(?:\r?\n|\r)+/,"");return a=a.replace(/[<]p[>]\s*[<]\/p[>]/g,"")},f.prototype.filterPlaintext=function(t){var e=i.escape(t);return e=e.replace(/\n/g,"<br>")},f.prototype.sanitizeIFrames=function(t){var e=document.createElement("div");return e.innerHTML=t,s(e).find("iframe").each(function(){s(this).attr("data-original-src",s(this).attr("src")),s(this).attr("src","javascript:''")}),e.innerHTML},f.prototype.unSanitizeIFrames=function(t){var e=document.createElement("div");return e.innerHTML=t,s(e).find("iframe[data-original-src]").each(function(){s(this).attr("src",s(this).attr("data-original-src")),s(this).removeAttr("data-original-src")}),e.innerHTML},f}();e.exports=n},{"./sanitize":329,jquery:"HlZQrA",lodash:"K2RcUv"}],323:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("velocity-animate"),n=t("./controlBase"),r=function(){function t(){this.element=s("<div />",{"class":"bubbles"}).css({position:"absolute",top:0,left:0}).append('<div class="bold" title="Bold" data-el="" data-command="bold" data-type="inline">&nbsp;</div>').append('<div class="italic" title="Italic" data-el="" data-command="italic" data-type="inline">&nbsp;</div>').append('<div class="headline" title="Headline" data-el="h2" data-command="formatBlock" data-type="block">&nbsp;</div>').append('<div class="link" title="Link" data-el="a" data-command="createLink" data-type="inline">&nbsp;</div>').append('<div class="strikethrough" title="Strikethrough" data-el="" data-command="strikethrough" data-type="inline">&nbsp;</div>').append('<div class="unordered-list" title="Unordered List" data-el="ul" data-command="insertUnorderedList" data-type="list">&nbsp;</div>').append('<div class="ordered-list" title="Ordered List" data-el="ol" data-command="insertOrderedList" data-type="list">&nbsp;</div>').append('<div class="quote" title="Quote" data-el="blockquote" data-command="formatBlock" data-type="block">&nbsp;</div>'),this.buttons=s(this.element).find("div"),this.hide();var t=this;this.buttons.on("mousedown",function(i){i.preventDefault(),e.call(t,this)})}function e(t){s(t).hasClass("active")&&this.inverseCommand&&"function"==typeof this.inverseCommand?this.inverseCommand(s(t).attr("data-command"),s(t).attr("data-el")):this.applyCommand&&"function"==typeof this.applyCommand&&this.applyCommand(s(t).attr("data-command"),s(t).attr("data-el"),this),this.onAction()}function r(t,e){var i=!1;return s.each(t,function(t,s){return s===e||"undefined"!=typeof s.nodeName&&s.nodeName===e?(i=!0,!1):void 0}),i}var a=function(e,i,s,o){this.applyCommand=e,this.inverseCommand=i,this.onAction=s||function(){},t.call(this),n.call(this,o)};return i.assign(a.prototype,n.prototype),a.prototype.setActives=function(t){this.buttons.removeClass("active");var e=this.buttons.filter(function(){var e=s(this).attr("data-command"),i=s(this).attr("data-el").toUpperCase(),o=r(t,i),n=document.queryCommandEnabled(e)&&document.queryCommandState(e);return n||o});e.addClass("active")},a.prototype.open=function(t,e){var i=s(this.element).children("div"),o=s(this.element).find(".shim");s(this.element).css({width:"auto"}),o.remove(),i.removeAttr("style"),this.showOverTarget(t,e)},a.prototype.closeWithShim=function(t,e,i,n){var r=this.element.children("div"),a=s('<div class="shim">&nbsp;</div>'),l=s(this.element).width(),h=s(t).position().left,d=l/2-(h+e/2);s(this.element).css({width:l+e}),a.insertBefore(t),s(t).hide();var c=this;o(r,{opacity:0},{duration:.5*i}),o(this.element,{left:"+="+d},{duration:i,easing:"ease"}),o(a,{width:e},{duration:i,easing:"ease",complete:function(){n&&"function"==typeof n&&n.call(c,a),c.hide()}})},a}();e.exports=r},{"./controlBase":321,jquery:"HlZQrA",lodash:"K2RcUv","velocity-animate":"lWl/mc"}],324:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./controlBase"),n=function(){function t(){this.element=s("<div />",{"class":"inline-controls"}).css({position:"absolute",top:0,left:0}),this.opener=s("<div />",{"class":"opener"}),this.isTrayOpen=!1;var t=this;this.opener.on("mousedown",function(i){return i.preventDefault(),i.stopPropagation(),e.call(t,null,!0),!1}),this.tray=s("<div />",{"class":"tray"}),this.element.append(this.opener),this.element.append(this.tray),this.hide()}function e(t,e){"boolean"!=typeof t&&(t=!this.isTrayOpen),t?(this.tray.show(),this.isTrayOpen=!0,this.onTrayOpen.call(this,e)):(this.tray.hide(),this.isTrayOpen=!1,this.onTrayClose.call(this,e)),s(this.opener).toggleClass("open",this.isTrayOpen),e?s(this.opener).toggleClass("closed",!this.isTrayOpen):s(this.opener).removeClass("closed")}var n=function(e){e=e||{},this.onTrayOpen=e.onTrayOpen||function(){},this.onTrayClose=e.onTrayClose||function(){},t.call(this),o.call(this,e)};return i.assign(n.prototype,o.prototype),n.prototype.addToTray=function(t){this.tray.append(t)},n.prototype.open=function(t,i){if(t){i=i||0;var o=s(t).position();e.call(this,!1),this.show(o.left+i,o.top)}},n.prototype.close=function(){e.call(this,!1),this.hide()},n}();e.exports=n},{"./controlBase":321,jquery:"HlZQrA",lodash:"K2RcUv"}],325:[function(t,e){var i={RichTextEditor:t("./richTextEditor"),PlainTextEditor:t("./plainTextEditor"),SelectionContext:t("./selectionContext"),SelectionPersistence:t("./selectionPersistence")};e.exports=i},{"./plainTextEditor":327,"./richTextEditor":328,"./selectionContext":330,"./selectionPersistence":331}],326:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("velocity-animate"),n=t("./utils"),r=t("./selectionPersistence"),a=t("./controlBase"),l=function(){function t(){this.element=s("<div />",{"class":"link-bubbles"}).css({position:"absolute",top:0,left:0}),this.linkUrl=s("<div />",{"class":"url"}),this.linkEditInput=s("<input />",{type:"text",placeholder:"http://"}),this.linkEditDone=s("<div />",{"class":"done"}).text("Done"),this.linkUrl.hide(),this.linkUrl.append(this.linkEditInput).append(this.linkEditDone),e.call(this),this.element.append(this.linkUrl),this.hide()}function e(){var t=this,e=s("<div />",{"class":"options"}),i={edit:function(){l.call(this)},remove:function(){var t=window.getSelection(),e=document.createRange();e.selectNodeContents(this.linkElement),t.removeAllRanges(),t.addRange(e),window.document.execCommand("unlink",!1,null),t.removeAllRanges(),this.onChange(),this.hide()},open:function(){var t=s(this.linkElement).attr("href");-1===t.indexOf("://")&&(t="http://"+t),window.open(t,"_blank")}};for(var o in i){var n=s("<div />",{"class":o}).text(o);s(n).on("click",function(e){return function(){e.call(t)}}(i[o])),e.append(n)}e.hide(),s(this.element).append(e)}function l(){this.linkElement||console.error("Cannot edit link without a valid linkElement");var t=this.linkElement;h.call(this,function(e){s(t).attr("href",e)},s(t).attr("href"))}function h(t,e){e&&(this.linkEditInput.val(e),this.linkUrl.addClass("modified"));var i=this,o=function(){var e=s(i.linkEditInput).val().trim();t(e),i.onChange(),i.close()};s(this.linkEditInput).on("keydown",function(t){i.linkUrl.addClass("modified"),t.keyCode===c.enter?(t.preventDefault(),o()):t.keyCode===c.esc&&i.close()}),s(this.linkEditInput).on("keyup",function(t){t.keyCode!==c.esc&&t.keyCode!==c.enter&&d.call(i)}),s(this.linkEditInput).on("paste",function(){i.linkUrl.addClass("modified"),d.call(i)}),this.linkEditDone.on("click",function(t){t.preventDefault(),o()}),this.element.find(".options").hide(),this.linkUrl.show(),this.show(),d.call(this),s(this.linkEditInput).focus()}function d(){var t=s(this.linkEditInput).val(),e=s(this.linkEditDone).outerWidth(),i=s(this.linkUrl).outerWidth()-s(this.linkUrl).width(),r=n.calcTextWidth(s(this.linkEditInput).get(0),t),a=n.calcTextWidth(s(this.linkEditInput).get(0),"A"),l=r+e+i+a,h=l<this.minWidth?this.minWidth:l;h=h>this.maxWidth?this.maxWidth:h;var d=s(this.element),c=h-d.width();if(0!==c){var u=Math.floor(c/2);o(d,{width:h,left:"-="+u},{duration:40,easing:"ease"})}}var c={shift:16,enter:13,esc:27,"delete":8,tab:9},u=function(e){this.onChange="onChange"in e&&i.isFunction(e.onChange)?e.onChange:i.noop,this.bypassClasses="bypassClasses"in e&&i.isArray(e.bypassClasses)?e.bypassClasses:[],this.maxWidth="maxWidth"in e&&i.isNumber(e.maxWidth)?e.maxWidth:600,this.minWidth="minWidth"in e&&i.isNumber(e.minWidth)?e.minWidth:200,this.linkElement=null,t.call(this),a.call(this)};return i.assign(u.prototype,a.prototype),u.prototype.createLink=function(t){h.call(this,function(e){r.restoreSelection(t),window.document.execCommand("createLink",!1,e);var i=window.getSelection(),s=i.getRangeAt(0);
s.collapse(!1),i.removeAllRanges(),i.addRange(s)})},u.prototype.showOptions=function(t){this.linkElement=t,this.linkUrl.hide(),this.element.css({width:"",left:0}),this.element.find(".options").show()},u.prototype.close=function(){this.linkUrl.hide(),this.element.find(".options").hide(),this.element.css("width",""),this.linkEditInput.val("").unbind(),this.linkEditDone.unbind(),this.linkUrl.removeClass("modified"),this.linkElement=null,this.hide()},u.prototype.isValidLink=function(t){return t?!i.some(this.bypassClasses,function(e){return s(t).hasClass(e)}):!1},u}();e.exports=l},{"./controlBase":321,"./selectionPersistence":331,"./utils":332,jquery:"HlZQrA",lodash:"K2RcUv","velocity-animate":"lWl/mc"}],327:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./dataFilter"),n=t("./selectionContext"),r=function(){function t(){d.call(this,m);var t=s("<div />",{"data-js":"editor-wrapper","class":"editor-wrapper"}).css("position","relative"),i=s("<div />",{"data-js":"editor-slot","class":"editor-slot"}).css("position","relative");s(this.element).wrap(t).wrap(i),this.placeholderElement=s("<div />",{"data-js":"editor-placeholder","class":"editor-placeholder"}).css("position","absolute"),i=s(this.element).parent(),i.append(this.placeholderElement),a.call(this),e.call(this)}function e(){var t=this;s(this.element).on("input keydown keyup keypress mousedown mouseup",function(e){t.config.onClientEvent.call(t,e)}),s(this.element).on("keydown",function(e){return 16===e.keyCode&&(t.keyModifiers.shift=!0),13===e.keyCode?(t.config.forceSingleLine||p(this,!1),!1):void i.defer(function(){t.onChange(e)})}),s(this.element).on("keyup",function(e){16===e.keyCode&&(t.keyModifiers.shift=!1),r.call(t,e),t.onChange(e)});var e=!1;s(this.element).on("mouseup",function(){e=!1,r.call(t)}),s(this.element).on("mousedown",function(){e=!0}),s(this.element).on("mouseleave",function(){e&&r.call(t)}),s(this.element).on("paste",function(e){var i=(e.originalEvent||e).clipboardData;t.config.pasteHook(i,t.keyModifiers.shift)||l.call(t,i,e),e.preventDefault()}),s(this.element).on("drop",function(t){t.stopPropagation(),t.preventDefault()}),this.placeholderElement.on("click",function(){t.isEmpty()&&s(t.element).focus()})}function r(){var t=this;setTimeout(function(){var e=window.getSelection();t.config.onSelection.call(t,e)},200)}function a(){var t=this.isEmpty()?this.config.placeholder:"";s(this.placeholderElement).html(t)}function l(t,e){var s="";if(i.contains(t.types,"text/plain"))s=t.getData("text/plain"),s=this.dataFilter.filterPlaintext(s),u.call(this,s);else{if(!i.contains(t.types,"text/html"))return;s=t.getData("text/html"),s=this.dataFilter.filterHTML(s);var o=s.replace(/<br(\s*)\/*>/gi,"\n").replace(/(<[p|div])/gi,"\n$1"),n=document.createElement("div");n.innerHTML=o;var r=n.textContent||n.innerText||"",a=r.trim().split("\n").join("<br>");u.call(this,a)}if(this.config.forceSingleLine){var l=c.call(this).replace(/<br\s*\/*>/g," ");d.call(this,l)}this.onChange(e)}function h(){s(this.element).contents().filter(function(){return 3===this.nodeType}).wrap("<span></span>")}function d(t){s(this.element).html(t)}function c(){return s(this.element).html().trim()}function u(t){if(t=t.trim(),t=t.replace(/[<]br\s?\/?[>]$/,t),!t)return void console.warn("Cannot insert empty data");var e=n.getSelection();if(!e||!e.focusNode)return void console.warn("Cannot insert without the editor having a cursor or selection");var i=e.getRangeAt(0);i.deleteContents();var s=i.createContextualFragment(t);i.insertNode(s),e.removeAllRanges(),i.collapse(!1),e.addRange(i)}function p(t,e){if(e||t.lastChild&&"br"===t.lastChild.nodeName.toLowerCase()||t.appendChild(document.createElement("br")),window.getSelection){var i=window.getSelection(),s=i.getRangeAt(0),o=document.createElement("br");s.deleteContents(),s.insertNode(o),s.setStartAfter(o),s.setEndAfter(o),s.collapse(!1),i.removeAllRanges(),i.addRange(s)}}var m="<span>&#8203;</span>",g="",f="<span>"+g+"</span>",_=function(e,s){if(!e)throw new Error("A valid element parameter is required to initalize the editor");this.element=e,this.config={placeholder:!1,onChange:function(){},onSelection:function(){},onClientEvent:function(){},pasteHook:function(){return!1},filterForSetData:function(t){return t},filterForGetData:function(t){return t},filterRules:{elements:["p","br","div"],attributes:{},remove_contents:["style","noscript","script","meta"],protocols:{}},forceSingleLine:!1},i.extend(this.config,s||{}),this.dataFilter=new o(this.config.filterRules),this.onChange=function(){h.call(this),a.call(this),this.config.onChange.apply(this,arguments)},this.keyModifiers={shift:!1},t.call(this)};return _.prototype.getData=function(t){var e=c.call(this);e=this.config.filterForGetData.call(this,e);var i=e.replace(/<br(\s*)\/*>/gi,"\n").replace(/(<[p|div])/gi,"\n$1").replace(g,""),s=document.createElement("div");s.innerHTML=i;var o=s.textContent||s.innerText||"",n=t?o.trim():o;return n},_.prototype.setData=function(t){t=this.config.filterForSetData.call(this,t),t=this.dataFilter.filterPlaintext(t),d.call(this,t),this.onChange()},_.prototype.setHTML=function(t){d.call(this,t),this.onChange()},_.prototype.getHTML=function(){return c.call(this)},_.prototype.insertData=function(t,e){e&&(t=this.dataFilter.filterHTML(t)),u.call(this,t),this.onChange()},_.prototype.hasFocus=function(){return s(this.element).is(":focus")},_.prototype.setPlaceholder=function(t){this.config.placeholder=t,a.call(this)},_.prototype.isEmpty=function(){var t=this.getData(!1);if(""===t||"\n"===t||"\r\n"===t)return!0;var e=c.call(this);return e===m||e===f||""===e},_.prototype.getCurrentElement=function(){return n.getNearestElement()},_}();e.exports=r},{"./dataFilter":322,"./selectionContext":330,jquery:"HlZQrA",lodash:"K2RcUv"}],328:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./linkControl"),n=t("./formattingControls"),r=t("./dataFilter"),a=t("./selectionPersistence"),l=t("./selectionContext"),h=t("./inlineControls"),d=t("./utils"),c=function(){function t(){T.call(this,B);var t=s("<div />",{"data-js":"editor-wrapper","class":"editor-wrapper"}).css("position","relative"),o=s("<div />",{"data-js":"editor-slot","class":"editor-slot"}).css("position","relative");s(this.element).wrap(t).wrap(o),o=s(this.element).parent(),this.wrapper=o.parent().get(0),this.placeholderElement=s("<div />",{"data-js":"editor-placeholder","class":"editor-placeholder"}).css("position","absolute"),o.append(this.contextualControls.element),o.append(this.linkControl.element),o.append(this.placeholderElement),o.append(this.inlineControls.element),C.call(this),this.controlBar=s("<div />",{"data-js":"control-bar","class":"control-bar disabled"});var n=s("<div />",{"class":"static-controls control"});this.controlBar.append(n),this.controlBar.append(this.staticControls.element);var r=this;n.on("mousedown",function(t){t.preventDefault(),t.stopPropagation();var e=l.getNodeList();r.staticControls.setActives(i.pluck(e,"nodeName"));var o=s(this).position();return r.staticControls.isShown?r.staticControls.hide():r.staticControls.open(o.left+s(this).width()/2,0),r.contextualControls.hide(),r.linkControl.close(),!1}),s(this.wrapper).append(this.controlBar),e.call(this),p.call(this)}function e(){var t=this;s(this.element).on("input keydown keyup keypress mousedown mouseup",function(e){t.controlBar.removeClass("disabled"),t.config.onClientEvent.call(t,e)}),s(this.element).on("keydown",function(e){return e.keyCode===H.shift&&(t.keyModifiers.shift=!0),e.keyCode===H.esc?(t.contextualControls.hide(),void t.staticControls.hide()):((e.keyCode===H.backspace||e.keyCode===H["delete"])&&R.call(t),f.call(t,e),y.call(t,e),void i.defer(function(){C.call(t)}))}),s(this.element).on("keyup",function(e){e.keyCode===H.shift?t.keyModifiers.shift=!1:e.keyCode===H.enter?R.call(t):(e.keyCode===H.backspace||e.keyCode===H["delete"])&&(b.call(t),i.defer(function(){u.call(t)})),e.keyCode!==H.esc&&(y.call(t,e),t.onChange())});var e=!1;s(this.element).on("mouseup",function(){e=!1,y.call(t)}),s(this.element).on("mousedown",function(){e=!0}),document.addEventListener("mousedown",function(i){t.wrapper===i.target||s.contains(t.wrapper,i.target)||(e=!1,c.call(t),t.controlBar.addClass("disabled"))},!0),document.addEventListener("mouseup",function(){e&&y.call(t)},!0),this.placeholderElement.on("click",function(){t.isEmpty()&&t.element&&(a.setToStart(s(t.element).children().first().get(0)),y.call(t))}),s(this.element).on("focus",function(){t.controlBar.removeClass("disabled")}),s(this.element).on("paste",function(e){var i=(e.originalEvent||e).clipboardData;t.config.pasteHook(i,t.keyModifiers.shift)||S.call(t,i),k.call(t),e.preventDefault()}),s(this.element).on("cut",function(){t.contextualControls.hide(),t.staticControls.hide(),t.linkControl.close(),i.defer(function(){u.call(t),k.call(t)})})}function c(){this.contextualControls.hide(),this.staticControls.hide(),this.linkControl.close(),this.inlineControls.close()}function u(){if(!s(this.element).has(V.join()).length){var t=s(this.element).find("ul:not(:has(li)),ol:not(:has(li))");t.remove();var e=i.some(s(this.element).children().toArray(),function(t){return s(t).text().length>0});e||(T.call(this,""),R.call(this),C.call(this))}}function p(){var t=this,e=s(t.element).offset().top,o=null,n="dragstart dragenter dragleave dragover dragend drop",r=!1,a=function(t){var e=t.dataTransfer.types&&i.some(t.dataTransfer.types,function(t){return"Files"===t});return e},l=function(t){return"false"===s(t.srcElement).attr("contenteditable")},h=function(e,o,n){var r=e.originalEvent.dataTransfer.files;r.length&&i.each(r,function(e){var i=e.type;if(!/^image[/]\w*$/.test(i))return void console.warn("Sorry, you may only add image files to the editor.");var r=new FileReader;r.onload=function(i){var r=s("<img />",{src:i.target.result}),a=U.call(t,r.get(0).outerHTML,o,n);t.onChange(),t.config.onImageAdded.call(t,a,e)},r.readAsDataURL(e)})},d=function(t,e){return t<e.top+.66*e.height},u=function(t,i){var o=s(i).offset().top-e,n=s(i).get(0).getBoundingClientRect().height,r=t>o+.66*n;return{element:i,top:o,bottom:o+n,height:n,isAfter:r}},p=function(){s(t.element).find(".over-top").removeClass("over-top"),s(t.element).find(".over-bottom").removeClass("over-bottom")},m=function(i){var n=null,r=i.pageY-e,a=s(t.element).children();o&&r>o.top&&d(r,o)||(a.each(function(){var t=u(r,this);return d(r,t)&&i.srcElement!==this?(n=t,!1):void 0}),n||(n=u(r,a.last().get(0)),n.isAfter=!0),n&&o&&o.element===n.element&&o.isAfter===n.isAfter||(p(),o=n))};s(t.element).unbind(n),s(t.element).on("dragleave",function(){p()}),s(t.element).on("dragover",function(t){return r?(i.debounce(m,100)(t.originalEvent),o&&(s(o.element).addClass(o.isAfter?"over-bottom":"over-top"),a(t.originalEvent)&&t.stopPropagation()),void t.preventDefault()):(t.preventDefault(),void t.stopPropagation())}),s(t.element).on("dragenter",function(t){t.preventDefault(),a(t.originalEvent)&&(r="file")}),s(t.element).on("dragstart",function(e){if(c.call(t),l(e.originalEvent)){r="media";var o=e.originalEvent.srcElement;i.defer(function(){s(o).data("origHeight",s(o).height()).animate({height:0},500,function(){}),s(o).addClass("dragging")})}}),s(t.element).on("drop",function(t){p(),a(t.originalEvent)&&h(t,o.element,o.isAfter?1:-1),t.stopPropagation(),t.preventDefault()}),s(t.element).on("dragend",function(e){if(l(e.originalEvent)){p();var i=e.originalEvent.srcElement,n=s(i).data("origHeight"),a=i;if(o&&a!==o.element){var h=s(i).remove();o.isAfter?s(o.element).after(h):s(o.element).before(h),A.call(t,h)}s(a).animate({height:n},200,function(){s(a).removeAttr("style"),s(a).removeClass("dragging")}),D.call(t)}r=!1})}function m(t,e,i){var o=this,n=function(){window.document.execCommand(t),o.config.flattenBlocks&&v.call(o)},r=function(){if(i){var t=function(t){var e=s(t).offset().left-s(o.wrapper).offset().left,i=s(t).offset().top-s(o.wrapper).offset().top;o.linkControl.size(s(t).outerWidth()),o.linkControl.show(e,i);var n=a.saveSelection(o.element);o.linkControl.createLink(n)};i.closeWithShim(i.element.find(".link").get(0),200,350,t)}},l=function(t){_.call(o,["UL","OL","BLOCKQUOTE"]),window.document.execCommand("formatBlock",!1,"<"+t+">")};switch(t){case"formatBlock":l(e),y.call(this);break;case"createLink":r();break;case"insertOrderedList":n(),y.call(this);break;case"insertUnorderedList":y.call(this),n();break;default:window.document.execCommand(t)}b.call(this),o.onChange()}function g(t,e){switch(t){case"formatBlock":switch(e){case"blockquote":_.call(this,["UL","OL"]),window.document.execCommand("formatBlock",!1,"<p>"),v.call(this);break;default:window.document.execCommand("formatBlock",!1,"<p>"),v.call(this)}break;case"insertOrderedList":_.call(this,"OL");break;case"insertUnorderedList":_.call(this,"UL");break;case"createLink":window.document.execCommand("unlink");break;default:window.document.execCommand(t)}b.call(this),y.call(this),this.onChange()}function f(t){var e=function(){return!!l.getNearestNodeByType(["UL","OL"])};e()&&t.keyCode===H.tab&&(t.preventDefault(),t.shiftKey?(m.call(this,"outdent"),e()||window.document.execCommand("formatBlock",!1,"<p>")):m.call(this,"indent"))}function _(t){for(var e=["UL","OL"],o=!1,n=null;l.getNearestNodeByType(t);){n=l.getNearestNodeByType(t);var r=function(){o=!0;var t="",e=l.getSelection(),i=document.createElement("div");this.dataFilter.scrubSpansAndStyles([i]);for(var n=0,r=e.rangeCount;r>n;++n)i.appendChild(e.getRangeAt(n).cloneContents());s(i).find("li").each(function(e,i){t+="<p>"+s(i).html().replace(/(<br[\s\/]*>\s*)+$/,"")+"</p>"}),window.document.execCommand("outdent"),E.call(this,t,!0),e=l.getSelection(),s(e.focusNode.parentNode).find("> br:last").remove(),this.dataFilter.scrubSpansAndStyles([e.focusNode.parentNode])};i.contains(e,n.nodeName)?r.call(this):window.document.execCommand("outdent")}o||l.getNearestNodeByType(["H2"])||window.document.execCommand("formatBlock",!1,"<p>")}function v(){var t=a.saveSelection(this.element),e=l.getNearestElement(),i=l.getParentNodes(e);this.dataFilter.unwrapParentBlocks(i),a.restoreSelection(t)}function b(){var t=a.saveSelection(this.element),e=l.getNearestElement(),i=l.getParentNodes(e),s=this.dataFilter.scrubSpansAndStyles(i);s&&t.end>t.start&&a.restoreSelection(t)}function y(){var t=this;setTimeout(function(){var e=window.getSelection();e.isCollapsed?x.call(t,e):w.call(t,e),t.config.onSelection.call(t,e)},20)}function w(t){if(l.isInContext(t,this.element)){var e=l.getContextCoordinates(s(this.element).parent().parent()),o=l.getNodeList(t);this.contextualControls.setActives(i.pluck(o,"nodeName")),this.staticControls.setActives(i.pluck(o,"nodeName")),this.linkControl.close(),this.inlineControls.close(),""!==t.toString().trim()&&e&&!this.staticControls.isShown&&this.contextualControls.open(e.x,e.y)}}function x(t){this.contextualControls.hide();var e=l.getNodeList(t),o=i.find(e,function(t){return"A"===t.nodeName});if(this.linkControl.isValidLink(o)){var n=l.getContextCoordinates(s(this.element).parent().parent(),o);this.linkControl.showOptions(o),this.linkControl.showOverTarget(n.x,n.y)}else this.linkControl.close();this.staticControls.setActives(i.pluck(e,"nodeName")),k.call(this)}function k(){var t=F();if(this.dataFilter.isEmptyElement(t)&&!this.isEmpty()&&t&&"P"===t.nodeName)this.inlineControls.open(t);else if(this.isEmpty()){var e=d.calcTextWidth(this.placeholderElement,this.config.placeholder);this.inlineControls.open(t,e)}else this.inlineControls.close()}function C(){var t=this.isEmpty()?this.config.placeholder:"";s(this.placeholderElement).html(t)}function S(t){var e="";if(i.contains(t.types,"text/html")){e=t.getData("text/html"),e=e.replace(new RegExp("</t(d|h)></tr>","g"),"<br></td></tr>"),e=e.replace(/\u00a0/g," "),e=this.dataFilter.filterHTML(e);var o=document.createElement("div");o.innerHTML=e,this.dataFilter.flattenBlocksDown(o),s(o).find(V.join()).remove();var n=i.some(o.children,function(t){return i.contains(N,t.nodeName)});if(n){var r=l.getSelection(),a=r.getRangeAt(0);a.deleteContents();var h=l.getParentNodes(r.anchorNode),d=F(h);if(""===s(d).text().trim()){var c=s(d).index(),u=s(d).parent(),p=c+o.children.length-1;s(d).replaceWith(o.children);var m=s(u).children().eq(p).get(0);a.selectNodeContents(m),a.collapse(!1),r.removeAllRanges(),r.addRange(a)}else{var g=i.escape(o.textContent),f=g.replace(/\n/g,"<br>");E.call(this,f)}}else E.call(this,o.innerHTML)}else e=t.getData("text/plain"),e=this.dataFilter.filterPlaintext(e),E.call(this,e);this.onChange()}function T(t){s(this.element).html(t)}function $(){return s(this.element).html().trim()}function E(t,e){if(!t)return void console.warn("Cannot insert empty data");var i=l.getSelection();if(!s(this.element).is(":focus")||!i||!i.focusNode)return void console.warn("Cannot insert without the editor having a cursor or selection");var o=i.getRangeAt(0);o.deleteContents();var n=o.createContextualFragment(t);o.insertNode(n),e||o.collapse(!1),i.removeAllRanges(),i.addRange(o)}function j(){var t=F();if(!t){var e=s(this.element).children(N.join());if(!e.length)return null;t=e.last().get(0)}return t}function F(t){return t||(t=l.getNodeList()),i.find(t.reverse(),function(t){return i.contains(N,t.nodeName)})}function R(){var t=j.call(this);t?"div"===t.nodeName.toLowerCase()&&window.document.execCommand("formatBlock",!1,"<p>"):(T.call(this,B),a.setToStart(s(this.element).children().first().get(0)))}function P(){var t=s(this.element).children(N.join()).last().get(0);t&&"p"!==t.nodeName.toLowerCase()&&s(this.element).append(B)}function U(t,e,i){e=e||j.call(this);var o=this.dataFilter.isEmptyElement(e.outerHTML,!0)?0:1;i="number"==typeof i?i:o;var n=s(t).get(0),r=M.call(this,n);if(A.call(this,r),0>i?(s(e).before(r),s(e).next().length||s(e).after(B)):i>0?(s(e).next().length||s(e).after(B),s(e).after(r)):0===i&&s(e).replaceWith(r),c.call(this),D.call(this),0===i){var h=s(r).next().get(0);a.setToStart(h)}else l.collapseToStart();return n}function D(){var t=this;s(this.element).children(".media-holder").each(function(){var e=s(this).prev();(!e.length||I.call(t,e))&&s(this).before(B);var i=s(this).next();(!i.length||I.call(t,i))&&s(this).after(B)})}function M(t){var e=s("<div />",{"class":this.config.mediaHolderClass,contentEditable:!1,draggable:!0});s(t).wrap(e);var i=s(t).parent(),o=s(this.config.mediaKillerMarkup);o.addClass("media-killer"),i.append(o);var n=s(this.config.mediaMoverMarkup);return n.addClass("media-mover"),i.append(n),i}function A(t){var e=this,i=t?s(t):s(this.element).find('[contenteditable="false"]');i.each(function(){var t=this;s(this).find(".media-killer").off("click").click(function(){t.remove(),e.onChange()}),s(this).off("keydown").on("keydown",function(e){(e.keyCode===H["delete"]||e.keyCode===H.backspace)&&t.remove(),e.preventDefault(),e.stopPropagation()});var i=null;s(this).on("mousedown",function(t){i=t.originalEvent.target}),s(this).on("dragstart",function(t){s(i).hasClass("media-mover")||(t.preventDefault(),t.stopPropagation())})})}function L(t){var e=this;i.each(s(t).find(V.join()),function(t){var i=z.call(e,t);i&&(s(i).find(".media-killer, .media-mover").remove(),s(t).unwrap())})}function O(){var t=this;i.each(s(this.element).find(V.join()),function(e){z.call(t,e)||M.call(t,e)})}function I(t){return s(t).hasClass(this.config.mediaHolderClass)}function z(t){var e=s(t).closest("[class="+this.config.mediaHolderClass+"]");return e.length?e.get(0):null}var B="<p><br></p>",q="<p></p>",N=["P","H2","BLOCKQUOTE","UL","OL","DIV"],V=["IMG","IFRAME","FIGURE","HR"],H={shift:16,enter:13,esc:27,backspace:8,"delete":46,tab:9},K=function(e,s){if(!e)throw new Error("A valid element parameter is required to initalize the editor");this.element=e,this.config={placeholder:!1,onChange:i.noop,onSelection:function(){},onImageAdded:function(){},onClientEvent:function(){},inlineControlsOptions:{onShow:i.noop,onHide:i.noop,onTrayOpen:function(){},onTrayClose:function(){}},flattenBlocks:!0,runIFrameSanitization:!1,mediaHolderClass:"media-holder",mediaKillerMarkup:"<div></div>",mediaMoverMarkup:"<div>&#8597;</div>",pasteHook:function(){return!1},filterForSetData:function(t){return t},filterForGetData:function(t){return t},filterRules:{elements:["a","b","i","ul","ol","li","p","h2","blockquote","img","iframe","figure","br","hr"],attributes:{a:["href","title"],img:["src","alt"],hr:[{name:"class",value:"read-more"},"data-label"],iframe:["src","width","height","frameborder"]},remove_contents:["style","noscript","script","meta"],protocols:{a:{href:["http","https","mailto"]}}},linkConfig:{bypassClasses:[]}},i.merge(this.config,s||{}),this.onChange=function(){C.call(this),this.config.onChange.call(this)},this.linkControl=new o(i.extend(this.config.linkConfig,{onChange:i.bind(function(){this.onChange.call(this)},this)})),this.contextualControls=new n(i.bind(m,this),i.bind(g,this),function(){var t=l.getNodeList();this.setActives(t)}),this.inlineControls=new h({onShow:i.bind(this.config.inlineControlsOptions.onShow,this),onHide:i.bind(this.config.inlineControlsOptions.onHide,this),onTrayOpen:i.bind(this.config.inlineControlsOptions.onTrayOpen,this),onTrayClose:i.bind(this.config.inlineControlsOptions.onTrayClose,this)}),this.staticControls=new n(i.bind(m,this),i.bind(g,this),function(){var t=l.getNodeList();this.setActives(t)},function(){var t=this,e=function(){var i=l.getNodeList();t.setActives(i),document.removeEventListener("click",e,!1)};document.addEventListener("mousedown",e)}),this.dataFilter=new r(this.config.filterRules),this.keyModifiers={shift:!1},t.call(this)};return K.prototype.getData=function(t){var e=$.call(this);e=this.config.filterForGetData.call(this,e),this.config.runIFrameSanitization&&(e=this.dataFilter.unSanitizeIFrames(e));var o=document.createElement("div");o.innerHTML=e,L.call(this,o);var n=this;if(t)for(var r=function(t){var e=s(o).children(":"+t+"-child").get(0);return e&&n.dataFilter.isEmptyElement(e,!0)?e:null},a=function(){return i.compact([r("first"),r("last")])};a().length;)i.forEach(a(),function(t){s(t).remove()});return o.innerHTML},K.prototype.setData=function(t,e,i){e&&(t=this.config.filterForSetData.call(this,t),t=this.dataFilter.filterHTML(t)),this.config.runIFrameSanitization&&(t=this.dataFilter.sanitizeIFrames(t)),T.call(this,t),O.call(this),i?this.dataFilter.flattenBlocksDown(this.element):this.dataFilter.blockifyNodes(this.element),R.call(this),A.call(this),P.call(this),this.onChange()},K.prototype.insertData=function(t,e,i){e&&(t=this.dataFilter.filterHTML(t)),E.call(this,t),i&&this.dataFilter.flattenBlocksDown(l.getNearestElement()),this.onChange()},K.prototype.hasFocus=function(){return s(this.element).is(":focus")},K.prototype.setPlaceholder=function(t){this.config.placeholder=t,C.call(this)},K.prototype.insertMedia=function(t,e,i,s){e&&(t=this.dataFilter.filterHTML(t)),U.call(this,t,i,s),this.onChange()},K.prototype.addControl=function(t){var e=s(this.wrapper).find("[data-js=control-bar]");e.append(t)},K.prototype.isEmpty=function(){var t=$.call(this);return""===t||"<br>"===t||t===B||t===q},K.prototype.getCurrentElement=function(){return l.getNearestElement()},K}();e.exports=c},{"./dataFilter":322,"./formattingControls":323,"./inlineControls":324,"./linkControl":326,"./selectionContext":330,"./selectionPersistence":331,"./utils":332,jquery:"HlZQrA",lodash:"K2RcUv"}],329:[function(t,e){function i(){var t,e;for(e=arguments[0]||{},this.config={},this.config.elements=e.elements?e.elements:[],this.config.attributes=e.attributes?e.attributes:{},this.config.attributes[i.ALL]=this.config.attributes[i.ALL]?this.config.attributes[i.ALL]:[],this.config.allow_comments=e.allow_comments?e.allow_comments:!1,this.allowed_elements={},this.config.protocols=e.protocols?e.protocols:{},this.config.add_attributes=e.add_attributes?e.add_attributes:{},this.dom=e.dom?e.dom:document,t=0;t<this.config.elements.length;t++)this.allowed_elements[this.config.elements[t]]=!0;if(this.config.remove_element_contents={},this.config.remove_all_contents=!1,e.remove_contents)if(e.remove_contents instanceof Array)for(t=0;t<e.remove_contents.length;t++)this.config.remove_element_contents[e.remove_contents[t]]=!0;else this.config.remove_all_contents=!0;this.transformers=e.transformers?e.transformers:[]}i.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i,i.RELATIVE="__RELATIVE__",i.ALL="__ALL__",i.prototype.clean_node=function(t){function e(t,e){var i;for(i=0;i<e.length;i++)if(e[i]===t)return i;return-1}function s(){var t,e,i=[],s={};for(t=0;t<arguments.length;t++)if(arguments[t]&&arguments[t].length)for(e=0;e<arguments[t].length;e++)s[arguments[t][e]]||(s[arguments[t][e]]=!0,i.push(arguments[t][e]));return i}function o(t){var e;switch(t.nodeType){case 1:n.call(this,t);break;case 3:e=t.cloneNode(!1),this.current_element.appendChild(e);break;case 5:e=t.cloneNode(!1),this.current_element.appendChild(e);break;case 8:this.config.allow_comments&&(e=t.cloneNode(!1),this.current_element.appendChild(e));break;default:console&&console.log&&console.log("unknown node type",t.nodeType)}}function n(t){var n,a,l,h,d,c,u,p,m,g,f=r.call(this,t);if(t=f.node,l=t.nodeName.toLowerCase(),a=this.current_element,this.allowed_elements[l]||f.whitelist){this.current_element=this.dom.createElement(t.nodeName),a.appendChild(this.current_element);var _=this.config.attributes;for(h=s(_[l],_[i.ALL],f.attr_whitelist),n=0;n<h.length;n++){c=h[n];var v="object"==typeof h[n]||h[n]instanceof Object;c=v?h[n].name:h[n],d=t.attributes[c],d&&(g=!0,this.config.protocols[l]&&this.config.protocols[l][c]&&(p=this.config.protocols[l][c],m=d.value.toLowerCase().match(i.REGEX_PROTOCOL),g=m?-1!==e(m[1],p):-1!==e(i.RELATIVE,p)),v&&(g=d.value.toLowerCase().match(h[n].value)),g&&(u=document.createAttribute(c),u.value=d.value,this.current_element.setAttributeNode(u)))}if(this.config.add_attributes[l])for(c in this.config.add_attributes[l])u=document.createAttribute(c),u.value=this.config.add_attributes[l][c],this.current_element.setAttributeNode(u)}else if(-1!==e(t,this.whitelist_nodes)){for(this.current_element=t.cloneNode(!0);this.current_element.childNodes.length>0;)this.current_element.removeChild(this.current_element.firstChild);a.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[l])for(n=0;n<t.childNodes.length;n++)o.call(this,t.childNodes[n]);this.current_element.normalize&&this.current_element.normalize(),this.current_element=a}function r(t){var i,o,n,r={attr_whitelist:[],node:t,whitelist:!1};for(i=0;i<this.transformers.length;i++)if(n=this.transformers[i]({allowed_elements:this.allowed_elements,config:this.config,node:t,node_name:t.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom}),null!==n){if("object"!=typeof n)throw new Error("transformer output must be an object or null");if(n.whitelist_nodes&&n.whitelist_nodes instanceof Array)for(o=0;o<n.whitelist_nodes.length;o++)-1===e(n.whitelist_nodes[o],this.whitelist_nodes)&&this.whitelist_nodes.push(n.whitelist_nodes[o]);r.whitelist=n.whitelist?!0:!1,n.attr_whitelist&&(r.attr_whitelist=s(r.attr_whitelist,n.attr_whitelist)),r.node=n.node?n.node:r.node}return r}var a=this.dom.createDocumentFragment();this.current_element=a,this.whitelist_nodes=[];for(var l=0;l<t.childNodes.length;l++)o.call(this,t.childNodes[l]);return a.normalize&&a.normalize(),a},e.exports=i},{}],330:[function(t,e){var i=t("lodash"),s=t("jquery"),o=function(){var t={getParentNodes:function(e,i){return i=i||[],s(e).is('[contentEditable="true"]')?i:e?(i.push(e),t.getParentNodes(e.parentNode,i)):null},getNodeList:function(e){e=e||t.getSelection();var i=e&&e.anchorNode?e.anchorNode:null;return i?t.getParentNodes(i):[]},getNearestNodeByType:function(e,s){var o=[].concat(e);return s||(s=t.getNodeList()),i.find(s,function(t){return i.contains(o,t.nodeName)})},getNearestElement:function(e){e=e||t.getSelection();var s=t.getNodeList();return i.find(s,function(t){return 1===t.nodeType})},getContextCoordinates:function(e,i){var o=t.getSelection(),n=o.getRangeAt(0).cloneRange(),r=s(e).offset();if(i||!o.isCollapsed){var a=(i||n).getBoundingClientRect();return{x:a.left+a.width/2-r.left,y:a.top-r.top+s(window).scrollTop()}}if(n.getClientRects){n.collapse(!0);var l=n.getClientRects()[0];if(l)return{x:l.left-r.left,y:l.top-r.top+s(window).scrollTop()}}},getSelection:function(){var t=window.getSelection();if(t.anchorNode){var e=s(t.anchorNode).closest("[contenteditable]").length;return e?t:null}return null},collapseToEnd:function(){var e=t.getSelection();e&&e.collapseToEnd()},collapseToStart:function(){var e=t.getSelection();e&&e.collapseToStart()},isInContext:function(t,e){return s(t.anchorNode).closest(e).length>0}};return t}();e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],331:[function(t,e){var i=function(){return{saveSelection:function(t,e){if(e=e||window.getSelection(),!e||!e.rangeCount)return null;var i=e.getRangeAt(0),s=i.cloneRange();s.selectNodeContents(t),s.setEnd(i.startContainer,i.startOffset);var o=s.toString().length;return{container:t,start:o,end:o+i.toString().length,selection:e}},restoreSelection:function(t){if(t){var e=0,i=document.createRange();i.setStart(t.container,0),i.collapse(!0);for(var s,o=[t.container],n=!1,r=!1;!r&&(s=o.pop());)if(3===s.nodeType){var a=e+s.length;!n&&t.start>=e&&t.start<=a&&(i.setStart(s,t.start-e),n=!0),n&&t.end>=e&&t.end<=a&&(i.setEnd(s,t.end-e),r=!0),e=a}else for(var l=s.childNodes.length;l--;)o.push(s.childNodes[l]);var h=window.getSelection();h.removeAllRanges(),h.addRange(i)}},setToStart:function(t){var e=document.createRange();e.setStart(t,0),e.setEnd(t,0),e.collapse(!0);var i=window.getSelection();i.removeAllRanges(),i.addRange(e)}}}();e.exports=i},{}],332:[function(t,e){var i=t("lodash"),s=t("jquery"),o=function(){var t=function(){};return t.calcTextWidth=function(t,e){var o=["font-style","font-weight","font-size","font-family"],n=i.reduce(o,function(e,i){return e+" "+s(t).css(i)},"").trim(),r=document.createElement("canvas"),a=r.getContext("2d");a.font=n;var l=a.measureText(e);return Math.round(l.width)},t}();e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],333:[function(t,e){(function(i){function s(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function o(t,e){function i(){de.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+t)}var s=!0;return d(function(){return s&&(i(),s=!1),e.apply(this,arguments)},e)}function n(t,e){return function(i){return p(t.call(this,i),e)}}function r(t,e){return function(i){return this.lang().ordinal(t.call(this,i),e)}}function a(){}function l(t){T(t),d(this,t)}function h(t){var e=b(t),i=e.year||0,s=e.quarter||0,o=e.month||0,n=e.week||0,r=e.day||0,a=e.hour||0,l=e.minute||0,h=e.second||0,d=e.millisecond||0;this._milliseconds=+d+1e3*h+6e4*l+36e5*a,this._days=+r+7*n,this._months=+o+3*s+12*i,this._data={},this._bubble()}function d(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return e.hasOwnProperty("toString")&&(t.toString=e.toString),e.hasOwnProperty("valueOf")&&(t.valueOf=e.valueOf),t}function c(t){var e,i={};for(e in t)t.hasOwnProperty(e)&&Ce.hasOwnProperty(e)&&(i[e]=t[e]);return i}function u(t){return 0>t?Math.ceil(t):Math.floor(t)}function p(t,e,i){for(var s=""+Math.abs(t),o=t>=0;s.length<e;)s="0"+s;return(o?i?"+":"":"-")+s}function m(t,e,i,s){var o=e._milliseconds,n=e._days,r=e._months;s=null==s?!0:s,o&&t._d.setTime(+t._d+o*i),n&&ne(t,"Date",oe(t,"Date")+n*i),r&&se(t,oe(t,"Month")+r*i),s&&de.updateOffset(t,n||r)}function g(t){return"[object Array]"===Object.prototype.toString.call(t)}function f(t){return"[object Date]"===Object.prototype.toString.call(t)||t instanceof Date}function _(t,e,i){var s,o=Math.min(t.length,e.length),n=Math.abs(t.length-e.length),r=0;for(s=0;o>s;s++)(i&&t[s]!==e[s]||!i&&w(t[s])!==w(e[s]))&&r++;return r+n}function v(t){if(t){var e=t.toLowerCase().replace(/(.)s$/,"$1");t=Xe[t]||ti[e]||e}return t}function b(t){var e,i,s={};
for(i in t)t.hasOwnProperty(i)&&(e=v(i),e&&(s[e]=t[i]));return s}function y(t){var e,s;if(0===t.indexOf("week"))e=7,s="day";else{if(0!==t.indexOf("month"))return;e=12,s="month"}de[t]=function(o,n){var r,a,l=de.fn._lang[t],h=[];if("number"==typeof o&&(n=o,o=i),a=function(t){var e=de().utc().set(s,t);return l.call(de.fn._lang,e,o||"")},null!=n)return a(n);for(r=0;e>r;r++)h.push(a(r));return h}}function w(t){var e=+t,i=0;return 0!==e&&isFinite(e)&&(i=e>=0?Math.floor(e):Math.ceil(e)),i}function x(t,e){return new Date(Date.UTC(t,e+1,0)).getUTCDate()}function k(t,e,i){return te(de([t,11,31+e-i]),e,i).week}function C(t){return S(t)?366:365}function S(t){return t%4===0&&t%100!==0||t%400===0}function T(t){var e;t._a&&-2===t._pf.overflow&&(e=t._a[_e]<0||t._a[_e]>11?_e:t._a[ve]<1||t._a[ve]>x(t._a[fe],t._a[_e])?ve:t._a[be]<0||t._a[be]>23?be:t._a[ye]<0||t._a[ye]>59?ye:t._a[we]<0||t._a[we]>59?we:t._a[xe]<0||t._a[xe]>999?xe:-1,t._pf._overflowDayOfYear&&(fe>e||e>ve)&&(e=ve),t._pf.overflow=e)}function $(t){return null==t._isValid&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&0===t._pf.charsLeftOver&&0===t._pf.unusedTokens.length)),t._isValid}function E(t){return t?t.toLowerCase().replace("_","-"):t}function j(t,e){return e._isUTC?de(t).zone(e._offset||0):de(t).local()}function F(t,e){return e.abbr=t,ke[t]||(ke[t]=new a),ke[t].set(e),ke[t]}function R(t){delete ke[t]}function P(e){var i,s,o,n,r=0,a=function(e){if(!ke[e]&&Se)try{t("./lang/"+e)}catch(i){}return ke[e]};if(!e)return de.fn._lang;if(!g(e)){if(s=a(e))return s;e=[e]}for(;r<e.length;){for(n=E(e[r]).split("-"),i=n.length,o=E(e[r+1]),o=o?o.split("-"):null;i>0;){if(s=a(n.slice(0,i).join("-")))return s;if(o&&o.length>=i&&_(n,o,!0)>=i-1)break;i--}r++}return de.fn._lang}function U(t){return t.match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function D(t){var e,i,s=t.match(je);for(e=0,i=s.length;i>e;e++)s[e]=oi[s[e]]?oi[s[e]]:U(s[e]);return function(o){var n="";for(e=0;i>e;e++)n+=s[e]instanceof Function?s[e].call(o,t):s[e];return n}}function M(t,e){return t.isValid()?(e=A(e,t.lang()),ei[e]||(ei[e]=D(e)),ei[e](t)):t.lang().invalidDate()}function A(t,e){function i(t){return e.longDateFormat(t)||t}var s=5;for(Fe.lastIndex=0;s>=0&&Fe.test(t);)t=t.replace(Fe,i),Fe.lastIndex=0,s-=1;return t}function L(t,e){var i,s=e._strict;switch(t){case"Q":return Be;case"DDDD":return Ne;case"YYYY":case"GGGG":case"gggg":return s?Ve:Ue;case"Y":case"G":case"g":return Ke;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return s?He:De;case"S":if(s)return Be;case"SS":if(s)return qe;case"SSS":if(s)return Ne;case"DDD":return Pe;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Ae;case"a":case"A":return P(e._l)._meridiemParse;case"X":return Ie;case"Z":case"ZZ":return Le;case"T":return Oe;case"SSSS":return Me;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return s?qe:Re;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return Re;case"Do":return ze;default:return i=new RegExp(H(V(t.replace("\\","")),"i"))}}function O(t){t=t||"";var e=t.match(Le)||[],i=e[e.length-1]||[],s=(i+"").match(Qe)||["-",0,0],o=+(60*s[1])+w(s[2]);return"+"===s[0]?-o:o}function I(t,e,i){var s,o=i._a;switch(t){case"Q":null!=e&&(o[_e]=3*(w(e)-1));break;case"M":case"MM":null!=e&&(o[_e]=w(e)-1);break;case"MMM":case"MMMM":s=P(i._l).monthsParse(e),null!=s?o[_e]=s:i._pf.invalidMonth=e;break;case"D":case"DD":null!=e&&(o[ve]=w(e));break;case"Do":null!=e&&(o[ve]=w(parseInt(e,10)));break;case"DDD":case"DDDD":null!=e&&(i._dayOfYear=w(e));break;case"YY":o[fe]=de.parseTwoDigitYear(e);break;case"YYYY":case"YYYYY":case"YYYYYY":o[fe]=w(e);break;case"a":case"A":i._isPm=P(i._l).isPM(e);break;case"H":case"HH":case"h":case"hh":o[be]=w(e);break;case"m":case"mm":o[ye]=w(e);break;case"s":case"ss":o[we]=w(e);break;case"S":case"SS":case"SSS":case"SSSS":o[xe]=w(1e3*("0."+e));break;case"X":i._d=new Date(1e3*parseFloat(e));break;case"Z":case"ZZ":i._useUTC=!0,i._tzm=O(e);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":t=t.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":t=t.substr(0,2),e&&(i._w=i._w||{},i._w[t]=e)}}function z(t){var e,i,s,o,n,r,a,l,h,d,c=[];if(!t._d){for(s=q(t),t._w&&null==t._a[ve]&&null==t._a[_e]&&(n=function(e){var i=parseInt(e,10);return e?e.length<3?i>68?1900+i:2e3+i:i:null==t._a[fe]?de().weekYear():t._a[fe]},r=t._w,null!=r.GG||null!=r.W||null!=r.E?a=ee(n(r.GG),r.W||1,r.E,4,1):(l=P(t._l),h=null!=r.d?Q(r.d,l):null!=r.e?parseInt(r.e,10)+l._week.dow:0,d=parseInt(r.w,10)||1,null!=r.d&&h<l._week.dow&&d++,a=ee(n(r.gg),d,h,l._week.doy,l._week.dow)),t._a[fe]=a.year,t._dayOfYear=a.dayOfYear),t._dayOfYear&&(o=null==t._a[fe]?s[fe]:t._a[fe],t._dayOfYear>C(o)&&(t._pf._overflowDayOfYear=!0),i=J(o,0,t._dayOfYear),t._a[_e]=i.getUTCMonth(),t._a[ve]=i.getUTCDate()),e=0;3>e&&null==t._a[e];++e)t._a[e]=c[e]=s[e];for(;7>e;e++)t._a[e]=c[e]=null==t._a[e]?2===e?1:0:t._a[e];c[be]+=w((t._tzm||0)/60),c[ye]+=w((t._tzm||0)%60),t._d=(t._useUTC?J:Y).apply(null,c)}}function B(t){var e;t._d||(e=b(t._i),t._a=[e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond],z(t))}function q(t){var e=new Date;return t._useUTC?[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]:[e.getFullYear(),e.getMonth(),e.getDate()]}function N(t){t._a=[],t._pf.empty=!0;var e,i,s,o,n,r=P(t._l),a=""+t._i,l=a.length,h=0;for(s=A(t._f,r).match(je)||[],e=0;e<s.length;e++)o=s[e],i=(a.match(L(o,t))||[])[0],i&&(n=a.substr(0,a.indexOf(i)),n.length>0&&t._pf.unusedInput.push(n),a=a.slice(a.indexOf(i)+i.length),h+=i.length),oi[o]?(i?t._pf.empty=!1:t._pf.unusedTokens.push(o),I(o,i,t)):t._strict&&!i&&t._pf.unusedTokens.push(o);t._pf.charsLeftOver=l-h,a.length>0&&t._pf.unusedInput.push(a),t._isPm&&t._a[be]<12&&(t._a[be]+=12),t._isPm===!1&&12===t._a[be]&&(t._a[be]=0),z(t),T(t)}function V(t){return t.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(t,e,i,s,o){return e||i||s||o})}function H(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function K(t){var e,i,o,n,r;if(0===t._f.length)return t._pf.invalidFormat=!0,void(t._d=new Date(0/0));for(n=0;n<t._f.length;n++)r=0,e=d({},t),e._pf=s(),e._f=t._f[n],N(e),$(e)&&(r+=e._pf.charsLeftOver,r+=10*e._pf.unusedTokens.length,e._pf.score=r,(null==o||o>r)&&(o=r,i=e));d(t,i||e)}function W(t){var e,i,s=t._i,o=We.exec(s);if(o){for(t._pf.iso=!0,e=0,i=Ye.length;i>e;e++)if(Ye[e][1].exec(s)){t._f=Ye[e][0]+(o[6]||" ");break}for(e=0,i=Je.length;i>e;e++)if(Je[e][1].exec(s)){t._f+=Je[e][0];break}s.match(Le)&&(t._f+="Z"),N(t)}else de.createFromInputFallback(t)}function G(t){var e=t._i,s=Te.exec(e);e===i?t._d=new Date:s?t._d=new Date(+s[1]):"string"==typeof e?W(t):g(e)?(t._a=e.slice(0),z(t)):f(e)?t._d=new Date(+e):"object"==typeof e?B(t):"number"==typeof e?t._d=new Date(e):de.createFromInputFallback(t)}function Y(t,e,i,s,o,n,r){var a=new Date(t,e,i,s,o,n,r);return 1970>t&&a.setFullYear(t),a}function J(t){var e=new Date(Date.UTC.apply(null,arguments));return 1970>t&&e.setUTCFullYear(t),e}function Q(t,e){if("string"==typeof t)if(isNaN(t)){if(t=e.weekdaysParse(t),"number"!=typeof t)return null}else t=parseInt(t,10);return t}function Z(t,e,i,s,o){return o.relativeTime(e||1,!!i,t,s)}function X(t,e,i){var s=ge(Math.abs(t)/1e3),o=ge(s/60),n=ge(o/60),r=ge(n/24),a=ge(r/365),l=45>s&&["s",s]||1===o&&["m"]||45>o&&["mm",o]||1===n&&["h"]||22>n&&["hh",n]||1===r&&["d"]||25>=r&&["dd",r]||45>=r&&["M"]||345>r&&["MM",ge(r/30)]||1===a&&["y"]||["yy",a];return l[2]=e,l[3]=t>0,l[4]=i,Z.apply({},l)}function te(t,e,i){var s,o=i-e,n=i-t.day();return n>o&&(n-=7),o-7>n&&(n+=7),s=de(t).add("d",n),{week:Math.ceil(s.dayOfYear()/7),year:s.year()}}function ee(t,e,i,s,o){var n,r,a=J(t,0,1).getUTCDay();return i=null!=i?i:o,n=o-a+(a>s?7:0)-(o>a?7:0),r=7*(e-1)+(i-o)+n+1,{year:r>0?t:t-1,dayOfYear:r>0?r:C(t-1)+r}}function ie(t){var e=t._i,s=t._f;return null===e||s===i&&""===e?de.invalid({nullInput:!0}):("string"==typeof e&&(t._i=e=P().preparse(e)),de.isMoment(e)?(t=c(e),t._d=new Date(+e._d)):s?g(s)?K(t):N(t):G(t),new l(t))}function se(t,e){var i;return"string"==typeof e&&(e=t.lang().monthsParse(e),"number"!=typeof e)?t:(i=Math.min(t.date(),x(t.year(),e)),t._d["set"+(t._isUTC?"UTC":"")+"Month"](e,i),t)}function oe(t,e){return t._d["get"+(t._isUTC?"UTC":"")+e]()}function ne(t,e,i){return"Month"===e?se(t,i):t._d["set"+(t._isUTC?"UTC":"")+e](i)}function re(t,e){return function(i){return null!=i?(ne(this,t,i),de.updateOffset(this,e),this):oe(this,t)}}function ae(t){de.duration.fn[t]=function(){return this._data[t]}}function le(t,e){de.duration.fn["as"+t]=function(){return+this/e}}function he(t){"undefined"==typeof ender&&(ce=me.moment,me.moment=t?o("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",de):de)}for(var de,ce,ue,pe="2.6.0",me="undefined"!=typeof global?global:this,ge=Math.round,fe=0,_e=1,ve=2,be=3,ye=4,we=5,xe=6,ke={},Ce={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},Se="undefined"!=typeof e&&e.exports,Te=/^\/?Date\((\-?\d+)/i,$e=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Ee=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,je=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,Fe=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,Re=/\d\d?/,Pe=/\d{1,3}/,Ue=/\d{1,4}/,De=/[+\-]?\d{1,6}/,Me=/\d+/,Ae=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Le=/Z|[\+\-]\d\d:?\d\d/gi,Oe=/T/i,Ie=/[\+\-]?\d+(\.\d{1,3})?/,ze=/\d{1,2}/,Be=/\d/,qe=/\d\d/,Ne=/\d{3}/,Ve=/\d{4}/,He=/[+-]?\d{6}/,Ke=/[+-]?\d+/,We=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Ge="YYYY-MM-DDTHH:mm:ssZ",Ye=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],Je=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Qe=/([\+\-]|\d\d)/gi,Ze=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),Xe={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},ti={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},ei={},ii="DDD w W M D d".split(" "),si="M D H h m s w W".split(" "),oi={M:function(){return this.month()+1},MMM:function(t){return this.lang().monthsShort(this,t)},MMMM:function(t){return this.lang().months(this,t)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(t){return this.lang().weekdaysMin(this,t)},ddd:function(t){return this.lang().weekdaysShort(this,t)},dddd:function(t){return this.lang().weekdays(this,t)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return p(this.year()%100,2)},YYYY:function(){return p(this.year(),4)},YYYYY:function(){return p(this.year(),5)},YYYYYY:function(){var t=this.year(),e=t>=0?"+":"-";return e+p(Math.abs(t),6)},gg:function(){return p(this.weekYear()%100,2)},gggg:function(){return p(this.weekYear(),4)},ggggg:function(){return p(this.weekYear(),5)},GG:function(){return p(this.isoWeekYear()%100,2)},GGGG:function(){return p(this.isoWeekYear(),4)},GGGGG:function(){return p(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return w(this.milliseconds()/100)},SS:function(){return p(w(this.milliseconds()/10),2)},SSS:function(){return p(this.milliseconds(),3)},SSSS:function(){return p(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+p(w(t/60),2)+":"+p(w(t)%60,2)},ZZ:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+p(w(t/60),2)+p(w(t)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},ni=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];ii.length;)ue=ii.pop(),oi[ue+"o"]=r(oi[ue],ue);for(;si.length;)ue=si.pop(),oi[ue+ue]=n(oi[ue],2);for(oi.DDDD=n(oi.DDD,3),d(a.prototype,{set:function(t){var e,i;for(i in t)e=t[i],"function"==typeof e?this[i]=e:this["_"+i]=e},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(t){return this._months[t.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(t){return this._monthsShort[t.month()]},monthsParse:function(t){var e,i,s;for(this._monthsParse||(this._monthsParse=[]),e=0;12>e;e++)if(this._monthsParse[e]||(i=de.utc([2e3,e]),s="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[e]=new RegExp(s.replace(".",""),"i")),this._monthsParse[e].test(t))return e},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(t){return this._weekdays[t.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(t){return this._weekdaysShort[t.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(t){return this._weekdaysMin[t.day()]},weekdaysParse:function(t){var e,i,s;for(this._weekdaysParse||(this._weekdaysParse=[]),e=0;7>e;e++)if(this._weekdaysParse[e]||(i=de([2e3,1]).day(e),s="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[e]=new RegExp(s.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(t){var e=this._longDateFormat[t];return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t]=e),e},isPM:function(t){return"p"===(t+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(t,e,i){return t>11?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(t,e){var i=this._calendar[t];return"function"==typeof i?i.apply(e):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(t,e,i,s){var o=this._relativeTime[i];return"function"==typeof o?o(t,e,i,s):o.replace(/%d/i,t)},pastFuture:function(t,e){var i=this._relativeTime[t>0?"future":"past"];return"function"==typeof i?i(e):i.replace(/%s/i,e)},ordinal:function(t){return this._ordinal.replace("%d",t)},_ordinal:"%d",preparse:function(t){return t},postformat:function(t){return t},week:function(t){return te(t,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),de=function(t,e,o,n){var r;return"boolean"==typeof o&&(n=o,o=i),r={},r._isAMomentObject=!0,r._i=t,r._f=e,r._l=o,r._strict=n,r._isUTC=!1,r._pf=s(),ie(r)},de.suppressDeprecationWarnings=!1,de.createFromInputFallback=o("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(t){t._d=new Date(t._i)}),de.utc=function(t,e,o,n){var r;return"boolean"==typeof o&&(n=o,o=i),r={},r._isAMomentObject=!0,r._useUTC=!0,r._isUTC=!0,r._l=o,r._i=t,r._f=e,r._strict=n,r._pf=s(),ie(r).utc()},de.unix=function(t){return de(1e3*t)},de.duration=function(t,e){var i,s,o,n=t,r=null;return de.isDuration(t)?n={ms:t._milliseconds,d:t._days,M:t._months}:"number"==typeof t?(n={},e?n[e]=t:n.milliseconds=t):(r=$e.exec(t))?(i="-"===r[1]?-1:1,n={y:0,d:w(r[ve])*i,h:w(r[be])*i,m:w(r[ye])*i,s:w(r[we])*i,ms:w(r[xe])*i}):(r=Ee.exec(t))&&(i="-"===r[1]?-1:1,o=function(t){var e=t&&parseFloat(t.replace(",","."));return(isNaN(e)?0:e)*i},n={y:o(r[2]),M:o(r[3]),d:o(r[4]),h:o(r[5]),m:o(r[6]),s:o(r[7]),w:o(r[8])}),s=new h(n),de.isDuration(t)&&t.hasOwnProperty("_lang")&&(s._lang=t._lang),s},de.version=pe,de.defaultFormat=Ge,de.momentProperties=Ce,de.updateOffset=function(){},de.lang=function(t,e){var i;return t?(e?F(E(t),e):null===e?(R(t),t="en"):ke[t]||P(t),i=de.duration.fn._lang=de.fn._lang=P(t),i._abbr):de.fn._lang._abbr},de.langData=function(t){return t&&t._lang&&t._lang._abbr&&(t=t._lang._abbr),P(t)},de.isMoment=function(t){return t instanceof l||null!=t&&t.hasOwnProperty("_isAMomentObject")},de.isDuration=function(t){return t instanceof h},ue=ni.length-1;ue>=0;--ue)y(ni[ue]);de.normalizeUnits=function(t){return v(t)},de.invalid=function(t){var e=de.utc(0/0);return null!=t?d(e._pf,t):e._pf.userInvalidated=!0,e},de.parseZone=function(){return de.apply(null,arguments).parseZone()},de.parseTwoDigitYear=function(t){return w(t)+(w(t)>68?1900:2e3)},d(de.fn=l.prototype,{clone:function(){return de(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var t=de(this).utc();return 0<t.year()&&t.year()<=9999?M(t,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):M(t,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()]},isValid:function(){return $(this)},isDSTShifted:function(){return this._a?this.isValid()&&_(this._a,(this._isUTC?de.utc(this._a):de(this._a)).toArray())>0:!1},parsingFlags:function(){return d({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(t){var e=M(this,t||de.defaultFormat);return this.lang().postformat(e)},add:function(t,e){var i;return i="string"==typeof t?de.duration(+e,t):de.duration(t,e),m(this,i,1),this},subtract:function(t,e){var i;return i="string"==typeof t?de.duration(+e,t):de.duration(t,e),m(this,i,-1),this},diff:function(t,e,i){var s,o,n=j(t,this),r=6e4*(this.zone()-n.zone());return e=v(e),"year"===e||"month"===e?(s=432e5*(this.daysInMonth()+n.daysInMonth()),o=12*(this.year()-n.year())+(this.month()-n.month()),o+=(this-de(this).startOf("month")-(n-de(n).startOf("month")))/s,o-=6e4*(this.zone()-de(this).startOf("month").zone()-(n.zone()-de(n).startOf("month").zone()))/s,"year"===e&&(o/=12)):(s=this-n,o="second"===e?s/1e3:"minute"===e?s/6e4:"hour"===e?s/36e5:"day"===e?(s-r)/864e5:"week"===e?(s-r)/6048e5:s),i?o:u(o)},from:function(t,e){return de.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)},fromNow:function(t){return this.from(de(),t)},calendar:function(){var t=j(de(),this).startOf("day"),e=this.diff(t,"days",!0),i=-6>e?"sameElse":-1>e?"lastWeek":0>e?"lastDay":1>e?"sameDay":2>e?"nextDay":7>e?"nextWeek":"sameElse";return this.format(this.lang().calendar(i,this))},isLeapYear:function(){return S(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?(t=Q(t,this.lang()),this.add({d:t-e})):e},month:re("Month",!0),startOf:function(t){switch(t=v(t)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===t?this.weekday(0):"isoWeek"===t&&this.isoWeekday(1),"quarter"===t&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(t){return t=v(t),this.startOf(t).add("isoWeek"===t?"week":t,1).subtract("ms",1)},isAfter:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)>+de(t).startOf(e)},isBefore:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)<+de(t).startOf(e)},isSame:function(t,e){return e=e||"ms",+this.clone().startOf(e)===+j(t,this).startOf(e)},min:function(t){return t=de.apply(null,arguments),this>t?this:t},max:function(t){return t=de.apply(null,arguments),t>this?this:t},zone:function(t,e){var i=this._offset||0;return null==t?this._isUTC?i:this._d.getTimezoneOffset():("string"==typeof t&&(t=O(t)),Math.abs(t)<16&&(t=60*t),this._offset=t,this._isUTC=!0,i!==t&&(!e||this._changeInProgress?m(this,de.duration(i-t,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,de.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(t){return t=t?de(t).zone():0,(this.zone()-t)%60===0},daysInMonth:function(){return x(this.year(),this.month())},dayOfYear:function(t){var e=ge((de(this).startOf("day")-de(this).startOf("year"))/864e5)+1;return null==t?e:this.add("d",t-e)},quarter:function(t){return null==t?Math.ceil((this.month()+1)/3):this.month(3*(t-1)+this.month()%3)},weekYear:function(t){var e=te(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==t?e:this.add("y",t-e)},isoWeekYear:function(t){var e=te(this,1,4).year;return null==t?e:this.add("y",t-e)},week:function(t){var e=this.lang().week(this);return null==t?e:this.add("d",7*(t-e))},isoWeek:function(t){var e=te(this,1,4).week;return null==t?e:this.add("d",7*(t-e))},weekday:function(t){var e=(this.day()+7-this.lang()._week.dow)%7;return null==t?e:this.add("d",t-e)},isoWeekday:function(t){return null==t?this.day()||7:this.day(this.day()%7?t:t-7)},isoWeeksInYear:function(){return k(this.year(),1,4)},weeksInYear:function(){var t=this._lang._week;return k(this.year(),t.dow,t.doy)},get:function(t){return t=v(t),this[t]()},set:function(t,e){return t=v(t),"function"==typeof this[t]&&this[t](e),this},lang:function(t){return t===i?this._lang:(this._lang=P(t),this)}}),de.fn.millisecond=de.fn.milliseconds=re("Milliseconds",!1),de.fn.second=de.fn.seconds=re("Seconds",!1),de.fn.minute=de.fn.minutes=re("Minutes",!1),de.fn.hour=de.fn.hours=re("Hours",!0),de.fn.date=re("Date",!0),de.fn.dates=o("dates accessor is deprecated. Use date instead.",re("Date",!0)),de.fn.year=re("FullYear",!0),de.fn.years=o("years accessor is deprecated. Use year instead.",re("FullYear",!0)),de.fn.days=de.fn.day,de.fn.months=de.fn.month,de.fn.weeks=de.fn.week,de.fn.isoWeeks=de.fn.isoWeek,de.fn.quarters=de.fn.quarter,de.fn.toJSON=de.fn.toISOString,d(de.duration.fn=h.prototype,{_bubble:function(){var t,e,i,s,o=this._milliseconds,n=this._days,r=this._months,a=this._data;a.milliseconds=o%1e3,t=u(o/1e3),a.seconds=t%60,e=u(t/60),a.minutes=e%60,i=u(e/60),a.hours=i%24,n+=u(i/24),a.days=n%30,r+=u(n/30),a.months=r%12,s=u(r/12),a.years=s},weeks:function(){return u(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*w(this._months/12)},humanize:function(t){var e=+this,i=X(e,!t,this.lang());return t&&(i=this.lang().pastFuture(e,i)),this.lang().postformat(i)},add:function(t,e){var i=de.duration(t,e);return this._milliseconds+=i._milliseconds,this._days+=i._days,this._months+=i._months,this._bubble(),this},subtract:function(t,e){var i=de.duration(t,e);return this._milliseconds-=i._milliseconds,this._days-=i._days,this._months-=i._months,this._bubble(),this},get:function(t){return t=v(t),this[t.toLowerCase()+"s"]()},as:function(t){return t=v(t),this["as"+t.charAt(0).toUpperCase()+t.slice(1)+"s"]()},lang:de.fn.lang,toIsoString:function(){var t=Math.abs(this.years()),e=Math.abs(this.months()),i=Math.abs(this.days()),s=Math.abs(this.hours()),o=Math.abs(this.minutes()),n=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(t?t+"Y":"")+(e?e+"M":"")+(i?i+"D":"")+(s||o||n?"T":"")+(s?s+"H":"")+(o?o+"M":"")+(n?n+"S":""):"P0D"}});for(ue in Ze)Ze.hasOwnProperty(ue)&&(le(ue,Ze[ue]),ae(ue.toLowerCase()));le("Weeks",6048e5),de.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},de.lang("en",{ordinal:function(t){var e=t%10,i=1===w(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+i}}),Se?e.exports=de:"function"==typeof define&&define.amd?(define("moment",function(t,e,i){return i.config&&i.config()&&i.config().noGlobal===!0&&(me.moment=ce),de}),he(!0)):he()}).call(this)},{}],334:[function(t,e){var i=document.createElement("style");document.head.appendChild(i);var s=i.styleSheet?function(t){i.styleSheet.cssText=t}:function(t){for(;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(document.createTextNode(t))},o=function(t){return s(i.innerHTML.replace(t,""))};e.exports.style=i,e.exports.inject=s,e.exports.eject=o},{}],335:[function(t,e){!function(t){t(function(t){var e=t("./when"),i=e.Promise.all,s=Array.prototype.slice;return function(t){function o(t){return n.push(t),n}var n=[];return i(s.call(arguments,1)).then(function(i){return e.reduce(t,function(t,s){return e(s.apply(void 0,i),o)},n)})}})}("function"==typeof define&&define.amd?define:function(i){e.exports=i(t)})},{"./when":"RG2dij"}]},{},[]);